var LiveViewMediaControl=function LiveViewMediaControl(a){LiveViewControlBase.call(this,a)},_MC=LiveViewMediaControl;if(typeof LiveViewMediaControlScriptData=="undefined")LiveViewMediaControlScriptData={};var _MCD=LiveViewMediaControlScriptData,_requiredSilverlightVersion=InboxPage.Config.requiredSilverlightVersion,_isSilverlightSupportedBrowser=Silverlight.supportedUserAgent(_requiredSilverlightVersion),_isSilverlightInstalled=Silverlight.isInstalled(_requiredSilverlightVersion);_MC._ITEM_NAME=0;_MC._ITEM_TYPE=1;_MC._ITEM_MEDIA_STRIP_THUMB_URL=2;_MC._ITEM_SLIDESHOW_MAIN_ASSET_URL=3;_MC._ITEM_SLIDESHOW_MAIN_ASSET_WIDTH=4;_MC._ITEM_SLIDESHOW_MAIN_ASSET_HEIGHT=5;_MC._ITEM_SLIDESHOW_THUMB_URL=6;_MC._ITEM_SLIDESHOW_THUMB_WIDTH=7;_MC._ITEM_SLIDESHOW_THUMB_HEIGHT=8;_MC._ITEM_ATTACHMENT_DOWNLOAD_SIZE=9;_MC._ITEM_ATTACHMENT_INDEX=10;_MC._ITEM_ATTACHMENT_DEPTH=11;_MC._ITEM_ATTACHMENT_STATE=12;_MC._MAX_THUMB_WIDTH=220;_MC._MAX_THUMB_HEIGHT=160;_MC._MIN_THUMB_WIDTH=90;_MC._MIN_THUMB_HEIGHT=40;_MC._ITEM_TYPE_PHOTO="Photo";_MC._ITEM_TYPE_VIDEO="Video";_MC._ITEM_TYPE_AUDIO="Audio";_MC._ITEM_TYPE_OFFICEDOC="OfficeDoc";_MC._ITEM_TYPE_GENERICFILE="GenericFile";_MC._ATTACHMENT_STATE_NONE="None";_MC._ATTACHMENT_STATE_BLOCKED="Blocked";_MC._ATTACHMENT_STATE_BROWSER_DISPLAY_ALLOWED="BrowserDisplayAllowed";_MC._ATTACHMENT_STATE_BROWSER_DISPLAY_DISALLOWED="BrowserDisplayDisallowed";_MC._CLICK_MORE="more";_MC._CLICK_GO_TO="go_to";_MC._CLICK_SLIDESHOW="slideshow";_MC._CLICK_DOWNLOAD_ALL="download_all";_MC._CLICK_ITEM="item";_MC._CLICK_DOWNLOAD_ITEM="download";_MC._CLICK_FILENAME="filename";_MC._CLICK_THUMBNAIL="thumbnail";_MC._CLICK_PLAY_AUDIO="play";_MC._CLICK_VIEW_DOC="wac";_MC._DISTANCE_BETWEEN_ITEMS=10;_MC._IMG_LOADER_TIMEOUT=50;_MC._MAX_TRIES=10;_MC._LOADING_STATE_NOT_LOADED=0;_MC._LOADING_STATE_LOADED_FAILED=1;_MC._LOADING_STATE_LOADED_SUCCESSFUL=2;_MC._PHOTO_ADDITIONAL_WIDTH=(2+1)*2;LiveViewMediaControl.prototype={};var __p=LiveViewMediaControl.prototype;__p.initialize=function LiveViewMediaControl$initialize(){this.callBase(LiveViewControlBase,"initialize");this.behavior=LiveViewMediaControl[this.elt.getAttribute("b")+"Behavior"];this.behavior.rtlMark=this.elt.getAttribute("rtlMark");this.nonPhotoThumbWidth=parseInt(this.elt.getAttribute("nptw"));this.nonPhotoThumbHeight=parseInt(this.elt.getAttribute("npth"));var mediaItems=this.elt.getAttribute("mi");this.mediaItems=eval(mediaItems);for(var ii=0;ii<this.mediaItems.length;ii++){var currentItem=this.mediaItems[ii];currentItem[LiveViewMediaControl._ITEM_MEDIA_STRIP_THUMB_URL]=Page.decode(currentItem[LiveViewMediaControl._ITEM_MEDIA_STRIP_THUMB_URL]);currentItem[LiveViewMediaControl._ITEM_SLIDESHOW_MAIN_ASSET_URL]=Page.decode(currentItem[LiveViewMediaControl._ITEM_SLIDESHOW_MAIN_ASSET_URL]);currentItem[LiveViewMediaControl._ITEM_SLIDESHOW_THUMB_URL]=Page.decode(currentItem[LiveViewMediaControl._ITEM_SLIDESHOW_THUMB_URL]);currentItem.status=LiveViewMediaControl._LOADING_STATE_NOT_LOADED;currentItem.imgLoader=null;currentItem.imgLoaderDelegate=null;currentItem.imgLoaderFailureDelegate=null;currentItem.imgLoaderDelegateCount=0;currentItem.index=ii;if(this.behavior&&this.behavior.initializeItem)this.behavior.initializeItem(currentItem,this)}this.totalItems=this.mediaItems?this.mediaItems.length:0;this.currentItemIndex=0;this.numVisibleItems=0;this.numRemainingItems=-1;this.moreLinkString=this.elt.getAttribute("mls");this.moreLinkUrl=this.elt.getAttribute("mlu");this.appLogoLink=Page.decode(this.elt.getAttribute("hmurl"));this.appLogoToolTip=this.elt.getAttribute("hmttip");this._resizeHandler=$CD(this,this._onResize);window.attachEvent("onresize",this._resizeHandler);this._onClickMoreHandler=$CD(this,function(){this._onLinkClick("more")});this._mouseOverHandler=$CD(this,this._onItemMouseOver);this.elt.attachEvent("onmouseover",this._mouseOverHandler);this._mouseOutHandler=$CD(this,this._onItemMouseOut);this.elt.attachEvent("onmouseout",this._mouseOutHandler);this.shouldAdjustMediaStripParentforIE6=true;this.slideshowAssetList=null;this.mediaItemIndexToSlideshowAssetIndexMap={};var renderMediaStrip=true,attList=$(this.elt.id+"_attachmentList");if(attList!=null)if($getDisplay(attList))renderMediaStrip=false;if(renderMediaStrip){this._renderItems();this._renderViewSlideshowLink()}};__p.dispose=function LiveViewMediaControl$dispose(){window.detachEvent("onresize",this._resizeHandler);window.detachEvent("onmouseover",this._mouseOverHandler);window.detachEvent("onmouseout",this._mouseOutHandler);for(var a=0;a<this.mediaItems.length;a++){var b=this.mediaItems[a];if(this.behavior&&this.behavior.disposeItem)this.behavior.disposeItem(b)}this.callBase(LiveViewControlBase,"dispose")};__p._hasMoreLink=function LiveViewMediaControl$_hasMoreLink(){return this.moreLinkString&&this.moreLinkString.length>0&&(this.moreLinkUrl&&this.moreLinkUrl.length>0)};__p._renderViewSlideshowLink=function LiveViewMediaControl$_renderViewSlideshowLink(){if(_isSilverlightSupportedBrowser){var a=$(this.elt.id+"_slideshowLinkContainer"),b=$(this.elt.id+"_pipeContainer");if(a){$setDisplay(a,true);this.viewSlideshowLinkShown=true}if(b)$setDisplay(b,true)}};__p._renderItems=function LiveViewMediaControl$_renderItems(o){if(this.isRendering){this.needsAnotherRender=true;return}var f=$(this.elt.id+"_ms"),e=0;if(this.totalItems){var i=0,j=0;if(f){j=this._getAvailableSpace();if(Browser.isIE6)if(this.shouldAdjustMediaStripParentforIE6){f.parentElement.style.width=j+"px";this.shouldAdjustMediaStripParentforIE6=false}e=this._computeVisibleItems(j,this.currentItemIndex,true);var h=this.totalItems-this.currentItemIndex,k=h<=Math.ceil(e);if(o&&(Math.floor(e)==this.numVisibleItems&&this.numRemainingItems==h))return;this.numVisibleItems=Math.floor(e);this.numRemainingItems=h;this.isRendering=true;var n=k?h:Math.ceil(e);f.innerHTML="";for(var g=0;g<n;g++){var a=this.mediaItems[g+this.currentItemIndex],d=_ce("div");d.className="MediaItemContainer";d.setAttribute("index",g+this.currentItemIndex);if(_MCD.sutraThumbnail)d.setAttribute("sutra",_MCD.sutraThumbnail);this._renderItem(a,d);f.appendChild(d);d=null;if(a.status==LiveViewMediaControl._LOADING_STATE_NOT_LOADED)if(a.imgLoader==null){a.imgLoaderDelegate=$CD(this,function(a){return function(){this._onThumbLoad(a)}}(g+this.currentItemIndex));a.imgLoaderFailureDelegate=$CD(this,function(a){return function(){this._onThumbFailure(a)}}(g+this.currentItemIndex));a.imgLoader=LiveViews.setupImageFetch(a.imgLoaderDelegate,a.imgLoaderFailureDelegate,null);a.imgLoader.src=a[LiveViewMediaControl._ITEM_MEDIA_STRIP_THUMB_URL]}i+=this._getItemWidth(a)+4;i+=LiveViewMediaControl._DISTANCE_BETWEEN_ITEMS}if(k)if(this._hasMoreLink()){var c=_ce("div");$css.add(c,"MoreLinkContainer");$css.add(c,"FloatLeft");c.style.paddingTop=Math.floor(LiveViewMediaControl._MAX_THUMB_HEIGHT/2)-5+"px";var b=_ce("a");if(_MCD.sutraMore)b.setAttribute("sutra",_MCD.sutraMore);b.href=this.moreLinkUrl;b.target="_blank";b.innerText=this.moreLinkString;b.onclick=this._onClickMoreHandler;c.appendChild(b);f.appendChild(c);c=null;b=null}f.style.width=i+(this._hasMoreLink()?LiveViewMediaControl._MAX_THUMB_WIDTH:0)+"px"}}var l=this.totalItems>0&&this.currentItemIndex>0,m=this.totalItems-this.currentItemIndex+(this._hasMoreLink()?1:0)>=Math.ceil(e)&&i>j;this._setNavControlEnabled("p",l);this._setNavControlEnabled("n",m);this.isRendering=false;if(this.needsAnotherRender){this.needsAnotherRender=false;this._renderItems()}};__p._renderItem=function LiveViewMediaControl$renderItem(b,a){while(a.childNodes.length)a.removeChild(a.childNodes[0]);var c={continueProcessing:true};if(this.behavior&&this.behavior._renderItem)this.behavior._renderItem(b,a,this,c);if(c.continueProcessing){switch(b[LiveViewMediaControl._ITEM_TYPE]){case LiveViewMediaControl._ITEM_TYPE_PHOTO:case LiveViewMediaControl._ITEM_TYPE_VIDEO:this._renderPhotoOrVideo(b,a)}if(this.behavior&&this.behavior._postRenderItem)this.behavior._postRenderItem(b,a,this)}};__p._renderPhotoOrVideo=function LiveViewMediaControl$renderPhotoOrVideo(a,e){var d=_ce("div");$css.add(d,"MediaItem");$css.add(d,"Photo");var b=_ce("div");$css.add(b,"ThumbContainer");b.onclick=$CD(this,function(a){return function(){return this._onItemClick(a,LiveViewMediaControl._CLICK_ITEM)}}(a.index));var c=_ce("img");$css.add(c,"Thumb");c.title=c.alt=this.behavior&&this.behavior._getPhotoAndVideoTooltip?this.behavior._getPhotoAndVideoTooltip(a):a[LiveViewMediaControl._ITEM_NAME];if(a.status==LiveViewMediaControl._LOADING_STATE_LOADED_SUCCESSFUL){c.src=a[LiveViewMediaControl._ITEM_MEDIA_STRIP_THUMB_URL];c.style.width=b.style.width=a.thumbWidth+"px";c.style.height=b.style.height=a.thumbHeight+"px";if(a.thumbWidth<LiveViewMediaControl._MIN_THUMB_WIDTH||a.thumbHeight<LiveViewMediaControl._MIN_THUMB_HEIGHT){if(a.thumbWidth<LiveViewMediaControl._MIN_THUMB_WIDTH){b.style.paddingLeft=Math.floor((LiveViewMediaControl._MIN_THUMB_WIDTH-a.thumbWidth)/2)+"px";b.style.paddingRight=Math.ceil((LiveViewMediaControl._MIN_THUMB_WIDTH-a.thumbWidth)/2)+"px"}if(a.thumbHeight<LiveViewMediaControl._MIN_THUMB_HEIGHT){b.style.paddingTop=Math.floor((LiveViewMediaControl._MIN_THUMB_HEIGHT-a.thumbHeight)/2)+"px";b.style.paddingBottom=Math.ceil((LiveViewMediaControl._MIN_THUMB_HEIGHT-a.thumbHeight)/2)+"px"}e.style.marginTop=Math.floor((LiveViewMediaControl._MAX_THUMB_HEIGHT-Math.max(a.thumbHeight,LiveViewMediaControl._MIN_THUMB_HEIGHT))/2)+"px"}else e.style.marginTop=Math.floor((LiveViewMediaControl._MAX_THUMB_HEIGHT-a.thumbHeight)/2)+"px"}else{$css.add(c,a.status==LiveViewMediaControl._LOADING_STATE_NOT_LOADED?"Loading":"Failed");c.src=LiveViews.clearImgSrc;c.style.width=b.style.width=LiveViewMediaControl._MAX_THUMB_WIDTH+"px";c.style.height=b.style.height=LiveViewMediaControl._MAX_THUMB_HEIGHT+"px"}d.appendChild(b);b.appendChild(c);e.appendChild(d);d=null;b=null;c=null};__p._getAvailableSpace=function LiveViewMediaControl$_getAvailableSpace(){var a=0,b=$(this.elt.id+"_ms");if(b){a=b.parentElement.offsetWidth;if(Browser.isIE6)a=b.parentElement.parentElement.offsetWidth}return a};__p._computeVisibleItems=function LiveViewMediaControl$computeVisibleItems(f,g,e){var b=0,c=f,d=g;while(d!=(e?this.totalItems:0)){var h=this.mediaItems[d],a=this._getItemWidth(h);if(a&&c<=a){b+=c/a;break}c-=a+LiveViewMediaControl._DISTANCE_BETWEEN_ITEMS;b++;d+=e?1:-1}return b};__p._getItemWidth=function LiveViewMediaControl$getItemWidth(b){var a=0,c={continueProcessing:true};if(this.behavior&&this.behavior._getItemWidth)a=this.behavior._getItemWidth(b,this,c);if(c.continueProcessing)switch(b[LiveViewMediaControl._ITEM_TYPE]){case LiveViewMediaControl._ITEM_TYPE_PHOTO:case LiveViewMediaControl._ITEM_TYPE_VIDEO:if(b.status==LiveViewMediaControl._LOADING_STATE_LOADED_SUCCESSFUL)if(b.thumbWidth<LiveViewMediaControl._MIN_THUMB_WIDTH)a=LiveViewMediaControl._MIN_THUMB_WIDTH;else a=b.thumbWidth;else a=LiveViewMediaControl._MAX_THUMB_WIDTH;a+=LiveViewMediaControl._PHOTO_ADDITIONAL_WIDTH}return a};__p._adjustThumbnailDimensions=function LiveViewMediaControl$adjustThumbnailDimensions(a){if(!a.thumbDimensionsAdjusted){a.thumbDimensionsAdjusted=true;if(a.thumbHeight!=0&&a.thumbHeight!=0){if(a.thumbWidth>LiveViewMediaControl._MAX_THUMB_WIDTH){a.thumbHeight=Math.floor(a.thumbHeight*(LiveViewMediaControl._MAX_THUMB_WIDTH/a.thumbWidth));a.thumbWidth=LiveViewMediaControl._MAX_THUMB_WIDTH}if(a.thumbHeight>LiveViewMediaControl._MAX_THUMB_HEIGHT){a.thumbWidth=Math.floor(a.thumbWidth*(LiveViewMediaControl._MAX_THUMB_HEIGHT/a.thumbHeight));a.thumbHeight=LiveViewMediaControl._MAX_THUMB_HEIGHT}}}};__p._onThumbLoad=function LiveViewMediaControl$_onThumbLoad(a){this._onThumbLoadImpl(a,true)};__p._onThumbFailure=function LiveViewMediaControl$_onThumbFailure(a){this._onThumbLoadImpl(a,false)};__p._onThumbLoadImpl=function LiveViewMediaControl$_onThumbLoadImpl(b,d){var a=this.mediaItems[b];if(!(this.elt&&a&&a.imgLoader))return;a.status=d?LiveViewMediaControl._LOADING_STATE_LOADED_SUCCESSFUL:LiveViewMediaControl._LOADING_STATE_LOADED_FAILED;a.thumbWidth=a.imgLoader.width;a.thumbHeight=a.imgLoader.height;this._adjustThumbnailDimensions(a);a.imgLoader=null;if(b>=this.currentItemIndex&&b<this.currentItemIndex+this.numVisibleItems+1){var e=b-this.currentItemIndex,c=$(this.elt.id+"_ms");if(c&&e<c.children.length)for(var f=0;f<c.children.length;f++){var g=c.children[e];if(g.getAttribute("index")==b){a.imgLoaderDelegate=null;a.imgLoaderFailureDelegate=null;this._renderItems(false);return}}if(a.imgLoaderDelegateCount++<LiveViewMediaControl._MAX_TRIES)setTimeout(d?a.imgLoaderDelegate:a.imgLoaderFailureDelegate,LiveViewMediaControl._IMG_LOADER_TIMEOUT);else a.status=LiveViewMediaControl._LOADING_STATE_LOADED_FAILED}else{a.imgLoaderDelegate=null;a.imgLoaderFailureDelegate=null}};__p._setNavControlEnabled=function LiveViewMediaControl$setNavControlEnabled(a,b){if(b)$css.remove(this._getNavButton(a),"Disabled");else $css.add(this._getNavButton(a),"Disabled")};__p._getNavButton=function LiveViewMediaControl$_getNavButton(a){return $(this.elt.id+"_"+a+"b")};__p._onNavMouseOver=function LiveViewMediaControl$onNavMouseOver(a){this._suppressHistoryAndAds();$css.add(this._getNavButton(a),"Hover")};__p._onNavMouseOut=function LiveViewMediaControl$onNavMouseOut(b){this._suppressHistoryAndAds();var a=this._getNavButton(b);$css.remove(a,"Hover");$css.remove(a,"Down")};__p._onNavMouseDown=function LiveViewMediaControl$onNavMouseDown(a){this._suppressHistoryAndAds();$css.add(this._getNavButton(a),"Down")};__p._onNavMouseUp=function LiveViewMediaControl$onNavMouseUp(a){this._suppressHistoryAndAds();$css.remove(this._getNavButton(a),"Down")};__p._onClickPrevious=function LiveViewMediaControl$_onClickPrevious(){this._reportClick("Internal");if(this.currentItemIndex==0)return;var b=this._getAvailableSpace(),a=Math.floor(this._computeVisibleItems(b,this.currentItemIndex,false));this.currentItemIndex-=a?a:1;if(this.currentItemIndex<0)this.currentItemIndex=0;this._renderItems()};__p._onClickNext=function LiveViewMediaControl$_onClickNext(){this._reportClick("Internal");if(this.currentItemIndex>=this.totalItems-this.numVisibleItems+(this._hasMoreLink()?1:0))return;this.currentItemIndex+=this.numVisibleItems?this.numVisibleItems:1;if(this.currentItemIndex>=this.totalItems+(this._hasMoreLink()?1:0))this.currentItemIndex=this.totalItems-1;this._renderItems()};__p._onResize=function LiveViewMediaControl$_onResize(){this.shouldAdjustMediaStripParentforIE6=true;this._renderItems(true);SilverlightSlideshow.resize()};__p._onItemMouseOver=function LiveViewMediaControl$_onItemMouseOver(){var a=event.srcElement;while(a&&!$css.has(a,"MediaItem"))a=a.parentElement;if(a&&!$css.has(a,"NoHover"))$css.add(a,"Hover");a=event.srcElement;while(a&&!$css.has(a,"Overlay"))a=a.parentElement;if(a&&!$css.has(a,"NoHover"))$css.add(a,"Hover")};__p._onItemMouseOut=function LiveViewMediaControl$_onItemMouseOut(){var a=event.srcElement;while(a&&!$css.has(a,"MediaItem"))a=a.parentElement;if(a&&!$css.has(a,"NoHover"))$css.remove(a,"Hover");a=event.srcElement;while(a&&!$css.has(a,"Overlay"))a=a.parentElement;if(a&&!$css.has(a,"NoHover"))$css.remove(a,"Hover")};__p._onItemClick=function LiveViewMediaControl$_onItemClick(b,a){var c=this.mediaItems[b],d={continueProcessing:false};if(this.behavior&&this.behavior._onItemClick)this.behavior._onItemClick(b,a,c,this,d);if(!d.continueProcessing)return;if(a==LiveViewMediaControl._CLICK_ITEM)if(c[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_PHOTO||c[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_VIDEO){this._reportClick("Internal");this._launchSilverlightSlideshow(a,b)}return false};__p._onLinkClick=function LiveViewMediaControl$_onLinkClick(a){var d="Internal";if(a==LiveViewMediaControl._CLICK_SLIDESHOW)if(!_isSilverlightSupportedBrowser){var b=$(this.elt.id+"_linkContainer");if(b){var c=$(this.elt.id+"_viewSlideshowLink");if(c)b.removeChild(c.parentElement);var e=$(this.elt.id+"_toolbarPipe");if(e)b.removeChild(e.parentElement)}}else if(!_isSilverlightInstalled)SilverlightUpsell.showUpsellDialog(HM.ContentId.SlideshowSilverlightUpsell);else this._launchSilverlightSlideshow(a);else if(a==LiveViewMediaControl._CLICK_DOWNLOAD_ALL)Control.invoke("MessagePartBody","_onAttachmentClick",event);else if(a==LiveViewMediaControl._CLICK_MORE||a==LiveViewMediaControl._CLICK_GO_TO)d="External";this._reportClick(d)};__p.onHmlvSelect=function LiveViewMediaControl$onHmlvSelect(){this.updateLayout()};__p.updateLayout=function LiveViewMediaControl$updateLayout(){this._renderItems()};__p._launchSilverlightSlideshow=function LiveViewMediaControl$_launchSilverlightSlideshow(l,m){if(this.viewSlideshowLinkShown){if(this.slideshowAssetList==null&&this.mediaItems!=null){var k=[],b=null,d=0;for(var i=0;i<this.mediaItems.length;i++){var c=this.mediaItems[i];if(c[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_PHOTO||c[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_VIDEO){this.mediaItemIndexToSlideshowAssetIndexMap[i]=d;b={};b.Index=d;b.Name=c[LiveViewMediaControl._ITEM_NAME];b.DataItemType=c[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_PHOTO?SilverlightSlideshow._DATAITEM_PHOTO:SilverlightSlideshow._DATAITEM_VIDEO;b.Large={};b.Large.Url=Page.decode(c[LiveViewMediaControl._ITEM_SLIDESHOW_MAIN_ASSET_URL]);var g=c[LiveViewMediaControl._ITEM_SLIDESHOW_MAIN_ASSET_WIDTH],e=c[LiveViewMediaControl._ITEM_SLIDESHOW_MAIN_ASSET_HEIGHT];if(g!=undefined&&g!=null&&g!="")b.Large.Width=g;if(e!=undefined&&e!=null&&e!="")b.Large.Height=e;b.Thumb={};b.Thumb.Url=Page.decode(c[LiveViewMediaControl._ITEM_SLIDESHOW_THUMB_URL]);var h=c[LiveViewMediaControl._ITEM_SLIDESHOW_THUMB_WIDTH],f=c[LiveViewMediaControl._ITEM_SLIDESHOW_THUMB_HEIGHT];if(h!=undefined&&h!=null&&h!="")b.Thumb.Width=h;if(f!=undefined&&f!=null&&f!="")b.Thumb.Height=f;if(this.behavior&&this.behavior._getAdditionalSlideshowAssetParams)this.behavior._getAdditionalSlideshowAssetParams(c,b,this);k[d]=b;d++}}this.slideshowAssetList=Object.toJSON(k)}var j=null;if(l==LiveViewMediaControl._CLICK_SLIDESHOW)j=0;else j=this.mediaItemIndexToSlideshowAssetIndexMap[m];var a={};a.XapFileUrl=InboxPage.Strings.slSlideshowXapFileUrl;a.BackgroundColor="black";a.MinSilverlightVersion="4.0";a.MaxFrameRate=24;a.EnableHtmlAccess="true";a.EnableAutoZoom="true";a.ShowSocialFeatures="false";a.IsBiDi=Loc.isBidi;a.Target="_blank";a.AppLogoInfo={};a.AppLogoInfo.ShowLogo=true;a.AppLogoInfo.Text=_MCD.brandingInfoText;a.AppLogoInfo.Link=_MCD.brandingInfoLink;a.AppLogoInfo.ToolTip=_MCD.brandingInfoToolTip;if(this.behavior&&this.behavior._getAdditionalSlideshowParams)this.behavior._getAdditionalSlideshowParams(a,this);SilverlightSlideshow.launchSlideshow(this.slideshowAssetList,j,a);if(this.behavior&&this.behavior._reportSlideshowClick)this.behavior._reportSlideshowClick(l)}};LiveViewMediaControl.createClass("LiveViewMediaControl",LiveViewControlBase);LiveViewMediaControl.AttachmentBehavior={};var _AB=LiveViewMediaControl.AttachmentBehavior;_AB._FILE_ITEM_PADDING=20;_AB._AUDIO_POPOVER_HEIGHT=75;_AB._AUDIO_POPOVER_WIDTH=300;_AB._getItemWidth=function LiveViewMediaControl$AttachmentBehavior$_getItemWidth(c,b,a){switch(c[LiveViewMediaControl._ITEM_TYPE]){case LiveViewMediaControl._ITEM_TYPE_AUDIO:case LiveViewMediaControl._ITEM_TYPE_OFFICEDOC:case LiveViewMediaControl._ITEM_TYPE_GENERICFILE:a.continueProcessing=false;return b.nonPhotoThumbWidth+_MCD.fileTextWidth}};_AB._renderItem=function LiveViewMediaControl$AttachmentBehavior$_renderItem(a,d,c,b){switch(a[LiveViewMediaControl._ITEM_TYPE]){case LiveViewMediaControl._ITEM_TYPE_AUDIO:case LiveViewMediaControl._ITEM_TYPE_OFFICEDOC:case LiveViewMediaControl._ITEM_TYPE_GENERICFILE:LiveViewMediaControl.AttachmentBehavior._renderFile(a,d,c);b.continueProcessing=false}};_AB._renderFile=function LiveViewMediaControl$_renderFile(a,p,d){var m=a[LiveViewMediaControl._ITEM_ATTACHMENT_STATE]==LiveViewMediaControl._ATTACHMENT_STATE_BLOCKED,j=m||a[LiveViewMediaControl._ITEM_ATTACHMENT_STATE]==LiveViewMediaControl._ATTACHMENT_STATE_BROWSER_DISPLAY_DISALLOWED,b=_ce("div");$css.add(b,"MediaItem");$css.add(b,"File");if(j)$css.add(b,"NoHover");b.style.width=d.nonPhotoThumbWidth+_MCD.fileTextWidth+"px";var c=_ce("img");$css.add(c,"Thumb");$css.add(c,"FloatLeft");if(a.status==LiveViewMediaControl._LOADING_STATE_LOADED_SUCCESSFUL)c.src=a[LiveViewMediaControl._ITEM_MEDIA_STRIP_THUMB_URL];else{c.src=LiveViews.clearImgSrc;$css.add(c,a.status==LiveViewMediaControl._LOADING_STATE_NOT_LOADED?"Loading":"Failed")}c.title=c.alt=_AB._getFileIconTooltip(a,j,m);if(_MCD.sutraFileIcon)c.setAttribute("sutra",_MCD.sutraFileIcon);if(!j)c.onclick=$CD(d,function(a){return function(){return this._onItemClick(a,LiveViewMediaControl._CLICK_THUMBNAIL)}}(a.index));b.appendChild(c);var h=_ce("div");$css.add(h,"Filename");if(_MCD.sutraFileName)h.setAttribute("sutra",_MCD.sutraFileName);h.innerText=a[LiveViewMediaControl._ITEM_NAME];b.appendChild(h);var q=a[LiveViewMediaControl._ITEM_TYPE];if(q==LiveViewMediaControl._ITEM_TYPE_AUDIO&&Browser.isIE){var f=_ce("a");f.href="javascript:;";f.innerText=_MCD.audioFileLinkText;f.title=String.format(_MCD.audioFileTooltip,a[LiveViewMediaControl._ITEM_NAME]);f.onclick=$CD(d,function(a){return function(){return this._onItemClick(a,LiveViewMediaControl._CLICK_PLAY_AUDIO)}}(a.index));if(_MCD.sutraPlayAudioLink)f.setAttribute("sutra",_MCD.sutraPlayAudioLink);b.appendChild(f)}else if(q==LiveViewMediaControl._ITEM_TYPE_OFFICEDOC){var g=_ce("a");g.href="javascript:;";g.innerText=_MCD.officeDocLinkText;g.title=String.format(_MCD.officeDocTooltip,a[LiveViewMediaControl._ITEM_NAME]);g.onclick=$CD(d,function(a){return function(){return this._onItemClick(a,LiveViewMediaControl._CLICK_VIEW_DOC)}}(a.index));if(_MCD.sutraViewOnlineLink)g.setAttribute("sutra",_MCD.sutraViewOnlineLink);b.appendChild(g)}if(!j){var i=_ce("div");$css.add(i,"FileSize");var r=$CD(d,function(a){return function(){return this._onItemClick(a,LiveViewMediaControl._CLICK_DOWNLOAD_ITEM)}}(a.index)),t=_AB._getDownloadLinkTooltip(a),e=_ce("a");e.href="javascript:;";e.innerText=_MCD.downloadLinkText;e.title=t;e.onclick=r;if(_MCD.sutraDownloadLink)e.setAttribute("sutra",_MCD.sutraDownloadLink);i.appendChild(e);var o=_ce("span");o.innerText=_AB.rtlMark+_AB._getDownloadSizeString(a);i.appendChild(o);b.appendChild(i)}else{var k=_ce("div");$css.add(k,"FileName");var n=_ce("span");n.innerText=_AB.rtlMark+_AB._getDownloadSizeString(a);k.appendChild(n);b.appendChild(k)}var l=_ce("div");$css.add(l,"ClearBoth");b.appendChild(l);p.appendChild(b);var s=$(d.elt.id+"_ms");p.style.marginTop=Math.floor((s.parentElement.offsetHeight-(d.nonPhotoThumbHeight+_AB._FILE_ITEM_PADDING))/2)+"px";b=null;c=null;h=null;i=null;l=null};_AB._getDownloadSizeString=function LiveViewMediaControl$AttachmentBehavior$_getDownloadSizeString(a){if(a[LiveViewMediaControl._ITEM_ATTACHMENT_DOWNLOAD_SIZE])return String.format(_MCD.downloadSizeTemplate,a[LiveViewMediaControl._ITEM_ATTACHMENT_DOWNLOAD_SIZE]);return ""};_AB._getPhotoAndVideoTooltip=function LiveViewMediaControl$AttachmentBehavior$_getPhotoAndVideoTooltip(a){if(a[LiveViewMediaControl._ITEM_NAME])if(!_isSilverlightSupportedBrowser||!_isSilverlightInstalled)return this._getDownloadLinkTooltip(a);else return String.format(_MCD.photoAndVideoTooltip,a[LiveViewMediaControl._ITEM_NAME]);return ""};_AB._getFilenameTooltip=function LiveViewMediaControl$AttachmentBehavior$_getFilenameTooltip(a){if(a[LiveViewMediaControl._ITEM_NAME]){var b=a[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_OFFICEDOC;if(b)return String.format(_MCD.officeDocTooltip,a[LiveViewMediaControl._ITEM_NAME]);else return this._getDownloadLinkTooltip(a)}return ""};_AB._getFileIconTooltip=function LiveViewMediaControl$AttachmentBehavior$_getFileIconTooltip(a,b,c){var d=a[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_OFFICEDOC;if(c)return _MCD.blockedAttachmentTooltip;else if(b)return _MCD.nonDownloadableAttachmentTooltip;else return this._getDownloadLinkTooltip(a)};_AB._getDownloadLinkTooltip=function LiveViewMediaControl$AttachmentBehavior$_getDownloadLinkTooltip(a){if(a[LiveViewMediaControl._ITEM_NAME])return String.format(_MCD.downloadLinkTooltip,a[LiveViewMediaControl._ITEM_NAME])+" "+_AB.rtlMark+_AB._getDownloadSizeString(a);return ""};_AB._postRenderItem=function LiveViewMediaControl$AttachmentBehavior$_postRenderItem(f,h,g){switch(f[LiveViewMediaControl._ITEM_TYPE]){case LiveViewMediaControl._ITEM_TYPE_PHOTO:case LiveViewMediaControl._ITEM_TYPE_VIDEO:var e=h.childNodes[0];if(e){e.style.position="relative";var a=_ce("div");a.className="Overlay";a.title=_AB._getDownloadLinkTooltip(f);a.onclick=$CD(g,function(a){return function(){return this._onItemClick(a,LiveViewMediaControl._CLICK_DOWNLOAD_ITEM)}}(f.index));if(_MCD.sutraDownloadLink)a.setAttribute("sutra",_MCD.sutraDownloadLink);e.appendChild(a);var c=_ce("span");$css.add(c,"FloatRight");c.innerText=_MCD.downloadLinkText;a.appendChild(c);var b=_ce("a");b.href="javascript:;";$css.add(b,"FloatRight");var d=_ce("img");d.src=_MCD.downloadImgSrc;b.appendChild(d);a.appendChild(b);a=null;c=null;d=null}}};_AB._onItemClick=function LiveViewMediaControl$AttachmentBehavior$_onItemClick(m,d,a,f,e){e.continueProcessing=true;if(a[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_PHOTO||a[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_VIDEO){if(!_isSilverlightSupportedBrowser||!_isSilverlightInstalled){f._reportClick("Internal");var b=event.srcElement,h=a[LiveViewMediaControl._ITEM_ATTACHMENT_STATE]==LiveViewMediaControl._ATTACHMENT_STATE_BROWSER_DISPLAY_ALLOWED;b.setAttribute("aIdx",a[LiveViewMediaControl._ITEM_ATTACHMENT_INDEX]);b.setAttribute("aDepth",a[LiveViewMediaControl._ITEM_ATTACHMENT_DEPTH]);b.setAttribute("entryPt",LiveViewMediaControl._CLICK_THUMBNAIL);if(h)b.setAttribute("aNewWin","");Control.invoke("MessagePartBody","_onAttachmentClick",event);e.continueProcessing=false;return}}else if(a[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_AUDIO)if(d==LiveViewMediaControl._CLICK_PLAY_AUDIO)if(Browser.isIE){f._reportClick("Internal");var g=_ce("div"),j=null,i=Control.findControl(f.elt,"MessagePartBody");if(i)j=i._getDownloadUrlFromParams(a[LiveViewMediaControl._ITEM_ATTACHMENT_INDEX],a[LiveViewMediaControl._ITEM_ATTACHMENT_DEPTH],d);var l=new WMP.WMPlayer(g,j,null),c=new WebDialog(_AB._AUDIO_POPOVER_HEIGHT,_AB._AUDIO_POPOVER_WIDTH,null,true,true,false,null);c.setHeaderTitle(a[LiveViewMediaControl._ITEM_NAME]);c.setContext(l);c.setCallback(_AB._onCloseAudioPlayer);c.setContents(g);c.setImgPath(gAlertsImagePath);c.addCloseBox(gAlertsCloseBoxAltText);c.addCloseOnEscapeKey();gShowDialog(c);g=null;e.continueProcessing=false;return}if(d==LiveViewMediaControl._CLICK_DOWNLOAD_ITEM||d==LiveViewMediaControl._CLICK_THUMBNAIL||d==LiveViewMediaControl._CLICK_VIEW_DOC){f._reportClick("Internal");var b=event.srcElement,h=a[LiveViewMediaControl._ITEM_ATTACHMENT_STATE]==LiveViewMediaControl._ATTACHMENT_STATE_BROWSER_DISPLAY_ALLOWED,k=a[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_OFFICEDOC;b.setAttribute("aIdx",a[LiveViewMediaControl._ITEM_ATTACHMENT_INDEX]);b.setAttribute("aDepth",a[LiveViewMediaControl._ITEM_ATTACHMENT_DEPTH]);b.setAttribute("entryPt",d);if(h)b.setAttribute("aNewWin","");if(k&&d==LiveViewMediaControl._CLICK_VIEW_DOC)b.setAttribute("wacScenario","View");Control.invoke("MessagePartBody","_onAttachmentClick",event);e.continueProcessing=false}};_AB._onCloseAudioPlayer=function LiveViewMediaControl$AttachmentBehavior$_onCloseAudioPlayer(a){if(a)a.dispose();return true};_AB._getAdditionalSlideshowParams=function LiveViewMediaControl$AttachmentBehavior$_getAdditionalSlideshowParams(a){a.CobrandInfo={};a.CobrandInfo.ShowLogo=false;a.CobrandInfo.LogoUrl="";a.CobrandInfo.Link="";a.CobrandInfo.ToolTip="";a.GoToInfo={};a.GoToInfo.ShowText=true;a.GoToInfo.Text=_MCD.downloadLinkText;a.GoToInfo.ToolTip=""};_AB._getAdditionalSlideshowAssetParams=function LiveViewMediaControl$AttachmentBehavior$_getAdditionalSlideshowAssetParams(b,c,d){var a=Control.findControl(d.elt,"MessagePartBody");if(a)c.SelfLink=a._getDownloadUrlFromParams(b[LiveViewMediaControl._ITEM_ATTACHMENT_INDEX],b[LiveViewMediaControl._ITEM_ATTACHMENT_DEPTH],LiveViewMediaControl._CLICK_FILENAME,true)};_AB._reportSlideshowClick=function LiveViewMediaControl$AttachmentBehavior$_reportSlideshowClick(a){$BSI.reportEvent("slideshow.click",{permissions:"private",dataSource:"Hotmail",viewMethod:"attachment",ssEntry:a==LiveViewMediaControl._CLICK_SLIDESHOW?"link":"thumbnail"})};LiveViewMediaControl.PhotoGalleryBehavior={};var _PGB=LiveViewMediaControl.PhotoGalleryBehavior;_PGB._onItemClick=function LiveViewMediaControl$PhotoGalleryBehavior$_onItemClick(f,d,e,b,a){a.continueProcessing=true;if(d==LiveViewMediaControl._CLICK_ITEM)if(!_isSilverlightSupportedBrowser||!_isSilverlightInstalled||e[LiveViewMediaControl._ITEM_TYPE]==LiveViewMediaControl._ITEM_TYPE_VIDEO){b._reportClick("External");var c=$(b.elt.id+"_goToLink");window.open(c.href);a.continueProcessing=false}};_PGB._getAdditionalSlideshowParams=function LiveViewMediaControl$PhotoGalleryBehavior$_getAdditionalSlideshowParams(a,d){var e=$(d.elt.id+"_cobrandLogo"),b=d.elt.getAttribute("cobrandLogo"),c=$(d.elt.id+"_goToLink");if(c&&e){a.CobrandInfo={};a.CobrandInfo.ShowLogo=true;a.CobrandInfo.LogoUrl=b&&b!=""?b:e.src;a.CobrandInfo.Link=c.href;a.CobrandInfo.ToolTip=c.innerText}};_PGB._reportSlideshowClick=function LiveViewMediaControl$PhotoGalleryBehavior$_reportSlideshowClick(a){$BSI.reportEvent("slideshow.click",{permissions:"public",dataSource:"Hotmail",viewMethod:"3rdparty",ssEntry:a==LiveViewMediaControl._CLICK_SLIDESHOW?"link":"thumbnail"})};var SilverlightSlideshow={};SilverlightSlideshow._MAX_WIDTH=1600;SilverlightSlideshow._MAX_HEIGHT=1200;SilverlightSlideshow._MIN_WIDTH=640;SilverlightSlideshow._MIN_HEIGHT=480;SilverlightSlideshow._BROWSER_PADDING=75;SilverlightSlideshow._DATAITEM_PHOTO=0;SilverlightSlideshow._DATAITEM_VIDEO=1;SilverlightSlideshow.initialize=function SilverlightSlideshow$initialize(){SilverlightSlideshow._dialog=null;SilverlightSlideshow._dialogWidth=null;SilverlightSlideshow._dialogHeight=null;SilverlightSlideshow._assetList=null;SilverlightSlideshow._startIndex=null;SilverlightSlideshow._params=null};SilverlightSlideshow.launchSlideshow=function SilverlightSlideshow$launchSlideshow(d,c,e){SilverlightSlideshow._assetList=d;SilverlightSlideshow._startIndex=c;SilverlightSlideshow._params=e;SilverlightSlideshow._params.CloseButtonInvokeMethod="_silverlightSlideshowCloseButtonCallback";var b=SilverlightSlideshow._getPopupContent();InboxPage.postProcData.history=false;InboxPage.postProcData.ads=false;SilverlightSlideshow._dialog=new WebDialog(null,null,null,true,false,false,"Slideshow");SilverlightSlideshow._computeSlideshowDimensions();SilverlightSlideshow._dialog.setDimensions(SilverlightSlideshow._dialogWidth,SilverlightSlideshow._dialogHeight);SilverlightSlideshow._dialog.setContents(b);SilverlightSlideshow._dialog.setImgPath(gAlertsImagePath);var a=window.$WLXIM;if(a&&a.CW&&a.CW.minimize)a.CW.minimize();gShowDialog(SilverlightSlideshow._dialog)};SilverlightSlideshow.resize=function SilverlightSlideshow$resize(){if(SilverlightSlideshow._dialog!=null&&SilverlightSlideshow._computeSlideshowDimensions()){SilverlightSlideshow._dialog.setDimensions(SilverlightSlideshow._dialogWidth,SilverlightSlideshow._dialogHeight);SilverlightSlideshow._dialog.centerModal()}};SilverlightSlideshow._computeSlideshowDimensions=function SilverlightSlideshow$_computeSlideshowDimensions(){var c=false;if(SilverlightSlideshow._dialog!=null){var d=SilverlightSlideshow._MAX_WIDTH/SilverlightSlideshow._MAX_HEIGHT,b=WebUtilities.getViewportWidth()-2*SilverlightSlideshow._BROWSER_PADDING;if(b>SilverlightSlideshow._MAX_WIDTH)b=SilverlightSlideshow._MAX_WIDTH;var a=Math.floor(b/d);if(a>WebUtilities.getViewportHeight()-2*SilverlightSlideshow._BROWSER_PADDING)a=WebUtilities.getViewportHeight()-2*SilverlightSlideshow._BROWSER_PADDING;if(a<SilverlightSlideshow._MIN_HEIGHT)a=SilverlightSlideshow._MIN_HEIGHT;b=Math.floor(a*d);if(SilverlightSlideshow._dialogWidth==null&&SilverlightSlideshow._dialogHeight==null)c=true;else if(SilverlightSlideshow._dialogWidth!=null&&SilverlightSlideshow._dialogHeight!=null&&(SilverlightSlideshow._dialogWidth!=b||SilverlightSlideshow._dialogHeight!=a))c=true;if(c){SilverlightSlideshow._dialogWidth=b;SilverlightSlideshow._dialogHeight=a}return c}};function _silverlightSlideshowCloseButtonCallback(){SilverlightSlideshow._closeSlideshow()}SilverlightSlideshow._closeSlideshow=function SilverlightSlideshow$_closeSlideshow(){SilverlightSlideshow._dialog.minimize();SilverlightSlideshow._dialog.hide();SilverlightSlideshow._dialog=null};function _silverlightSlideshowOnLoadCallback(){setTimeout("_setSlideshowFocus();",1e3)}function _setSlideshowFocus(){try{$("sl_slideshow").focus()}catch(a){}}SilverlightSlideshow._getPopupContent=function SilverlightSlideshow$_getPopupContent(){var a="<div class='SlideshowParentContainer'>            <div class='SlideshowContainer'>                <object id='sl_slideshow' data='data:application/x-silverlight,' type='application/x-silverlight-2' width='100%' height='100%'>                    <param name='onLoad' value='_silverlightSlideshowOnLoadCallback'/>                    <param name='source' value='"+SilverlightSlideshow._params.XapFileUrl+"'/>                    <param name='background' value='"+SilverlightSlideshow._params.BackgroundColor+"'/>                    <param name='minRuntimeVersion' value='"+SilverlightSlideshow._params.MinSilverlightVersion+"'/>                    <param name='maxFrameRate' value='"+SilverlightSlideshow._params.MaxFrameRate+"'/>                    <param name='enableHtmlAccess' value='"+SilverlightSlideshow._params.EnableHtmlAccess+"'/>                    <param name='enableautozoom' value='"+SilverlightSlideshow._params.EnableAutoZoom+"'/>                    <param name='initParams' value='isskydrive="+SilverlightSlideshow._params.ShowSocialFeatures+", closebuttoninvokemethod="+SilverlightSlideshow._params.CloseButtonInvokeMethod+",";if(SilverlightSlideshow._params.AppLogoInfo!=null)a+="showapplogo="+SilverlightSlideshow._params.AppLogoInfo.ShowLogo+","+"applogourl="+SilverlightSlideshow._params.AppLogoInfo.LogoUrl+","+"applogolink="+SilverlightSlideshow._params.AppLogoInfo.Link+","+"applogotext="+SilverlightSlideshow._params.AppLogoInfo.Text+","+"applogotooltip="+SilverlightSlideshow._params.AppLogoInfo.ToolTip+",";if(SilverlightSlideshow._params.CobrandInfo!=null)a+="showcobrand="+SilverlightSlideshow._params.CobrandInfo.ShowLogo+","+"cobrandlogourl="+SilverlightSlideshow._params.CobrandInfo.LogoUrl+","+"cobrandlink="+SilverlightSlideshow._params.CobrandInfo.Link+","+"cobrandlogotooltip="+SilverlightSlideshow._params.CobrandInfo.ToolTip+",";if(SilverlightSlideshow._params.GoToInfo!=null){a+="showgoto="+SilverlightSlideshow._params.GoToInfo.ShowText+","+"gototext="+SilverlightSlideshow._params.GoToInfo.Text+","+"gototooltip="+SilverlightSlideshow._params.GoToInfo.ToolTip+",";if(SilverlightSlideshow._params.GoToInfo.Link!=null)a+="gotolink="+SilverlightSlideshow._params.GoToInfo.Link+","}a+="isrtl="+SilverlightSlideshow._params.IsBiDi+","+"target="+SilverlightSlideshow._params.Target+","+"'/> </object> </div> </div>";return a};function GetSlideshowAssetList(){return SilverlightSlideshow._assetList}function GetSlideshowStartIndex(){return SilverlightSlideshow._startIndex}Type.createStaticClass(SilverlightSlideshow,"SilverlightSlideshow");SilverlightSlideshow.initialize();var SilverlightUpsell={},_hasOlderSLVersionInstalled=Silverlight.isInstalled();SilverlightUpsell.initialize=function SilverlightUpsell$initialize(){SilverlightUpsell._dialog=null;SilverlightUpsell._contentId=null};SilverlightUpsell.showUpsellDialog=function SilverlightUpsell$showUpsellDialog(a){SilverlightUpsell._contentId=a;var b=function(){var b=DemandLoadHandler.getContent(a);if(b){SilverlightUpsell._dialog=new WebDialog(null,b.dialogWidth,null,true,false,false);SilverlightUpsell._dialog.setContents(b.dialogContent);SilverlightUpsell._dialog.setImgPath(gAlertsImagePath);SilverlightUpsell._dialog.addCloseBox(gAlertsCloseBoxAltText);SilverlightUpsell._dialog.setCallback(SilverlightUpsell._upsellCallback);SilverlightUpsell._dialog.addCloseOnEscapeKey();gShowDialog(SilverlightUpsell._dialog)}};DemandLoadHandler.demandLoadContent([a],[b])};SilverlightUpsell.onInstallSilverlightClick=function SilverlightUpsell$onInstallSilverlightClick(){SilverlightUpsell._reportClick("accepted");var a=DemandLoadHandler.getContent(SilverlightUpsell._contentId);if(a){Infopane.show(a.infoPaneText,{pri:Infopane.ErrorPri.Medium});window.open(a.installLink);SilverlightUpsell._dialog.hide()}};SilverlightUpsell._upsellCallback=function SilverlightUpsell$_upsellCallback(){SilverlightUpsell._reportClick("cancel");SilverlightUpsell._dialog.hide()};SilverlightUpsell._reportClick=function SilverlightUpsell$_reportClick(b){var a=null;if(SilverlightUpsell._contentId==HM.ContentId.SlideshowSilverlightUpsell)a="slideshow";else if(SilverlightUpsell._contentId==HM.ContentId.PhotosSilverlightUpsell)a="photo";else if(SilverlightUpsell._contentId==HM.ContentId.DocsSilverlightUpsell)a="doc";else if(SilverlightUpsell._contentId==HM.ContentId.VideoPlaybackSilverlightUpsell)a="videoplayback";$BSI.reportEvent("rv.photoup",{upsellType:"Silverlight",upsellEntryPoint:a,endState:b})};Type.createStaticClass(SilverlightUpsell,"SilverlightUpsell");SilverlightUpsell.initialize();if("undefined"==typeof WMP)WMP={};WMP.WMPlayer=function(c,h,f){if(!WMP.WMPlayer.m_strings)WMP.WMPlayer.m_strings=InboxPage.WMP;if(!WMP.WMPlayer.m_pollingInt){WMP.WMPlayer.m_pollingInt=Number(InboxPage.WMP.wmplayer_pollingInt);if(isNaN(WMP.WMPlayer.m_pollingInt))WMP.WMPlayer.m_pollingInt=100}var e=false,g=["WMPlayer.OCX.7","WMPlayer.OCX"];for(var d=0;d<g.length;d++)try{if(window.ActiveXObject){this.m_player=new ActiveXObject(g[d]);e=true;break}else if(window.GeckoActiveXObject){this.m_player=new GeckoActiveXObject(g[d]);e=true;break}}catch(i){}if(!e){this.m_player=null;if(window.ActiveXObject||window.GeckoActiveXObject){if(c&&!Browser.isFF){this.m_playerElem=document.createElement("div");this.m_playerElem.className="media-player";c.appendChild(this.m_playerElem);var a=document.createElement("p");a.className="label-name";var b=document.createElement("a");b.appendChild(document.createTextNode(decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_errorWMPNotInstalled)));b.href=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_errorWMPInstallUrl);b.onclick=function(){window.open(b.href);return false};a.appendChild(b);this.m_playerElem.appendChild(a)}return}}if(this.m_player){this.m_player.uiMode="invisible";this.m_player.settings.enableErrorDialogs=false;if(f&&f.length>0){this.m_mediaLabel=f;this.m_showLabel=true}else{this.m_mediaLabel="";this.m_showLabel=false}if(c){this.m_playerElem=document.createElement("div");this.m_playerElem.className="media-player";c.appendChild(this.m_playerElem);if(h){var a=document.createElement("p");a.className="label-name";a.appendChild(document.createTextNode(decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_loading)+(this.m_mediaLabel?": "+this.m_mediaLabel:"")+"..."));this.m_playerElem.appendChild(a);WMP.WMPlayer.resolveUrl(this,h)}}}};WMP.WMPlayer.prototype.dispose=function(){if(this.m_updateMethod)this.m_updateMethod=null;if(this.m_player){this.stop();this.m_player.close();this.m_player=null}if(this.m_playerElem){if(this.m_playerElem.parentElement)this.m_playerElem.parentElement.removeChild(this.m_playerElem);this.m_playerElem=null}};WMP.WMPlayer.m_tabIndex=1e3;WMP.WMPlayer.attachHandler=function(a,b,c){if(a.addEventListener)a.addEventListener(b.toLowerCase(),c,true);else if(a.attachEvent)a.attachEvent("on"+b.toLowerCase(),c)};WMP.WMPlayer.detachHandler=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b.toLowerCase(),c,true);else if(a.detachEvent)a.detachEvent("on"+b.toLowerCase(),c)};WMP.WMPlayer.getXMLHttpRequest=function(){if(!window.XMLHttpRequest){var b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var a=0;a<b.length;a++)try{var c=new ActiveXObject(b[a]);return c}catch(d){}return null}return new XMLHttpRequest};WMP.WMPlayer.resolveUrl=function(b,c){var a=WMP.WMPlayer.getXMLHttpRequest();function d(){if(a&&4==a.readyState){if(b){var d=a.getResponseHeader("Content-Location");if(!d)d=a.getResponseHeader("Location");b.openUrl(d?d:c)}a=null}}if(a)try{a.onreadystatechange=d;a.open("HEAD",c,true);a.send(null)}catch(e){a=null;b.openUrl(c)}else b.openUrl(c)};WMP.WMPlayer.prototype.openUrl=function(c){this.m_url=c;if(this.m_player){var a=this,b=window.setInterval(function(){if(!a.m_player)window.clearInterval(b);else if(a.m_player.openState==13){window.clearInterval(b);a.stop();a.m_player.settings.mute=false;a.buildUI();a=null}else a.reportErrors()},200);this.m_player.settings.invokeURLs=false;this.m_player.settings.autoStart=true;this.m_player.settings.mute=true;this.m_player.URL=this.m_url}};WMP.WMPlayer.prototype.buildUI=function(){if(!this.m_playerElem||!this.m_player)return;while(this.m_playerElem.lastChild)this.m_playerElem.removeChild(this.m_playerElem.lastChild);var l=document.createElement("p");l.className="label-name";if(!this.m_showLabel)l.style.visibility="hidden";l.appendChild(document.createTextNode(this.m_mediaLabel));this.m_playerElem.appendChild(l);var g=document.createElement("div");g.className="seek-area";g.onmousedown=WMP.WMPlayer.createHandler(this,"seek_onDragStart");var q=document.createElement("div");q.className="seek-left";g.appendChild(q);var p=document.createElement("div");p.className="seek-right";g.appendChild(p);var m=document.createElement("div");m.className="seek-fill";m.onUpdateState=WMP.WMPlayer.seekFill_onUpdateState(this);g.appendChild(m);var e=document.createElement("a");e.className="seek-thumb";e.href="#seek";e.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_seek);e.hideFocus=true;e.tabIndex=WMP.WMPlayer.m_tabIndex*10+1;e.onkeydown=WMP.WMPlayer.createHandler(this,"seek_onKeyDown");e.onmousedown=WMP.WMPlayer.createHandler(this,"seek_onDragStart");e.appendChild(document.createTextNode(" "));g.appendChild(e);this.m_playerElem.appendChild(g);var j=document.createElement("div");j.className="label-time";j.onUpdateState=WMP.WMPlayer.timeLabel_onUpdateState(this);j.appendChild(document.createTextNode(" "));this.m_playerElem.appendChild(j);var h=document.createElement("div");h.className="controls-area";this.m_playerElem.appendChild(h);var b=document.createElement("a");b.className="button-play";b.href="#play";b.title="";b.hideFocus=true;b.tabIndex=WMP.WMPlayer.m_tabIndex*10+2;b.onclick=WMP.WMPlayer.createHandler(this,"play");b.onmousedown=WMP.WMPlayer.button_onPressChanged(this,true);b.onmouseup=WMP.WMPlayer.button_onPressChanged(this,false);b.onUpdateState=WMP.WMPlayer.playButton_onUpdateState(this);b.appendChild(document.createTextNode(" "));h.appendChild(b);var c=document.createElement("a");c.className="button-stop";c.href="#stop";c.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_stop);c.hideFocus=true;c.tabIndex=WMP.WMPlayer.m_tabIndex*10+3;c.onclick=WMP.WMPlayer.createHandler(this,"stop");c.onmousedown=WMP.WMPlayer.button_onPressChanged(this,true);c.onmouseup=WMP.WMPlayer.button_onPressChanged(this,false);c.onUpdateState=WMP.WMPlayer.button_onUpdateState(this,"stop");c.appendChild(document.createTextNode(" "));h.appendChild(c);var a=document.createElement("a");a.className="button-mute";a.href="#mute";a.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_mute);a.hideFocus=true;a.tabIndex=WMP.WMPlayer.m_tabIndex*10+4;a.onclick=WMP.WMPlayer.createHandler(this,"mute");a.onmousedown=WMP.WMPlayer.button_onPressChanged(this,true);a.onmouseup=WMP.WMPlayer.button_onPressChanged(this,false);a.onUpdateState=WMP.WMPlayer.mute_onUpdateState(this);a.appendChild(document.createTextNode(" "));h.appendChild(a);var f=document.createElement("div");f.className="volume-area";f.onmousedown=WMP.WMPlayer.createHandler(this,"volume_onDragStart");var o=document.createElement("div");o.className="volume-left";f.appendChild(o);var n=document.createElement("div");n.className="volume-right";f.appendChild(n);var k=document.createElement("div");k.className="volume-fill";k.onUpdateState=WMP.WMPlayer.volumeFill_onUpdateState(this);f.appendChild(k);var d=document.createElement("a");d.className="volume-thumb";d.href="#volume";d.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_volume);d.hideFocus=true;d.tabIndex=WMP.WMPlayer.m_tabIndex*10+5;d.onmousedown=WMP.WMPlayer.createHandler(this,"volume_onDragStart");d.onkeydown=WMP.WMPlayer.createHandler(this,"volume_onKeyDown");d.appendChild(document.createTextNode(" "));f.appendChild(d);h.appendChild(f);WMP.WMPlayer.m_tabIndex++;var i=this;this.m_updateMethod=function(){b.onUpdateState();c.onUpdateState();a.onUpdateState();m.onUpdateState();k.onUpdateState();j.onUpdateState();i.reportErrors();if(i.m_updateMethod&&i.m_player&&(i.m_player.playState==3||i.m_player.playState==6))window.setTimeout(i.m_updateMethod,WMP.WMPlayer.m_pollingInt)};this.m_updateMethod()};WMP.WMPlayer.prototype.setVolume=function(a){if(this.m_player){this.m_player.settings.volume=a*100;this.m_player.settings.mute=false}};WMP.WMPlayer.prototype.setPosition=function(a){if(this.m_player)this.m_player.controls.currentPosition=a*this.m_player.controls.currentItem.duration};WMP.WMPlayer.prototype.play=function(){if(this.m_player)if((this.m_player.playState==3||this.m_player.playState==6)&&this.m_player.controls.isAvailable("pause"))this.m_player.controls.pause();else if(this.m_player.controls.isAvailable("play")){this.m_player.controls.play();InboxActions.markAsRead()}if(this.m_updateMethod)window.setTimeout(this.m_updateMethod,WMP.WMPlayer.m_pollingInt)};WMP.WMPlayer.prototype.stop=function(){if(this.m_player&&this.m_player.controls.isAvailable("stop"))this.m_player.controls.stop();if(this.m_updateMethod)this.m_updateMethod()};WMP.WMPlayer.prototype.mute=function(){if(this.m_player)this.m_player.settings.mute=!this.m_player.settings.mute;if(this.m_updateMethod)this.m_updateMethod()};WMP.WMPlayer.prototype.reportErrors=function(){if(this.m_player&&this.m_player.error&&this.m_player.error.errorCount>0){var a="",e=this.m_player.error.errorCount;for(var b=0;b<e;b++){switch(this.m_player.error.item(b).errorCode>>>0){case 2147746389:case 2147749890:case 3222080450:case 3222080456:case 3222081444:case 3222079501:case 3222080450:case 3222080456:case 3222081443:case 3222081623:case 3222081642:case 3222081652:case 3222081654:case 3222081680:case 3222081718:case 3222081722:case 3222081745:case 3222081943:case 3222081945:case 3222081946:case 3222081949:case 3222081964:case 3222081974:case 3222081978:case 3222081979:case 3222081981:case 3222081984:case 3222081991:case 3222082001:case 3222082347:case 3222087453:case 3222087499:case 3222087501:a+=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_errorCannotPlay);break;case 2148270088:case 2147942455:case 2147943631:case 2148270093:case 2148270095:case 2148282082:case 3222077471:case 3222079473:case 3222079474:case 3222081940:case 3222081944:case 3222081971:case 3222081988:case 3222081995:case 3222082002:case 3222089445:case 3222089454:a+=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_errorCannotOpenUrl);break;default:a+=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_error)}if(true){var d=[],f=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],c=this.m_player.error.item(b).errorCode>>>0;while(c>=.9){d.push(f[c%16]);c=Math.floor(c/16)}a+=" (0x"+d.reverse().join("")+': "';a+=this.m_player.error.item(b).errorDescription+'")'}if(b>0)a+="<br/>";this.m_player.error.clearErrorQueue()}Infopane.show(a,{pri:Infopane.ErrorPri.High});this.dispose()}};WMP.WMPlayer.translateOffset=function(a){var b=0;while(a){b+=a.offsetLeft;var c=a.tagName.toLowerCase();if(c!="body"){b-=a.scrollLeft;if(c!="table")if(a.clientLeft)b+=a.clientLeft}a=a.offsetParent}return b};WMP.WMPlayer.getEventTarget=function(a){if(!a)return null;if(a.srcElement)return a.srcElement;if(a.currentTarget)return a.currentTarget;if(a.originalTarget)return a.originalTarget;return null};WMP.WMPlayer.prototype.seek_onKeyDown=function(b){var a=this.m_player.controls.currentPosition/this.m_player.controls.currentItem.duration;switch(b.keyCode){case 37:case 40:a-=.05;this.setPosition(Math.min(Math.max(a,0),1));if(this.m_updateMethod)this.m_updateMethod();return false;case 39:case 38:a+=.05;this.setPosition(Math.min(Math.max(a,0),1));if(this.m_updateMethod)this.m_updateMethod();return false;default:return true}};WMP.WMPlayer.prototype.seek_onDragStart=function(a){this.m_pSeekDragElem=WMP.WMPlayer.getEventTarget(a);while(this.m_pSeekDragElem&&this.m_pSeekDragElem.className.indexOf("seek-area")<0)this.m_pSeekDragElem=this.m_pSeekDragElem.parentNode;if(!this.m_pSeekDragElem)return;if(this.m_pSeekDragElem.className.indexOf("seek-drag")<0)this.m_pSeekDragElem.className+=" seek-drag";this.m_seekLeft=WMP.WMPlayer.translateOffset(this.m_pSeekDragElem);this.m_seekWidth=this.m_pSeekDragElem.offsetWidth;this.m_pSeekDragHandlers={seek_onDrag:WMP.WMPlayer.createHandler(this,"seek_onDrag"),seek_onDragStop:WMP.WMPlayer.createHandler(this,"seek_onDragStop")};WMP.WMPlayer.attachHandler(document,"mousemove",this.m_pSeekDragHandlers.seek_onDrag);WMP.WMPlayer.attachHandler(document,"mouseup",this.m_pSeekDragHandlers.seek_onDragStop);this.seek_onDrag(a)};WMP.WMPlayer.prototype.seek_onDrag=function(c){if(c&&this.m_pSeekDragElem){var b=null,d=this.m_pSeekDragElem.childNodes.length;for(var a=0;a<d;a++)if(this.m_pSeekDragElem.childNodes[a].className=="seek-fill")b=this.m_pSeekDragElem.childNodes[a];if(b){this.m_SeekPos=Math.min(Math.max((c.clientX-this.m_seekLeft)/this.m_seekWidth,0),1);if(!isNaN(this.m_SeekPos))b.style.width=""+100*this.m_SeekPos+"%"}}};WMP.WMPlayer.prototype.seek_onDragStop=function(a){if(this.m_pSeekDragElem){this.seek_onDrag(a);if(!isNaN(this.m_SeekPos))this.setPosition(this.m_SeekPos);if(this.m_pSeekDragElem.className.indexOf("seek-drag")>=0)this.m_pSeekDragElem.className=this.m_pSeekDragElem.className.replace(/\s*seek-drag/,"");WMP.WMPlayer.detachHandler(document,"mousemove",this.m_pSeekDragHandlers.seek_onDrag);WMP.WMPlayer.detachHandler(document,"mouseup",this.m_pSeekDragHandlers.seek_onDragStop);this.m_pSeekDragHandlers=null;this.m_pSeekDragElem=null;this.m_seekLeft=null;this.m_seekWidth=null;if(this.m_updateMethod)this.m_updateMethod()}};WMP.WMPlayer.prototype.volume_onKeyDown=function(b){var a=this.m_player.settings.volume/100;switch(b.keyCode){case 37:case 40:a-=.1;this.setVolume(Math.min(Math.max(a,0),1));if(this.m_updateMethod)this.m_updateMethod();return false;case 39:case 38:a+=.1;this.setVolume(Math.min(Math.max(a,0),1));if(this.m_updateMethod)this.m_updateMethod();return false;default:return true}};WMP.WMPlayer.prototype.volume_onDragStart=function(a){this.m_pVolumeDragElem=WMP.WMPlayer.getEventTarget(a);while(this.m_pVolumeDragElem&&this.m_pVolumeDragElem.className.indexOf("volume-area")<0)this.m_pVolumeDragElem=this.m_pVolumeDragElem.parentNode;if(!this.m_pVolumeDragElem)return;if(this.m_pVolumeDragElem.className.indexOf("volume-drag")<0)this.m_pVolumeDragElem.className+=" volume-drag";this.m_volumeLeft=WMP.WMPlayer.translateOffset(this.m_pVolumeDragElem);this.m_volumeWidth=this.m_pVolumeDragElem.offsetWidth;this.m_pVolumeDragHandlers={volume_onDrag:WMP.WMPlayer.createHandler(this,"volume_onDrag"),volume_onDragStop:WMP.WMPlayer.createHandler(this,"volume_onDragStop")};WMP.WMPlayer.attachHandler(document,"mousemove",this.m_pVolumeDragHandlers.volume_onDrag);WMP.WMPlayer.attachHandler(document,"mouseup",this.m_pVolumeDragHandlers.volume_onDragStop);this.volume_onDrag(a)};WMP.WMPlayer.prototype.volume_onDrag=function(c){if(c&&this.m_pVolumeDragElem){var b=null,d=this.m_pVolumeDragElem.childNodes.length;for(var a=0;a<d;a++)if(this.m_pVolumeDragElem.childNodes[a].className=="volume-fill")b=this.m_pVolumeDragElem.childNodes[a];if(b){this.m_volumePos=Math.min(Math.max((c.clientX-this.m_volumeLeft)/this.m_volumeWidth,0),1);if(!isNaN(this.m_volumePos)){b.style.width=""+100*this.m_volumePos+"%";this.setVolume(this.m_volumePos)}}}};WMP.WMPlayer.prototype.volume_onDragStop=function(a){if(this.m_pVolumeDragElem){this.volume_onDrag(a);if(this.m_pVolumeDragElem.className.indexOf("volume-drag")>=0)this.m_pVolumeDragElem.className=this.m_pVolumeDragElem.className.replace(/\s*volume-drag/,"");WMP.WMPlayer.detachHandler(document,"mousemove",this.m_pVolumeDragHandlers.volume_onDrag);WMP.WMPlayer.detachHandler(document,"mouseup",this.m_pVolumeDragHandlers.volume_onDragStop);this.m_pVolumeDragHandlers=null;this.m_pVolumeDragElem=null;this.m_volumeLeft=null;this.m_volumeWidth=null}};WMP.WMPlayer.button_onUpdateState=function(b,a){return function(){if(!b||!b.m_player)return;var c=this;c.disabled=!b.m_player.controls.isAvailable(a);if(c.disabled){if(c.className.indexOf("button-"+a+"-disabled")<0)c.className+=" button-"+a+"-disabled"}else if(c.className.indexOf("button-"+a+"-disabled")>=0)c.className=c.className.replace(new RegExp("s*button-"+a+"-disabled"),"");if(c.m_isPressed){if(c.className.indexOf("button-"+a+"-press")<0)c.className+=" button-"+a+"-press"}else if(c.className.indexOf("button-"+a+"-press")>=0)c.className=c.className.replace(new RegExp("s*button-"+a+"-press"),"")}};WMP.WMPlayer.button_onPressChanged=function(a,b){return function(){if(!a)return;var c=this;c.m_isPressed=b;if(a.m_updateMethod)a.m_updateMethod()}};WMP.WMPlayer.playButton_onUpdateState=function(a){return function(){if(!a||!a.m_player)return;var b=this,c="play";if((a.m_player.playState==3||a.m_player.playState==6)&&a.m_player.controls.isAvailable("pause")){b.className="button-pause";b.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_pause);b.href="#pause";c="pause"}else if(a.m_player.controls.isAvailable("play")){b.className="button-play";b.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_play);b.href="#play"}else{b.className="button-play button-play-disabled";b.title=decodeURIComponent(WMP.WMPlayer.m_strings.wmplayer_play);b.href="#play"}if(b.m_isPressed){if(b.className.indexOf("button-"+c+"-press")<0)b.className+=" button-"+c+"-press"}else if(b.className.indexOf("button-"+c+"-press")>=0)b.className=b.className.replace(new RegExp("s*button-"+c+"-press"),"")}};WMP.WMPlayer.mute_onUpdateState=function(a){return function(){if(!a||!a.m_player)return;var b=this,c="mute";if(a.m_player.settings.mute){c="muted";if(b.className.indexOf("button-muted")<0)b.className+=" button-muted"}else if(b.className.indexOf("button-muted")>=0)b.className=b.className.replace(/\s*button-muted/,"");if(b.m_isPressed){if(b.className.indexOf("button-"+c+"-press")<0)b.className+=" button-"+c+"-press"}else if(b.className.indexOf("button-mute-press")>=0||b.className.indexOf("button-muted-press")>=0)b.className=b.className.replace(new RegExp("s*button-mute([d]?)-press"),"")}};WMP.WMPlayer.seekFill_onUpdateState=function(a){return function(){if(!a||!a.m_player)return;var c=this;if(!a.m_pSeekDragElem){var b=a.m_player.controls.currentPosition/a.m_player.controls.currentItem.duration;if(!isNaN(b))c.style.width=""+100*b+"%"}}};WMP.WMPlayer.volumeFill_onUpdateState=function(a){return function(){if(!a||!a.m_player)return;var b=this;if(!a.m_pVolumeDragElem)b.style.width=""+a.m_player.settings.volume+"%"}};WMP.WMPlayer.timeLabel_onUpdateState=function(a){return function(){if(!a||!a.m_player)return;var d=this,b=a.m_player.controls.currentPositionString;if(b)b+=" / ";b+=a.m_player.currentMedia.durationString;var e=d.childNodes.length;for(var c=0;c<e;c++)if(d.childNodes[c].nodeType==3){d.childNodes[c].nodeValue=b;return}}};WMP.WMPlayer.createHandler=function(a,b){return function(c){c=c?c:window.event;var d=a?a[b](c):false;return d?true:false}}