new function(){var n=window,q=n.document,a=n.$WLXIM,Bb=n["$Config"]||{},db=Bb.WebIM||{},Mb=db.imgBase,k="",Qb="0",g="style",i="length",t="innerHTML",l="px",S="&nbsp;",Ab="character",Q="parentNode",ub="firstChild",R="className",v="appendChild",d=null,f=true,b=false,p="get_contact",J="get_address",nb="get_currentAddress",P="get_propertyName",K="get_presence",x="add_propertyChanged",D="remove_propertyChanged",H="add_collectionChanged",F="remove_collectionChanged",bb="onmousedown",ob="onmousemove",sb="onmouseup",z="onunload",Y="onfocus",ab="onfocusin",wb="onfocusout",Db="onselectstart",h="onclick",Hb="onresize",Ib="onkeyup",N="onkeydown",Eb="ondragstart",Fb="onmouseover",tb="onscroll",qb="onmouseout",Jb="onblur",fb="c_clr",rb="c_chev",E="width",Gb="overflowY",y="height",Kb=$B.rtl?"right":"left",Lb="top",r="display",B="none",O="block",kb="inline",Z="visibility",zb="visible",jb="hidden",M="currentStyle",V="auto",gb="paddingTop",eb="paddingBottom",j="DIV",o="SPAN",m="A",I="LI",X="UL",Nb="live.shared.strings.webim.client.",vb="live.shared.marketinfo.webim.client.",w="live.shared.globalsettings.webim.client.",Pb="Sms",mb="MobileSpecialContactTemplate",C=$B.Mobile;function e(a){return s(Nb,a)}function s(b,c){var a=k;if(n["GetString"])a=n.GetString(b+c);return a}function G(b,e,c){var a=b?b.get_item(e):d;if(a==d)a=c;return a}function A(a,b,c){if(a)a.set_item(b,c)}function c(e,c,d,b){var a=q.createElement(e);if(e==m){a.href="#";a.setAttribute(h,"return false;")}if(b)a[t]=b;if(d)a[R]=d;if(c)c[v](a);return a}function pb(a){U(a);c(o,a,"c_ms");U(a)}function U(a){c(o,a,d,"&nbsp; ")}function T(a,b){return $IS.CreateFromConfig(a,b,Mb)}function xb(a){if(a<10)a=Qb+a;return a}function ib(){var a=q.body,c=a.getBoundingClientRect(),b=c.right-c.left;return a.clientWidth&&b?b/a.clientWidth:1}function Ob(){if($B.IE_M7&&ib()!=1)q.body.className=q.body.className}function cb(i,j,g){var f=i.get_addresses();for(var c=0,h=f.get_count();c<h;c++){var b=f.get_item(c),e=b.get_type();if(e==j&&(e!=a.MLM.IMAddressType.connect||!g||g==b.get_network()))return b}return d}function Cb(c,f,h){var b;if(f)b=cb(c,f,h);if(!b){b=c[nb]();if(b.get_type()==a.MLM.IMAddressType.telephone){var g=c.get_addresses();for(var d=0,i=g.get_count();d<i;d++){var e=g.get_item(d);if(e.get_capabilities().get_supportsOfflineMessages()){b=e;break}}}}return b}function W(b){var a=b?b.get_name():k;if(a=="SMS")a=e(Pb);return a}function lb(d){var b=a.MLM.PresenceStatus,c;switch(d.get_status()){case b.online:c=b.online;break;case b.busy:case b.inACall:c=b.busy;break;case b.beRightBack:case b.away:case b.idle:case b.outToLunch:c=b.away;break;case b.offline:c=b.offline}return c}function yb(){a.user.get_settings().set_signInPreference(a.MLM.SignInPreference.autoSignIn);return b}$WLXIM.getDisplayName=u;function u(c,b){var g=window["$Config"]||{},e=g.WebIM||{},a=c.get_displayName();if(!a){var f=b&&b.get_network()||c.get_linkedContacts().get_item(0).get_network(),d=e.so3||k;a=d.format(W(f))}return a}new function(){if(a.outerWindow!=n)return;var v=1e3,e,i,h=$Config,g=h.WebIM,E=h.BSI||{},o=E.BICI||{},d,r,j,q,t,k,c;a.ConversationStarted=new $Event;$Do.register("$WLXIM.ConversationStarted");function F(){if(g.p)return;a.addStateListener(m);m();$Do.register("$WLXIM.setInitialText",A);q=setInterval(B,v);n.attachEvent(z,u)}function p(b,a){if(a.get_propertyName()=="Endpoints")y()}function y(){if(c){try{if(c.GetLocalUserStatus()<=1&&!c.IsUser(h.email)){c=null;a._inform()}}catch(b){c=null;a._inform()}return}if(window.ActiveXObject)try{c=new ActiveXObject("MSNMessenger.Hotmail3Control");if(c){if(!c.IsUser(h.email))c=null;else{var d=c.GetLocalUserStatus();c.SetLocalUserStatus(d)}a._inform()}}catch(b){c=null;a._inform()}}function u(){clearInterval(q);a.removeStateListener(m);n.detachEvent(z,u);a.ConversationStarted.dispose();if(j)a.user.get_address()[D](p)}function m(){if(!j&&a.hasPresence()){j=1;a.user.get_address()[x](p)}if(!C&&!r&&(a.hasPresence()||a.isUnsupported())){r=1;e=document.createElement("iframe");e.src="/Handlers/WebIMPop.mvc?0&biciNoLDParse=1&V=6&domain="+document.domain;e.style.display="none";var b=_d.getElementById("head")||_dh;b.appendChild(e)}}a.displaySendSMS=function K(d){if(d&&d.get_isContact()&&!d.get_isBlocked()&&(g.sms=="1"&&!c||a.validSMSEndpoint(d)>0)){var h=d.get_addresses();for(var e=0,i=h.get_count();e<i;e++)if(h.get_item(e).get_type()!=a.MLM.IMAddressType.connect)return f}return b};function l(b){var a;if(!d){d=s(w,"SMSAreaCodeDenyList").split(",");for(a=0;a<d.length;a++)d[a]="+1"+d[a]}for(a=0;a<d.length;a++)if(b.indexOf(d[a])==0)return 0;return 1}a.validSMSEndpoint=function I(g){var e,c=g.get_addresses(),f,d,b;if(c){f=c.get_count();for(b=0;b<f;b++){d=c.get_item(b);if(d.get_type()==a.MLM.IMAddressType.telephone){e=d[J]();break}}return a.checkValidSMSNumber(e)}return 0};a.checkValidSMSNumber=function G(a){if(a)if(a.indexOf("+1")==0&&a.length==12)return l(a);else if(a.length==10&&l("+1"+a))return 3;else if(a.length==11&&a[0]=="1"&&l("+"+a))return 4;else if(a.length<12&&a.indexOf("+")<0)return 2;return 0};a.startConversation=function H(e,m,i,n){i=i||"Other";$BSI.reportEvent("ClickedSelected.Messaging.IMConversation",{StartLocation:i},1);if(c){var f=a.ML.Messenger,h=Cb(e,m,n),d,o=e.get_cid();if(o)d="cid:"+o;else{var l=h[J](),j=h.get_type();if(j==f.IMAddressType.telephone)d="tel:+"+l;else if(j==f.IMAddressType.yahoo)d="yahoo:"+l;else if(j==f.IMAddressType.connect)d="mri:"+h.get_id();else d=l}c.InstantMessage2(d,k,0);return}if(!g.p&&a.hasPopout()){a.popout(e);return}$Do.when("wlxim_startconversation",0,e,1,m,k,n);a.ConversationStarted.fire(b)};a.popout=function O(a){if(i){if(!a){var b=o.urlHash;o.urlHash=e.contentWindow.urlHash;$BSI.informNav(0,0,0,0,1);o.urlHash=b}e.contentWindow.popout(a);i=false}};a._popoutReady=function L(){i=true};a.hasPopout=function N(){return !g.p&&$Cookie.getCookie("wimpop")=="1"};a.hasActiveX=function M(){return c};function B(){var b=a.hasPopout();if(t!=b){t=b;a._inform()}}function A(a){k=a}F()};var hb=new function(){var k=this,s=2e3,c,l,h,g=b,a=[],e=f,j=b;n.attachEvent(z,p);q.attachEvent(ab,o);q.attachEvent(wb,m);function p(){q.detachEvent(ab,o);q.detachEvent(wb,m);n.detachEvent(z,p)}k.get_hasFocus=function u(){return e};k.removeFromRotation=function t(b){a.remove(b);if(a[i]==0){clearInterval(h);h=0;q.title=c||""}};k.addToRotation=function v(b){a.push(b);if(!h){c=q.title;h=setInterval(r,s);r()}};function r(){var b=q.title;if(b!=l)c=b;var d=c;if(b==c){g=g%a[i];d=a[g];g++}l=q.title=d}function o(){e=f;if(event.srcElement.tagName=="OBJECT")j=f}function m(){if(j){j=b;return}try{if(event.toElement==d)if(event.srcElement&&event.srcElement.tagName!="OBJECT")e=b}catch(a){e=b}}};a.getUniqueId=L;function L(b){var a=b.wlximUniqueId;if(a)return a;if(b.get_isEmailOnlyContact())a=b.get_emailAddress();else{var e=b.get_addresses(),c=e.get_item(0),d=c.get_type();a=c.get_id()+c[J]()+d}b.wlximUniqueId=a;return a}new function(){if(a.outerWindow!=n)return;var b,q=0,c;a.onlineCount=0;a.unreadMailCount=0;a.invitationsCount=0;var O="wlxim_online_count",t="cid",e=[],j=[],h=[];function y(){a.addStateListener(r);window.attachEvent(z,u);r()}function u(){a.removeStateListener(r);if(b)b.remove_initialized(k);if(q){a.user.get_onlineContacts()[F](p);a.user.get_mailbox()[D](m);a.user.get_pendingContacts()[F](l);if(c)clearTimeout(c)}window.detachEvent(z,u)}function r(){if((a.hasNotify()||a.hasPresence())&&!q){c=setTimeout(w,1e3);a.verifyLocalStorageCid(b);var d;if(window["$HeaderCookie"])d=$HeaderCookie.getContactsCount();else d=0;a.onlineCount=d;if(d!=0)g(e)}}function w(){a.user.get_onlineContacts()[H](p);p();a.user.get_mailbox()[x](m);m();a.user.get_pendingContacts().add_collectionChanged(l);l();q=1;c=d}a.addUnreadMailCountListener=function I(b){j.push(b);if(a.unreadMailCount!=0)f(b)};a.removeUnreadMailCountListener=function C(a){o(a,j)};a.addOnlineCountListener=function L(b){e.push(b);if(a.onlineCount!=0)f(b)};a.removeOnlineCountListener=function K(a){o(a,e)};a.addInvitationsCountListener=function E(b){h.push(b);if(a.invitationsCount!=0)f(b)};a.removeInvitationsCountListener=function B(a){o(a,h)};function o(b,a){var c=a.remove(b)}a.getReconnectingTime=function N(){var b=a.user.get_autoReconnectWaitTime(),c=s(Math.floor(b/60));b=s(b%60);return {min:c,sec:b}};function s(a){if(a<10)a="0"+a;return a}function p(){var b=parseInt(a.user.get_onlineContacts().get_count());a.onlineCount=b=Math.max(0,b);g(e)}function m(){var b=parseInt(a.user.get_mailbox().get_inboxUnreadCount());a.unreadMailCount=Math.max(0,b);g(j)}function l(){var e=a.user.get_pendingContacts(),i=a.user.get_pendingContacts().get_count(),d=0;for(var b=0;b<i;b++){var f=e.get_item(b),c=f.get_imAddress();if(c&&c.get_type()==a.MLM.IMAddressType.windowsLive)d++}a.invitationsCount=Math.max(0,d);g(h)}function g(c){var a=0,b=c.clone(),d=b[i];for(;a<d;a++)f(b[a])}function f(b){try{b()}catch(a){$WebWatson.submitFromException(a,d,97)}}a.verifyLocalStorageCid=function M(b){if(a.user&&b){var c=a.user[J]().get_cid();if(c&&c!=G(b,t,0)){b.clear();A(b,t,c)}}};function v(){if(!a.ML||!a.ML.Core||!a.ML.Core.LocalStorageProxy)$WebWatson.submitFromException(new Error("Web IM Error - Microsoft.Live.Core.LocalStorage Not found"),d,90);else{b=new a.ML.Core.LocalStorageProxy("wlxim_helper");b.add_initialized(k)}}function k(d,c){y();if(c.get_status()!=a.ML.Core.LocalStorageStatus.initialized){b.remove_initialized(k);b=0}}$Do.when("wlximlocalstoreready",0,v)};new function(){var q;function A(){var W=this,Ob="c_mm_clc",Wb="c_mm_gi",bc="DisplayName",fc="Status",ec="Groups",rb="wlxim_new_message",C="al",fb="z",ac="l",Cb="s",Xb="ug",Pb="un",M="af",Z="cc",A={},R={},U=[],hb={},gb={},ab,ib,xb,sb,G,vb,eb=0,cb={};function hc(){a.addStateListener(Tb);window.attachEvent(z,W.dispose)}W.initialize=function kc(a){if(!cb[a]){var b=$(Ob+a);if(!b)return;A[a]=b.list=new gc(b,a);cb[a]=1;$Do.register("$WLXIMCL"+a);A[a].updateStatus()}if(!q)$Do.when("$WLXIMCL.prereqs",0,a);else Zb(a)};function Zb(g){if(!eb&&a.hasPresence()){G=a.user;var c=G.get_onlineContacts(),k=c.get_count(),f=G.get_groups(),d=G.get_networks();f[H](Nb);c[H](Hb);d[H](Mb);function h(a){var b=bb(a);if(b!=M)vb=1;qb(a)}for(var b=0,j=f.get_count();b<j;b++)h(f.get_item(b));for(var b=0,j=d.get_count();b<j;b++){var i=d.get_item(b);if(wb(i))h(i)}qb(0,C,e("ContactList.All"));qb(0,fb,e("ContactList.OtherContacts"));for(var b=0;b<k;b++){var l=c.get_item(b);Ub(l)}U.sort(dc);eb=1}if(eb&&cb[g]==1){A[g].initialize();cb[g]=2}}W.dispose=function mc(){a.removeStateListener(Tb);if(eb){var f=G.get_contacts(),c=G.get_onlineContacts(),e=G.get_emailOnlyContacts(),i=G.get_groups(),g=G.get_networks();c[F](Hb);i[F](Nb);g[F](Mb);for(var b=0,j=c.get_count();b<j;b++){var h=c.get_item(b);Sb(h)}if(xb){f[F](Lb);e[F](Fb)}if(sb)a.user.get_conversations()[F](Kb)}for(var b in A)if(!FunctionHelper.isSpecialMember(A,b)){A[b].dispose();delete A[b]}window.detachEvent(z,W.dispose);$WLXIMCL=d};function Sb(a){a[D](db);a[K]()[D](db)}W.initSearch=function lc(){if(!xb){ab=new $Trie(Rb);ib=new $Trie(Rb);var c=G.get_contacts(),b=G.get_emailOnlyContacts();for(var a=0,d=c.get_count();a<d;a++){var f=c.get_item(a);kb(ab,f)}for(var a=0,d=b.get_count();a<d;a++){var e=b.get_item(a);kb(ib,e)}c[H](Lb);b[H](Fb);xb=1}};W.ChangeGroup=function jc(a){var a=a||event,d=a.target||a.srcElement,c=$f.pn(d,Wb),e=c?c.g:0,b=$f.pn(d,Ob);if(b.list)b.list.changeGroup(e)};W.Resize=function nc(b){var a=$("c_mm_clc"+b);if(a.list)a.list.resize()};W.AttachOpenConversationsListener=function ic(){if(!sb){sb=true;a.user.get_conversations()[H](Kb)}};W.getListById=function(a){return A[a]};function Eb(b){var a=bb(b);if(!R[a]){qb(b);if(a!=M)vb=1;else Bb(b);for(var c in A)if(!FunctionHelper.isSpecialMember(A,c))if(A[c].listInitialized)A[c].changeGroup(a,1)}}function Bb(d){var b=d.get_contacts();for(var a=0,c=b.get_count();a<c;a++){var e=L(b.get_item(a));gb[e]=a+""}}function qb(a,b,c){var d;if(a){b=bb(a);c=cc(a);if(Vb(a))d=a.get_id()}R[b]={name:c,count:0,networkID:d};U.push(b)}function Ub(a){var e=tb(a).groupsNetworks,d=e[i],g=L(a);a[x](db);a[K]()[x](db);if(d>=1)for(var c=0;c<d;c++){var b=e[c],f=bb(b);Eb(b);if(ob(b))Bb(b)}db(a)}function bb(a){if(ob(a))return M;else{var c=a.get_name(),b=Xb;if(Vb(a))b=Pb;return b+c}}function cc(a){if(ob(a))return e("ContactList.Favorites");else return a.get_name()}function tb(b){var a=b.get_groups().slice(0),c=a.length;Yb(b,a);return {groupsNetworks:a,groupOnlyCount:c}}function Yb(g,a){a=a||[];var c=g.get_addresses(),e=c.get_count(),b=0;for(;b<e;b++){var f=c.get_item(b),d=f.get_network();if(wb(d))a.push(d)}return a}function ob(a){return a.get_isFavorites&&a.get_isFavorites()}function Vb(a){return a.get_supportsIM}function wb(b){if(!b||!b.get_supportsIM())return 0;var a=b.get_id();return a!="WL"&&a!="OCS"&&a!="YH"&&a!="SMS"}function Tb(){for(var b in A)if(!FunctionHelper.isSpecialMember(A,b))A[b].updateStatus();if(!eb&&a.hasPresence())for(var b in cb)if(!FunctionHelper.isSpecialMember(A,b))W.initialize(b)}function Nb(b){for(var a=0,d=b.get_count();a<d;a++){var c=b.get_item(a);Eb(c)}}function Mb(c){for(var a=0,d=c.get_count();a<d;a++){var b=c.get_item(a);if(wb(b))Eb(b)}}function Lb(f,e){var a=e.get_newItems();if(a)for(var b=0,d=a.length;b<d;b++){var c=a[b];kb(ab,c)}}function Fb(f,e){var a=e.get_newItems();if(a)for(var b=0,d=a.length;b<d;b++){var c=a[b];kb(ib,c)}}function Hb(f,e){var a=e.get_newItems();if(a)for(var b=0,d=a.length;b<d;b++){var c=a[b],g=L(c);Ub(c)}}function db(f,i){var a=f[p]?f[p]():f,b=L(a),e=a.get_isOnline(),c,h,g;if(i){var d=i[P]();c=d==bc;h=d==fc;g=d==ec}if(c&&ab)ab.insert(u(a).toLowerCase(),a);if(hb[b])if(!e||g){hb[b]=0;Db(a,-1);if(!e)Sb(a)}else if(h||c)Db(a);if(!hb[b]&&e){hb[b]=1;Db(a,1)}}function Kb(d,c){for(var b in A)if(!FunctionHelper.isSpecialMember(A,b)){var a=A[b];if(a.listInitialized)a.updateCurrentConversationsList(c)}}function Db(b,a){var g=a==-1,e=tb(b,g),d=e.groupsNetworks;if(e.groupOnlyCount==0&&Qb(b))Ab(b,fb,a);for(var c=0,f=d[i];c<f;c++){if(ob(d[c])&&a==1)Bb(d[c]);Ab(b,bb(d[c]),a)}Ab(b,C,a)}function Qb(g){var c=g.get_addresses();for(var b=0,d=c.get_count();b<d;b++){var f=c.get_item(b),e=f.get_type();if(e!=a.MLM.IMAddressType.connect)return 1}return 0}function Ab(d,b,a){a=a||0;R[b].count+=a;for(var e in A)if(!FunctionHelper.isSpecialMember(A,e)){var c=A[e];if(c.listInitialized)if(a<0)c.removeContact(d,b);else if(a==1)c.addContact(d,b);else c.moveContact(d,b)}}function Rb(c,d){var a=L(c),b=L(d);if(a==b)return 0;if(a>b)return -1;return 1}function kb(c,a){c.insert(u(a).toLowerCase(),a);var d=a[nb](),b;if(d)b=d[J]();else b=a.get_emailAddress();if(b)c.insert(b.toLowerCase(),a);var e=a.get_firstName(),f=a.get_lastName();if(e)c.insert(e.toLowerCase(),a);if(f)c.insert(f.toLowerCase(),a)}function dc(a,b){if(a==M&&b!=C)return -1;if(a!=C&&b==M)return 1;return a.toLowerCase()>b.toLowerCase()?1:-1}function gc(cb,db){var z=this,Wc=ac,Kb="c_mm_g"+db,sc="c_mm_ci"+db,Gc="c_mm_contact",Sc=245,Bc=150,uc="InlineTemplate",bd=220,jd="c_mm_twocol",id="c_mm_threecol",Xc="c_mm_scr",Jc="c_mm_errorMsg",Rc=$B.rtl?"&#x200f;":k,Ab,Tb,Pb,H,J,Xb,A,dc,wb,Eb,Yb,F,Mb,Hb,Fb,Bb,Nb,Ub,Wb,Ob,Kc,qb,ob,Rb,hc,gc;z.listInitialized=0;var qc=0,nb=0,cd=25,eb=0,q,kb,W,sb,zc,oc,wc,Qc=k,Db={},pc,ic,Vb={},Lb={};z.ToggleEvent=new $Event;z.UpdateEvent=new $Event;function hd(){q=cb.getAttribute("r");q=q?q.toLowerCase():0;nb=parseInt(cb.getAttribute("maxc"));Ab=$("c_mm_status"+db);Tb=Ab.firstChild;H=$("c_mm_cl"+db);Pb=H.parentNode;J=H.firstChild;Xb=$("c_mm_s"+db);if(Xb){A=Xb.getElementsByTagName("INPUT")[0];dc=Xb.getElementsByTagName(o)[0];wb=$("c_mm_sr"+db);Yb=c(j,wb,d,'<ul></ul><div class="c_clr"></div>');Eb=Yb.firstChild;A.value=A.title=e("ContactList.SearchContacts");A.attachEvent(Jb,yc);A.attachEvent(Y,Nc);A.attachEvent(N,Ic);A.attachEvent(Ib,xc);dc.attachEvent(h,ec)}F=$("c_mm_links"+db);Mb=F.getElementsByTagName("A").length;if(!Mb)f(F);Hb=$("c_mm_oc"+db);Ub=$("c_mm_va"+db);if(Ub){Wb=Ub.parentNode;f(Wb);n(Ub,1)}var g='<a href="#" onclick="$WLXIM.signOut();$menu.closeCurrent();return false;">'+e("SignOut").encodeHtml()+"</a>";if(q=="header"){var b=F.firstChild,i=$Config.WebIM.pi||k,l='<a href="'+i.encodeHtmlAttribute()+'" target="_top"></a>';Bb=c(I,b,d,l);Fb=Bb.firstChild;f(Bb);Nb=c(I,d,d,g);c(o,Nb,"c_ms"," ");b.insertBefore(Nb,b.firstChild)}else{Fb=$("c_mm_pic"+db);if(Fb)Bb=Fb[Q][Q];if(q=="hotmailleftnav"||q=="home"){var b=F.firstChild;Nb=c(I,b,d,g);if(q=="home")c(o,Wb,"c_ms"," ")}}if(Fb)a.addInvitationsCountListener(Ac);Mb=F.getElementsByTagName("A").length;if(!Mb)f(F);Kc=$("c_mm_col");Ob=$("c_mm_slchev"+db);if(Ob){n(Ob);Ob.attachEvent(h,Mc)}if(q=="header")Fc();f(Nb);kb=cb.binding}function Fc(){if(!$B.IE_M6)cb[g][E]=V;var a=Bc;if(F.offsetWidth>Bc)a=F.offsetWidth;cb[g][E]=a+l}z.initialize=function(){if(!z.listInitialized){if(q=="hotmailleftnav"||q=="home")uc="InlineWebimMenuTemplate";else if(q=="popout")uc="InlinePsmTemplate";else if(q=="mobile"){qb=c(X,0,d,'<li><h2><span class="link groupText">'+e("ContactList.CurrentConversations")+"</span></h2></li>");qb[g][r]=B;qb.id=Kb+Z;qb.key=Z;J.insertBefore(qb,J.firstChild);$WLXIMCL.AttachOpenConversationsListener()}if(nb){W=1;z.changeGroup(C);if(q=="hotmailleftnav"&&window.top.$WLXIMCLExpanded)z.changeGroup()}else for(var b=0,f=U[i];b<f;b++)z.changeGroup(U[b]);a.addOnlineCountListener(Cc);setTimeout(z.resize);z.listInitialized=1;z.updateStatus()}};function Tc(){if(q=="header")eb=Sc;else if(q=="home")H[g][y]=V;else if(q=="hotmailleftnav"||q=="sacbadge"||q=="mobile")eb=0;else{var b=cb.parentNode;eb=b.offsetHeight;var a=H.offsetTop;if(q=="popout")a=a-b.offsetTop;var c=0;if(Mb)c=F.offsetHeight+$f.toInt($f.getStyle(F,"margin-bottom"));eb-=a+c;eb-=$f.toInt($f.getStyle(Pb,"margin-bottom"));eb=Math.max(eb,0)}hb(J,H)}z.resize=function(){Tc();if(q=="popout"){var e=Math.floor(H.offsetWidth/bd),a=1;for(var b=0,d=U.length;b<d;b++){var c=R[U[b]].count;if(c>a)a=c}var h=Math.min(e,a),g=Math.floor(100/h),f=".c_mm_clcPopout .c_mm_contact {width:"+g+"% !important;}";Kc[t]='&nbsp;<style type="text/css">'+f+"</style>"}};z.dispose=function(){if(Db)for(var b in Db)clearTimeout(Db[b]);z.ToggleEvent.dispose();z.UpdateEvent.dispose();if(A){A.detachEvent(Jb,yc);A.detachEvent(Y,Nc);A.detachEvent(N,Ic);A.detachEvent(Ib,xc);dc.detachEvent(h,ec);Yb=d}if(ob){Rb.detachEvent(h,nc);hc.detachEvent(h,nc);gc.detachEvent(h,Pc);ob=Rb=hc=gc=d}if(qc)kb.removeStateListener(Hc);if(Fb){a.removeInvitationsCountListener(Ac);Bb=d}if(Ob)Ob.detachEvent(h,Mc);for(var b in Vb)if(!FunctionHelper.isSpecialMember(Vb,b))cc(b);if(z.listInitialized)a.removeOnlineCountListener(Cc)};function Ec(c){var a=$(Kb+Z).children;for(var b in a)if(a[b]&&a[b].conv==c)return a[b]}function Dc(b,c){if(c[P]()=="HasUnreadMessages"){var a=Ec(b);if(a)b.get_hasUnreadMessages()?$css.add(a,rb):$css.remove(a,rb)}}function Uc(a){var d=a.get_roster(),c=d.get_item(0)[p](),b=vc(c,Z,0);b.conv=a;a[x](Dc);a.get_hasUnreadMessages()?$css.add(b,rb):$css.remove(b,rb);qb.appendChild(b)}z.updateCurrentConversationsList=function(f){if(q=="mobile"){var c=f.get_oldItems();if(f.get_action()==a.MLM.NotifyCollectionChangedAction.reset){c=[];var j=$(Kb+Z).children;for(var h=1;h<j.length;h++)c.push(j[h].conv)}if(c)for(var b=0,k=c[i];b<k;b++){var e=Ec(c[b]);if(e){cc(e.icid);c[b][D](Dc);qb.removeChild(e)}}var d=f.get_newItems();if(d)for(var b=0,l=d[i];b<l;b++)Uc(d[b]);qb[g][r]=qb.children.length<2?B:O}};function cc(a){if(a){var b=Vb[a].getElementsByTagName(m)[0];if(!b)b=Vb[a];b.detachEvent(h,kc);$ic.ic.removeIC(a);delete Vb[a]}}function Mc(){z.ToggleEvent.fire(z)}z.changeGroup=function(c,o){if(nb&&W&&o)return;if(!sb){var m=G.get_contacts().get_count();sb=m>=cd||vb||q=="mobile";if(sb)for(var d=0,l=U.length;d<l;d++){var b=xb(U[d]);if(b&&b.empty){Lc(b);mc(c,b)}}}var k,a=[];if(!c){k=1;W=!W;window.top.$WLXIMCLExpanded=q=="hotmailleftnav"&&!W;if(Ub)Ub[t]=W?e("ContactList.ShowAll"):e("ContactList.ShowLess");if(W){a.push(C);tc(U,0,1)}else{c=fb;a.push(C)}}else a.push(c);if(sb&&!W){if(!nb){ad(C);if(c==C)return}a=U}for(var d=0,l=a[i];d<l;d++){var h=a[d],j=h==C;if(!W&&sb&&j)continue;var b=xb(h);if(!b)b=Zc(h);if(!W)if(!sb&&!j)f(b);else n(b);else tc(a,nb)}if(k){if(!sb)f(xb(M));if(!W){tc(a);if(sb)f(xb(C))}}if(lc())Sb(1);else Sb();H[g][Gb]=jb;setTimeout(function(){H[g][Gb]=q=="home"?zb:V},0);Wc=c;setTimeout(function(){hb(J,H)},0)};function lc(){return nb<R[C].count}function Sb(a){if(a){if(Mb){n(Wb,1);n(F)}}else{if(Wb&&Mb==1)f(F);f(Wb)}}function xb(a){return $(Kb+a)}function tc(h,j,k){for(var e=0,l=h[i];e<l;e++){var m=h[e],a=xb(m);if(a){var d=a.children,c=j;if(!c)c=d[i]-1;var b=j?1:0;for(;b<=c;b++)if(k)f(d[b]);else n(d[b]);if(k)f(a);else n(a)}}if(q=="home"){H[g][y]=cb.parentNode[g][y]=V;eb=0}}function Zc(a){var h='<span class="link groupText">'+R[a].name.encodeHtml()+"</span>",n=0;if(a==C||a==M)n="alf";if(q=="mobile")h="<h2>"+h+"</h2>";var b=c(X,0,n,'<li class="groupText">'+h+"</li>");b.id=Kb+a;b.key=a;Lb[a]={groupEl:b,contacts:[]};fc(b,J,"id");if(W||a==C)b.firstChild[g][r]=B;var f=[];if(!R[a].count)mc(a,b);else{var o=G.get_onlineContacts(),e=0;for(var j=0,s=o.get_count();j<s;j++){var d=o.get_item(j);if(a==C){f.push(Zb(d,a,b));e++}else{var l=tb(d),m=l.groupsNetworks,p=m[i];if(a==fb){if(l.groupOnlyCount<1&&Qb(d)){f.push(Zb(d,a,b));e++}}else for(var k=0;k<p;k++)if(a==bb(m[k])){f.push(Zb(d,a,b));e++}}}if(!e)mc(a,b);else{Lb[a].contacts=Lb[a].contacts.concat(f);jc(a)}}return b}function ad(d){var a=xb(d);if(a){var c=a.children;for(var b=0,f=c[i];b<f;b++){var e=c[b];cc(e.icid)}a.parentNode.removeChild(a)}}function Zb(b,a,c){return {contact:b,groupKey:a,groupEl:c}}function jc(b,e){var f=Lb[b];if(f){var c=f.contacts,h=c[i],j=Math.min(h,10),g=0;while(g<j){var a=c.shift();if(e)vc(a.contact,a.groupKey,a.groupEl);else ed(a.contact,a.groupKey);g++}if(e)hb(Yb,wb);else hb(J,H);if(c[i]>0)Db[b]=setTimeout(function(){jc(b,e)},100);else Db[b]=d}}function mc(j,b){var a,d=k;if(j==M&&!G.get_groups().get_favorites().get_contacts().get_count()){f(b);b.hidden=1}if(sb){a=e("ContactList.NoContactsCategory");d="c_mm_nco"}else{var h=G.get_contacts().get_count(),i=$Config.WebIM.af||k,g='<a href="'+i.encodeHtmlAttribute()+'" target="_top">';if(q=="hotmailleftnav"&&h)a=e("ContactList.NoWLContacts").format(g,"</a>");else if(q=="home"&&h){a=e("ContactList.Home.NoContacts").format(g,"</a>");d="c_mm_ncoh"}else{a=e("ContactList.NoContactsOnline");d="c_mm_nco"}}var l=c(I,b,d,bc(a));b.empty=1}function Lc(a){a.removeChild(a.lastChild);a.empty=0}function vc(b,f,x){var i=1,j,r,d=uc;if(q=="mobile"&&(f==M||f==Z))d=mb;if(d=="InlineWebimMenuTemplate"){i=0;j=6;r=1;if(q=="home")j=0}else if(d=="InlinePsmTemplate"||d==mb)i=0;var p=$ic.ic.createICFromTemplate(d,b,0,0,0,0,0,0,0,0,0,0,"0",j,r,1),o=p.html;if(i)o='<a href="#" class="c_ml" onclick="return false;">'+o+"</a>";var a=c(I,x,Gc,o),w=L(b);a.id=sc+w+f;a.icid=p.id;a.isFavorite=0;var n=gb[w],l=u(b),g=l;if(f==M){g=n;a.isFavorite=1}else if(f==C)if(n){g=n+l;a.isFavorite=1}else g="z"+l;a.name=g;a.contact=b;if(d==mb)a.attachEvent(h,kc);else{var e=a.getElementsByTagName(m)[0];if(b.get_isEmailOnlyContact()){e.onclick=k;var t=b.get_profileUrl();if(t)e.href=t;else{var s=$Config.WebIM.pd,v=b.get_id();if(s&&v)e.href=s+"?ContactId="+v}if(q=="popout")e.setAttribute("target","")}else e.attachEvent(h,kc)}Vb[p.id]=a;return a}function kc(c,d){if(!d){var c=c||event,e=c.target||c.srcElement;d=$f.pn(e,Gc)}var b;if(q=="header")b="Header";else if(q=="home")b="HomePage";else if(q=="hotmailleftnav")b="LeftNav";else if(q=="popout")b="PopOut";else if(q=="slideshow")b="SlideShow";else if(q=="sacbadge")b="SACBadge";else if(q=="mobile")b="Mobile";a.startConversation(d.contact,0,b);$menu.closeCurrent()}function Cc(){if(Hb){var b=a.onlineCount;if(b==0)f(Hb);else if(a.hasPresence()){n(Hb,1);Hb[t]="&nbsp;"+Rc+"("+b+")"}}}function Ac(){var b=a.invitationsCount;if(b){var c;n(Bb);if(q=="header")c=e("ContactList.Header.Inivtations.Text").format(Rc+"("+b+")");else{var d="Invitations";if(b==1)d="Invitation";c=e("ContactList."+d).format(b)}Fb[t]=c}else f(Bb);hb()}z.addContact=function(c,a){var b=xb(a);if(!b)return;Lb[a].contacts.push(Zb(c,a,b));if(!Db[a])Db[a]=setTimeout(function(){jc(a)},100)};function ed(i,b){var a=xb(b);if(a.empty){Lc(a);a=J.removeChild(a);fc(a,J,"id")}else if(b==M||b==C){var e=a.children;for(var c=0,g=e.length;c<g;c++){var d=e[c].contact;if(d){var f=L(d),h=u(d);if(gb[f])e[c].name=gb[f]+h}}}var j=vc(i,b,0);fc(j,a,"name",1);if(lc())Sb(1);hb(J,H);return a}z.moveContact=function(d,c){var e=L(d),a=$(Kb+c),b=$(sc+e+c);if(a&&b){a.removeChild(b);if(W&&c==C)rc(0,a);fc(b,a,"name",1)}hb(J,H)};function fc(e,c,k,h){var d=c.children,g=0,f=h?1:0,j=d[i],a,l=e[k];while(j>=f){a=Math.floor((j-f)/2)+f;if(!d[a])break;if(Yc(e,d[a],k,h)==1){f=a+1;g=0}else{j=a-1;g=1}}var b=d[a];if(!g&&b){b=b.nextSibling;a++}if(b)c.insertBefore(e,b);else c[v](e);if(h&&W)rc(1,c,a)}function Yc(a,b,i,l){var g=a[i].toLowerCase(),h=b[i].toLowerCase();if(l){if(!a.isFavorite&&!b.isFavorite){var j=lb(a.contact[K]()),k=lb(b.contact[K]());if(j<k)return -1;else if(k<j)return 1}if(g<h)return -1;return 1}var e=a.key,f=b.key;if(q=="mobile"){if(e==Z)return -1;if(f==Z)return 1}if(e==M)return -1;if(f==M)return 1;var c=R[e],d=R[f];if(c&&d){if(c.count>0&&d.count==0)return -1;if(c.count==0&&d.count>0)return 1}if(g<h)return -1;return 1}function rc(c,d,b){var a=d.children,e=a[i]-1;if(e>=nb)if(c)if(b<=nb){f(a[nb+1]);n(a[b])}else f(a[b]);else n(a[nb])}z.removeContact=function(d,b){var f=L(d),a=$(Kb+b),c=$(sc+f+b);if(a&&c){var e=c.icid;cc(e);a.removeChild(c);if(!R[b].count){mc(b,a);a=J.removeChild(a);fc(a,J,"id")}if(W&&b==C)rc(0,a)}if(!lc())Sb();hb(J,H)};z.updateStatus=function(){if(z.listInitialized&&a.hasPresence()){n(Nb,q=="home");if(q=="header"&&zc){Fc();$css.remove(F,"c_mm_clrzm");zc=0}else if(q=="hotmailleftnav"||q=="home")n(F);n(Pb);n(Xb);n(Hb,1);f(Ab);if(lc())Sb(1);if((q=="home"||q=="hotmailleftnav")&&a.isFull()&&a.user.get_settings().get_signInPreference()==a.MLM.SignInPreference.none){Vc();n(ob)}}else{f(Xb);ec();f(Pb);f(Hb);f(Nb);f(ob);n(Ab);Sb();if(q=="hotmailleftnav"||q=="home")f(F);if((a.isOff()||a.hasNotify())&&!a.hasPresence()&&!a.isLoading()){if(q=="header"){zc=1;cb[g][E]=V;$css.add(F,"c_mm_clrzm")}Tb[t]='<a href="#" onclick="$WLXIM.signIn();$Do.when(\'$WLXIMCL.initialize\',0,'+db+');return false">'+e("ContactList.TurnOn")+"</a>"}else if(a.isError())if(a.isUnsupported()&&q!="popout"){if(q=="header"){cb[g][E]=V;$css.add(F,"c_mm_clrzm")}Tb[t]='<a href="#" onclick="$WLXIM.popout();return false">'+e("Popout")+"</a>"}else{if(q=="header"){f(Ab);cb[g][E]=V;cb[g][E]=F.offsetWidth+l;n(Ab)}else if(q=="home")$css.add(Ab[ub],Jc);Tb[t]=bc(e("ServerBusy"))}else if(a.isWaitingToReconnect()){var b=a.getReconnectingTime();Tb[t]=bc(e("InfoBar.Reconnecting").format(b.min,b.sec));setTimeout(z.updateStatus,1e3)}else if(a.isLoading()||!z.listInitialized)Tb[t]=bc(e("ContactList.Loading"));else f(Ab)}hb()};function Vc(){if(!ob){ob=c(I,d,"c_mm_status c_mm_fr");var b=c(j,ob,Jc);Rb=c(m,b,"c_mm_frclose");var f=T(s(w,"ImageStripConfig"),s(w,"ImageStrip.Close"));Rb[v](f);c(o,Rb,d,S);Rb.attachEvent(h,nc);var a=c(j,b,"c_mm_frtext");c(o,a,d,e("InfoBar.FirstRun"));c("br",a);hc=c(m,a,d,e("InfoBar.FirstRunSignIn"));hc.attachEvent(h,nc);pb(a);gc=c(m,a,d,e("SignOut"));gc.attachEvent(h,Pc);c(j,b,"c_clr"," ");cb.insertBefore(ob,cb.firstChild)}}function Pc(){a.signOut();f(ob);return b}function nc(){yb();f(ob);return b}function bc(a){return '<div class="statusText"><span>'+a+"</span></div>"}function Hc(){if(!kb.isOpen()&&oc)ec()}function yc(){if(A.value==k){Oc();A.value=e("ContactList.SearchContacts");A.className="c_mm_sbhint";A.s=0}if(kb)kb.keepHoverMenuOpen=0}function Nc(){$WLXIMCL.initSearch();if(!A.s){A.s=1;A.value=k;A.className=k;if(kb&&!qc){kb.addStateListener(Hc);qc=1}}if(kb)kb.keepHoverMenuOpen=1}function ec(){if(oc){A.value=k;yc()}}function Oc(){oc=0;n(Pb);f(wb);f(wb.nextSibling);f(dc);hb(J,H)}function gd(){oc=1;f(Pb);n(wb);n(wb.nextSibling);n(dc);hb(Yb,wb)}function Ic(a){a=a||event;var b=a.keyCode||a.which;if(b==13)xc(a,1)}function xc(c,d){c=c||event;var a=A.value;d=d||c.keyCode==13||c.which==13;var f;if(Qc==a)if(d){var e=Eb.getElementsByTagName(m);if(e[i]>0){var b=e[0].parentNode;b=b.tagName=="LI"?b:b.parentNode;kc(0,b);a=k}f=1}Qc=a;if(a==k)if(d)ec();else Oc();else{if(wc)clearTimeout(wc);wc=setTimeout(function(){fd(a)},100)}if(f)return $f.cancelEvent(c)}function fd(l){Lb[Cb]=d;var b=Eb.children;for(var a=0,o=b[i];a<o;a++){var n=b[a],m=n.icid;if(m)cc(m)}Eb[t]=k;var h=ab.matchPrefix(l.toLowerCase());h.sort(dd);var f=ib.matchPrefix(l.toLowerCase());f.sort();var j=h.concat(f),c=j[i];if(c<1)Eb[t]="<li>"+bc(e("ContactList.NoResults"))+"</li>";else{var g=[];for(var a=0;a<c;a++)g.push(Zb(j[a],"search",Eb,0));Lb[Cb]={groupEl:Eb,contacts:g};jc(Cb,1)}gd()}function dd(c,d){var a=c.get_isOnline(),b=d.get_isOnline();if(a&&!b)return -1;if(!a&&b)return 1;return u(c).toLowerCase()>u(d).toLowerCase()?1:-1}function hb(a,c){if(!pc)pc=setTimeout(function(){b()},0);if(!ic&&a&&$B.IE)ic=setTimeout(function(){b(1)},100);function b(f){if(f){clearTimeout(ic);ic=d}else{clearTimeout(pc);pc=d}if(a&&c&&eb){var b,e=Math.max(a.offsetHeight,0);if(e>eb-2){b=eb;a.className=Xc}else{b=e+2;a.className=k}c[g][y]=b+l}if(kb)kb.update();z.UpdateEvent.fire(z)}}hd()}hc()}function f(a){if(a)a[g][r]=B}function n(a,b){if(a&&!a.hidden)a[g][r]=b?kb:O}function G(){window.$WLXIMCL=new A;$Do.when("$ic",0,C);$Do.register("$WLXIMCL.initialize",$WLXIMCL.initialize);$Do.register("$WLXIMCL")}function C(){q=1;$Do.register("$WLXIMCL.prereqs",$WLXIMCL.initialize)}$Do.when("wlximuiinner",0,G)};new function(){if(a.outerWindow!=n)return;var Rb=17,Wb=S+"&#9660;",Ec="WLXIMConversation",hc="TabInlineTemplate",pc="Sms",gc="MessagesSentVia",rc="UnreadLeavingConfirmation",Nb="ImageStripConfig",Zb="ImageStrip.Close",tc="ImageStrip.Minimize",uc="ImageStrip.Restore",vc="ImageStrip.Popout",Yb="abuse",Sb="globalinfo",Cc=$B.rtl?"\u200e":k,mc=$B.rtl?"&rlm;":k,nb,Tb,Gb,Jb,Qb=$IS.toggle,Xb=d,Ub=b;a.CW={};a.RequestingFocusChanged=new $Event;a.CW.IsOpenChanged=new $Event;function Fc(){$Do.when("wlximlocalstoreready",d,wc)}function wc(){nb=new a.ML.Core.LocalStorageProxy(Ec,a.channelUrl);nb.add_initialized(ec)}function ec(c,b){if(!Tb){Tb=f;if(b.get_status()!=a.ML.Core.LocalStorageStatus.initialized){nb.remove_initialized(ec);nb=d}Jb=new Dc(nb);a.addStateListener(ac);ac();$BSI.addNavCallback(kc);n.attachEvent("onbeforeunload",oc);n.attachEvent(z,lc);a.addInnerWindowListener(bc);bc();$Do.when("$WLXIM.CW.doneLoading",0,sc)}}function sc(){$Do.register("wlxim_startconversation",jc)}$WLXIM.CW.minimize=function Lc(){if(Jb)Jb.minimize()};function oc(){if((Xb==f||Xb==d)&&Jb&&!C&&Jb.isRequestingFocus()){var a=e(rc);event.returnValue=a;return a}}function kc(c,e,d,b){var a=$Network.extractHost(c).split(":")[0];Xb=b&&a&&!a.endsWith(Bb.sd)&&a!=Bb.sd.substr(1)}function ac(){a.verifyLocalStorageCid(nb);if(a.isFull()&&!a.hasPopout()&&!a.hasActiveX())Jb.initialize();else if(a.isOff()||a.hasPopout()||a.hasActiveX())Jb.dispose()}function nc(c,g){if(c){var e=c.get_addresses().get_count(),d=a.MLM.IMAddressType;if(g!=d.windowsLive||e>1||e==1&&!cb(c,d.telephone)&&a.displaySendSMS(c))return f}return b}function jc(c,e,d,f,g){var b=Cb(c,d,g);if(d==a.MLM.IMAddressType.telephone&&(!b||b.get_type()!=d||!a.validSMSEndpoint(c)))Jb.startSmsInput(c);else fc(b,e,f)}function fc(d,a,c){var b=Jb.startConversation(d,c);if(b&&a)Jb.selectConversation(b,a)}function bc(){var b=a.innerWindow;if(b&&b!=n)b.$BSI.addNavCallback(kc)}function lc(){if(Tb){Tb=b;a.removeStateListener(ac);a.removeInnerWindowListener(bc);n.detachEvent("onbeforeunload",oc);n.detachEvent(z,lc);if(nb)nb.remove_initialized(ec);a.RequestingFocusChanged.dispose();a.CW.IsOpenChanged.dispose();if(Jb)Jb.dispose()}}function Vb(){return b}function R(c,b,a){if(c)$css.add(b,a);else $css.remove(b,a)}function dc(a){for(var b=a.children[i];b>0;b--)a.removeChild(a.children[0])}function Pb(b){function a(){b.detachEvent(Eb,Vb);n.detachEvent(z,a)}b.attachEvent(Eb,Vb);n.attachEvent(z,a)}function Ib(b){var d=[],f=b.get_count,g=f?b.get_count():b.length;for(var c=0;c<g;c++){var e=f?b.get_item(c):b[c];if(e.get_cid()!=a.user[J]().get_cid())d.push(e)}return d}function cc(g){var e=g.get_type(),c=a.MLM.IMAddressType;if(e==c.windowsLive)return f;if(e==c.connect){var d=g.get_linkedContact().get_reportAbuseUrl();return d&&d.toString()}return b}var Mb={Floating:1,Fixed:2},Ic=function(Y){var e=this,h,n,x,v=3,U=170,X=290,L="isMin",V="tabOrder",W="tabHeight",T="selTab",m,H,w,N,D,J,o,s,u,z,F,K,p;e.resize=function qb(d,e){K=e||m.offsetWidth||K;F=d||m.offsetHeight||F;if(u!=Mb.Fixed)A(nb,W,F);I();for(var a=0,c=h[i];a<c;a++){var b=h[a].get_object();if(b)b.resize()}if(o)o.restore()};e.initialize=function fb(k){h=[];m=k;if(!m){u=Mb.Floating;m=c(j,q.body,"wlxim_conv");H=c(j,m,"wlxim_shad")}else{u=Mb.Fixed;v=0}K=m.offsetWidth;F=m.offsetHeight;w=c(j,m,"wlxim_conv_ui");N=c(j,w,"wlxim_header_wrapper");D=c(j,N,"wlxim_header");J=c(j,w,"wlxim_conversations");if(u==Mb.Floating){o=new Gc(nb,m,D);o.initialize()}s=new Jc(e,u,h,m,D,P,S,Y);s.initialize();if(u!=Mb.Fixed)e.resize(G(nb,W,U));var f=G(nb,V,[]),l=G(nb,T,d);for(var a=0,n=f[i];a<n;a++){var t=f[a],p=e.createTab(f[a]);if(t==l)e.selectTab(p)}C();e.resize();if(o&&G(nb,L,b))P();m[g][r]=h[i]==0?B:O;z=1};e.get_tabs=function kb(){return h};e.selectTab=function jb(b,a,c){if(n!=b){if(n)n.deselect();$menu.closeCurrent();n=b;C()}if(n){if(!c&&p&&z&&a)S();n.select(a);if(n.get_isInMore())e.moveTab(n,0)}s.update()};e.dispose=function mb(){if(z){z=b;if(o)o.dispose();if(s)s.dispose();for(var a=0,c=h[i];a<c;a++)h[a].dispose();h=[];if(u==Mb.Floating)m[Q].removeChild(m);else if(u==Mb.Fixed)m[t]=k;m=H=w=N=D=J=d}};e.cleanUp=function lb(){for(var a=0,b=h[i];a<b;a++)if(!h[a].get_object()){e.removeTab(h[a]);a--;b--}};e.createTab=function hb(c){for(var b=0,d=h[i];b<d;b++)if(h[b].get_id()==c)return h[b];var a=new Kc(e,s,J,c);a.initialize();a.TabIdChanged.attach(C);e.addTab(a);return a};e.addTab=function pb(a){h.push(a);C();R(h[i]>1,w,"wlxim_multi");m[g][r]=O;if(h[i]==1&&z&&o){e.resize(U);o.dock()}e.updateFocus();I();if(!n)e.selectTab(a);else s.update()};e.isRequestingFocus=function Z(){return x};e.updateFocus=function db(){var d=x;x=b;for(var c=0,e=h[i];c<e;c++)if(h[c].isRequestingFocus())x=f;if(d!=x)a.RequestingFocusChanged.fire(x)};e.removeTab=function ib(a){h.remove(a);a.dispose();C();e.updateFocus();R(h[i]>1,w,"wlxim_multi");if(h[i]==0){n=d;S();m[g][r]=B;if(o)o.notifyClosed()}else if(a==n)e.selectTab(h[0],f);else s.update()};e.moveTab=function ob(a,b){if(h.indexOf(a)!=b){h.remove(a);h.insert(b,a);C();s.update()}};e.get_isMinimized=function ab(){return p};e.get_selectedTab=function bb(){return n};e.requestResize=function cb(a){if(u==Mb.Floating){a=Math.min(X,a+D.offsetHeight+5);if($B.IE_M6)a+=6;if(a>F){m[g][y]=a+l;e.resize(a);return f}}return b};function C(){if(z){var b=[];for(var a=0,c=h[i];a<c;a++)b.push(h[a].get_id());A(nb,V,b);A(nb,T,n?n.get_id():d)}}function I(){var j=D.offsetHeight,a=F,b=K;if(p)a=j+2+v;w[g][y]=a-v-2+l;w[g][E]=b-v-2+l;m[g][y]=a+l;m[g][E]=b+l;if(H){H[g][y]=a-v-2+l;H[g][E]=b-v-2+l}s.set_width(b-v-3);if(n&&n.get_isInMore())e.selectTab(n);var f=a-v-j;J[g][y]=f+l;for(var d=0,k=h[i];d<k;d++){var c=h[d].get_contentEl();c[g][y]=Math.max(0,f-parseInt(c[M][gb])-parseInt(c[M][eb])-parseInt(c[M].top))+l}}e.minimize=P;function P(){if(!p){p=f;o.set_isMinimized(p);A(nb,L,p);$css.add(m,"wlxim_minimized");if(n)n.deselect();I();o.dock()}}function S(){if(p){p=b;o.set_isMinimized(p);A(nb,L,p);$css.remove(m,"wlxim_minimized");o.restore();I();e.selectTab(n,f,f);if(o)o.restore()}}},Jc=function(Q,N,x,ab,t,pb,qb,sb){var A=this,cb=70,lb=170,mb=75,jb="wlxim_actions_end_selected",kb="MoreContactsTooltip",D,K,u,q,a,J,W,ib,p,C,F,H,G,L,Y=0;A.set_width=function ub(a){K=a;A.update()};A.initialize=function tb(){if(!L){L=f;n.attachEvent(z,A.dispose);p=c(j,t,"wlxim_window_actions");if(N!=Mb.Fixed){F=c(m,p,"wlxim_window_action wlxim_minimize");F[v](T(s(w,Nb),s(w,tc)));c(o,F,d,S);F.attachEvent(h,Z);Pb(F);G=c(m,p,"wlxim_window_action wlxim_restore");G[v](T(s(w,Nb),s(w,uc)));c(o,G,d,S);G.attachEvent(h,bb);Pb(G);H=c(m,p,"wlxim_window_action wlxim_popout");H[v](T(s(w,Nb),s(w,vc)));c(o,H,d,S);H.attachEvent(h,db);Pb(H)}C=c(m,p,"wlxim_window_action wlxim_window_close");C[v](T(s(w,Nb),s(w,Zb)));c(o,C,d,S);C.attachEvent(h,hb);Pb(C);u=c(X,t,"wlxim_tabs");q=c(I,0,"wlxim_moretab");ib=c(j,0,fb);c(j,t,fb);J=c(m,q,"wlxim_tab c_ml wlxim_tabml");Pb(J);W=c(o,J);c(o,J,rb,Wb);J.attachEvent(h,U);a=c(X,q,"wlxim_mc c_m t_hovl");var b=c(I,u,"wlxim_tab_wrapper",S),e=c(j,b,"wlxim_tab",S);D=e.offsetHeight;t[g][y]=D+l}};A.dispose=function vb(){if(L){L=b;n.detachEvent(z,A.dispose);if(N!=Mb.Fixed){F.detachEvent(h,Z);H.detachEvent(h,db);G.detachEvent(h,bb)}C.detachEvent(h,hb);q.detachEvent(h,U)}};A.update=function wb(){var T=Q.get_selectedTab(),v=N==Mb.Fixed,h=x[i];if(h){D=Math.max(D,x[0].get_height());K=K||t.offsetWidth;t[g][E]=K+l;t[g][y]=D+l;p[g][y]=Math.max(0,D-parseInt(p[M][gb])-parseInt(p[M][eb])-1)+l;dc(u);dc(a);p[g][r]=v&&h>1?B:O;var c=ob(),U=P(c<h),n=h-c;W.innerText="({0})".format(n);J.title=e(kb).format(n);var A=!Q.get_isMinimized()&&x[c-1]==T&&n==0,db=v&&A,S=0,cb=parseInt(U/c),d=U-(c-1)*(cb+1)-(n>0?1:0);d=c==1||!v?d-2:d;d=$B.IE_M6&&(c==1||A&&!v)?d-1:d;d-=$B.IE_M6?1:0;if(db&&c>1){t[g][E]=K+1+l;d+=1}R(A,p,jb);for(var j=0;j<c;j++){var m=x[j],X=j==0,bb=j==c-1,o=bb?d:cb,Z=m==T;o=X&&c>1&&Z?o+1:o;if(m.isRequestingFocus())S++;m.update(X,bb&&n==0,b,o,D+(Z&&h>1?4:0),u)}if(c<h)u.appendChild(q);u.appendChild(ib);a[g][E]=k;var I=0,w=mb;for(var j=c;j<h;j++){var m=x[j];if(m.isRequestingFocus())I++;m.update(0,b,f,0,0,a);w=Math.max(w,m.get_width())}var z=S==1&&h==1,L=z?1:0,s=L-Y;if(N!=Mb.Fixed){Qb(F,s);Qb(H,s);Qb(G,s)}Qb(C,s);Y=L;R(z,t,"wlxim_headerfocus");R(z,p,"wlxim_actionsfocus");if(!Q.get_isMinimized()&&a.scrollHeight>ab.offsetHeight)a[g][y]=ab.offsetHeight-2+l;else a[g][y]=V;a[g][E]=Math.min(w,lb)+l;R(I>0,q,"wlxim_focusmore");nb()}};function P(a){if(a)u.appendChild(q);var b=t.offsetWidth-p.offsetWidth-q.offsetWidth-2;if(a)u.removeChild(q);return b}function ob(){var c=x[i],b=P(),a=parseInt(b/cb);if(a>=c)a=c;else{b=P(1);a=parseInt(b/cb)}return Math.max(1,Math.min(c,a))}function hb(){if(!Gb)while(x[0])x[0].close();return b}function Z(){if(!Gb)pb();return b}function db(){if(!Gb)sb();return b}function bb(){if(!Gb)qb();return b}function nb(){var b=a.binding;if(b)b.update()}function U(){if(!Gb){var c=a.binding;if(!c)c=a.binding=new $menu(a,q,1,0,1);c.invalidatePosition();c.toggleState();if($B.IE_M6)A.update()}return b}},Kc=function(D,hb,fb,db){var a=this,O="wlxim_close_visible",A,i,x,k,u,F,L,C,U=0,B=b,r,p,e,G,H,J,P;a.TabIdChanged=new $Event;a.initialize=function ub(){if(!G){G=f;gb();A=c(j,fb,"wlxim_conv_wrapper");var b={};b[h]=eb;b[ab]=bb;b[wb]=M;P=new $Event.Manager(A,b);q.attachEvent(N,cb);n.attachEvent(z,a.dispose)}};a.dispose=function Bb(){if(G){G=b;a.TabIdChanged.dispose();x.detachEvent(h,W);k.detachEvent(h,K);u.detachEvent(h,K);if($B.IE_M6){k.detachEvent(Fb,Y);k.detachEvent(qb,X)}P.dispose();q.detachEvent(ab,M);A[Q].removeChild(A);q.detachEvent(N,cb);if(e&&e.dispose)e.dispose();n.detachEvent(z,a.dispose)}};a.requestResize=function lb(a){if(p)return D.requestResize(a);else{H=a;return b}};a.get_id=function Cb(){return db};a.set_id=function Eb(b){db=b;a.TabIdChanged.fire(a)};a.get_object=function tb(){return e};a.set_object=function vb(a){e=a;if(e)e.resize();else dc(A)};a.get_isInMore=function nb(){return r};a.set_titleHtml=function mb(a){C[t]=a};a.set_tooltip=function rb(a){k.title=a;u.title=a};a.get_contentEl=function kb(){return A};a.isRequestingFocus=function ib(){return B};a.requestFocus=function ob(a){a=a||b;if(B==a){B=a?b:f;hb.update();D.updateFocus()}};a.hasFocus=function Ab(){return J};a.get_width=function xb(){return r?u.scrollWidth:i.scrollWidth};a.get_height=function sb(){return r?u.offsetHeight:k.offsetHeight};a.close=function Hb(){if(e)e.close();D.removeTab(a)};a.select=function Db(a){if(H){D.requestResize(H);H=d}if(!p){p=f;A[g][Z]=zb;if(e)e.select()}if(e)setTimeout(e.resize,0);if(a){bb();if(e)e.focus(a)}};a.deselect=function yb(){M();if(p){p=b;A[g][Z]=jb}};a.update=function pb(b,j,h,a,m,d){r=h;R(!r,i,"wlxim_tab_wrapper");R(r,i,"wlxim_menuitem");R(p,i,"wlxim_selectTabWrap");R(p,k,"wlxim_selectTab");R(b,i,"wlxim_tab_first");R(j&&!p,i,"wlxim_tab_last");R(b&&p,i,"wlxim_tab_firstselected");R(B,i,"wlxim_focus");R(B,u,"wlxim_focus");R(B&&p,i,"wlxim_selectWrapFocus");var c=B?1:0;Qb(x,c-U);U=c;if(!a)a=V;else{if($B.IE_M6)F[g][E]=a-14-16-(b&&p?1:0)+l;a+=l}i[g][E]=a;if(d){if(C){var f=r?L:F,e=r?F:L;if(C[Q]==e)e.removeChild(C);f[v](C)}d[v](r?u:i);if(!r)i[g][y]=m+l}};function M(){J=b}function eb(){var a=b;try{range=document.selection.createRange()}catch(c){}if(range&&(range.text||range.toString&&range.toString()))a=f;if(e)e.focus(!a)}function bb(){J=f;if(e)e.focus(b)}function cb(){if(J&&event.keyCode==27)setTimeout(function(){a.close()},0)}function gb(){i=c(I,0,"wlxim_tab_wrapper");k=c(j,i,"wlxim_tab");x=c(m,k,"wlxim_tab_close");Pb(x);x[v](T(s(w,Nb),s(w,Zb)));c(o,x,d,S);u=c(I,0,"wlxim_menuitem");C=c(o);if($B.IE_M6){k.attachEvent(Fb,Y);k.attachEvent(qb,X)}F=c(m,k,"wlxim_tab_content");L=c(m,u,"c_ml");Pb(F);x.attachEvent(h,W);k.attachEvent(h,K);u.attachEvent(h,K)}function Y(){R(f,x,O)}function X(){R(b,x,O)}function K(){if(!Gb)D.selectTab(a,f);return b}function W(){if(!Gb)a.close();event.cancelBubble=f;return b}},Gc=function(i,e,W){var h=this,O="ie7zoomdrag",L=2,fb=3,r="userMoved",x="curX",B="curY",H,M,Q,S,m,C,D,o,p,u,w,k;h.initialize=function Z(){if(!w){a.addInnerWindowListener(I);I();W.attachEvent(bb,U);n.attachEvent(Hb,N);n.attachEvent(z,h.dispose);C=s();var c=G(i,r,b);o=c?G(i,x,d):d;p=c?G(i,B,d):d;v();w=f}};h.dispose=function ab(){if(w){w=b;P();a.removeInnerWindowListener(I);n.detachEvent(Hb,N);W.detachEvent(bb,U);n.detachEvent(z,h.dispose)}};h.set_isMinimized=function X(a){u=a};h.dock=function db(){var c=s(),g=K(e),j=J(),f=c.w-g.w;if(!u){if(!G(i,r,b)&&k&&D){var a=k.$("HomeContent")||k.$("c_content")||k.document.body;if(a){var d=c.w;if(a)d=a.offsetLeft+a.offsetWidth-j.x;if(f<d)f=Math.min(c.w,d)-g.w-D}}A(i,r,b)}var l=f,m=c.h-g.h;h.move(l,m)};h.notifyClosed=function Y(){A(i,r,b);o=d;p=d;A(i,x,o);A(i,B,p);u=b};h.restore=function cb(){v()};h.move=function eb(z,C){var v=s(),y=K(e),m=J(),c=0,j=0;if(k&&k!=n){var f=k.document.documentElement,h=q.body;if(f.scrollHeight>h.offsetHeight)c=Rb;if(f.scrollWidth>h.offsetWidth)j=Rb}var r=v.w-y.w,t=v.h-y.h,a=Math.max(0,Math.min(r,z)),b=Math.max(2,Math.min(t,C));if(!u||Gb){o=a;p=b;if(!Gb){A(i,x,o);A(i,B,p)}}var d=$B.ltr||$B.IE;a=Math.max(d?0:c,Math.min(a,r-(d?c:0)));b=Math.min(b,t-j);a+=m.x;b+=m.y;if($B.IE_M7){var w=ib();a=a/w;b=b/w}e[g][Kb]=a+l;e[g][Lb]=b+l};function v(){if(u||o==d||p==d)h.dock();else h.move(o,p)}function N(){function a(){if(G(i,r,b)){var a=s(),f=a.w-C.w,g=a.h-C.h,c,d;o+=f;p+=g;if(!u){c=o;d=p}else{c=e.offsetLeft+f;d=e.offsetTop+g}C=a;h.move(c,d)}else h.dock()}setTimeout(a,0)}function J(){var b={x:0,y:0};if($B.IE_M6){var a=n.document.body.parentNode,c=s();b.x=$B.rtl?a.scrollWidth-c.w-a.scrollLeft:a.scrollLeft;b.y=a.scrollTop}return b}function s(){var b=q.documentElement||q.body,a={w:parseInt(b.clientWidth),h:parseInt(b.clientHeight)};if(a.h==0)a.h=parseInt(q.body.clientHeight);return a}function U(){if(event.button!=$Browser.Button.LEFT)return;Gb=b;if(u){event.returnValue=b;return b}var d=event.srcElement;while(d){if($css.has(d,"wlxim_mc"))return;d=d.parentNode}var h=T(event),f=s(),a=J();Q=h.x;S=h.y;H=e.offsetLeft-a.x;M=e.offsetTop-a.y;if(!m){m=c(j,q.body,"wlxim_dragcover");m[g][E]=f.w+l;m[g][y]=f.h+l;m[g][Kb]=a.x+l;m[g][Lb]=a.y+l;m.attachEvent(ob,F);m.attachEvent(sb,t);e.attachEvent(ob,F);e.attachEvent(sb,t);n.attachEvent(qb,V)}e.attachEvent(Db,Vb);event.returnValue=b;return b}function V(){try{if(event.toElement==d)t()}catch(a){t()}}function F(){if(event.button!=$Browser.Button.LEFT){t();return}var c=T(event),a=c.x-Q,b=c.y-S;if(Gb||Math.abs(a)>L||Math.abs(b)>L){if(!Gb&&$B.IE_M7&&ib()!=1)R(f,e,O);Gb=f;var g=s(),i=K(e),d=$B.rtl?g.w-i.w-H-a:H+a;h.move(d,M+b)}}function T(c){var a={x:c.pageX,y:c.pageY};if(!a.x&&a.x!==0){var b=q.documentElement||q.body;a.x=c.clientX+b.scrollLeft-b.clientLeft;a.y=c.clientY+b.scrollTop-b.clientTop}return a}function t(){if(Gb){A(i,r,f);A(i,x,o);A(i,B,p);if($B.IE_M7&&ib()!=1){R(b,e,O);Ob()}}P();return b}function P(){e.detachEvent(sb,t);e.detachEvent(ob,F);e.detachEvent(Db,Vb);n.detachEvent(qb,V);if(m){m.detachEvent(sb,t);m.detachEvent(ob,F);q.body.removeChild(m);m=d}}function K(c){var a={w:c.offsetWidth,h:c.offsetHeight};if($B.IE_M7){var b=ib();a.w=a.w*b;a.h=a.h*b}return a}function I(){if($B.IE_M6&&k)k.detachEvent(tb,v);k=a.innerWindow;if(k){var e=k["$AdConfig"];D=0;if(e){var d=e.Data;for(var c=0,f=d.length;c<f;c++){var g=d[c][0];if(g.indexOf("Ad"==0)){D=d[c][2];break}}}if(w)if(G(i,r,b))v();else h.dock()}if($B.IE_M6&&k)k.attachEvent(tb,v)}},Bc=function(e,i){var c="convstor",h=this,a=i.get_id(),g;h.initialize=function k(){if(!g){i[x](j);g=f}};h.dispose=function l(){if(g){g=b;i[D](j)}};h.get=function n(i,h){var g=G(e,c,{}),f=g[a]||{},b=f[i];return b==d?h:b};h.set=function o(h,f){if(g){var d=G(e,c,{}),b=d[a];if(!b)b=d[a]={};b[h]=f;A(e,c,d)}};h.clear=function m(){var b=G(e,c,{});delete b[a];A(e,c,b)};function j(g,f){if(f[P]()=="Id"){var b=G(e,c,{}),d=b[a];delete b[a];a=i.get_id();b[a]=d;A(e,c,b)}}},Dc=function(m){var g=this,h,n,Q,c={},j=0,e,l,o,p,q=a.CW.IsOpenChanged,y="wim_cw";g.initialize=function K(){if(!l){l=f;j=0;Ub=b;_libraryConversations=a.user.get_conversations();_libraryConversations[H](t);for(var c=0,d=_libraryConversations.get_count();c<d;c++)k(_libraryConversations.get_item(c));h=setTimeout(s,5e3)}};g.dispose=function M(){if(l){l=b;n=b;Ub=b;_libraryConversations[F](t);_libraryConversations=d;if(h){clearTimeout(h);h=d}if(e){e.dispose();e=d}for(var a in c)if(!FunctionHelper.isSpecialMember(c,a)){c[a].dispose();delete c[a]}if(j!=0){j=0;q.fire(b)}}};g.minimize=function L(){if(e)e.minimize()};g.isRequestingFocus=function E(){return e&&e.isRequestingFocus()};function r(a,b){e.resize(a,b)}function t(m,f){var e=f.get_newItems();if(e)for(var b=0,l=e[i];b<l;b++)k(e[b]);var d=f.get_oldItems();if(f.get_action()==a.MLM.NotifyCollectionChangedAction.reset){d=[];for(var h in c)if(!FunctionHelper.isSpecialMember(c,h))d.push(c[h].get_conversation())}if(d)for(var b=0,j=d[i];b<j;b++)g.remove(d[b])}function z(){e=new Ic(B);e.initialize($(y))}g.selectConversation=function D(d,a){var b=c[d.get_id()];e.selectTab(b.get_tab(),a)};g.startConversation=function G(e,h){if(a.user[J]()!=e){o=f;var d=a.user.get_conversations().create(e);o=b;var g=d.get_id();u(e.get_contact(),g);k(d);var i=c[g];if(h)i.appendText(h);return d}};function u(j,i){var g=e.get_selectedTab();if(g){var a=g.get_object();if(a&&!a.get_isModified()&&a.get_contact()==j&&!c[i]){p=f;a.close();p=b;a.dispose();g.set_object(d);var h=g.get_id();if(c[h])delete c[h];g.set_id(i)}}}g.isOpen=function N(){return j>0};function w(){for(var a in c)if(!FunctionHelper.isSpecialMember(c,a))c[a].updateInfoBar()}function B(){Ub=f;w();if(m)m.flush();a.popout()}function s(){if(!n){if(h){clearTimeout(h);h=d}n=f;z();var l=a.user.get_conversations();for(var i=0,q=l.get_count();i<q;i++){var s=l.get_item(i);k(s)}var p=e.get_tabs();for(var j=0,t=p.length;j<t;j++){var c=p[j],o=c.get_id();if(o.indexOf("sms:")==0){var b=a.user.get_contacts().findById(o.substr(4));if(b&&!cb(b,a.MLM.IMAddressType.telephone)){var m=new qc(g,c,b);m.initialize();c.set_object(m)}}}e.cleanUp();a.CW.resize=r;a.CW.isOpen=g.isOpen;$Do.register("$WLXIM.CW.resize",r);$Do.register("$WLXIM.CW.doneLoading");r()}}function v(b,f){var e=f[P]();if(e=="Id")for(var a in c)if(!FunctionHelper.isSpecialMember(c,a)){var d=c[a];if(d.get_conversation()==b){c[b.get_id()]=c[a];delete c[a];break}}}g.remove=function O(f){var d=f.get_id(),a=c[d];if(a){a.dispose();delete c[d];if(!p){e.removeTab(a.get_tab());j--;if(j==0){q.fire(b);A(m,Sb,{})}}}};g.startSmsInput=function I(a){$Do.when("$WLXIM.CW.doneLoading",g,C,a)};function C(c){var d="sms:"+c.get_linkedContacts().get_item(0).get_id();u(c,d);var b=e.createTab(d),a=b.get_object();if(!a){a=new qc(g,b,c);a.initialize();b.set_object(a)}e.selectTab(b,f)}function k(a){if(!n)if(a.get_reloaded()){clearTimeout(h);h=setTimeout(s,100)}else s();else if(!o){var d=e.createTab(a.get_id());if(!d.get_object()){var b=new Hc(g,a,d,m);b.initialize();d.set_object(b);a[x](v);c[a.get_id()]=b;j++;if(j==1)q.fire(f)}}}},Hc=function(dc,n,w,Lb,oc){var h=this,ac=C?mb:"ConvTemplate",jc="FromFormat",ec="FromFormatOffline",gc="NudgeFormat",Ub="TitleFormat",Tb="TitleMultiFormat",bc="TabMultiFormat",kc="SendFailed",Zb="PsmUpdate",Xb="Join",Vb="Leave",Wb="SendFailedTooLong",Qb="SendFailedRecipientDisabled",Sb="SendFailedRecipientInvalid",mc="Close",nc="Send",Eb="convscroll",bb,X,L,K,ob=[],G,Jb=f,S,A=n.get_roster(),Nb=a.user[J]().get_cid(),N=w?w.get_contentEl():oc,kb,T,V,s,cb,wb,z,Pb,vb,rb,zb,ib,I,Bb,Ab,lb,R,sb,U;h.RosterUpdated;h.initialize=function wc(){if(!bb){bb=f;K=new Bc(Lb,n);sb=K.get(Yb,b);h.RosterUpdated=new $Event;V=c(j,N,"wlxim_infobar");V[g][r]=B;ib=new Ac(h,n,Lb,K,V);s=c(j,N,"wlxim_conv_area");if(C&&$B.RE_WebKit)S=new WebkitCustomScroll(s);s.attachEvent(tb,Db);s[g][Z]=jb;cb=c(j,s,"wlxim_roster");z=c(j,N,"wlxim_footer");zb=C?c(j,z,"wlxim_statusBar"):z;wb=c(j,z,"wlxim_inputarea");I=new yc(h,n,wb);I.initialize();Bb=new zc(h,n,K,z);Bb.initialize();if(!C){Pb=c(j,z,"wlxim_viacont");lb=new ic(h.get_contact(),n.get_network(),A.get_item(0).get_type(),Pb);lb.initialize()}else{c(o,z,"wlxim_footerText"," | ");vb=c(m,z,"wlxim_close",e(mc));vb.onclick=function(){$WLXIM.CW.closeConversation(n)};rb=c("button",z,"wlxim_submitButton",e(nc));rb.onclick=function(){I.send()}}Ab=new xc(h,n,I,zb);Ab.initialize();c(j,z,fb);L=setTimeout(Gb,100);n[x](Cb);if(w)w.requestFocus(n.get_hasUnreadMessages()?b:f);A[H](Kb);A[H](xb);xb();for(var a=0,k=A[i];a<k;a++){var d=A.get_item(a)[p]();if(d.get_cid()!=Nb)d[x](pb)}n.add_messageReceived(Hb);n.add_sendMessageFailed(Mb);if(!C)h.resize()}};h.dispose=function Fc(){if(bb){bb=b;X=b;ib.dispose();I.dispose();Bb.dispose();Ab.dispose();if(!C)lb.dispose();else{U=vb=rb=rb.onclick=vb.onclick=d;if(S)S.dispose()}K.dispose();s.detachEvent(tb,Db);q.detachEvent(ab,qb);n[D](Cb);A[F](xb);A[F](Kb);n.remove_messageReceived(Hb);n.remove_sendMessageFailed(Mb);h.RosterUpdated.dispose();Ob();zb=V=s=cb=wb=z=d;for(var a=0,e=A[i];a<e;a++){var c=A.get_item(a)[p]();if(c.get_cid()!=Nb)c[D](pb)}if(L){clearTimeout(L);L=d}if(G){hb.removeFromRotation(G);G=d}}};h.focus=function Lc(a){n.set_hasUnreadMessages(b);if(a)I.focus()};h.get_tab=function Gc(){return w};h.get_displayName=function qc(){return U};h.get_conversation=function pc(){return n};h.appendText=function vc(a){I.appendText(a)};h.reportAbuse=function uc(){if(!sb){var e=Ib(A);for(var d=0,g=e[i];d<g;d++){var c=e[d];if(cc(c))if(c.get_type()==a.MLM.IMAddressType.windowsLive){K.set(Yb,f);sb=f;var b={};b.acid=c.get_cid();b.ctid=6;b.cstid=17;b.cs=db.can;$Beacon.fire("/handlers/ReportAbuse.mvc",b)}else window.open(c.get_linkedContact().get_reportAbuseUrl(),"_blank")}h.updateInfoBar()}};h.get_isAbuseReported=function rc(){return sb};h.enable=function Hc(){if(bb)I.enable()};h.disable=function Ec(){I.disable()};h.get_isModified=function Dc(){return n.get_history().get_count()>0||I.get_text()!=k};h.get_contact=function tc(){var a=Ib(A);return a.length==1?a[0].get_contact():d};h.resize=function Ic(){I.resize();var j=Y(),h=z.offsetHeight,a=V.offsetHeight;a=a?a+parseInt(V[M].marginBottom):a;var c=s.scrollHeight,f=parseInt(N[M][gb])+parseInt(N[M][eb]);if(C||!w.requestResize(a+c+h+f)){var i=$B.IE_M6?parseInt(N[Q][g][y]):N[Q].offsetHeight,d=i-a-h-f+2,k=!C?Math.max(0,d-c):0;if($B.IE_M6)s[g][r]=B;var b=Math.max(0,d);b=!C?Math.min(c,b):b-4;var e=N.offsetWidth-2*parseInt(N[M].paddingRight);if($B.IE_M6)s[g][r]=O;s[g][y]=b+l;s[g][E]=e+l;if(S)S.resize();if(T)$ic.presence.setConvWidth(T.id,e-Rb);z[g].marginTop=k+l;if(j||C)ub()}};function Db(){if($B.IE&&$B.rtl&&Jb){q.body.className=q.body.className;Jb=b}K.set(Eb,Y()?d:s.scrollTop)}function Gb(){if(!X){X=f;if(L){clearTimeout(L);L=d}ib.initialize();var b=n.get_history();for(var a=0,c=b.get_count();a<c;a++)yb(b.get_item(a));s[g][Z]=k;K.initialize();ub(K.get(Eb,d))}}function Ob(){if(kb){$ic.ic.removeIC(kb.id);kb=d}if(T){$ic.ic.removeIC(T.id);T=d}}function xb(){Ob();var f=Ib(A),d=f[i];if(d>1){cb[t]=k;var l=[];for(var j=0;j<d;j++){var b=f[j];l.push(u(b[p](),b))}U=l.join(", ");cb[v](a.MLM.MessengerUtility.emoticonEncode(U));if(w){w.set_titleHtml(e(bc).format(d));w.set_tooltip(U)}}else if(d==1){var b=f[0],c=b[p]();T=$ic.ic.createICFromTemplate(ac,c,b,0,0,0,0,0,0,0,0,0,0,0,0,1);cb[t]=T.html;U=u(c,b);var m=c.get_emailAddress()||u(c,b),n=b.get_network();if(b.get_type()!=a.MLM.IMAddressType.windowsLive){var g;if(b.get_type()==a.MLM.IMAddressType.telephone)g=b.get_address();else g=W(n);m+=" \n"+Cc+"(\u200e"+g+")"}if(w){kb=$ic.ic.createICFromTemplate(hc,c,b,0,0,0,0,0,0,0,0,0,0,0,0,1);w.set_titleHtml(kb.html);w.set_tooltip(m)}}h.RosterUpdated.fire(h)}function Hb(c,b){var a=b.get_message();if(!X){if(a.get_reloaded()){clearTimeout(L);L=setTimeout(Gb,100)}}else yb(a)}h.handleMessage=yb;function yb(b,d){var c=a.MLM.MessageType;switch(b.get_type()){case c.textMessage:fc(b,d);R=b;break;case c.nudgeMessage:lc(b);R=b}}h.updateInfoBar=function sc(){ib.update()};function Y(){return s.scrollTop>=parseInt(s.scrollHeight-parseFloat(s[M][y]))}function ub(a){if(X){if(a==d)a=s.scrollHeight;s.scrollTop=a}}function fc(b,F){var f=b.get_sender(),r=a.user[J](),w=R&&R.get_sender(),B=R&&R.get_isOfflineMessage()&&w!=r,A=f==r,y=b.get_isOfflineMessage()&&!A,d=f[p](),E=F||Y();if(!R||R.get_type()!=b.get_type()||B!=y||f!=w){var z=e(jc);if(y)z=e(ec);var H=c(j,s,"wlxim_says");H[v](a.MLM.MessengerUtility.emoticonEncode(z.format(u(d,f))))}if(!b.get_reloaded()&&!A){var o=n.get_hasUnreadMessages();if(o)a.RequestingFocusChanged.fire(o);if(!hb.get_hasFocus()&&d&&ob.indexOf(d)<0){if(G)hb.removeFromRotation(G);ob.push(d);var t=ob[i];if(t>1)G=e(Tb).format(t);else G=e(Ub).format(u(d,f));hb.addToRotation(G);q.attachEvent(ab,qb)}}var k=c(j,s,"wlxim_msg"),l;if(C)l=k;else{c(j,k,"wlxim_bullet");l=c(j,k,"wlxim_msgwrap")}var x=b.createTextElement();l[v](x);var m=b.get_format().get_fontColor(),D=m.get_r()==255&&m.get_g()==255&&m.get_b()==255;if(D)x[g].color="#000";if(!C)h.resize();if(E)ub();if(S)S.resize()}function lc(f){var b=f.get_sender(),d=b[p]();if(b!=a.user[J]()){var c=a.MLM.MessengerUtility.emoticonEncode(e(gc).format(u(d,b)));nb(c)}}function Kb(l,k){var d=k.get_newItems();for(var a=0,j=d[i];a<j;a++){var c=d[a],g=c[p]();g[x](pb);Fb(c,f)}var e=k.get_oldItems();for(var a=0,j=e[i];a<j;a++){var c=e[a],g=c[p]();g[D](pb);Fb(c,b)}if(lb)lb.set_contact(h.get_contact())}function Mb(o,m){var i=a.MLM.SendMessageResultCode,k=m.get_resultCode(),h=e(kc),g=f;if(k==i.messageTooLong){h=e(Wb);g=b}else if(k==i.recipientDisabled){h=e(Qb);g=b}else if(k==i.recipientInvalid){h=e(Sb);g=b}var l=c(j);c(j,l,d,h);var n=c(j,l,"wlxim_err");if(g)n.innerText=m.get_message().get_text();nb(l)}function Fb(b,d){var c=e(d?Xb:Vb),f=a.MLM.MessengerUtility.emoticonEncode(c.format(u(b[p](),b)));nb(f)}function nb(a){var b=Y();if(typeof a=="string")a=c(j,d,d,a);a.className="wlxim_says";s[v](a);c(j,s,"wlxim_ms");h.resize();if(b)setTimeout(function(){ub()},0);R=d}function qb(){if(G){ob=[];q.detachEvent(ab,qb);hb.removeFromRotation(G);G=d}}h.select=function Jc(){n.set_hasUnreadMessages(b);ib.update()};h.close=function Kc(){n.close();K.clear();dc.remove(n)};function Cb(d,e){var c=e[P]();if(c=="HasUnreadMessages"){var a=n.get_hasUnreadMessages();if(w){if(w.hasFocus()&&n.get_history().get_count()>1&&Y()){n.set_hasUnreadMessages(b);a=b}w.requestFocus(a?b:f)}if(!a)qb()}else if(c=="Id")if(w)w.set_id(d.get_id())}function pb(b,h){var f=h[P]();if(f=="PersonalMessage"){var g=e(Zb).format(u(b[p](),b),b.get_personalMessage()),d=c(j);d[v](a.MLM.MessengerUtility.emoticonEncode(g));nb(d)}}},zc=function(v,P,H,C){var O="MoreMenu",N="ReportAbuse",G="MoreMenuTooltip",E="DownloadLink",F="DownloadMessenger",K="AppearOffline",L="AppearOnline",J=a.MLM.IMAddressType,D=this,x,q,j,l,t,n,u,g,p,r;D.initialize=function R(){if(!x){q=c(m,C,"wlxim_moremenu c_ml",e(O));c(o,q,rb,Wb);q.attachEvent(h,z);q.title=e(G);j=c(X,C,"c_m t_hovl");r=c(I,j);var a=c(m,r,0,e(F));a.href=s(w,E);a.target=db.p?"_blank":"_top";a.onclick=k;x=f}};D.dispose=function S(){if(x){x=b;q.detachEvent(h,z);if(p)p.detachEvent(h,y);q=j=g=p=r=d}};function M(){var C=Ib(P.get_roster()),o=C[i],f=o>=1?C[0]:d;if(!H.get(Yb,b)&&(o>1||o==1&&cc(f))){if(!g){var w=e(N);if(f.get_type()!=J.windowsLive)w+=" "+mc+"(&lrm;"+W(f.get_network()).encodeHtml()+")";g=c(I);p=c(m,g,k,w);p.attachEvent(h,y);j.insertBefore(g,r)}}else if(g){g[Q].removeChild(g);p.detachEvent(h,y);g=p=d}var q=v.get_contact(),s=o==1&&f.get_supportsAppearOfflineTo()&&q&&a.user.get_presence().get_status()!=a.MLM.PresenceStatus.appearOffline,x=s&&!q.get_isAppearOfflineTo(),z=s&&q.get_isAppearOfflineTo();if(!x&&l){l[Q].removeChild(l);t.detachEvent(h,A);l=t=d}else if(x&&!l){l=c(I);t=c(m,l,k,e(K));t.attachEvent(h,A);j.insertBefore(l,j[ub])}if(!z&&n){n[Q].removeChild(n);u.detachEvent(h,B);n=u=d}else if(z&&!n){n=c(I);u=c(m,n,k,e(L));u.attachEvent(h,B);j.insertBefore(n,j[ub])}}function A(){var a=v.get_contact();if(a)a.appearOfflineTo();$menu.closeCurrent();return b}function B(){var a=v.get_contact();if(a)a.appearOnlineTo();$menu.closeCurrent();return b}function z(){M();$menu.bind(event,3,0,1,1);var a=j.binding;if(a)a.update();return b}function y(){v.reportAbuse();$menu.closeCurrent();return b}},yc=function(R,w,t){var U="EnterYourMessageTooltip",ab=":) :D ;) :-O :P (H) :@ :$ :S :( :'( :| (6) (A) (L) (U) (M) (@) (&) (S) (*) (~) (8) (E) (F) (W) (O) (K) (G) (^) (P) (I) (C) (T) ({) (}) (B) (D) (Z) (X) (Y) (N)".split(" "),Y=":) :D ;) :O (H) :@ :$ :S :( :'( :| (6) (A) (L) (U) (K) :-# 8-| ^o) +o( *-) <O) 8-) |-)".split(" "),cb=":) :( :D :O :P :'( ;) <3".split(" "),W=60,fb="Emoticons",Z=50,p=this,u,n,s,x,D,G,A=0,S=0,H,K=[],F;p.TextChanged=new $Event;p.initialize=function jb(){if(!D){u=c(j,t,"wlxim_inputboxwrap");u.title=e(U);n=c("textarea",u,"wlxim_inputbox");n.attachEvent(N,Q);G=C?Z:n.scrollHeight;s=c(m,t,"wlxim_emoicon c_ml");s[v](a.MLM.MessengerUtility.emoticonEncode(":-)"));var b=s.getElementsByTagName("IMG")[0];b.alt=b.title=e(fb);c(o,s,rb,Wb);s.attachEvent(h,L);s.attachEvent(bb,J);if(!C)s[g].top=(G-s.offsetHeight+parseInt(t[M][gb])+parseInt(t[M][eb]))/2+l;else s[g].top=5+l;if(!C)p.resize();D=f}};p.dispose=function mb(){if(D){D=b;n.detachEvent(N,Q);s.detachEvent(h,L);s.detachEvent(bb,J);var a;while(a=K.pop())a.a.detachEvent(h,a.h);n=u=s=x=d;p.TextChanged.dispose()}};p.send=function qb(){var b=n.value;if(b){n.value=k;_lastValidInput=k;z();var c=new a.MLM.TextMessage(b);w.sendMessage(c);R.handleMessage(c,f)}};p.resize=function ob(){var a=Math.min(W,n.scrollHeight);if(n.value==k)a=G;if(Math.abs(a-A)<5)a=A;s[g][r]=F?B:O;var b=t.offsetWidth-s.offsetWidth-($B.Chrome?3:0)-4,d=b,c=0;if($B.Firefox&&!C)if($B.FF_Mac||a>=32){b+=Rb;c=-Rb}if(C)b-=5;if(S!=b||a!=A){if(!$B.IE_M6){u[g][E]=d+l;n[g].marginRight=c+l;u[g][y]=a+l}n[g][E]=b+l;S=b;t[g][y]=a+l;n[g][y]=a+l;A=a;R.resize()}};p.enable=function nb(){F=b;n.disabled=b;p.resize()};p.disable=function lb(){F=f;n.disabled=f;p.resize()};p.focus=function pb(){try{n.focus()}catch(a){}};p.get_text=function kb(){return n.value};p.appendText=function ib(a){n.value+=a;z();T()};function L(){if(!x){x=c(X,t,"wlxim_emomenu c_m t_hovl");var d=ab,g=w.get_roster().get_item(0).get_type(),j=a.MLM.IMAddressType;if(g==j.yahoo)d=Y;else if(g==j.connect)d=cb;for(var f=0,p=d[i];f<p;f++){var l=d[f],o=c(I,x,"wlxim_emoitem"),e=c(m,o),k=V(l);e[v](a.MLM.MessengerUtility.emoticonEncode(l));e.attachEvent(h,k);K.push({a:e,h:k})}}$menu.bind(event,3,0,1,1);var n=x.binding;if(n)n.update();return b}function V(a){return function(){hb(a);return b}}function hb(a){p.focus();db(a);$menu.closeCurrent()}function db(b){var e=b[i];if($B.IE){var a=H||q.selection.createRange();if(a.parentElement()!=n){n.value+=b;T()}else{a.select();a.text=b;a.select();a.move(Ab,e)}}else{var c=n.selectionStart,f=n.value,d=c+e;n.value=f.substr(0,c)+b+f.substr(n.selectionEnd);n.setSelectionRange(d,d)}P()}function T(){var c=n.createTextRange,a=n.value[i];if(c){var b=c();b.collapse();b.moveStart(Ab,a);b.moveEnd(Ab,a);b.select()}else if(n.setSelectionRange)n.setSelectionRange(a,a)}function J(){if($B.IE){var a=q.selection.createRange();if(a.parentElement()==n)H=a;else H=d}}function Q(){w.set_hasUnreadMessages(b);var d=event,a=d.keyCode,c=a==13&&!d.shiftKey||a==10;if(!F&&c)p.send();if(!c&&a!=9&&a!=27){w.notifyUserTyped();setTimeout(z,0)}if(c){d.returnValue=b;return b}else P()}function z(){var b=n.value,c=a.MLM.TextMessage.getRemainingCharCount(w,b);if(c<0){n.value=b.substr(0,b[i]-Math.abs(c));n.scrollTop=n.scrollHeight;z()}else p.resize()}function P(){setTimeout(function(){p.TextChanged.fire()},0)}},xc=function(V,h,t,O){var Q=8.64e7,G="HideDateReceivedMessage",J="LastMessageReceivedFormat",I="LastMessageReceivedDateFormat",M="DateReceivedFormat",N="TimeReceivedFormat",S="Pm",R="Am",L="TypingFormat",K="TypingMultiFormat",E="CharactersRemainingFormat",C=this,n=h.get_history(),r=h.get_typingAddresses(),m,A,l,z,B;C.initialize=function T(){if(!m){m=f;B=c(j,O,"wlxim_status");z=c(o,B);var b=Ib(h.get_roster()),k=b[0],d=k.get_type();if(b[i]==1&&d==a.MLM.IMAddressType.telephone)t.TextChanged.attach(y);n[x](v);w(n.get_lastReceived());r[H](q);q();if(b[i]==1&&nc(k.get_contact(),d)){var l=W(h.get_network());if(l)g(e(gc).format(l))}}};C.dispose=function U(){if(m){m=b;t.TextChanged.detach(y);n[D](v);r[F](q)}};function y(){var b=t.get_text();if(b){var c=a.MLM.TextMessage.getRemainingCharCount(h,b);g(e(E).format(c),f,2e3)}else g()}function q(){var a=Ib(r),j=a[i],c=d,k=b;if(j!=0){k=f;if(j==1){var h=a[0];c=e(L).format(u(h[p](),h))}else c=e(K).format(a[i])}g(c,k)}function v(b,a){if(a[P]()=="LastReceived")w(n.get_lastReceived())}function w(a){if(a.getTime()!=0){var b,f;if(new Date-a>Q){if(s(vb,G)!="1"){b=s(vb,M);f=e(I)}}else{b=s(vb,N);f=e(J)}if(b){var d=a.getHours(),h=d<12,c=h?d:d-12;c=c==0?12:c;var i=b.format(a.getMonth()+1,xb(a.getDate()),a.getFullYear().toString().substr(2),c,xb(d),xb(a.getMinutes()),h?e(R):e(S));g(f.format(i))}}}function g(a,b,c){if(l){clearTimeout(l);l=d}var a=a||A||k;z.innerText=a;if(!b&&a)A=a;if(b&&c)l=setTimeout(function(){g()},c)}},ic=function(O,A,u,y){var N="Via",L="ImageStrip.Sms",C="ImageStrip.SmsTight",q=this,t,i,j,z,p,J,n,l=[];q.initialize=function U(){if(!t){j=c(m,y,"wlxim_viamenulink c_ml");j.attachEvent(h,H);if(u==a.MLM.IMAddressType.telephone){p=T(s(w,Nb),s(w,C));n=T(s(w,Nb),s(w,C));j.appendChild(p);y.appendChild(n)}else if(A){p=c("IMG",j,"wlxim_neti");n=c("IMG",y,"wlxim_neti");p.src=n.src=A.get_iconUrl();p.alt=n.alt=W(A)}J=c(o,j,rb,Wb+S);z=c(X,y,"c_m t_hovl wlxim_viamenu");q.set_contact(O);t=f}};q.dispose=function V(){if(t){t=b;j.detachEvent(h,H);q.set_contact(d);J=j=z=d}};q.set_contact=function R(d){if(i){var b=i.get_addresses();for(var a=0,c=b.get_count();a<c;a++)b.get_item(a)[D](G)}i=d;if(i){var b=i.get_addresses();for(var a=0,c=b.get_count();a<c;a++)b.get_item(a)[x](G)}E()};function G(b,a){if(a[P]()=="Presence")E()}function M(c,d,b){var a=this;a.Addr=c;a.El=d;a.Fn=b}function E(){for(var p=0,D=l.length;p<D;p++){var z=l[p],m=z.El;m.detachEvent(h,z.Fn);m[Q].removeChild(m)}l=[];if(i){var y=i.get_addresses();for(var o=0,C=y.get_count();o<C;o++){var b=y.get_item(o),f=b.get_contact(),k=b.get_network(),v=b.get_type();if(k&&v!=a.MLM.IMAddressType.telephone&&(b.get_presence().get_status()!=a.MLM.PresenceStatus.offline||b.get_capabilities().get_supportsOfflineMessages()))F(W(k),k.get_iconUrl(),d,f,b,v)}if(a.displaySendSMS(i)){var E=T(s(w,Nb),s(w,L)),A=e(pc),c=cb(f,a.MLM.IMAddressType.telephone);if(c)A+=" "+mc+"(&lrm;"+c.get_address().encodeHtml()+")";F(A,d,E,f,c,a.MLM.IMAddressType.telephone)}}var t=B,q=B;if(nc(i,u)){var x=l.length;if(x==0||x==1&&(l[0].Addr&&l[0].Addr.get_type()==u||u==a.MLM.IMAddressType.telephone&&!l[0].Addr))q=kb;else t=kb}j[g][r]=t;if(n)n[g][r]=q}function F(j,q,a,p,i,n){var g=c(I,z),b=c(m,g);if(!a){a=c("IMG",d,"wlxim_neti");a.src=q;a.alt=k}b[v](a);var r=c(o,b,0,"&nbsp;"+e(N).format(j)),f=K(p,i,n);b.attachEvent(h,f);l.add(new M(i,g,f))}function K(e,a,c){return function g(){if(a)fc(a,f,d);else jc(e,f,c,d,d);$menu.closeCurrent();return b}}function H(){var c={nofocus:1,maxWidth:250,skipEdgeDetection:1};$menu.create(event,2,c);var a=z.binding;if(a)a.update();return b}},Ac=function(R,q,hb,Eb,ub){var vb=this,ib="f",zb="infobars",Vb="lastEndCount",Ec='<a href="#" onclick="return false;">',Bc="</a>",Ac="ServerBusy",Dc="Loading",pd="ComposeLink",l="InfoBar.",kc=l+"SignedOut",Tb=l+"SignedOutThirdParty",dc=l+"AppearOffline",jb=l+"AppearOfflineUnsupported",wb=l+"AppearOfflineGlobal",Pc=l+"AppearOnlineGlobalLink",Pb=l+"AppearOfflineMultiparty",Rb=l+"AppearOnlineToAllLink",Qc=l+"AppearOnlineToLink",nc=l+"Offline",Tc=l+"OfflineEmailText",Rc=l+"SendMessage",ac=l+"OfflineAllNoOIM",Lb=l+"OfflineCurrentOnlineOther",Xb=l+"IsntContact",cd=l+"AddContact",Sc=l+"ReportSpammer",bc=l+"AbuseReported",tc=l+"Status",hc=l+"StatusMulti",gc=l+"Reconnecting",Wb=l+"ReconnectingNoTime",yc=l+"OIM",lc=l+"Suspended",vc=l+"MPOP",dd=l+"MPOPSignOut",zc=l+"SMS",fc=l+"PopupBlock",mc=l+"FirstRun",Wc=l+"FirstRunSignOut",Zc=l+"FirstRunSignIn",oc="PresenceStatus.",ed=oc+"away",fd=oc+"busy",fb,N,eb,z,y,I=q.get_network(),M,n=function(c,k,j,d,g,h,e,i){var a=this;a.get_priority=function n(){return k};a.disablesWindow=function m(){return g};a.isShown=function r(i,c){var e;if(d)e=h(i,c,c&&c[p]());else e=h(i,q.get_roster());var g=l(c),j=e==ib;if(j||!e&&g&&(!d||c))a.close(c,b,f);return j?ib:e&&!g};a.get_html=function o(a){if(d)return e(a,a&&a[p]());return e(q.get_roster())};a.get_id=function s(a){return d&&a?L(a[p]()):"c"};a.close=function t(l,f,k){var h=a.get_id(l),e=Eb.get(zb,{}),d=G(hb,Sb,{}),b=e[c];if(!b)b=e[c]=[];if(k)b.remove(h);else if(f)b.push(h);if(j)d[c]=!k&&(f||d[c]);A(hb,Sb,d);Eb.set(zb,e);if(g)R.enable();if(i)i()};function l(e){var d=G(hb,Sb,{}),b=Eb.get(zb,{});return d[c]||b[c]&&b[c].exists(a.get_id(e))}},xd=function(c,e){var a=this;a.get_id=function n(){return c.get_id(e)};a.get_type=function l(){return c};a.get_address=function j(){return e};a.display=function m(){var b=c.get_html(e);if(typeof b=="string")eb[t]=b;else{eb[t]=k;eb[v](b)}if(!c.disablesWindow()){N[g][r]=O;N.attachEvent(h,a.close)}else N[g][r]=B;if(c.disablesWindow())R.disable();z=a;Kc()};a.closeHelper=function i(b){N.detachEvent(h,a.close);c.close(e,b);z=d;if(b)Gb(a,f)};a.close=function o(){a.closeHelper(f);return b}},sd=new n(Ac,0,f,b,f,function qe(){return a.isError()},function pe(){return e(Ac)}),rb,kd=new n(gc,0,f,b,f,function Vd(){return a.isWaitingToReconnect()},function Ud(){a.user[x](qc);rb=c(o);ec();return rb},function Wd(){a.user[D](qc);rb=d});function ec(){var b=a.getReconnectingTime();rb.innerHTML=e(gc).format(b.min,b.sec)}var Yc=new n(Wb,0,f,b,f,function Jd(){return I&&I.get_status()==a.MLM.NetworkStatus.autoReconnectWaiting},function Id(){return e(Wb)});function qc(b,a){if(a[P]()=="AutoReconnectWaitTime")ec()}function rc(b,a){if(a[P]()=="SignInPreference")vb.update()}var qd=new n(Dc,0,f,b,f,function le(){return a.isLoading()||I&&I.get_status()==a.MLM.NetworkStatus.signingIn},function ke(){return e(Dc)}),cb,rd=new n(kc,0,f,b,f,function $OfflineInfoBar$isShown(){return a.isOff()},function $OfflineInfoBar$display(){var b=e(kc).format(Ec,Bc),a=c(o,d,d,b);cb=a.getElementsByTagName(m)[0];cb.attachEvent(h,Ic);return a},function $OfflineInfoBar$onClose(){if(cb){cb.detachEvent(h,Ic);cb=d}}),X,bd=new n(Tb,0,f,b,f,function ne(){return !a.isOff()&&I&&!I.get_imEnabled()&&I.get_supportsRemoteSignIn()},function me(){var b=e(Tb).format(Ec,W(I),Bc),a=c(o,d,d,b);X=a.getElementsByTagName(m)[0];X.attachEvent(h,xc);return a},function oe(){if(X){X.detachEvent(h,xc);X=d}});function Ic(){a.signIn();return b}function xc(){I.set_imEnabled(f);return b}var nd=new n(lc,1,f,b,f,function ge(){return db.sus},function fe(){var a=db.sus||k;return e(lc).format('<a href="'+a.encodeHtmlAttribute()+'" target="_top">',"</a>")}),jd=new n(fc,2,f,b,b,function ce(){return Ub},function be(){return e(fc)}),hd=new n(bc,2,b,b,b,function Qd(){return R.get_isAbuseReported()},function Pd(d){var b=Ib(d),a=b[0],c=a[p]();return M(e(bc).format(u(c,a)))}),vd=new n(zc,3,b,b,b,function ye(b,c){return !b&&c.get_item(0).get_type()==a.MLM.IMAddressType.telephone},function xe(){return e(zc)}),Y,kb,od=new n(mc,4,f,b,b,function ie(){return a.isFull()&&!db.p&&!C&&a.user.get_settings().get_signInPreference()==a.MLM.SignInPreference.none},function he(){var a=c(o,d,d,e(mc));U(a);Y=c(m,a,d,e(Zc));Y.attachEvent(h,yb);pb(a);kb=c(m,a,d,e(Wc));kb.attachEvent(h,Hc);return a},function je(){if(Y){Y.detachEvent(h,yb);Y=d;kb.detachEvent(h,Hc);kb=d}});function Hc(){a.signOut();return b}var Q,mb,id=new n(dc,1,b,b,f,function Sd(d,g){var c=b;if(!d){var e=g.get_item(0),a=e[p]();if(Db(a)&&!Qb(a))c=f}return c},function Rd(a){return Ab(a,dc)},Bb),Mc=new n(jb,5,b,b,b,function Bd(b,a){return Yb(b,a)&&!a.get_item(0).get_supportsAppearOfflineTo()},function Ad(a){return Ab(a,jb)},Bb),Nc=new n(jb+"B",1,b,b,f,function Dd(b,a){return Yb(b,a)&&a.get_item(0).get_supportsAppearOfflineTo()},function Cd(a){return Ab(a,jb)},Bb);function Yb(d,g){var c=b;if(!d){var e=g.get_item(0),a=e[p]();if(Db(a)&&Qb(a))c=f}return c}function Bb(){if(Q){Q.detachEvent(h,nb);mb.detachEvent(h,ob);Q=mb=d}}function Ab(j,i){var b=j.get_item(0),f=b[p](),a=c(o);a[v](M(e(i).format(u(f,b))));U(a);var g=M(e(Qc).format(u(f,b)));Q=c(m,a,d);Q.appendChild(g);Q.attachEvent(h,nb);pb(a);mb=c(m,a,d,e(Rb));mb.attachEvent(h,ob);return a}function Qb(g){var c=g.get_addresses();for(var a=0,e=c.get_count();a<e;a++){var d=c.get_item(a);if(!d.get_supportsAppearOfflineTo()&&d.get_network().get_imEnabled())return f}return b}var V,Xc=new n(Pb,5,b,b,b,function Gd(h,e){var d=b;if(h)for(var a=0,g=e.get_count();a<g;a++){var c=e.get_item(a);if(Db(c[p]())&&c.get_supportsAppearOfflineTo()){d=f;break}}return d},function Fd(){var a=c(o,d,d,e(Pb));U(a);V=c(m,a,d,e(Rb));V.attachEvent(h,nb);return a},function Hd(){if(V){V.detachEvent(h,nb);V=d}}),bb,Uc=new n(wb,5,b,b,b,function $AppearOfflineGlobalInfobar$isShown(b,a){return sb()&&a.get_item(0).get_supportsAppearOfflineTo()},Mb,Ob),Oc=new n(wb+"B",1,b,b,f,function Ed(b,a){return sb()&&!a.get_item(0).get_supportsAppearOfflineTo()},Mb,Ob);function Mb(){var a=c(o,d,d,e(wb));U(a);bb=c(m,a,d,e(Pc));bb.attachEvent(h,ob);return a}function Ob(){if(bb){bb.detachEvent(h,ob);bb=d}}function sb(){return a.user.get_presence().get_status()==a.MLM.PresenceStatus.appearOffline}function Db(a){return a.get_isAppearOfflineTo()&&!sb()}function ob(){if(sb())a.switchPresence(a.MLM.PresenceStatus.online);else a.user.appearOnlineToAllContacts();return b}function nb(){var c=Ib(q.get_roster());for(var a=0,d=c[i];a<d;a++)c[a].get_contact().appearOnlineTo();return b}var gb,td=new n(vc,5,f,b,b,function te(){var b=1,d=a.user.get_endpoints();for(var c=0,f=d.get_count();c<f;c++)if(!d.get_item(c).get_isInstance())b++;var e=b>1;if(b>G(hb,Vb,b))e=ib;A(hb,Vb,b);return e},function se(){var b=c(o,d,d,e(vc).format(a.user.get_endpoints().get_count()));U(b);gb=c(m,b,d,e(dd));gb.attachEvent(h,jc);return b},function ue(){if(gb){gb.detachEvent(h,jc);gb=d}});function jc(){a.user.signOut(a.MLM.SignOutLocations.remote);z.close();return b}var Z,ab,Hb,ld=new n(Xb,7,b,f,b,function Zd(c,d,b){return !c&&b&&!b.get_isContact()&&d.get_type()!=a.MLM.IMAddressType.connect},function Yd(b,f){var a=c(o);a[v](M(e(Xb).format(u(f,b))));if(b[J]()){U(a);ab=c(m,a,d,e(cd));Hb=b;ab.attachEvent(h,Gc);if(cc(b)){pb(a);Z=c(m,a,d,e(Sc));Z.attachEvent(h,Fc)}}return a},function ae(){if(ab){ab.detachEvent(h,Gc);ab=d}if(Z){Z.detachEvent(h,Fc);Z=d}Hb=d});function Fc(){R.reportAbuse();z.close();return b}function Gc(){a.user.addContact(Hb[J]());z.close();return b}var Kb,md=new n(tc,8,b,f,b,function ee(h,f){var d=b,g=b;if(!h&&f){var e=a.MLM.PresenceStatus,c=lb(f[K]());d=c!=e.online&&c!=e.offline;g=d&&Kb&&Kb!=c;Kb=c}return g?ib:d},function de(c,g){var d=a.MLM.PresenceStatus,b,f=lb(c[K]());if(f==d.busy)b=e(fd);else b=e(ed);return M(e(tc).format(u(g,c),b))}),gd=new n(hc,9,b,b,b,function Od(k,h){var g=b,d=a.MLM.PresenceStatus;if(k)for(var c=0,j=h.get_count();c<j;c++){var e=h.get_item(c),i=e[K]().get_status();if(i!=d.online&&i!=d.offline||!e[p]().get_isOnline()){g=f;break}}return g},function Nd(){return e(hc)}),ad=new n(nc,10,b,f,b,function Ld(a,b){return Fb(a,b)&&q.get_supportsOfflineMessages()},function Kd(a,b){return xb(nc,a,b)}),Lc=new n(Lb,1,b,f,f,function $ContactOfflineCurrentOnlineOtherInfobar$isShown(a,b,c){return Fb(a,b)&&c.get_isOnline()&&!q.get_supportsOfflineMessages()},function $ContactOfflineCurrentOnlineOtherInfobar$display(a,b){return xb(Lb,a,b)}),Vc=new n(ac,1,b,f,f,function zd(a,b,c){return Fb(a,b)&&!c.get_isOnline()&&!q.get_supportsOfflineMessages()},function yd(a,b){return xb(ac,a,b)});function Fb(c,b){return !c&&b&&b[K]().get_status()==a.MLM.PresenceStatus.offline&&b.get_type()!=a.MLM.IMAddressType.telephone}function xb(p,h,l){var b=c(j);b[v](M(e(p).format(u(l,h),W(I))));var k=l.get_emailAddress(),f,g=h.get_linkedContact();if(h.get_type()==a.MLM.IMAddressType.connect&&g){var i=g&&g.get_sendMessageUrl();f=i&&i.toString()}if(f){U(b);var m=c(o,d,d,'<a href="'+f.encodeHtmlAttribute()+'" target="_blank">'+e(Rc).encodeHtml()+"</a>");b[v](m)}else if(k){U(b);var n=s(w,pd).format(k.encodeUrl()),m=c(o,d,d,'<a href="'+n.encodeHtmlAttribute()+'" target="_blank">'+e(Tc).encodeHtml()+"</a>");b[v](m)}return b}var Jb={},ud=new n(yc,11,b,f,b,function we(b,c,a){return !b&&a&&Jb[L(a)]},function ve(a,b){return M(e(yc).format(u(b,a)))});n.All=[sd,kd,Yc,qd,rd,bd,nd,od,jd,hd,vd,td,id,Uc,Oc,Mc,Nc,Xc,ld,md,gd,ad,Lc,Vc,ud];vb.initialize=function Md(){if(!fb){M=a.MLM.MessengerUtility.emoticonEncode;y=[];Jb={};N=c(m,ub,"wlxim_infobar_close");eb=c(j,ub,"wlxim_infobar_message");N[v](T(s(w,Nb),s(w,Zb)));c(o,N,d,S);fb=f;var k=q.get_history();for(var b=0,t=k.get_count();b<t;b++)sc(k.get_item(b));q.add_messageReceived(uc);a.addStateListener(Cb);Cb();q.get_roster()[H](Cc);a.user.get_endpoints()[H](wc);a.user.get_settings()[x](rc);a.user.get_presence()[x](pc);var l=a.user.get_networks();for(var e=0,r=l.get_count();e<r;e++)l.get_item(e)[x](ic);var h=Ib(q.get_roster());for(var g=0,u=h[i];g<u;g++){var n=h[g],z=n[p]();z[x](qb);n[K]()[x](tb)}E()}};function uc(b,a){sc(a.get_message())}function sc(b){var c=b.get_sender();if(b.get_isOfflineMessage()&&c!=a.user[J]()){Jb[L(c.get_contact())]=f;E()}}vb.update=function Xd(){E()};vb.dispose=function Td(){if(fb){fb=b;a.removeStateListener(Cb);q.remove_messageReceived(uc);q.get_roster()[F](Cc);a.user.get_endpoints()[F](wc);a.user.get_settings()[D](rc);a.user.get_presence()[x](pc);var g=a.user.get_networks();for(var c=0,j=g.get_count();c<j;c++)g.get_item(c)[D](ic);var f=Ib(q.get_roster());for(var e=0,k=f[i];e<k;e++){var h=f[e],l=h[p]();l[D](qb);h[K]()[D](tb)}if(z)z.closeHelper();z=N=eb=d}};function pc(c,b){var a=b[P]();if(a=="Status")E()}function Cb(){E()}function wc(){E()}function Cc(m,h){var e=Ib(h.get_newItems());for(var a=0,k=e[i];a<k;a++){var b=e[a],f=b[p]();f[x](qb);b[K]()[x](tb)}var d=Ib(h.get_newItems()),j=d[i];for(var a=0;a<j;a++){var b=d[a],f=b[p]();f[D](qb);b[K]()[D](tb);for(var c=0,l=y[i];c<l;c++){var g=y[c];if(g.get_address()==b)Gb(g)}}E()}function ic(c,b){var a=b[P]();if(a=="Status"||a=="IMEnabled")E()}function qb(){E()}function tb(){E()}function E(){if(fb){var g=q.get_roster(),d=Ib(g);for(var b=0,l=d[i];b<l;b++){var e=d[b],j=y[i],k=g.get_count()>2;for(var c=0,m=n.All[i];c<m;c++){var h=n.All[c],f=new xd(h,e),a=h.isShown(k,e);if(!a||a==ib)Gb(f);if(a)wd(f)}if(j!=0&&y[i]==0)Jc()}}}function wd(b){var h=b.get_type().get_priority(),d,a=0,g=y[i];while(a<g){var c=y[a],e=c.get_type();if(e==b.get_type()&&c.get_id()==b.get_id()){d=f;break}if(h<e.get_priority())break;a++}if(!d)y.insert(a,b);if(a==0&&y[0]!=z){if(z)z.closeHelper();y[0].display();Kc()}}function Gb(e,f){for(var a=0,d=y[i];a<d;a++){var c=y[a];if(c.get_type()==e.get_type()&&c.get_id()==e.get_id()){y.splice(a,1);if(a==0){if(!f)c.closeHelper(b);if(y[0])y[0].display();else Jc()}a--;d--}}}function Jc(){z=d;ub[g][r]=B;R.resize()}function Kc(){ub[g][r]=O;R.resize()}},qc=function(vb,y,v){var jb="InfoBar.SmsInput",kb="SmsInputLabel",kb="SmsInputLabel",ab="SmsInputCountryCode",lb="SmsInputNote",ib="SmsInputAddError",db="SmsInputDupeNumber",bb="SmsInputAddInvalid",hb="SmsInputSaveButton",Z="SmsInputCancelButton",m=this,H,L=/[^0-9]/g,x=y.get_contentEl(),G,E,R,t,W,rb,mb,n,q,p,z,qb,Q,K=b,sb,F,D;m.initialize=function xb(){if(!H){H=f;$css.add(x,"wlxim_sms");E=c(j,x,"wlxim_infobar");R=c(j,E,"wlxim_infobar_message");E[g][r]=B;t=c(j,x,"wlxim_smsform");W=c(j,t,"wlxim_prompt");W.innerText=e(jb);rb=c(o,t,"wlxim_smslabel",e(kb).encodeHtml());mb=c(o,t,"wlxim_smslabel",s(w,ab).encodeHtml());n=c("input",t,"wlxim_areainput");n.maxLength=3;n.size=3;n.attachEvent(N,U);n.attachEvent(Y,C);n.attachEvent("onblur",A);q=c("input",t,"wlxim_prefixinput");q.maxLength=3;q.size=3;q.attachEvent(N,T);q.attachEvent(Y,C);q.attachEvent("onblur",A);p=c("input",t,"wlxim_numberinput");p.maxLength=4;p.size=4;p.attachEvent(N,S);p.attachEvent(Y,C);p.attachEvent("onblur",A);c(j,t,fb);sb=c(j,t,"wlxim_smsnote",e(lb).format("<b>","</b>"));F=c("button",t,d,e(hb).encodeHtml());F.attachEvent(h,X);D=c("button",t,d,e(Z).encodeHtml());D.attachEvent(h,y.close);z=c(j,x,"wlxim_footer");var u=c(j,z,"wlxim_viacont");Q=new ic(v,d,a.MLM.IMAddressType.telephone,u);Q.initialize();qb=c(j,z,"wlxim_status",e(gc).format(e(pc)));c(j,z,fb);G=$ic.ic.createICFromTemplate(hc,v);y.set_titleHtml(G.html);a.addStateListener(J);J();var i=cb(v,a.MLM.IMAddressType.telephone);if(i){var b=i.get_address().replace("+1",k).replace(L,k);n.value=b.substr(0,3);q.value=b.substr(3,3);p.value=b.substr(6,4)}else{m.disable();var l={canary:$Config.WebIM.fmcan,cid:v.get_cid(),contactId:v.get_id()};$Network.fetchXML("/Handlers/FindMobileNumber.mvc?"+$Utility.serialize(l),m.FindMobileNumberCallback,"GET")}m.resize()}};m.get_isModified=function ub(){return b};m.get_contact=function wb(){return v};m.close=function tb(){m.dispose()};function C(){K=f}function A(){K=b}m.FindMobileNumberCallback=function(b){if(b&&b.status==200&&b.responseText){var a=b.responseText.replace(L,k);if(a.startsWith("1"))a=a.substr(1);if(a.length==10){n.value=a.substr(0,3);q.value=a.substr(3,3);p.value=a.substr(6,4)}else if(a.length==7){q.value=a.substr(0,3);p.value=a.substr(3,4)}}m.enable()};m.dispose=function zb(){if(H){H=b;n.detachEvent(N,U);n.detachEvent(Y,C);n.detachEvent("onblur",A);q.detachEvent(N,T);q.detachEvent(Y,C);q.detachEvent("onblur",A);p.detachEvent(N,S);p.detachEvent(Y,C);p.detachEvent("onblur",A);D.detachEvent(h,y.close);F.detachEvent(h,X);Q.dispose();if(G){$ic.ic.removeIC(G.id);G=d}a.removeStateListener(J)}};m.select=function Db(){};m.focus=function Eb(a){try{if(!K&&a){n.focus();n.select()}}catch(b){}};m.get_tab=function Ab(){return y};m.enable=function Bb(){n.disabled=b;q.disabled=b;p.disabled=b;F.disabled=b;D.disabled=b};m.disable=function yb(){n.disabled=f;q.disabled=f;p.disabled=f;F.disabled=f;D.disabled=f};m.resize=function Cb(){var b=parseInt(x[M][gb])+parseInt(x[M][eb]),d=x.offsetHeight-b,a=E.offsetHeight+t.offsetHeight+z.offsetHeight,c=0;if(d>a)c=d-a-1;z[g].marginTop=c+l;y.requestResize(a+b)};function U(){setTimeout(pb,0)}function pb(){P(n,q)}function T(){setTimeout(ob,0)}function ob(){P(q,p)}function S(){setTimeout(nb,0)}function nb(){P(p)}function P(b,d){var c=b.value,e=b.maxLength,a=c.replace(L,k);a=a.substr(0,e);if(a!=c)b.value=a;if(b.lastValue&&b.lastValue!=a&&a[i]==e&&d)try{d.focus();d.select()}catch(f){}b.lastValue=c}function I(a){E[g][r]=a?O:B;R.innerText=a;m.resize()}function X(){I();a.user.add_addContactCompleted(V);var b="+1"+n.value+q.value+p.value;if(a.checkValidSMSNumber(b)==1){a.user.addContact(b);m.disable()}else I(e(bb))}function V(h,g){a.user.remove_addContactCompleted(V);m.enable();var b=g.get_contact();if(g.get_resultCode()==0)if(b.get_addresses().get_count()==1){var d=v.get_addresses(),c=cb(v,a.MLM.IMAddressType.telephone);if(c)d.remove(c);d.add(b.get_currentAddress());y.close();$Do.when("wlxim_startconversation",0,v,f,a.MLM.IMAddressType.telephone)}else I(e(db).format(u(b)));else I(e(ib))}function J(){if(a.isFull())m.enable();else m.disable()}};$Do.when("wlximuiouter",d,Fc)};$HeaderWebIM={};new function(){var K=$HeaderWebIM,j=["c_himla","c_himlb","c_himlc","c_himld"],A=$("c_mocc"),C=$("c_murc"),u={},E=$("c_me"),k;if(E)k=$css.getCN("c_ic_i","span",E)[0];var s=0,h=0,i=0,J,M=0,f=$("c_me"),b;if(f){f=f.getElementsByTagName(X)[0];J=f[ub];$Do.when("wlximuiinner",0,F)}function F(){a.addStateListener(p);p();n.attachEvent(z,D)}function D(){a.removeStateListener(p);if(s){a.removeOnlineCountListener(v);a.removeUnreadMailCountListener(w)}if(i)$("c_melink").menu.removeStateListener(l);if(h)b.get_networks().remove_collectionChanged(o);n.detachEvent(z,D)}function y(a,b){if(a!=null){a=a.parentNode;if($css.has(a,"c_ld"))a=a.parentNode;a.style.display=b}}function c(a){y(a,"block")}function d(a){y(a,"none")}function I(){for(var a=0;a<j.length;a++)d($(j[a]))}K.toggle=function(f){var c=f.id;c=c.substr(9);var e=b.get_networks().get_count();for(var d=0;d<e;d++){var a=b.get_networks().get_item(d);if(a.get_id()==c){a.set_imEnabled(!a.get_imEnabled());q(a)}}};function L(b,g){var a=$("c_wimnet").parentNode.cloneNode(true),d=a.getElementsByTagName("a")[0],c=document.createElement("span"),f=$B.rtl?"rtl":"ltr";c.setAttribute("dir",f);var i=document.createTextNode(b.get_name());c.appendChild(i);d.replaceChild(c,d.childNodes[1]);d.id="c_wimnet_"+b.get_id();a.style.display="block";if(!g){var h=$css.getCN("c_ms","span",a),e=h[0];e.parentNode.removeChild(e)}b[x](q);G(a);q(b)}function G(a){$("c_wimn").parentNode.parentNode.insertBefore(a,$("c_himlo").parentNode)}function q(a){var b=$("c_wimnet_"+a.get_id());if(b){var f=b.childNodes[1].firstChild,i=b.childNodes[0],h=" "+e("MeMenu.Chat"),c=a.get_name(),g=a.get_status(),d=$WLXIM.MLM.NetworkStatus;if(!a.get_imEnabled()||g==d.signedOut){m(b,a,2);f.nodeValue=a.get_name()+h;b.title=e("MeMenu.SignInTo").format(c)}else{b.title=e("MeMenu.SignOutOf").format(c);if(g==d.signedIn){m(b,a,0);f.nodeValue=c+h}else if(g==d.signingIn||g==d.autoReconnectWaiting){m(b,a,0);f.nodeValue=c+" "+e("MeMenu.Enabling")}else if(a.get_tokenState()=="error"){m(b,a,0);f.nodeValue=c+" "+e("MeMenu.CannotConnect")}}}}function m(d,c,a){var b=c.get_id(),e=a-u[b];$IS.toggle(d,e);u[b]=a}function o(){var a=$("c_melink").menu;if(a&&a.isOpen()&&!i){i=1;a.addStateListener(l)}else l()}function l(){if(i){$("c_melink").menu.removeStateListener(l);i=0}var d=b.get_networks().get_count();if(d){networksSetup=1;for(var a=0;a<d;a++){var c=b.get_networks().get_item(a),f=c.get_id();if(f!="WL"&&c.get_supportsIM()&&c.get_supportsRemoteSignIn()&&!$("c_wimnet_"+f)){u[c.get_id()]=0;var e=false;if(a+1==d)e=true;if(a+2==d&&b.get_networks().get_item(a+1).get_id()!="WL")e=true;L(c,e)}}}if(!h){b.get_networks().add_collectionChanged(o);h=1}}function H(){if(h){b.get_networks().remove_collectionChanged(o);h=0}var c=$css.getCN("c_wimnw","a",$("c_me"));for(var a=0;a<c.length;a++)if(c[a].id!="c_wimnet"){var d=c[a].parentNode;d.parentNode.removeChild(d)}}function p(){var m=a.hasPresence(),x=a.hasNotify(),u,q;if(!s&&(x||m)){b=a.user;a.addOnlineCountListener(v);a.addUnreadMailCountListener(w);s=1}if(m){q=1;o();if(k)k[g][Z]=zb}else{H();if(k)k[g][Z]=jb}if(m)for(var i=0;i<j.length;i++){var h=$(j[i]);if(h.style.display=="none"){$edh.e(h.parentNode,"block");$IS.toggle(h,-1,null)}c(h)}else if(a.isLoading())for(var i=0;i<4;i++){var h=$(j[i]);c(h);if(h.style.display=="block"){$IS.toggle(h,1,null);$edh.d(h)}}else I();if(a.isWaitingToReconnect()||m)c($("c_himlo"));else d($("c_himlo"));if(x)u=1;if(a.isError())if(a.isUnsupported())c($("c_wimp"));else c($("c_wims"));else{d($("c_wimp"));d($("c_wims"))}if(a.isWaitingToReconnect()){var l=$("c_wimr");if(l){var y=e("InfoBar.Reconnecting"),n=a.getReconnectingTime();l[t]=y.format(n.min,n.sec);c(l);setTimeout(p,1e3)}}else{var l=$("c_wimr");if(l)d(l)}if(a.isOff())c($("c_wimn"));else d($("c_wimn"));if(C)C[g][r]=u?kb:B;if(A)A[g][r]=q?kb:B;if(f.binding)f.binding.update()}function v(){if(window["$HeaderCookie"])if(a.hasPresence())$HeaderCookie.updateContactsCount(a.onlineCount)}function w(){if(window["$HeaderCookie"])$HeaderCookie.updateUnreadCount(a.unreadMailCount)}};new function(){var j,d,y,c,L,U=$B.IE_M6,M="&nbsp;-&nbsp;",G="n:WL",P="a",E,v=p+"s",e,w,z="c_ic_sendim_av",C="c_ic_pr_av",A="c_ic_sms_av",I="({0})",h="get_count",q="get_item",s="get_addresses",m,l;if(U)n.uxp_p=function(a){a[Q][g].filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"')";a[g][Z]=jb};function N(){$Do.when("$ic",0,S)}function S(){j=$ic;d=j.ic;L=j.data;c=j.dom.$;E=d.get_membername_iclist_map;m=j.constants.ControlDataIndex;l=L.ControlData.getItem;j.presence=new T;d.set_wlxim();j.presence.initialize()}function T(){var n=this,N=b;n.dispose=function(){sb()};function T(e,d){var a=[],c=e.get_addresses();for(var b=0,f=c.get_count();b<f;b++)a.push(c.get_item(b).get_id());if(d)a.push(d.get_id());return a.join("")}function ib(g,d){var e=d?d:0,f=g,b={},a=this,c;a.queue=function(){var a=arguments[0],c=Array.prototype.slice.call(arguments,1);if(!b[a])b[a]=c};a.queueAndEATF=function(){a.queue.apply(this,arguments);a.executeAfterThreadFreed()};a.execute=function(){var c=0;for(var d in b){f.apply(this,b[d]);delete b[d];c++;if(c==10){setTimeout(a.execute,0);break}}};a.executeAfterThreadFreed=function(){if(c)clearTimeout(c);c=setTimeout(a.execute,e)}}n.webImGetString=function(b){var a="";if(window["GetString"])a=GetString("live.shared.strings.webim.ic."+b);return a};function eb(e,d){var b=e[s]();for(var a=0,f=b[h]();a<f;a++){var c=b[q](a);if(c.get_id()==d)return c}return 0}n.webImGetPresText=function(g){var i=$(g),a=" ";if(i){var b=n.webImGetString,c=i.presColor,j=l(g,m.membernamescope),h=l(g,m.membername),f=n.getContact(h),e;if(f){var d;if(j=="a")d=f[nb]();else d=eb(f,h);if(d){if(c=="green")a=b("Online");else if(c=="orange")a=b("Away");else if(c=="red")a=b("Busy");else if(c=="blue")a=b("Offline");e=d.get_network();return I.format(e.get_id()!="WL"&&e.get_id()!="SMS"?e.get_name():a)}}}return " "};n.getContact=function(b){if(n.enabled()&&b){var d=a.user.findContactById(b);if(d)return d;var c=a.user[J]()[p]();return eb(c,b)?c:0}return 0};n.updateStatusFromRegister=function(b){if(n.enabled()){var a=n.getContact(b);if(a)L(a)}};function kb(a,d){var b=d.get_propertyName();if(a&&(b=="Presence"||b=="IsAppearOfflineTo")){var c=a[p]();Y.queueAndEATF(T(c,a),c,a)}}function qb(b,c){var a=c.get_propertyName();if(b&&(a=="Groups"||a=="IsAppearOfflineTo"))L(b)}function mb(a){if(a&&a[p]){var b=a[p]();Z.queueAndEATF(T(b),b)}}function rb(d){var g=d.get_cid(),b=[],c=d[s](),e=c[h]();for(var a=0;a<e;a++){var f=c[q](a);b.push(f.get_id())}return b}function hb(g){var a,b,c=[],e=rb(g),f=E();for(var d=0,h=e.length;d<h;d++){a=e[d];if(a){b=f[a];if(b)c=c.concat(b)}}return c}function L(a){var b=a[s]();if(b)for(var d=0,e=b[h]();d<e;d++){var c=b[q](d);if(c)Y.queueAndEATF(T(a,c),a,c)}Z.queueAndEATF(T(a),a)}function ob(b,c){if(!b)return;var d=G,e=0,g=hb(b);if(g.length<=0)return;var f=c.get_network();if(f)d="n:"+f.get_id();if(d==G)e=a.displaySendSMS(b);var i=c.get_type()!=w||b[s]()[h]()>1,j=c.get_supportsAppearOfflineTo()?b.get_isAppearOfflineTo():0;jb(g,b,d,c[K](),i,e,j,c)}function pb(b){if(!b)return;var g=hb(b);if(g.length<=0)return;var i=a.displaySendSMS(b),e=0,c=b[s]();if(c)for(var d=0,j=c[h]();d<j;d++){var f=c[q](d);if(f&&f.get_type()!=w){e=1;break}}jb(g,b,P,b[K](),e,i,b.get_isAppearOfflineTo())}var Z=new ib(pb,100),Y=new ib(ob,100);function jb(Z,Q,ab,T,W,X,db,q){var E,P,p=psmorg=T.get_personalMessage(),v=y.PresenceStatus;if(q)P=q.get_id();else q=Q[nb]();E=q.get_network();if(p)p=!$B.Mobile?T.createPersonalMessageElement()[t]:p.encodeHtml();var f,e;switch(lb(T)){case v.online:f="green";e=n.webImGetString("Online");break;case v.busy:f="red";e=n.webImGetString("Busy");break;case v.away:f="orange";e=n.webImGetString("Away");break;case v.offline:f="blue";e=n.webImGetString("Offline");break;default:f="blue";e=k}if(!n.enabled())e=k;var cb=Q.get_isFavorite();if(f){var a,H,x,w,G,U,J,K,b,gb,eb,S,s,D,L,N,bb=["c_ic_",f,"frame"].join(k);for(H=0;H<Z[i];++H){a=Z[H];if($(a)){if(ab==l(a,m.membernamescope)&&(!P||P==l(a,m.membername))){G=c(a,"frame");U=c(a,"usertile");x=c(a,"menu_si");w=c(a,"menu_ss");K=c(a,"menu_si_pr_t");eb=c(a,"menu");S=c(a,"menu_ul");J=c(a,"name");N=l(a,m.extradata);if(G){var Y=k;if(G[R].indexOf("c_ic_frame_clip")>=0)Y=" c_ic_frame_clip";var F=$(a);if(F){var h=F[R];if(h.indexOf(C)<0&&e)h+=" "+C;if(h.indexOf(z)<0&&W)h+=" "+z;if(h.indexOf(A)<0&&X)h+=" "+A;F[R]=h;F.presColor=f}$IS.setClass(G,bb+Y)}var V=db?" c_ic_hidden":"";if(U)U[R]="c_ic_tile"+V;if(J){J[R]="c_ic_name"+V;if(N&&N.ltnu)J[t]=(u(Q,q)+"").encodeHtml()}if(K)K[t]=I.format(E.get_id()!="WL"&&E.get_id()!="SMS"?E.get_name():e);if(x)if(e==k||!W||!q.get_capabilities().get_supportsOfflineMessages()&&f=="blue")x[g][r]=B;else x[g][r]=O;if(w)if(e==k||!X)w[g][r]=B;else w[g][r]=O;if(S)S.binding.update();if(cb)d.displayICAsFav(a);b=c(a,"psm");L=l(a,m.additionalchickletdata);if(b&&(!L||L[j.constants.InlineMenuIndex.rm]<1))if(b.nodeName==o)if(p)try{b[t]=M+p}catch(fb){if(psmorg)b[t]=M+psmorg.encodeHtml()}else b[t]=k;else{s=c(a,"text");D=d.getICTileSize(a);if(p){b.title=psmorg;b[g][r]=O;b[t]=p;if(s[R].indexOf("text_h")>0&&D!="xl")s[R]="c_ic_text_h"}else{b.title=k;b[g][r]=B;b[t]=k;if(s[R].indexOf("text_h")>0&&D!="xl")s[R]="c_ic_text_h c_ic_text_h_"+D}}d.updateMenuBindingRef(a)}}else d.removeIC(a)}}}n.enabled=function(){return N&&a.hasPresence()};n.isAvailableForIC=function(d,e,f){if(n.enabled()){var c=$(d);if(c){var a=C;if(e)a=z;else if(f)a=A;return c[R].indexOf(a)>=0}}return b};n.startIM=function(c,d){if(n.enabled()){var b=n.getContact(c);if(b)a.startConversation(b,d?w:0,"ICMenu")}};n.isFavorite=function(b){var a=n.getContact(b);if(a)return a.get_isFavorite();return 0};n.addContactToWebImFavorites=function(d){var b=n.getContact(d);if(b&&!b.get_isFavorite()&&b.get_isContact()){var c=a.user.get_groups().get_favorites();if(c){c[v]().add(b);return 1}}return 0};n.setConvWidth=function(d,b){var a=c(d,"name").parentNode[g];if($B.IE&&$B.V<=6)a.width=b-70+"px";else a.maxWidth=b-64+"px"};function sb(){if(N){var c=a.user[J]()[p]();bb(c);var b=a.user.get_onlineContacts();b[F](S);V(b);var d=a.user[v]();d[F](cb);a.user.get_groups()[F](fb);if(e){e[F](S);V(e);e=null}N=0}a.removeStateListener(X)}function X(){if(!N&&a.hasPresence()){y=a.MLM;w=y.IMAddressType.telephone;d.set_wlximML();var g=a.user[J]()[p]();db(g);var b=a.user.get_onlineContacts();b[H](S);Q(b);var e=a.user[v]();new U(e);e[H](cb);a.user.get_groups()[H](fb);var h=d.getMemberFavoriteList();for(var c in h)if(n.addContactToWebImFavorites(c))d.removeMemberFromFavoriteList(c);N=f}}function db(a){ab(a,x);L(a)}function bb(a){ab(a,D);L(a)}function ab(c,b){c[K]()[b](mb);c[b](qb);var a=c[s]();if(a)for(var d=0;d<a[h]();d++){var e=a[q](d);if(e)e[b](kb)}}function V(a){W(a,bb)}function Q(a){W(a,db)}function gb(a){var b=a[i];if(!b&&a[h])b=a[h]();return b}function W(b,f,d,a){var e=gb(b);if(!d)d=0;if(!a)a=e;else a=Math.min(a,e);for(var c=d;c<a;c++){var g=b[q]?b[q](c):b[c];f(g)}}function fb(){if(!e){var b=a.user.get_groups().get_favorites();if(b){e=b[v]();e[H](S);Q(e)}}}function S(d,c){var a=c.get_newItems(),b=c.get_oldItems();if(!a&&!b)Q(d);else{if(a)Q(a);if(b)V(b)}}function cb(d,c){var b=c.get_newItems();if(b)new U(b);else if(y.NotifyCollectionChangedAction.reset==c.get_action())new U(a.user[v]())}function U(d){var a=0,c=500,e=gb(d);function b(){W(d,L,a,a+c);a+=c;if(e>a)setTimeout(b,0)}b()}n.initialize=function(){a.addStateListener(X);X()}}$Do.when("wlxim",0,N)};new function(){if(a.outerWindow!=n)return;var b,c=3e5;a.nonIdle=function e(){if(a.user&&a.isFull()&&a.user.get_presence().get_status()==a.MLM.PresenceStatus.idle)a.user.get_presence().set_status(a.MLM.PresenceStatus.online);clearTimeout(b);b=setTimeout(d,c)};function d(){if(a.user&&a.isFull())if(a.user.get_presence().get_status()==a.MLM.PresenceStatus.online){a.user.get_presence().set_status(a.MLM.PresenceStatus.idle);return}clearTimeout(b);b=setTimeout(d,c)}a.nonIdle()};new function(){var b=a.nonIdle,c="onmousewheel";if(b){function d(){n.detachEvent(z,d);_d.detachEvent(N,b);_d.detachEvent(bb,b);_d.detachEvent(c,b)}n.attachEvent(z,d);_d.attachEvent(N,b);_d.attachEvent(bb,b);_d.attachEvent(c,b)}}};$Network.registerScript("webimui")