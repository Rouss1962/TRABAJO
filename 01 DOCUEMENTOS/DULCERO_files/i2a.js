SmartLoader={};SmartLoader._keys=[];SmartLoader.DescriptorState=new $Enum("NotFetched","Fetching","Fetched");SmartLoader._Descriptor=function SmartLoader$_Descriptor(c,a,b){this._onload_callback=function d(){this.state=SmartLoader.DescriptorState.Fetched;this.callback.call(null)};this.state=SmartLoader.DescriptorState.NotFetched;this.cssUrls=c;this.scriptUrls=a;this.callback=b;this.onload_delegate=$CD(this,this._onload_callback)};SmartLoader.getLoadingState=function SmartLoader$getLoadingState(b){var a=SmartLoader._keys[b];return a?a.state:SmartLoader.DescriptorState.NotFetched};SmartLoader.load=function SmartLoader$load(c,g,d,f,e){var b=SmartLoader._keys,a=b[c];if(!a){a=new SmartLoader._Descriptor(g,d,f);b.push(a);b[c]=a}if(a.state==SmartLoader.DescriptorState.NotFetched){Loader.load(a.cssUrls,a.scriptUrls,a.onload_delegate,e);a.state=SmartLoader.DescriptorState.Fetching;return false}return true};if(!LiveViews["hiPriTimeout"])LiveViews.hiPriTimeout=50;if(!LiveViews["defaultTimeout"])LiveViews.defaultTimeout=5e3;if(!LiveViews["maxRequestsPending"])LiveViews.maxRequestsPending=10;LiveViews._queues=[];LiveViews._inProgressCount=0;LiveViews._hiPriQueueCreated=false;LiveViews._uniqueId=0;LiveViews._Queue=function LiveViews$_Queue(b){this.onSendRequests=function d(e,d,c){$BSI.informPVHead();this.state=LiveViews.QueueState.Done;LiveViews.Providers[this.kind].bindCallback(e,d,c);var a=LiveViews._queues,b=a.indexOf(this);if(b>=0)a.splice(b,1);$BSI.informLoaded(true)};this.onSendRequestError=function c(c,b){var a=[];b.forEach(function(b){var a=new HM.HMLiveViewResponseObject;a.Id=b.request.Id;a.StatusCode=HM.HMLiveViewResultCode.Failure;this.push(a)},a);Page.errorReportData.suppressUI=true;this.onSendRequests(a,b)};this.onTimeout=function e(){var b=[];this._items.forEach(function(a){this.push(a.request)},b);this.state=LiveViews.QueueState.Waiting;Page.setPerformanceId(LiveViews.Providers[this.kind].csiPerfId);var a=this;HM.LFPP=function(){LiveViews.Providers[a.kind].fppRequestSender.call(null,b,$CD(a,a.onSendRequests),a._items,$CD(a,a.onSendRequestError),LiveViews.fppTimeout)};HM.LFPP()};this.add=function f(b){var a=this._items;a.push(b);if(a.length==LiveViews.maxRequestsPending){clearTimeout(this.timeout);this.timeout=0;this.onTimeout()}};this.kind=b;this.state=LiveViews.QueueState.NotSent;this._items=[];var a;if(!LiveViews._hiPriQueueCreated){a=LiveViews.hiPriTimeout;LiveViews._hiPriQueueCreated=true}else a=LiveViews.defaultTimeout;this.timeout=setTimeout($CD(this,this.onTimeout),a)};LiveViews._findQueue=function LiveViews$_findQueue(e,d){var c=LiveViews._queues;for(var b=c.length-1;b>=0;b--){var a=c[b];if(a.state==d&&a._items.length<LiveViews.maxRequestsPending)return a}var a=new LiveViews._Queue(e);LiveViews._queues.push(a);return a};LiveViews.processPendingRequests=function LiveViews$processPendingRequests(){var a=LiveViews._pendingRegistration;LiveViews._pendingRegistration=[];a.forEach(function(b){var c=b.length;for(var a=0;a<c;a++)LiveViews.Providers[b.kind].registerCallback.apply(LiveViews,b[a])},null)};LiveViews.setupImageFetch=function LiveViews$fetchImage(b,c,d){var a=document.createElement("IMG");a.onload=b;a.onerror=c||b;a.onabort=d;return a};LiveViews.initialize=function LiveViews$initialize(){if(!LiveViews._started)return;if(LiveViews._timer){clearTimeout(LiveViews._timer);LiveViews._timer=null}var a=LiveViews.Providers[LiveViews.Kind.Hotmail];a.bindCallback=LiveViews.bindHmlvs;a.registerCallback=LiveViews.registerHmlv;a.fppRequestSender=HM.GetHMLiveViews;var b=LiveViews.Providers[LiveViews.Kind.External];b.bindCallback=LiveViews.bindElvs;b.registerCallback=LiveViews.registerElv;b.fppRequestSender=HM.DispatchSandboxRequests;LiveViews.processPendingRequests()};LiveViews.start=function LiveViews$start(){LiveViews._started=true;LiveViews.initialize()};LiveViews.registerElv=function LiveViews$registerElv(c,b){var e=$(b.id);if(e==null)return;e._elvData=b;var f=LiveViews.Kind.External,a=LiveViews.Providers[f],g=a.scriptUrls.length+a.cssUrls.length,d=null;if(g==0||(d=SmartLoader.getLoadingState(a))==SmartLoader.DescriptorState.Fetched){LiveViews._inProgressCount++;var i=LiveViews._findQueue(LiveViews.Kind.External,LiveViews.QueueState.NotSent);i.add({request:c,context:b})}else{if(d==SmartLoader.DescriptorState.NotFetched){var h=Browser.isIE?$("smart_bucket_External"):null;SmartLoader.load(a,a.cssUrls,a.scriptUrls,LiveViews.processPendingRequests,h)}LiveViews._delayRegistration(f,[c,b])}};LiveViews.bindElvs=function LiveViews$bindElvs(responses,context,timestamp){$Sandbox.config.cssRulePrefix=LiveViews.sandboxCssScope;$Sandbox.config.xmlProxy=LiveViews.sandboxProxyUrl;$Sandbox.config.developer=false;var responseIndex=0;responses.forEach(function(currentResponse){var currentContext=null;if(responseIndex<context.length)currentContext=context[responseIndex].context;var bindElem=$(currentContext.id);if(bindElem){if(responseIndex==0&&timestamp){var msgPartControl=Control.findControl(bindElem,"MessagePart");msgPartControl.updateDateStamp(timestamp)}if(currentResponse.Status==0&&currentResponse.HttpStatusCode==200){$CSIPerf.startTrace("elv"+currentContext.provider,LiveViews.ElvIdSeed.toString()+responseIndex.toString());eval("{"+currentResponse.Body+"}");var _elvControl=new ExternalLiveViewControl(bindElem,currentContext.provider,currentContext.lvh);_elvControl.Events.onsandboxerror.attach(LiveViews._elvOnSandboxErrorHandler);_elvControl.Events.onsandboxloaderror.attach(LiveViews._elvOnSandboxLoadErrorHandler);_elvControl.Events.onpipelineerror.attach(LiveViews._elvOnPipelineErrorHandler);_elvControl.Events.onxmlhttperror.attach(LiveViews._elvOnXmlHttpErrorHandler);_elvControl.Events.onload.attach(LiveViews._elvOnLoadHandler);_elvControl.Events.onprofile.attach(LiveViews._elvOnProfileHandler);_elvControl.Events.onsandboxupdated.attach(LiveViews._elvOnUpdated);_elvControl.elt.attachEvent("onclick",LiveViews._elvContainerClickHandler);_elvControl.loadCode(currentResponse);currentContext.binding=_elvControl;$CSIPerf.endTrace("elv"+currentContext.provider,LiveViews.ElvIdSeed.toString()+responseIndex.toString())}else{ExternalLiveViewControl.reportSuccessesAndFailures(currentContext.provider,0,1,0);LiveViews._elvUpdateUiOnError(currentContext.id,LiveViews._isSandBoxAuthFailure(currentResponse.AuthOption,currentResponse.HttpStatusCode),true)}}responseIndex++},context)};LiveViews.detachElvControlHandlers=function LiveViews$detachElvControlHandlers(a){a.Events.onsandboxerror.detach(LiveViews._elvOnSandboxErrorHandler);a.Events.onsandboxloaderror.detach(LiveViews._elvOnSandboxLoadErrorHandler);a.Events.onpipelineerror.detach(LiveViews._elvOnPipelineErrorHandler);a.Events.onxmlhttperror.detach(LiveViews._elvOnXmlHttpErrorHandler);a.Events.onload.detach(LiveViews._elvOnLoadHandler);a.Events.onprofile.detach(LiveViews._elvOnProfileHandler);a.Events.onsandboxupdated.detach(LiveViews._elvOnUpdated);a.elt.detachEvent("onclick",LiveViews._elvContainerClickHandler)};LiveViews._elvContainerClickHandler=function LiveViews$_elvContainerClickHandler(){if(!document.body.contains(event.srcElement)){event.returnValue=false;event.cancelBubble=true;InboxPage.doPostProc=false}};LiveViews._elvOnUpdated=function LiveViews$_elvOnUpdated(a){var b=LiveViews._getElvDataFromContext(a.context);if(b){var c=Control.findControl($(b.id),"MessagePart");c.updateDateStamp(a.timestamp)}};LiveViews._elvUpdateUiOnError=function LiveViews$_elvUpdateUiOnError(d,e,f){LiveViews._inProgressCount=0;var c=$(d);if(f){var b=$(d+"_staticcontent");if(b)c.innerHTML=b.innerHTML}var a=Control.findControl(c,"MessagePartBody");a.setLiveViewsProgressBarDisplay(false);if(e)a.setLiveViewsAuthInfoPaneDisplay(true);else a.setLiveViewsInfoPaneDisplay(true)};LiveViews._elvOnSandboxLoadErrorHandler=function LiveViews$_elvOnSandboxLoadErrorHandler(a){try{LiveViews._elvOnErrorHandlerImp(a.context,a.context.AuthOption,a.request.HttpStatusCode)}catch(b){}};LiveViews._elvOnSandboxErrorHandler=function LiveViews$_elvOnSandboxErrorHandler(a){try{LiveViews._elvOnErrorHandlerImp(a.context,a.context.AuthOption,a.context.HttpStatusCode)}catch(b){}};LiveViews._elvOnPipelineErrorHandler=function LiveViews$_elvOnPipelineErrorHandler(a){try{LiveViews._elvOnErrorHandlerImp(a.context,a.response.AuthOption,a.response.HttpStatusCode)}catch(b){}};LiveViews._elvOnXmlHttpErrorHandler=function LiveViews$_elvOnXmlHttpErrorHandler(a){try{LiveViews._elvOnErrorHandlerImp(a.context,a.context.AuthOption,a.httpStatusCode)}catch(b){}};LiveViews._elvOnErrorHandlerImp=function LiveViews$_elvOnErrorHandlerImp(d,c,b){var a=LiveViews._getElvDataFromContext(d);if(a)LiveViews._elvUpdateUiOnError(a.id,LiveViews._isSandBoxAuthFailure(c,b),false)};LiveViews._elvOnLoadHandler=function LiveViews$_elvOnLoadHandler(d){if(LiveViews._inProgressCount>0)LiveViews._inProgressCount--;if(LiveViews._inProgressCount<=0){var a=LiveViews._getElvDataFromContext(d.context);if(a){var b=Control.findControl($(a.id),"MessagePartBody");b.setLiveViewsProgressBarDisplay(false);var c=Control.findControl($(a.id),"MessagePart");c.resetWidth()}}};LiveViews._elvOnProfileHandler=function LiveViews$_elvOnProfileHandler(a){$CSIPerf.lapseTimer(a.profileContext.profileevent)};LiveViews._isSandBoxAuthFailure=function LiveViews$_isSandBoxAuthFailure(b,a){return !LiveViews.isPsaDown&&b!=HM.SandboxAuthenticationOption.None&&(a==400||a==401)};LiveViews._getElvDataFromContext=function LiveViews$_getElvDataFromContext(d){var c=null,a=d.ID;a=a.substr(0,a.lastIndexOf("__"));var b=$(a);if(b)c=b._elvData;return c};LiveViews.registerHmlv=function LiveViews$registerHmlv(c,a){var d=$(c.Id);if(d==null)return;var k=c.Id+LiveViews._uniqueId++;d.id=c.Id=k;LiveViews._setupData(d,"hmlv",a);var g=LiveViews.Kind.Hotmail,b=c.Type,j=LiveViews.Providers[g],e=j.typeHandlers[b],h=e.scriptUrls.length+e.cssUrls.length,f=null;if(h==0||(f=SmartLoader.getLoadingState(b))==SmartLoader.DescriptorState.Fetched)if(b=="Attachment"){a.binding=LiveViews._getHmlvBindingObject(b,d.lastChild,a);if(a.containerControl&&a.containerControl.onHmlvLoaded)a.containerControl.onHmlvLoaded(a)}else{var l=LiveViews._findQueue(LiveViews.Kind.Hotmail,LiveViews.QueueState.NotSent);l.add({request:c,context:a})}else{if(f==SmartLoader.DescriptorState.NotFetched){var i=Browser.isIE?$("smart_bucket_"+b):null;setTimeout(function(c,a,b){return function(){SmartLoader.load(c,a.cssUrls,a.scriptUrls,LiveViews.processPendingRequests,b)}}(b,e,i),5)}LiveViews._delayRegistration(g,[c,a])}};LiveViews.bindHmlvs=function LiveViews$bindHmlvs(b,a){b.forEach(function(e){var b=null;for(var d=this.length-1;d>=0;d--)if(this[d].request.Id==e.Id){b=a[d].context;break}var c=$(e.Id);if(c)if(e.StatusCode==HM.HMLiveViewResultCode.Success){c.innerHTML=e.Html;var f=c.firstChild;LiveViews._setupData(f,"hmlv",b);b.binding=LiveViews._getHmlvBindingObject(b.type,f);if(b.containerControl&&b.containerControl.onHmlvLoaded)b.containerControl.onHmlvLoaded(b)}else $replaceClass(c.lastChild,"Progress","Error")},a)};LiveViews._setupData=function LiveViews$_setupData(c,a,b){Control.getAncestorByAttr(c,a)["_"+a+"Data"]=b};LiveViews._getHmlvBindingObject=function LiveViews$_getHmlvBindingObject(c,b){var a=LiveViews.Providers[LiveViews.Kind.Hotmail].typeHandlers[c].bindingClassName;return new window[a](b)};InboxPage.initializeBucket2=function InboxPage$initializeBucket2(){LiveViews.initialize();if(InboxPage.bucket3Script)window.setTimeout(function(){InboxPage.downloadBucket3()},20);else if(InboxPage.bucket4Script)window.setTimeout(function(){InboxPage.downloadBucket4()},20);else Page.pageComplete()};InboxPage.downloadBucket3=function InboxPage$downloadBucket3(){Loader.load(InboxPage.bucket3Css,InboxPage.bucket3Script,InboxPage.onBucket3Download,$("bucket3"))};InboxPage.onBucket3Download=function InboxPage$onBucket3Download(){InboxPage.initializeBucket3()};InboxPage.downloadBucket4=function InboxPage$downloadBucket4(){Loader.load(InboxPage.bucket4Css,InboxPage.bucket4Script,InboxPage.onBucket4Download,$("bucket4"))};InboxPage.onBucket4Download=function InboxPage$onBucket4Download(){InboxPage.initializeBucket4()};if(!Browser.isIE)InboxPage.downloadBucket3=function InboxPage$downloadBucket3(){Loader.load(InboxPage.bucket3Css,InboxPage.bucket3Script,InboxPage.onBucket3Download)}