/* Copyright (C) 2011 Microsoft Corporation */var _de=document.documentElement,_deScr=$B.RE_WebKit?document.body:document.documentElement;window.Function.KillEvent=function(){event.cancelBubble=true;event.returnValue=false;return false};registerNamespace("$UI");$UI.Dialog=function(p,e,y,l){var s=document.body.className.indexOf("rtl")>-1,d,m,c=this,f=new $Memory.Groups,a=null,g=null,i=null,k=null,r=document.body,h,n,A,t,j=null,b;this.dock=new $UI.Dialog.Rect(0,0,0,0);if(e&&e<5)e=5;l=l?" "+l:"";function o(){if(d){var b=d.style,a=$B.IE&&$B.V==7?m.offsetLeft/100:1;if(a==0)a=1;if($B.IE&&$B.V==6){b.width=_deScr.scrollWidth-3+"px";b.pixelTop=Math.max(0,_deScr.scrollTop/a)}b.pixelHeight=_de.clientHeight/a}}function q(){var b;if(null!=window["event"]&&event.srcElement==h)b=$UI.Dialog.findFocusableElement(a,n,false);else b=$UI.Dialog.findFocusableElement(a,h,true);if(b)setTimeout(function(){try{b.focus()}catch(a){}},0)}this.dispose=function(){if(j){clearTimeout(j);j=null}if(f){f.dispose();f=null}b=null;d=null;m=null;h=null;n=null};this.setContents=function(m){f.create(null).dispose();var b=f.create(null);a=m;var j=a.parentNode;if(null==j||null==j.tagName){r.appendChild(a);b.Nodes.register(a)}var e={href:"#"},c={position:"absolute"},d=$B.RE_WebKit?"input":"a";n=b.Nodes.create(d,e,c,a);h=b.Nodes.create(d,e,c);if($B.RE_WebKit)if(s)n.style.right=h.style.right="10000px";else n.style.left=h.style.left="-10000px";a.insertAdjacentElement("afterBegin",h);b.Events.register(n,{onfocus:q});b.Events.register(h,{onfocus:q});a.style.position="absolute";a.className+=l;if(!p&&$B.IE&&$B.V<7){g=new $UI.FramePopup;b.Properties.register(g);k=new $UI.FramePopup;b.Properties.register(k)}i=b.Nodes.create("div",{},c,a.parentElement);i.className="UI_Dialog_Shadow"+l;x();return a};this.recalc=function(k){if(!a)return;if(j){clearTimeout(j);j=null}o();var d=a.style;if(!y){var b=$UI.Dialog.getLocation(a);if(!b||b.isEmpty()){var i={visibility:a.currentStyle.visibility||d.visibility||"visible",display:a.currentStyle.display||d.display||"auto"};d.visibility="hidden";d.display="block";b=$UI.Dialog.getLocation(a);d.display=i.display;d.visibility=i.visibility}if(!c.dock)c.dock=new $UI.Dialog.Rect(0,0,0,0);var h=_de.clientWidth/2-b.width/2;if(s){c.dock.x=Math.min(h,0-(b.width-_de.clientWidth)-25);if($B.RE_WebKit)c.dock.x+=_deScr.scrollWidth-_de.clientWidth}else c.dock.x=Math.max(h,25);if(k){var f=_de.clientHeight-b.height-3;c.dock.y=_deScr.scrollTop+Math.min(Math.max(f>200?f:(_de.clientHeight-b.height)/2,0),100)}c.dock.height=b.height;c.dock.width=b.width}d.pixelTop=c.dock.y;d.pixelLeft=c.dock.x;if(g)g.positionAt(c.dock,e?1e3:e-2);w(true)};function w(m){var h=$UI.Dialog.getLocation(a),f=h.height,l=h.width;if(f!=t||m){var b=new $UI.Dialog.Rect,d=i.style;d.width=(b.width=l)+"px";d.height=(b.height=f)+"px";d.left=(b.x=c.dock.x+(s?-3:3))+"px";d.top=(b.y=c.dock.y+3)+"px";if(g)k.positionAt(b,e?1e3:e-2);t=f}j=setTimeout(w,25)}this.show=function(h,j){i.style.backgroundColor="#000";z(i,30);c.recalc(true);a.style.display="block";if(e){i.style.zIndex=e-1;a.style.zIndex=e}if(p){var g=f.create("show");d=_ce("div");u();m=_ce("div");m.className="UI_Dialog_ZoomTest"+l;d.className=d.id="UI_Dialog_BG";d.className+=l;if(e)d.style.zIndex=e-1;r.appendChild(d);r.appendChild(m);var b=Function.KillEvent;g.Events.register(d,{onfocus:q,onclick:b,onmousedown:b,onkeydown:b,onkeypress:b,ondblclick:b});g.Events.register(window,{onresize:function(){setTimeout(o,0)},onfocus:b});g.Nodes.register(d);g.Nodes.register(m);o()}function k(){try{(h?h:$UI.Dialog.findFocusableElement(a)).focus()}catch(b){}}if(!j)setTimeout(k,10)};this.hide=function(){f.create("show").dispose();f.create("ext").dispose();if($B.IE&&$B.V<7)if(b){for(var a=0;a<b.length;a++)if(typeof b[a].wlppHide!="undefined")b[a].style.visibility=b[a].wlppHide;b=null}};this.minimize=function(){i.style.display="none";if(g)g.minimize();if(k)k.minimize();a.style.visibility="hidden";if(p){d.style.display="none";if(b)for(var c=0;c<b.length;c++)b[c].style.visibility=b[c].wlppHide;o()}};this.restore=function(){i.style.display="block";a.style.visibility="visible";if(g)g.restore();if(k)k.restore();c.recalc(true);if(p){d.style.display="block";u();o()}};function z(b,a){var c="undefined"==typeof b.style.filter?"opacity":"filter";b.style[c]=c=="filter"?"alpha(opacity="+a+")":.01*a}function x(){f.create("ext").Events.register(window,{onresize:v,onscroll:v})}function v(){f.create("ext").dispose();c.recalc(false);x()}function u(){if($B.IE&&$B.V<7){b=document.getElementsByTagName("select");var e=a.getElementsByTagName("select");for(var c=0;c<b.length;c++){var f=false;for(var d=0;d<e.length;d++)if(b[c]==e[d]){f=true;break}if(!f){b[c].wlppHide=b[c].style.visibility;b[c].style.visibility="hidden"}}}}};$UI.Dialog.Rect=function(c,d,b,a){return new function(){var e=this;this.x=c;this.y=d;this.width=b;this.height=a;this.isEmpty=function(){return e.width<=0||e.height<=0}}};$UI.Dialog.findFocusableElement=function(b,a,c){function g(a){function c(a){while(a&&a.currentStyle&&a.currentStyle.display!="none"&&a.currentStyle.visibility!="hidden")a=a.parentNode;if(!a||!a.currentStyle)return true;return false}var b="BUTTON|TEXTAREA|FIELDSET|IFRAME|SELECT|";return a.tagName&&!a.disabled&&(b.indexOf(a.tagName+"|")>-1||a.tagName=="A"&&a.href||a.tagName=="INPUT"&&a.type.toLowerCase()!="hidden"&&(!$B.Firefox||a.type.toLowerCase()!="file"))&&c(a)}function d(b){if(!b)return null;var a=c?b.nextSibling:b.previousSibling;while(a&&a.nodeType!=1)a=c?a.nextSibling:a.previousSibling;if(!a)return d(b.parentNode);else return a}function f(b,e){var a=e;if(a&&b.contains(a))while(a!=null)if(!g(a))if(c&&a.firstChild)a=a.firstChild;else if(!c&&a.lastChild)a=a.lastChild;else a=d(a);else return a;return null}if(a)a=d(a);else a=b;var e=f(b,a);if(!e&&a&&a!=b)return f(b,b);else return e};$UI.Dialog.getLocation=function(b){if(!b)return new $UI.Dialog.Rect(0,0,0,0);var c=0,d=0,a=b;while(a){c+=a.offsetLeft;d+=a.offsetTop;a=a.offsetParent}return new $UI.Dialog.Rect(c,d,b.offsetWidth,b.offsetHeight)};$UI.Popover=function(){this.header=null;this.body=null;this.footerText=null;this.width=300;this.bodyPadding=true;this.showHeader=true;this.showFooter=true;this.modal=false;this.zIndex=null;this.addButton=function(e,c,a,b){d.push({name:e,value:c,isDefault:a,isCancel:b})};this.show=function(w,u,s,t){if(e)return;p=w;o=u;if(!a){a=new $UI.Dialog(b.modal,b.zIndex);c=_ce("div");c.style.display="none";c.innerHTML="<div><h3></h3></div><div></div><div><nobr></nobr></div>";a.setContents(c);q();c.className="UI_Popover";var r=c.childNodes;h=r[1];i=r[2];g=r[3];n=h.firstChild;k=g.firstChild;h.className=" Header";i.className=" Body";g.className=" Footer";var m=b.width;c.style.width=parseInt(m,10)==m?m+"px":m;j=null;f=[];for(var l=0;l<d.length;l++)v(d[l].name,d[l].value,d[l].isDefault,d[l].isCancel);if(d.length==0)b.showFooter=false;x()}a.show(s?f[s]:null,t);e=true};this.hide=function(){if(!e)return;if(o)setTimeout(w,10);try{l.dispose();m.dispose();a.hide();a.dispose()}catch(b){}e=false;c=h=g=i=n=k=f=null};this.enableButton=function(a){f[a].disabled=false};this.disableButton=function(a){f[a].disabled=true};function w(){try{o.focus()}catch(a){}}function q(){l.Events.register(b.modal?$B.IE?document.body:window:c,$B.RE_WebKit?{onkeydown:t}:{onkeypress:t})}function u(){l.Events.dispose()}function v(b,g,c,e){k.appendChild(document.createTextNode(" "));var d=_ce("div");d.innerHTML='<button id="popover_btn_{0}" type="{1}" />'.format(b,c?"submit":"button");var a=d.firstChild;m.Nodes.register(a);if(c)a.className+="Default";else if(e)j=b;f[b]=a;a.innerHTML="<nobr>"+g+"</nobr>";m.Events.register(a,{onclick:function(a){r(b);a.returnValue=false}});k.appendChild(a)}function t(a){switch(($B.RE_WebKit?a:event).keyCode){case 27:r(j?j:"$cancel")}}function r(c){var a=true;if(p)a=p(b,c);if(a)b.hide();event.returnValue=false}function x(){function a(a,b){if(a)if(typeof a=="string")b.innerHTML=a;else{b.innerHTML="";b.appendChild(a)}}h.style.display=b.showHeader?"block":"none";g.style.display=b.showFooter?"block":"none";if(!b.bodyPadding)i.style.padding="0";a(b.header,n);a(b.body,i)}this.recalc=function(){if(!e)return;if(a)a.recalc(false)};this.minimize=function(){if(!a||!e)return;a.minimize();u()};this.restore=function(){if(!a||!e)return;a.restore();q()};var e=false,a,b=this,h,i,g,n,k,j,s=new $Memory.Groups,m=s.create("show"),l=s.create("showHide"),f,c,d=[],p=null,o=null}