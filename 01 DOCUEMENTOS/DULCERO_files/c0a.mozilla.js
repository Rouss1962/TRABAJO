if(!window.Silverlight)window.Silverlight={};Silverlight._SAFARI_BROWSER=1;Silverlight._CHROME_BROWSER=2;Silverlight._isInstalledCache={};Silverlight.isInstalled=function(a){a=a==undefined?null:a;var h=a==null?"default":a;if(this._isInstalledCache[h]!=undefined)return this._isInstalledCache[h];var b=false,n=null;try{var j=null,k=false;if(window.ActiveXObject)try{j=new ActiveXObject("AgControl.AgControl");if(a===null)b=true;else if(j.IsVersionSupported(a))b=true;j=null}catch(m){k=true}else k=true;if(k){var l=navigator.plugins["Silverlight Plug-In"];if(l)if(a===null)b=true;else{var i=l.description;if(i==="1.0.30226.2")i="2.0.30226.2";var c=i.split(".");while(c.length>3)c.pop();while(c.length<4)c.push(0);var e=a.split(".");while(e.length>4)e.pop();var d,g,f=0;do{d=parseInt(e[f]);g=parseInt(c[f]);f++}while(f<e.length&&d===g);if(d<=g&&!isNaN(d))b=true}}}catch(m){b=false}this._isInstalledCache[h]=b;return b};Silverlight.supportedUserAgent=function(j,i,c){try{var b=null;if(i)b=i;else b=window.navigator.userAgent;var g=true,h=true;if(c){if(c&Silverlight._CHROME_BROWSER)g=false;if(c&Silverlight._SAFARI_BROWSER)h=false}var a={OS:"Unsupported",Browser:"Unsupported"};if(b.indexOf("Windows NT")>=0||b.indexOf("Mozilla/4.0 (compatible; MSIE 6.0)")>=0)a.OS="Windows";else if(b.indexOf("PPC Mac OS X")>=0)a.OS="MacPPC";else if(b.indexOf("Intel Mac OS X")>=0)a.OS="MacIntel";if(a.OS!="Unsupported")if(b.indexOf("MSIE")>=0){if(navigator.userAgent.indexOf("Win64")==-1)if(parseInt(b.split("MSIE")[1])>=6)a.Browser="MSIE"}else if(b.indexOf("Firefox")>=0){var d=b.split("Firefox/")[1].split("."),e=parseInt(d[0]);if(e>=2)a.Browser="Firefox";else{var k=parseInt(d[1]);if(e==1&&k>=5)a.Browser="Firefox"}}else if(b.indexOf("Chrome")>=0&&g){var d=b.split("Chrome/")[1].split("."),e=parseInt(d[0]);if(e>=3)a.Browser="Chrome"}else if(b.indexOf("Safari")>=0&&h)a.Browser="Safari";var f=!(a.OS=="Unsupported"||a.Browser=="Unsupported"||a.OS.indexOf("Mac")>=0&&a.Browser=="MSIE");if(j=="2.0")return f&&a.OS!="MacPPC";else if(j=="1.0")return f&&b.indexOf("Windows NT 5.0")<0;else return f}catch(l){return false}};$Network.registerFpp("HM",function(){var f=$Network.FppProxy,a=f.__string,c=f.__primitive,d=f.__array,e=f.__custom,h=f.__enum,j=f.__date,g=f.__object,i=f.__oArray,b=new $Network.FppProxy("HM");b.FppStatus=new $Flags("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);b.rfc("FppError",[a("ErrorCode"),a("Message"),g("ErrorObj"),a("StackTrace")]);b.rfc("FppReturnPackage",[h("Status"),g("Value"),i("OutRefParams"),e(b.FppError,"Error"),g("ProfilingInfo")]);b.rfm("ReportError",[a("errorString")],"ReportError",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("HmSimpleMsg",[c("IsBlocking"),c("YesCode"),c("NoCode"),a("Message")]);b.rfm("CheckSpelling_ec",[a("sentence"),d("ignoredWords")],"CheckSpelling_ec",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("AddWordsToUserDictionary_ec",[d("words")],"AddWordsToUserDictionary_ec",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("DeleteUploadedAttachment_ec",[a("attachmentToBeDeleted"),c("attachmentSizes")],"DeleteUploadedAttachment_ec",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("SaveDraft",[a("to"),a("from"),a("cc"),a("bcc"),c("priority"),a("subject"),a("message"),d("attachments"),a("rfc822MessageId"),a("rfc822References"),a("rfc822InReplyTo"),a("priorDraft"),a("originalMessage"),a("originalDraft"),h("replyState"),d("ignoredWordsFromSpellCheck"),c("isAutoSave"),a("meetingIcalId"),c("saveAsPlainTextMessage")],"SaveDraft",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("VerifyRecipients",[d("emails")],"VerifyRecipients",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MoveMessagesToFolder",[a("fromFolderId"),a("toFolderId"),d("messageList"),d("messageAuxData"),e("batchInfo"),e("messageListRenderingInfo"),c("fetchMessageList"),c("refreshFolderAndQuickViewLists"),a("folderNameForRuleSuggestion"),e("messageRenderingInfo"),e("conversationRenderingInfo"),c("fetchItem"),c("blockIfDelete")],"MoveMessagesToFolder",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("InboxUiData",[a("FolderListHtml"),a("QuickViewListHtml"),a("MessageListHtml"),a("MessageHtml"),a("InfoPaneHtml"),a("SuggestionHtml"),e(b.BatchInfo,"BatchInfo")]);b.rfm("GetInboxData",[c("fetchFolderList"),c("renderUrlsInFolderList"),c("fetchMessageList"),e("messageListRenderingInfo"),c("fetchMessage"),e("messageRenderingInfo")],"GetInboxData",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.ContentId=new $Enum("PhotosSilverlightUpsell","DocsSilverlightUpsell");b.rfm("DemandLoad",[d("demandLoadContentValues")],"DemandLoad",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.seal();return b});window.ComposeServices={Events:{endsavedraft:new $Event,endspellchecking:new $Event,endaddwordstouserdictionary:new $Event}};ComposeServices.beginSaveDraft=function ComposeServices$beginSaveDraft(b,q,n,p,o,k,m,l,a,j,c,i,d,e,f,h,g){HM.LFPP=function(){HM.SaveDraft(q,n,p,o,k,m,l,g,i,d,e,null!=a&&""!=a?a:null,c,null,j,null,b,h,f,ComposeServices._endSaveDraft,{isAutoSave:b})};HM.LFPP()};ComposeServices._endSaveDraft=function ComposeServices$_endSaveDraft(c,d,b,a){ComposeServices.Events.endsavedraft.fire([c,b,d.isAutoSave,a])};ComposeServices.beginDeleteDraft=function ComposeServices$beginDeleteDraft(a){HM.LFPP=function(){HM.MoveMessagesToFolder(ComposePage.sysFldrs.draftsFid,ComposePage.sysFldrs.trashFid,[a],null,null,null,false,false,null,null,null,false,false,function(){},null)};HM.LFPP()};window.DemandLoadServices={Events:{enddemandload:new $Event}};DemandLoadServices.beginDemandLoad=function DemandLoadServices$beginDemandLoad(b,c,a){HM.LFPP=function(){HM.DemandLoad(b,DemandLoadServices._endDemandLoad,{callbacks:c},a?a:null)};HM.LFPP()};DemandLoadServices._endDemandLoad=function DemandLoadServices$_endDemandLoad(b,a){DemandLoadServices.Events.enddemandload.fire([b,a.callbacks])};function Toolbar(b,a){Control.create(this,b);this._ignoreActions=[];this._handler=null;this._onIgnore=null;this.registerOnClickHandler(a)}Toolbar.standardIgnoreList=["Help","HelpFeedback","HelpGettingStarted","HelpSupport"];var __p=Toolbar.prototype;__p.dispose=function Toolbar$dispose(){this._ignoreActions=null;this._handler=null;this._onIgnore=null;Control.destroy(this)};__p.registerOnClickHandler=function Toolbar$registerOnClickHandler(a){this._handler=a};__p.registerOnIgnoreHandler=function Toolbar$registerOnIgnoreHandler(a){this._onIgnore=a};__p.setIgnoreActions=function Toolbar$setIgnoreActions(a){this._ignoreActions=a};__p.onclick=function Toolbar$onClick(a){if(!a||this._ignoreActions.exists(a)){if(this._onIgnore)this._onIgnore(a);return}return this._handler(a,event)};Toolbar.createClass("Toolbar");ComposeToolbar={items:null};ComposeToolbar.onclick=function ComposeToolbar$onclick(a){switch(a){case "sendMessage":ComposeActions.sendMsg(event);break;case "meetingRequestOk":case "exchangeSharingRequestOk":ComposeActions.sendMsgImpl(a);break;case "saveDraft":ComposeActions.saveDraft();break;case "cancelMessage":return true;break;case "AddAttachment":case "AddFileAttachment":ComposePage.addAttachment("file");break;case "AddPhotoAttachment":ComposePage.addAttachment("photo");break;case "spellCheck":ComposeActions.spellCheck();break;case "msgPriHigh":case "msgPriLow":ComposeToolbar._handleMsgPri("msgPriHigh"==a?"2":"1");break;case "From":ComposeToolbar._handleFromDropdown();break;case "rTERichText":case "rTEHTML":case "rTEPlainText":var b=ComposePage.RTE;if(b)b.modeMenuOnClick([b,{key:a.substr(3)}]);break;default:return true}return false};ComposeToolbar._handleMsgPri=function ComposeToolbar$_handleMsgPri(b){if(b==$("msgPri").value)b="0";var a="Selected",c=$("MsgPriHigh"),d=$("MsgPriLow");switch(b){case "0":$css.remove(c,a);$css.remove(d,a);break;case "1":$css.remove(c,a);$css.add(d,a);break;case "2":$css.add(c,a);$css.remove(d,a)}$("msgPri").value=b};ComposeToolbar._handleFromDropdown=function ComposeToolbar$_handleFromDropdown(){var a=$tag($tag(Control.getAncestorByAttr(event.srcElement,"aId"),"A")[0],"SPAN")[0].innerHTML;$tag($tag($("fromAddrMenu"),"A")[0],"SPAN")[0].innerHTML=a;$("fromAddr").value=a};ComposeToolbar._setupItems=function Tooolbar$_setupItems(){var b=$tag($("toolbarContainer"),"LI");ComposeToolbar.items=[];for(var a=b.length-1;a>=0;--a)if(!($css.has(b[a],"ToolbarHelpLink")||$css.has(b[a],"ToolbarOptionsLink")))ComposeToolbar.items.push(b[a])};ComposeToolbar.updateToolbarState=function ComposeToolbar$updateToolbarState(){if(null==ComposeToolbar.items)ComposeToolbar._setupItems();Resize.recalculatePrimaryToolbarWidths()};Type.createStaticClass(ComposeToolbar,"ComposeToolbar");if(!window.RTE)window.RTE={};RTE.ModeStrings=["PlainText","RichText","HTML"];RTE.Mode={};for(var i=RTE.ModeStrings.length-1;i>=0;i--)RTE.Mode[RTE.ModeStrings[i]]=i;RTE.FONT_UPDATE=function RTE$Font_Update(a){if(!a.size)return "inherit";return RTE_CONFIG.FONT_SIZE[a.size-1]};RTE.Sync=function RTE$Sync(a){var b=$tag(a,"IFRAME")[0].contentWindow.document.body,e=$tag(a,"TEXTAREA")[0],c=null;if(a.getAttribute("suppressempty")){var d=b.createTextRange?b.createTextRange():document.selection.createRange();if(d["moveToElementText"]){d.moveToElementText(b);if(""==d.text)c=""}}if(c==null)c=a.getAttribute("mode")==RTE.ModeStrings[RTE.Mode.RichText]?b.innerHTML:RTE.ConvertToPlainText(b.innerHTML);e.value=c;$tag(a,"INPUT")[0].value=a.getAttribute("mode")};RTE.ConvertToPlainText=function RTE$IE$ConvertToPlainText(c,b){var a=document.createElement("div");a.innerHTML=c.replace(/\r\n/g,"<br>");if(b)return RTE.Editor.HTMLEncode(a.innerText,true);return a.innerText};RTE.turnOn=function RTE$turnOn(a,g){if(a.getAttribute("frameready")=="yes")return;var d=a.contentWindow,c=d.document,e=c.body,h=a.nextSibling;if(!Browser.isIE)$Browser.attachCompatabilities(d);d.attachEvent("onkeydown",function i(b){if(b.keyCode==9&&!b.ctrlKey&&!b.shiftKey)$callFocus($tag(a.parentNode.parentNode,"A")[0])},true);c.documentElement.dir=document.documentElement.dir;setTimeout(function(){var b=["fontFamily","fontSize","fontWeight","backgroundColor","color"],d=c.body;for(var a=b.length-1;a>=0;a--)d.style[b[a]]=h.style[b[a]]},0);RTE._setInitialValue(e,a.parentElement.getElementsByTagName("TEXTAREA")[0].value);var b=a.parentElement;while(b&&b.tagName!="FORM")b=b.parentElement;if(b)b.onsubmit=$CombineDelegate(b.onsubmit,function(){var b=a.parentElement;RTE.Sync(b)});if(!g)$updateClass(e,[RTE.ModeStrings[RTE.Mode.PlainText]],RTE.ModeStrings);RTE._makeEditable(a);a.setAttribute("frameready","yes");var f=Control.tryFindControl(a,"RTE.Editor");if(f)f._doInit()};RTE._makeEditable=function RTE$IE$_makeEditable(a){a.contentWindow.document.body.contentEditable=true};RTE._setInitialValue=function RTE$IE$_setInitialValue(b,a){try{if(a!="")b.innerHTML=a}catch(c){try{b.innerHTML=a.replace(/<p.*>/gi,"<br/>")}catch(c){}}};if(Browser.isIE&&window.__RTE){for(var i=__RTE.length-1;i>=0;i--)RTE.turnOn(__RTE[i][0],__RTE[i][1]);__RTE=null}Type.createStaticClass(RTE,"RTE");RTE._setInitialValue=function RTE$Moz$_setInitialValue(b,a){b.innerHTML=a};RTE._makeEditable=function RTE$Moz$_makeEditable(a){a.contentWindow.document.designMode="on"};RTE.ConvertToPlainText=function RTE$Moz$ConvertToPlainText(c,b){var a=document.createElement("div");a.innerHTML=c.replace(/<br>/g,"\n");if(b)return RTE.Editor.HTMLEncode(a.innerText,true);return a.innerText};if(window.__RTE){for(var i=__RTE.length-1;i>=0;i--)RTE.turnOn(__RTE[i][0],__RTE[i][1]);__RTE=null}Type.createStaticClass(RTE,"RTE");FolderQuickViewListHelper={qvidPrefix:"qv-"};FolderQuickViewListHelper.resolveToFolderElt=function FolderQuickViewListHelper$resolveToFolderElt(e){var c=null,b=null,a=Control.getAncestorByAttr(e,"f");if(a)if(a.getAttribute("fidref")){b=a;c=$(b.getAttribute("idref"))}else if(a.getAttribute("fid"))c=a;var d={};d.folderElt=c;d.targetElt=b?b:c;return d};FolderQuickViewListHelper.getFolderEltAndRefElts=function FolderQuickViewListHelper$getFolderEltAndRefElts(a){if(!$(a))return null;var d=$getDescendantsByAttr($("folderListContainer"),"LI","f","f"),c=[];d.forEach(function(b){if(b.getAttribute("fidref")&&a==b.getAttribute("idref")||b.getAttribute("fid")&&a==b.getAttribute("id"))c.push(b)});var b={};b.folderElt=$(a);b.refElts=c;return b};FolderQuickViewListHelper.getCount=function FolderQuickViewListHelper$getCount(b){var a=$(b);return parseInt(a.getAttribute("count"))};FolderQuickViewListHelper._setCountForElt=function FolderQuickViewListHelper$_setCountForElt(a,b){var c=$tag(a,"span"),f=b.id,d=b.getAttribute("count"),e=!this._isTotalCountFolder(f)&&!this._isTotalCountQuickView(f);if(d>0){c[1].style.display="inline";if(e)$css.add(a,"BoldText")}else{$setDisplay(c[1],false);if(e)$css.remove(a,"BoldText")}c[2].innerText=d+"";$getDescendantByAttr(a,"A","lni","lni").title=FolderQuickViewListHelper._createTitle(b.getAttribute("nm"),d)};FolderQuickViewListHelper.setCount=function FolderQuickViewListHelper$setCount(a,c){if(typeof InboxPage!="undefined"&&InboxPage)if(a==InboxPage.Config.sysFldrs.searchFid||a==InboxPage.Config.sysFldrs.noneFid)return;if(FolderQuickViewListHelper.getCount(a)==c)return;var b=$(a);b.setAttribute("count",c);if(b.getAttribute("qvid")||typeof ComposePage!="undefined")FolderQuickViewListHelper._setCountForElt(b,b);else if(typeof InboxPage!="undefined"&&a!=InboxPage.Config.sysFldrs.sentFid&&b.getAttribute("fid")){var d=FolderQuickViewListHelper.getFolderEltAndRefElts(a);if(d)d.refElts.forEach(function(a){FolderQuickViewListHelper._setCountForElt(a,d.folderElt)})}if(typeof InboxPage!="undefined"&&a==InboxPage.Config.sysFldrs.inboxFid)$HeaderCookie.updateUnreadCount(c)};FolderQuickViewListHelper.initLeftNavTitles=function InboxPage$initLeftNavTitles(a){var b=$getDescendantsByAttr(a,"LI","f");b.forEach(function(a){if(a.getAttribute("fidref"))FolderQuickViewListHelper._initLeftNavTitlesForElt(a,$(a.getAttribute("idref")));else if(a.getAttribute("fid")||a.getAttribute("qvid"))FolderQuickViewListHelper._initLeftNavTitlesForElt(a,a)})};FolderQuickViewListHelper._initLeftNavTitlesForElt=function FolderQuickViewListHelper$_initLeftNavTitlesForElt(e,a){var c=a.getAttribute("nm"),d=a.getAttribute("count"),b=$getDescendantByAttr(e,"A","lni","lni");if(a.id==InboxPage.Config.sysFldrs.sentFid)b.title=c;else b.title=FolderQuickViewListHelper._createTitle(c,d)};FolderQuickViewListHelper._createTitle=function FolderQuickViewListHelper$_createTitle(d,b){var a=d;if(b>0&&!($B.Safari&&$B.rtl)){var c=" "+($B.rtl?"\u200f":"");a=a+c+"("+b+")"}return a};FolderQuickViewListHelper._isTotalCountFolder=function FolderQuickViewListHelper$_isTotalCountFolder(b){var a=null;if(typeof InboxPage!="undefined")a=InboxPage.Config.sysFldrs.draftsFid;else if(typeof ComposePage!="undefined")a=ComposePage.sysFldrs.draftsFid;return b==a};FolderQuickViewListHelper._isTotalCountQuickView=function FolderQuickViewListHelper$_isTotalCountQuickView(b){var a=null;if(typeof InboxPage!="undefined")a=InboxPage.Config.quickViews.flaggedQvid;else if(typeof ComposePage!="undefined")a=ComposePage.quickViews.flaggedQvid;return b==FolderQuickViewListHelper.qvidPrefix+a};FolderQuickViewListHelper.updateCounts=function FolderQuickViewListHelper$updateCounts(b){if(!b)return;for(var a in b){if(FunctionHelper.isSpecialMember(b,a)||!$(a))continue;var d=this.getCount(a),c=b[a];if(0==c)continue;var e=d+c;if(e>=0)this.setCount(a,d+c)}};FolderQuickViewListHelper._getFolderIdFromAuxData=function FolderQuickViewListHelper$_getFolderIdFromAuxData(d){var b=$(d),c=b.getAttribute("mad"),a=c.split("|")[3];return a};FolderQuickViewListHelper.canUpdateFolderQuickViewCounts=function FolderQuickViewListHelper$canUpdateFolderQuickViewCounts(b,a){return !(a||InboxPage.messageList.hasConversation(b))};FolderQuickViewListHelper.getCountOffsetsForFlagMessages=function FolderQuickViewListHelper$getCountOffsetsForFlagMessages(b,i,c,e){if(!this.canUpdateFolderQuickViewCounts(b,i))return null;var g={},f=e?b.length:1;for(var d=b.length-1;d>=0;d--){var a=this._getMessageInfo(b[d]);if(!e);if(!a)continue;if(a.isFlagged&&c||!a.isFlagged&&!c)continue;if(this._quickViewsNeedUpdatingOnMark(a.fid)){var h=!c?-f:f;this._addOffset(g,FolderQuickViewListHelper.qvidPrefix+InboxPage.Config.quickViews.flaggedQvid,h)}}return g};FolderQuickViewListHelper.getCountOffsetsForMark=function FolderQuickViewListHelper$getCountOffsetsForMark(e,k,d,j){if(!this.canUpdateFolderQuickViewCounts(e,k))return null;var c={},b=1;for(var f=e.length-1;f>=0;f--){var a=this._getMessageInfo(e[f],j);if(!a)continue;if(!a.duplicateMsgIds||a.duplicateMsgIds.length==0)b=1;else b=a.duplicateMsgIds.length;if(a.isRead&&d||!a.isRead&&!d)continue;var h=d?-b:b;if(!this._isTotalCountFolder(a.fid))this._addOffset(c,a.fid,h);if(this._quickViewsNeedUpdatingOnMark(a.fid))for(var g=a.categories.length-1;g>=0;g--){var i=FolderQuickViewListHelper.qvidPrefix+a.categories[g];if(!this._isTotalCountQuickView(i))this._addOffset(c,i,h)}}return c};FolderQuickViewListHelper.getCountOffsetsForMove=function FolderQuickViewListHelper$getCountOffsetsForMove(a,c,d,b){if(!this.canUpdateFolderQuickViewCounts(a,c))return null;return this._getCountOffsetsForMove(a,d,b)};FolderQuickViewListHelper.getCountOffsetsForJmr=function FolderQuickViewListHelper$getCountOffsetsForJmr(d,f,b){if(!this.canUpdateFolderQuickViewCounts(d,f))return null;var e=InboxPage.Config.sysFldrs.trashFid,c=InboxPage.Config.sysFldrs.junkFid,a;if(HM.JmrType.NotJunk==b)if(InboxPage.folderList.fid==c)a=InboxPage.Config.sysFldrs.inboxFid;else a=null;else if(HM.JmrType.Junk==b)a=c;else if(HM.JmrType.Unsubscribe==b)a=null;else if(HM.JmrType.Phish==b)a=e;if(a)return this._getCountOffsetsForMove(d,a);else return {}};FolderQuickViewListHelper._getCountOffsetsForMove=function FolderQuickViewListHelper$getCountOffsetsForMove(h,c,j){var d={};for(var e=h.length-1;e>=0;e--){var a=this._getMessageInfo(h[e]);if(!j);if(!a)continue;var b=a.fid,g=InboxPage.Config.sysFldrs.trashFid,l=InboxPage.Config.sysFldrs.junkFid;if(c==g&&(b==g||b==l)){if(!a.isRead)this._addOffset(d,b,-1)}else if(b!=c){if(!a.isRead||this._isTotalCountFolder(b))this._addOffset(d,b,-1);if(!a.isRead||this._isTotalCountFolder(c))this._addOffset(d,c,1)}if(this._quickViewsNeedUpdatingOnMove(b,c)){var k=this.isJunkOrDeletedFolder(c)?-1:1;for(var f=a.categories.length-1;f>=0;f--){var i=FolderQuickViewListHelper.qvidPrefix+a.categories[f];if(!a.isRead||this._isTotalCountQuickView(i))this._addOffset(d,i,k)}}}return d};FolderQuickViewListHelper.isJunkOrDeletedFolder=function FolderQuickViewListHelper$isJunkOrDeletedFolder(b){var a=InboxPage.Config.sysFldrs;return b==a.junkFid||b==a.trashFid};FolderQuickViewListHelper.isDeletedFolder=function FolderQuickViewListHelper$isDeletedFolder(b){var a=InboxPage.Config.sysFldrs;return b==a.trashFid};FolderQuickViewListHelper._quickViewsNeedUpdatingOnMark=function FolderQuickViewListHelper$_quickViewsNeedUpdatingOnMark(a){return !FolderQuickViewListHelper.isJunkOrDeletedFolder(a)};FolderQuickViewListHelper._quickViewsNeedUpdatingOnMove=function FolderQuickViewListHelper$_quickViewsNeedUpdatingOnMove(a,b){return this.isJunkOrDeletedFolder(b)!=this.isJunkOrDeletedFolder(a)};FolderQuickViewListHelper._addOffset=function FolderQuickViewListHelper$_addOffset(a,b,c){a[b]=a[b]?a[b]+c:c};FolderQuickViewListHelper._getFolderForMessage=function FolderQuickViewListHelper$_getFolderForMessage(a){if(InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.noneFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.searchFid)return InboxPage.folderList.fid;else return this._getFolderIdFromAuxData(a)};FolderQuickViewListHelper._getMessageInfo=function FolderQuickViewListHelper$_getMessageInfo(b,e){var a=null;if($(b)&&!e){var d=InboxPage.messageList;a={};a.fid=this._getFolderForMessage(b);a.isRead=d.isRead(b);a.isFlagged=d.isFlagged(b);a.categories=d.getCategories(b)}else{var c=InboxPage.readingPane.getMessagePart(b);if(c){a={};a.fid=c.fid;a.isRead=c.isRead;a.isFlagged=c.isFlagged;a.categories=c.categories;a.duplicateMsgIds=c.duplicateMsgIds}}return a};FolderQuickViewListHelper.getFolderNameByFid=function FolderQuickViewListHelper$getFolderNameByFid(c){var b="",a=$(c);if(a)b=a.getAttribute("nm");return b};FolderQuickViewListHelper._getCurrentFolderOrQuickViewEltId=function FolderQuickViewListHelper$_getCurrentFolderOrQuickViewEltId(){var b="",a=InboxPage.folderList.fid,c=InboxPage.quickViewList.qvid;if(c&&""!=c)b=FolderQuickViewListHelper.qvidPrefix+c;else if(a&&""!=a&&a!=InboxPage.Config.sysFldrs.noneFid)b=a;return b};FolderQuickViewListHelper.scrollIntoView=function FolderQuickViewListHelper$scrollIntoView(){var a=FolderQuickViewListHelper._getCurrentFolderOrQuickViewEltId();if(null!=a&&""!=a)$scrollIntoView($(a),$("contentFolderQuickViewList"),2)};Type.createStaticClass(FolderQuickViewListHelper,"FolderQuickViewListHelper");ComposeActions={};ComposeActions.spellCheck=function $ComposeActions$spellCheck(){if(!ComposePage.spellChkSupp||ComposePage.isReqResponse)return true;ComposePage.dontWarn=true;ComposePage.spellCheck()};ComposeActions.saveDraft=function $ComposeActions$saveDraft(){if(ComposePage.isReqResponse)return true;ComposePage.dontWarn=true;if(ComposePage.attachmentList)ComposePage.attachmentList.updateAttachmentIdsFromSilverlightUploader();ComposePage.spellChecker.removeAllMarkers();ComposePage.saveDraft()};ComposeActions.sendMsg=function $ComposeActions$sendMsg(a){if(ComposePage.isReqResponse||!ComposePage["RTE"]||!ComposePage.RTE["rte"])return true;ComposePage.dontWarn=true;if(Browser.isIE6)a.cancelBubble=true;Control.invokeStatic("ComposeContactPicker","sendMessagePrep",a,true);ComposeActions.sendMsgImpl("SendMessage")};ComposeActions.sendMsg2=ComposeActions.sendMsg;ComposeActions.sendMsgImpl=function $ComposeActions$sendMsgImpl(b){this.aId=b;var a=$(b);if(a&&!a.disabled){if(ComposePage.attachmentList&&!ComposePage.attachmentList.confirmOkToSend())return false;a.disabled="disabled";if(ComposePage.attachmentList)ComposePage.attachmentList.beginFinalizeAttachments();else this.sendMsgFinalize()}};ComposeActions.cancelMsgFinalize=function $ComposeActions$cancelMsgFinalize(){var a=$(this.aId);if(a&&a.disabled)a.disabled=""};ComposeActions.sendMsgFinalize=function $ComposeActions$sendMsgFinalize(){var c=this.aId;ComposePage.spellChecker.removeAllMarkers();var b="";if(ComposePage.ru!=""&&ComposePage.ru!=null)b=String.format("{0}?_ec=1&n={1}&ru={2}&ruid={3}",ComposePage.smc,Page.queryString.newNonce,ComposePage.ru,ComposePage.ruid);else b=String.format("{0}?_ec=1&n={1}",ComposePage.smc,Page.queryString.newNonce);if("SendMessage"==c){var a=ComposePage.RTE.rte.getValue();if(a&&a.length>0)$CSIPerf.payloadLength=a.length;Page.setPerformanceId("S")}ComposePage.dontWarn=true;Page.postWithFolderQuickViewCache(c,b)};Type.createStaticClass(ComposeActions,"ComposeActions");var DemandLoadHandler={};DemandLoadHandler.initialize=function DemandLoadHandler$initialize(a){DemandLoadHandler._contentObj=a;DemandLoadHandler._endDemandLoadDelegate=$CD(this,DemandLoadHandler._endDemandLoad);DemandLoadServices.Events.enddemandload.attach(DemandLoadHandler._endDemandLoadDelegate)};DemandLoadHandler.dispose=function DemandLoadHandler$dispose(){DemandLoadServices.Events.enddemandload.detach($CD(this,DemandLoadHandler._endDemandLoad));DemandLoadHandler._endDemandLoadDelegate=DemandLoadHandler._contentObj=null};DemandLoadHandler.getContent=function DemandLoadHandler$getContent(a){return DemandLoadHandler._contentObj[a]};DemandLoadHandler.filterFetchedContentIds=function DemandLoadHandler$filterFetchedContentIds(a){for(var b=a.length-1;b>=0;b--)if(DemandLoadHandler.getContent(a[b]))a.splice(b,1);return a};DemandLoadHandler.demandLoadContent=function DemandLoadHandler$demandLoadContent(a,b,c){a=DemandLoadHandler.filterFetchedContentIds(a);if(a.length>0)DemandLoadServices.beginDemandLoad(a,b,c);else DemandLoadServices.Events.enddemandload.fire([null,b])};DemandLoadHandler.createFppCallback=function DemandLoadHandler$createFppCallback(b,a){return function(c,d){if(c.Content)DemandLoadServices.Events.enddemandload.fire([c.Content,a]);b(c,d)}};DemandLoadHandler._endDemandLoad=function DemandLoadHandler$_endDemandLoad(e){var a=e[0],b=e[1];for(var c in a)if(!FunctionHelper.isSpecialMember(a,c))DemandLoadHandler._contentObj[c]=a[c];if(b)for(var d=b.length-1;d>=0;d--){var f=b[d];if(f)f()}};ComposePage.initialize=function ComposePage$initialize(){ComposePage._initializePostProcData();ComposePage._formDataElts=["fTo","fCc","fBcc","fSubject","fAttachments_data","fromAddr","msgPri"];ComposePage._storeInitialState();window.attachEvent("onunload",ComposePage._onUnload);window.attachEvent("onbeforeunload",ComposePage._onBeforeUnload);window.attachEvent("onresize",ComposePage._resizePage);document.attachEvent("onclick",ComposePage._onClick);var a=$("RichTextEditor_surface");window.rteOnClick=function(){a.fireEvent("onmousedown")};window.rteOnKeyUp=function(){a.fireEvent("onkeyup")};ComposePage._invokes=[];ComposePage.spellChecker={check:function(){},removeAllMarkers:function(){}};Page.setupNetwork({onprecallback:ComposePage._onNetworkPreInvoke,onpostcallback:ComposePage._onNetworkPostCallback,onaftercallback:ComposePage._onPostInvoke});Control.onPreInvoke=ComposePage._onPreInvoke;Control.onPostInvoke=ComposePage._onPostInvoke;Infopane.initialize(true);LoadingIndicator.hide();if((!Page.isPageLoaded||document.activeElement&&document.activeElement==document.body)&&(ComposePage.isReply||ComposePage.isDraft))if(a.getAttribute("frameready")!="yes")a.attachEvent("onload",function(){ComposePage._setFocusOnIframe(event.srcElement)});else ComposePage._setFocusOnIframe(a);ComposePage.toolbar=new Toolbar($("toolbarContainer"),function(a,b){return Control.invokeStatic("ComposeToolbar","onclick",b,a)});ComposePage.toolbar.setIgnoreActions(Toolbar.standardIgnoreList);if(ComposePage.kbdShortcuts)KeyboardHandler.initialize(ComposePage.kbdShortcuts,ComposePage.shortcutsHandler,KbdShortcutsTimeout,true,function(){return !AlertManager.getInstance().isAlertVisible()&&!WebDialogManager.getInstance().isDialogVisible()});ComposePage.Content={};DemandLoadHandler.initialize(ComposePage.Content);ComposePage._draftSaved=false;ComposePage._keepDraftOnCancel=ComposePage.isDraft;ComposePage._autoSaveIntervalID=0;ComposePage._sending=false;ComposePage._autoSaveStartTick();ComposeServices.Events.endsavedraft.attach($CD(this,ComposePage._endSaveDraft));setTimeout(ComposePage.downloadBucket1,100);Page.oninitresize=ComposePage._resizePage;Page.onreauth=ComposePage._autoSaveStartTick;Page.initPageNavFppCallbackErrorSuppression()};ComposePage.shortcutsHandler=function ComposePage$shortcutsHandler(f,b){var c=App.config.pdCookie,d=true,a=true;if(!ComposePage.hasSeenKbdUi&&"sendMsg"==b){d=confirm(Page.decode(ComposePage.hasSeenKbdUiText));ComposePage.hasSeenKbdUi=true;if(OptionsWriter)OptionsWriter.fireOption(ComposePage.uiSeenKbdUrl);var e=$Cookie.getCookieValues(c);e["ksui"]="1";$Cookie.setCookieValues(c,e,$Cookie.getPermanentExpirationDate());a=false}if(d){var g=Control.invokeStatic("ComposeActions",b,f,f);if(a)a=g}return a};ComposePage._setFocusOnIframe=function ComposePage$_setFocusOnIframe(d){var c=d.contentWindow;c.focus();var b=c.document,a=b.selection.createRange();a.moveToElementText(b.body);a.collapse(true)};ComposePage._storeInitialState=function ComposePage$_storeInitialState(){ComposePage.initialState={};for(var a=ComposePage._formDataElts.length-1;a>=0;--a){var b=$(ComposePage._formDataElts[a]);if(b)ComposePage.initialState[ComposePage._formDataElts[a]]=b.value}};ComposePage._compareEmailLists=function ComposePage$_compareEmailLists(d,e){if(d==e)return true;var a=[d,e],c=[/"[^"]*" ?/g,/<|>/g,/; ?/g,/; $/g];for(var b=0;b<2;b++){a[b]=a[b].replace(c[0],"");a[b]=a[b].replace(c[1],"");a[b]=a[b].replace(c[2],"; ");a[b]=a[b].replace(c[3],"")}return a[0]==a[1]};ComposePage._isDirty=function ComposePage$_isDirty(){if(ComposePage.isDirty)return true;if(ComposePage.initialState.rteValue!=null&&ComposePage.RTE!=null&&ComposePage.RTE.rte.getValue()!=ComposePage.initialState.rteValue)return true;for(var c=ComposePage._formDataElts.length-1;c>=0;--c){var a=ComposePage._formDataElts[c],b=$(a);if(b)switch(a){case "fTo":case "fCc":case "fBcc":if(!ComposePage._compareEmailLists(ComposePage.initialState[a],b.value))return true;break;default:if(ComposePage.initialState[a]!=b.value)return true}}if(ComposePage.attachmentList&&ComposePage.attachmentList.hasAttachments())return true;return false};Resize._resizeComposeHeader=function ComposePage$_resizeComposeHeader(){try{Resize._mainContentResize();var a=$("insertBarContainer");if(a&&$("dlUploadControlContainer").style.display!="none")Resize._resizeToolbar(a,a.children[0],[]);var b=$("composeHeader").offsetHeight;if(Resize.shouldAdjustValuePx($("composeMessage").offsetTop,b))$("composeMessage").style.top=Resize.convertToEm(b)+"em"}catch(c){return}};ComposePage.downloadBucket1=function ComposePage$downloadBucket1(){Loader.load(ComposePage.cssUrls,ComposePage.scriptUrls,ComposePage.onBucket1Download,$("bucket1"))};ComposePage.onBucket1Download=function ComposePage$onBucket1Download(){ComposePage.initializeBucket1()};ComposePage.dispose=function ComposePage$dispose(){ComposePage._autoSaveStopTick();ComposePage._cancelAutoDraft();document.detachEvent("onclick",ComposePage._onClick);window.detachEvent("onbeforeunload",ComposePage._onBeforeUnload);window.detachEvent("onunload",ComposePage._onUnload);DemandLoadHandler.dispose();if(ComposePage.kbdShortcuts)KeyboardHandler.dispose();if(ComposePage.RTE)ComposePage.RTE.dispose();if(ComposePage.attachmentList)ComposePage.attachmentList.dispose();if(ComposePage.toolbar)ComposePage.toolbar.dispose()};ComposePage._onClick=function ComposePage$_onClick(){var a=event.srcElement;while(a&&a.tagName!="A")a=a.parentElement;var b=false;if(a&&a.tagName=="A")if(a.protocol!="http:"&&a.protocol!="https:")b=true;else{var c=a.href.length;if(c>0&&a.href.substr(c-1)=="#"){var e=a.href.substr(0,c-1),d=document.location.href.replace(/#$/,"");if(e==d)b=true}}ComposePage.dontWarn=b};ComposePage._onBeforeUnload=function ComposePage$_onBeforeUnload(){var a;ComposeContactPicker.sendMessagePrep();if(!ComposePage.doPostProc&&!ComposePage.dontWarn&&(ComposePage._isDirty()||ComposePage._draftSaved&&!ComposePage._keepDraftOnCancel))event.returnValue=a=Res.strings.notSavedWarning;ComposePage.dontWarn=false;return a};ComposePage._onUnload=function ComposePage$_onUnload(){LoadingIndicator.hide();ComposePage.dispose()};ComposePage._initializePostProcData=function ComposePage$_initializePostProcData(){ComposePage.postProcData={showLoading:true,hideInfoPane:false}};ComposePage._onPreInvoke=function ComposePage$_onPreInvoke(b){if(b=="Resize")return;var a=Infopane.getInstance(false);if(a&&null!=event&&(a.elt==event.srcElement||a.elt.contains(event.srcElement)))ComposePage.postProcData.hideInfoPane=true;ComposePage.doPostProc=true;ComposePage._initializePostProcData()};ComposePage._onPostInvoke=function ComposePage$_onPostInvoke(a){if(a=="Resize")return;if(ComposePage.doPostProc){if(ComposePage.postProcData.showLoading)LoadingIndicator.show();if(ComposePage.postProcData.hideInfoPane){Infopane.hide();ComposePage.postProcData.hideInfoPane=false}if(!Page.hasNetworkOpenRequests()){ComposePage.doPostProc=false;ComposePage._onUserActionComplete();ComposePage._initializePostProcData()}}};ComposePage._onUserActionComplete=function ComposePage$_onUserActionComplete(){var a=ComposePage.postProcData;if(a.hideInfoPane)Infopane.hide();LoadingIndicator.hide()};ComposePage.showCcBcc=function ComposePage$showCcBcc(){$setDisplay($("Cc"),true);$setDisplay($("Bcc"),true);$setDisplay($("showCcBcc"),false);$css.add($("fSubject"),"NO_OP");$css.remove($("fSubject"),"NO_OP");document.cookie="shc=1; path=/";Resize._resizeComposeHeader();return false};ComposePage.getPayloadLength=function ComposePage$getPayloadLength(){var a=$("aspnetForm").fMessageBody;return a?a.value.length:0};ComposePage._getUserActionsStack=function ComposePage$_getUserActionsStack(){return ComposePage._invokes};FireAnt.Debug.CB.getUserActions=ComposePage._getUserActionsStack;ComposePage._postWatsonCallback=function ComposePage$_postWatsonCallback(){ComposePage.postProcData.hideInfoPane=false};FireAnt.Debug.CB.postWatsonCallback=ComposePage._postWatsonCallback;ComposePage._postReportErrorCallback=function ComposePage$_postReportErrorCallback(){ComposePage.postProcData.hideInfoPane=false};Page.postReportErrorCallback=ComposePage._postReportErrorCallback;ComposePage._onNetworkPostCallback=function ComposePage$_onNetworkPostCallback(){Page.fppPending(false);Page.startCaching()};ComposePage._onNetworkPreInvoke=function ComposePage$_onNetworkPreInvoke(){ComposePage.postProcData.hideInfoPane=true;Page.fppPending(true);Page.stopCaching()};ComposePage.addAttachment=function(){};ComposePage.spellCheck=function ComposePage$spellCheck(){if(ComposePage.spellChecker)ComposePage.spellChecker.check()};ComposePage.convertHotmailFavorites=function ComposePage$convertHotmailFavorites(){ComposeContactPicker.sendMessagePrep();if(ComposePage.spellChecker)ComposePage.spellChecker.removeAllMarkers();Page.submit("ConvertFavorites",String.format("EditMessageLight.aspx?_ec=1&n={0}",Page.queryString.newNonce))};ComposePage._resizePage=function ComposePage$_resizePage(){if(Resize!=null){Resize._resizeComposeHeader();var a=$("RichTextEditor"),c=a.children[0],b=a.children[1],d=a.children[2],e=$tag(b,"UL")[0];Resize._resizeToolbar(b,e,[c,d])}};ComposePage.saveDraft=function ComposePage$saveDraft(h){ComposePage._autoSaveStopTick();ComposeContactPicker.sendMessagePrep();var i=$("fOriginalMessageId"),g=$("fRfc822MessageId"),d=$("fRfc822References"),e=$("fRfc822InReplyTo"),b=$("RTE_MessageType"),f=$("MtgIcalId"),c=$("fAttachments_data"),a=null;if(c&&""!=c.value){a=unescape(c.value).split("||");if(a.length>0&&""==a[a.length-1])a.pop()}if(!h)ComposePage._keepDraftOnCancel=true;ComposeServices.beginSaveDraft(true===h,$("fTo").value,$("fromAddr").value,$("fCc").value,$("fBcc").value,$("msgPri").value,$("fSubject").value,ComposePage.RTE.rte.getValue(),$("fDraftId").value,$("fMsgSentState").value,null!=i?i.value:null,null!=g?g.value:null,null!=d?d.value:null,null!=e?e.value:null,null==b||""==b.value||"PlainText"==b.value,null!=f?f.value:null,a);ComposePage.postProcData.hideInfoPane=false;ComposePage._storeInitialState();if(ComposePage.RTE&&ComposePage.RTE.rte)ComposePage.initialState.rteValue=ComposePage.RTE.rte.getValue()};ComposePage._autoSaveStartTick=function ComposePage$_autoSaveStartTick(){var b=$("msgPri")!=null,a=parseInt(ComposePage.autoSaveDraft.interval);if(b&&a>0&&0==ComposePage._autoSaveIntervalID)ComposePage._autoSaveIntervalID=setInterval(ComposePage._autoSaveTick,a*6e4)};ComposePage._autoSaveStopTick=function ComposePage$_autoSaveStopTick(){if(ComposePage._autoSaveIntervalID>0)clearInterval(ComposePage._autoSaveIntervalID);ComposePage._autoSaveIntervalID=0};ComposePage._autoSaveTick=function ComposePage$_autoSaveTick(){ComposeContactPicker.sendMessagePrep();if(!ComposePage._isDirty())return;Control.invokeStatic("ComposePage","saveDraft",{},true)};ComposePage._endSaveDraft=function ComposePage$_endSaveDraft(a){var c=a[0],b=a[1],g=a[2],f=a[3];if(null!=c){$("fDraftId").value=c;if(!(ComposePage.isDraft&&ComposePage._draftSaved)){ComposePage.isDraft=ComposePage._draftSaved=true;var h=ComposePage.folderList,d=ComposePage.sysFldrs.draftsFid;FolderQuickViewListHelper.setCount(d,parseInt(FolderQuickViewListHelper.getCount(d))+1)}if(!ComposePage._keepDraftOnCancel&&!g)ComposePage._keepDraftOnCancel=true}if(null!=b&&""!=b){var e=Infopane.getInstance();e.setContent(b);e.show()}if(f)ComposePage.autoSaveDraft.interval=Math.abs(ComposePage.autoSaveDraft.interval)*-1;else{ComposePage.autoSaveDraft.interval=Math.abs(ComposePage.autoSaveDraft.interval);ComposePage._autoSaveStartTick()}};ComposePage._cancelAutoDraft=function ComposePage$_cancelAutoDraft(){var a=$("fDraftId").value;if(null!=a&&""!=a&&ComposePage._draftSaved&&!ComposePage._keepDraftOnCancel&&!ComposePage._sending)ComposeServices.beginDeleteDraft(a);ComposePage._sending=false};Type.createStaticClass(ComposePage,"ComposePage");Type.createStaticClass(ComposeServices,"ComposeServices");Type.createStaticClass(ComposeContactPicker,"ComposeContactPicker");if(!Browser.isIE)ComposePage.downloadBucket1=function ComposePage$downloadBucket1(){Loader.load(ComposePage.cssUrls,ComposePage.scriptUrls,ComposePage.onBucket1Download)};ComposePage.initialize()