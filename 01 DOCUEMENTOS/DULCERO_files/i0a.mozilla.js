new function(){function a(a){function e(a){switch(a){case "onkeydown":case "onkeyup":case "onkeypress":return true}return false}function d(b){if(b===a)return true;switch(b.tagName){case "INPUT":case "A":case "BUTTON":case "SELECT":case "TEXTAREA":case "HTML":return true}return false}var f=a.attachEvent,g=a.detachEvent;function b(c,b){if(e(c)&&!d(this)){var g=b;b=function(c){var d=a.event;a.event=c;if(!b._elt.contains||b._elt.contains(c.srcElement))g(c);a.event=d};b._elt=this;b._isKeyboardHandlerAttached=false;b._onKeyboardFocusIn=function(){if(!b._isKeyboardHandlerAttached){b._isKeyboardHandlerAttached=true;a.attachEvent(c,b)}};this.attachEvent("onfocusin",b._onKeyboardFocusIn);b._onKeyboardFocusOut=function(){if(!b._elt.contains(event.toElement)){b._isKeyboardHandlerAttached=false;a.detachEvent(c,b)}};this.attachEvent("onfocusout",b._onKeyboardFocusOut);return}f.call(this,c,b)}function c(b,a){if(e(b)&&!d(this)){var f=a._onKeyboardFocusIn;delete a._onKeyboardFocusIn;this.detachEvent("onfocusin",f);var c=a._onKeyboardFocusOut;delete a._onKeyboardFocusOut;this.detachEvent("onfocusout",c);delete a._elt;delete a._isKeyboardHandlerAttached;return}g.call(this,b,a)}a.attachEvent=b;a.detachEvent=c;a.HTMLDocument.prototype.attachEvent=b;a.HTMLDocument.prototype.detachEvent=c;a.HTMLElement.prototype.attachEvent=b;a.HTMLElement.prototype.detachEvent=c}$Browser.addExtension(a)};History={Events:{onnavigate:new $Event}};History.addNavigationStep=function History$addNavigationStep(a){History._addNavigationStepImpl(a)};History._addNavigationStepImpl=function History$_addNavigationStepImpl(){};History.stateChanged=function History$stateChanged(a){var b=History._deserializeState(a);History.isOnNavigateFiring=true;History.Events.onnavigate.fire(b);History.isOnNavigateFiring=false};History.getSerializedState=function History$getSerializedState(){return History._getSerializedStateImpl()};History._getSerializedStateImpl=function History$_getSerializedStateImpl(){};History._serializeState=function History$_serializeState(c){var a=[];for(var b in c)a.push(History.NAME_VALUE_DELIMITER,encodeURIComponent(b),History.NAME_VALUE_DELIMITER,encodeURIComponent(c[b]));if(a.length!=0)a[0]="";return a.join("")};History._deserializeState=function History$_deserializeState(b){var d={};if(b==""||b==null)return d;var c=b.split(History.NAME_VALUE_DELIMITER);for(var a=c.length-1;a>0;a=a-2)d[decodeURIComponent(c[a-1])]=decodeURIComponent(c[a]);return d};History.isOnNavigateFiring=false;History.NAME_VALUE_DELIMITER="/";__classes["History"]=History;History._addNavigationStepImpl=function History$iframe$_addNavigationStepImpl(e){History._isSavingState=true;var b=null,c=null,a=null;try{if(null!=(b=$(History.historyFrameId))&&null!=(c=b.contentWindow)&&null!=(a=c.document)&&(a.readyState===undefined||"complete"==a.readyState)){var d=History._serializeState(e);History._navigateIframe(a,d)}else History._isSavingState=false}catch(f){History._isSavingState=false}};History._getSerializedStateImpl=function History$iframe$_getSerializedStateImpl(){return $(History.historyFrameId).contentWindow.stateStr};History._navigateIframe=function History$iframe$_navigateIframe(a,b){a.open("javascript:'<html></html>'");a.write(['<html><head><script>function Init(){window.stateStr="',b,"\"; if(parent.History && parent.History.isPageLoaded && parent.History.stateChanged) {if(!parent.History._isSavingState){parent.History.stateChanged(window.stateStr);}else{parent.History._isSavingState=false;}}}</script></head><body onload='Init()'></body></html>"].join(""));a.close()};History._isSavingState=false;History.historyFrameId="historyFrame";History.isPageLoaded=false;History._navigateIframe=function History$iframe$hotmail$_navigateIframe(a,c){if(""==History._domain)History._getDomain();var b=InboxPage.Config.isPfDown?"":['document.domain="',History._domain,'";'].join("");a.open("javascript:'<html></html>'");a.write(["<html><head><script>function Init(){",b,'window.stateStr="',c,"\"; if(parent.History && parent.History.isPageLoaded && parent.History.stateChanged) {if(!parent.History._isSavingState){parent.History.stateChanged(window.stateStr);}else{parent.History._isSavingState=false;}}}</script></head><body onload='Init()'></body></html>"].join(""));a.close()};if(Browser.isFF2)History._navigateIframe=function History$FF2$iframe$hotmail$_navigateIframe(a,b){a.location.href=a.location.pathname+a.location.search+"#"+b};History._getDomain=function History$iframe$hotmail$_getDomain(){var a=window.location.hostname,c=a.lastIndexOf(".",a.length),d=a.lastIndexOf(".",c-1),b=a.substr(d+1).toLowerCase();if("live.com"==b||"live-int.com"==b)History._domain=b;else History._domain=window.location.hostname};History._domain="";FolderQuickViewListHelper={qvidPrefix:"qv-"};FolderQuickViewListHelper.resolveToFolderElt=function FolderQuickViewListHelper$resolveToFolderElt(e){var c=null,b=null,a=Control.getAncestorByAttr(e,"f");if(a)if(a.getAttribute("fidref")){b=a;c=$(b.getAttribute("idref"))}else if(a.getAttribute("fid"))c=a;var d={};d.folderElt=c;d.targetElt=b?b:c;return d};FolderQuickViewListHelper.getFolderEltAndRefElts=function FolderQuickViewListHelper$getFolderEltAndRefElts(a){if(!$(a))return null;var d=$getDescendantsByAttr($("folderListContainer"),"LI","f","f"),c=[];d.forEach(function(b){if(b.getAttribute("fidref")&&a==b.getAttribute("idref")||b.getAttribute("fid")&&a==b.getAttribute("id"))c.push(b)});var b={};b.folderElt=$(a);b.refElts=c;return b};FolderQuickViewListHelper.getCount=function FolderQuickViewListHelper$getCount(b){var a=$(b);return parseInt(a.getAttribute("count"))};FolderQuickViewListHelper._setCountForElt=function FolderQuickViewListHelper$_setCountForElt(a,b){var c=$tag(a,"span"),f=b.id,d=b.getAttribute("count"),e=!this._isTotalCountFolder(f)&&!this._isTotalCountQuickView(f);if(d>0){c[1].style.display="inline";if(e)$css.add(a,"BoldText")}else{$setDisplay(c[1],false);if(e)$css.remove(a,"BoldText")}c[2].innerText=d+"";$getDescendantByAttr(a,"A","lni","lni").title=FolderQuickViewListHelper._createTitle(b.getAttribute("nm"),d)};FolderQuickViewListHelper.setCount=function FolderQuickViewListHelper$setCount(a,c){if(typeof InboxPage!="undefined"&&InboxPage)if(a==InboxPage.Config.sysFldrs.searchFid||a==InboxPage.Config.sysFldrs.noneFid)return;if(FolderQuickViewListHelper.getCount(a)==c)return;var b=$(a);b.setAttribute("count",c);if(b.getAttribute("qvid")||typeof ComposePage!="undefined")FolderQuickViewListHelper._setCountForElt(b,b);else if(typeof InboxPage!="undefined"&&a!=InboxPage.Config.sysFldrs.sentFid&&b.getAttribute("fid")){var d=FolderQuickViewListHelper.getFolderEltAndRefElts(a);if(d)d.refElts.forEach(function(a){FolderQuickViewListHelper._setCountForElt(a,d.folderElt)})}if(typeof InboxPage!="undefined"&&a==InboxPage.Config.sysFldrs.inboxFid)$HeaderCookie.updateUnreadCount(c)};FolderQuickViewListHelper.initLeftNavTitles=function InboxPage$initLeftNavTitles(a){var b=$getDescendantsByAttr(a,"LI","f");b.forEach(function(a){if(a.getAttribute("fidref"))FolderQuickViewListHelper._initLeftNavTitlesForElt(a,$(a.getAttribute("idref")));else if(a.getAttribute("fid")||a.getAttribute("qvid"))FolderQuickViewListHelper._initLeftNavTitlesForElt(a,a)})};FolderQuickViewListHelper._initLeftNavTitlesForElt=function FolderQuickViewListHelper$_initLeftNavTitlesForElt(e,a){var c=a.getAttribute("nm"),d=a.getAttribute("count"),b=$getDescendantByAttr(e,"A","lni","lni");if(a.id==InboxPage.Config.sysFldrs.sentFid)b.title=c;else b.title=FolderQuickViewListHelper._createTitle(c,d)};FolderQuickViewListHelper._createTitle=function FolderQuickViewListHelper$_createTitle(d,b){var a=d;if(b>0&&!($B.Safari&&$B.rtl)){var c=" "+($B.rtl?"\u200f":"");a=a+c+"("+b+")"}return a};FolderQuickViewListHelper._isTotalCountFolder=function FolderQuickViewListHelper$_isTotalCountFolder(b){var a=null;if(typeof InboxPage!="undefined")a=InboxPage.Config.sysFldrs.draftsFid;else if(typeof ComposePage!="undefined")a=ComposePage.sysFldrs.draftsFid;return b==a};FolderQuickViewListHelper._isTotalCountQuickView=function FolderQuickViewListHelper$_isTotalCountQuickView(b){var a=null;if(typeof InboxPage!="undefined")a=InboxPage.Config.quickViews.flaggedQvid;else if(typeof ComposePage!="undefined")a=ComposePage.quickViews.flaggedQvid;return b==FolderQuickViewListHelper.qvidPrefix+a};FolderQuickViewListHelper.updateCounts=function FolderQuickViewListHelper$updateCounts(b){if(!b)return;for(var a in b){if(FunctionHelper.isSpecialMember(b,a)||!$(a))continue;var d=this.getCount(a),c=b[a];if(0==c)continue;var e=d+c;if(e>=0)this.setCount(a,d+c)}};FolderQuickViewListHelper._getFolderIdFromAuxData=function FolderQuickViewListHelper$_getFolderIdFromAuxData(d){var b=$(d),c=b.getAttribute("mad"),a=c.split("|")[3];return a};FolderQuickViewListHelper.canUpdateFolderQuickViewCounts=function FolderQuickViewListHelper$canUpdateFolderQuickViewCounts(b,a){return !(a||InboxPage.messageList.hasConversation(b))};FolderQuickViewListHelper.getCountOffsetsForFlagMessages=function FolderQuickViewListHelper$getCountOffsetsForFlagMessages(b,i,c,e){if(!this.canUpdateFolderQuickViewCounts(b,i))return null;var g={},f=e?b.length:1;for(var d=b.length-1;d>=0;d--){var a=this._getMessageInfo(b[d]);if(!e);if(!a)continue;if(a.isFlagged&&c||!a.isFlagged&&!c)continue;if(this._quickViewsNeedUpdatingOnMark(a.fid)){var h=!c?-f:f;this._addOffset(g,FolderQuickViewListHelper.qvidPrefix+InboxPage.Config.quickViews.flaggedQvid,h)}}return g};FolderQuickViewListHelper.getCountOffsetsForMark=function FolderQuickViewListHelper$getCountOffsetsForMark(e,k,d,j){if(!this.canUpdateFolderQuickViewCounts(e,k))return null;var c={},b=1;for(var f=e.length-1;f>=0;f--){var a=this._getMessageInfo(e[f],j);if(!a)continue;if(!a.duplicateMsgIds||a.duplicateMsgIds.length==0)b=1;else b=a.duplicateMsgIds.length;if(a.isRead&&d||!a.isRead&&!d)continue;var h=d?-b:b;if(!this._isTotalCountFolder(a.fid))this._addOffset(c,a.fid,h);if(this._quickViewsNeedUpdatingOnMark(a.fid))for(var g=a.categories.length-1;g>=0;g--){var i=FolderQuickViewListHelper.qvidPrefix+a.categories[g];if(!this._isTotalCountQuickView(i))this._addOffset(c,i,h)}}return c};FolderQuickViewListHelper.getCountOffsetsForMove=function FolderQuickViewListHelper$getCountOffsetsForMove(a,c,d,b){if(!this.canUpdateFolderQuickViewCounts(a,c))return null;return this._getCountOffsetsForMove(a,d,b)};FolderQuickViewListHelper.getCountOffsetsForJmr=function FolderQuickViewListHelper$getCountOffsetsForJmr(d,f,b){if(!this.canUpdateFolderQuickViewCounts(d,f))return null;var e=InboxPage.Config.sysFldrs.trashFid,c=InboxPage.Config.sysFldrs.junkFid,a;if(HM.JmrType.NotJunk==b)if(InboxPage.folderList.fid==c)a=InboxPage.Config.sysFldrs.inboxFid;else a=null;else if(HM.JmrType.Junk==b)a=c;else if(HM.JmrType.Unsubscribe==b)a=null;else if(HM.JmrType.Phish==b)a=e;if(a)return this._getCountOffsetsForMove(d,a);else return {}};FolderQuickViewListHelper._getCountOffsetsForMove=function FolderQuickViewListHelper$getCountOffsetsForMove(h,c,j){var d={};for(var e=h.length-1;e>=0;e--){var a=this._getMessageInfo(h[e]);if(!j);if(!a)continue;var b=a.fid,g=InboxPage.Config.sysFldrs.trashFid,l=InboxPage.Config.sysFldrs.junkFid;if(c==g&&(b==g||b==l)){if(!a.isRead)this._addOffset(d,b,-1)}else if(b!=c){if(!a.isRead||this._isTotalCountFolder(b))this._addOffset(d,b,-1);if(!a.isRead||this._isTotalCountFolder(c))this._addOffset(d,c,1)}if(this._quickViewsNeedUpdatingOnMove(b,c)){var k=this.isJunkOrDeletedFolder(c)?-1:1;for(var f=a.categories.length-1;f>=0;f--){var i=FolderQuickViewListHelper.qvidPrefix+a.categories[f];if(!a.isRead||this._isTotalCountQuickView(i))this._addOffset(d,i,k)}}}return d};FolderQuickViewListHelper.isJunkOrDeletedFolder=function FolderQuickViewListHelper$isJunkOrDeletedFolder(b){var a=InboxPage.Config.sysFldrs;return b==a.junkFid||b==a.trashFid};FolderQuickViewListHelper.isDeletedFolder=function FolderQuickViewListHelper$isDeletedFolder(b){var a=InboxPage.Config.sysFldrs;return b==a.trashFid};FolderQuickViewListHelper._quickViewsNeedUpdatingOnMark=function FolderQuickViewListHelper$_quickViewsNeedUpdatingOnMark(a){return !FolderQuickViewListHelper.isJunkOrDeletedFolder(a)};FolderQuickViewListHelper._quickViewsNeedUpdatingOnMove=function FolderQuickViewListHelper$_quickViewsNeedUpdatingOnMove(a,b){return this.isJunkOrDeletedFolder(b)!=this.isJunkOrDeletedFolder(a)};FolderQuickViewListHelper._addOffset=function FolderQuickViewListHelper$_addOffset(a,b,c){a[b]=a[b]?a[b]+c:c};FolderQuickViewListHelper._getFolderForMessage=function FolderQuickViewListHelper$_getFolderForMessage(a){if(InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.noneFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.searchFid)return InboxPage.folderList.fid;else return this._getFolderIdFromAuxData(a)};FolderQuickViewListHelper._getMessageInfo=function FolderQuickViewListHelper$_getMessageInfo(b,e){var a=null;if($(b)&&!e){var d=InboxPage.messageList;a={};a.fid=this._getFolderForMessage(b);a.isRead=d.isRead(b);a.isFlagged=d.isFlagged(b);a.categories=d.getCategories(b)}else{var c=InboxPage.readingPane.getMessagePart(b);if(c){a={};a.fid=c.fid;a.isRead=c.isRead;a.isFlagged=c.isFlagged;a.categories=c.categories;a.duplicateMsgIds=c.duplicateMsgIds}}return a};FolderQuickViewListHelper.getFolderNameByFid=function FolderQuickViewListHelper$getFolderNameByFid(c){var b="",a=$(c);if(a)b=a.getAttribute("nm");return b};FolderQuickViewListHelper._getCurrentFolderOrQuickViewEltId=function FolderQuickViewListHelper$_getCurrentFolderOrQuickViewEltId(){var b="",a=InboxPage.folderList.fid,c=InboxPage.quickViewList.qvid;if(c&&""!=c)b=FolderQuickViewListHelper.qvidPrefix+c;else if(a&&""!=a&&a!=InboxPage.Config.sysFldrs.noneFid)b=a;return b};FolderQuickViewListHelper.scrollIntoView=function FolderQuickViewListHelper$scrollIntoView(){var a=FolderQuickViewListHelper._getCurrentFolderOrQuickViewEltId();if(null!=a&&""!=a)$scrollIntoView($(a),$("contentFolderQuickViewList"),2)};Type.createStaticClass(FolderQuickViewListHelper,"FolderQuickViewListHelper");$Network.registerFpp("HM",function(){var h=$Network.FppProxy,a=h.__string,c=h.__primitive,e=h.__array,d=h.__custom,f=h.__enum,j=h.__date,g=h.__object,i=h.__oArray,b=new $Network.FppProxy("HM");b.FppStatus=new $Flags("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);b.rfc("FppError",[a("ErrorCode"),a("Message"),g("ErrorObj"),a("StackTrace")]);b.rfc("FppReturnPackage",[f("Status"),g("Value"),i("OutRefParams"),d(b.FppError,"Error"),g("ProfilingInfo")]);b.rfm("ReportError",[a("errorString")],"ReportError",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("HmSimpleMsg",[c("IsBlocking"),c("YesCode"),c("NoCode"),a("Message")]);b.SortBy=new $Flags("Sender",0,"Subject",1,"Size",2,"Type",3,"Date",4);b.ContentId=new $Enum("CommonSenderAction","CommonDeleteAndBlockAllFromSender","DeleteAllFromSender","BlockAllFromSender","MoveAllFromSender","MoveMessage","ReadMessageAddContact","MessageListContextMenu","MoveToFolderListSelect","AdvancedSearch","SlideshowSilverlightUpsell","VideoPlaybackSilverlightUpsell","JunkContactOrSafeSender");b.RemoveSenderFromListOption=new $Flags("None",0,"KeepContact",1,"RemoveContact",2,"KeepSafeSender",3,"RemoveSafeSender",4);b.rfc("BatchInfo",[a("AnchorDate"),a("AnchorId"),c("ProcessedCount"),c("IsLastBatch"),a("Timestamp"),a("SenderSearch")]);b.rfc("InboxUiData",[a("FolderListHtml"),a("QuickViewListHtml"),a("MessageListHtml"),a("MessageHtml"),a("SuggestionHtml"),d(b.BatchInfo,"BatchInfo"),a("MltRootHtml"),a("MltSubHtml"),a("InfoPaneHtml"),a("RedirectUrl"),g("Content"),a("BiciJsonConfig")]);b.rfc("HmAuxData",[a("Value")]);b.rfc("AdvancedSearch",[a("Keywords"),a("From"),a("To"),a("Subject"),a("Folder"),a("DateBegin"),a("DateEnd"),c("HasAttachment")]);b.rfc("MessageRenderingInfo",[a("MessageId"),c("AllowUnsafeContent"),c("OverrideCodepage"),a("MtLang"),d(b.HAD,"AuxData"),c("ConversationUpsell"),a("FolderId"),c("MarkAsRead"),a("SenderEmail")]);b.rfc("MessageListRenderingInfo",[a("FolderId"),c("QuickViewId"),c("FilterId"),f("PageDirection"),c("ExtraFetchCount"),c("PageNumCurrent"),a("AnchorId"),a("AnchorDate"),f("SortKey"),c("SortAsc"),c("IsSearchResults"),a("SearchKeyword"),d(b.AdvancedSearch,"AdvancedSearch"),c("AutoSelectMessageIndex"),f("ReadingPaneLocationMember"),c("NumberOfMessages"),a("BulkSelectAllTimestamp"),a("LastUpdateTimestamp"),c("IsFavoriteSelected")]);b.rfc("ConversationRenderingInfo",[a("ConversationId"),a("MessageId"),a("FolderId"),c("MarkAsRead"),a("SenderEmail")]);b.ListNavigateDirection=new $Flags("FirstPage",0,"LastPage",1,"NextPage",2,"PreviousPage",3,"CurrentPage",4);b.ReadingPaneLocation=new $Flags("None",0,"Off",1,"Right",2,"Bottom",3);b.rfm("ViewAllFromSender",[d("messageListRenderingInfo"),a("senderEmail")],"ViewAllFromSender",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetInboxData",[c("fetchFolderList"),c("renderUrlsInFolderList"),c("fetchMessageList"),d("messageListRenderingInfo"),c("fetchMessage"),d("messageRenderingInfo")],"GetInboxData",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("ClearFolder",[a("clearFolderId"),d("messageListRenderingInfo")],"ClearFolder",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.JmrType=new $Flags("Junk",0,"NotJunk",1,"AV",2,"SVMOptInOptOut",3,"SVMClassification",4,"Phish",5,"Unsubscribe",6,"Unknown",-1);b.rfm("MoveMessagesToFolder",[a("fromFolderId"),a("toFolderId"),e("messageList"),e("messageAuxData"),d("batchInfo"),d("messageListRenderingInfo"),c("fetchMessageList"),c("refreshFolderAndQuickViewLists"),a("folderNameForRuleSuggestion"),d("messageRenderingInfo"),d("conversationRenderingInfo"),c("fetchItem"),c("blockIfDelete")],"MoveMessagesToFolder",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagesForJmr",[a("folderId"),e("messages"),e("auxData"),d("batchInfo"),f("jmrType"),c("setReportToJunkOK"),d("messageListRenderingInfo"),d("messageRenderingInfo"),c("refreshFolderAndQuickViewLists"),f("removeFromList"),c("suppressListTransition"),c("markSenderAsSafe")],"MarkMessagesForJmr",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("__2",[c("IsBlocking"),c("YesCode"),c("NoCode"),a("Message")]);b.rfm("AddContactFromMessage",[d("messageRenderingInfo"),d("messageListRenderingInfo"),a("contactName"),a("contactEmail"),e("demandLoadContentValues")],"AddContactFromMessage",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("AddContactFromMessagePart",[a("conversationId"),a("folderId"),a("startingMid"),c("numParts"),g("mpIndexMap"),d("messageRenderingInfo"),a("contactName"),a("contactEmail"),e("demandLoadContentValues")],"AddContactFromMessagePart",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("SvmFeedback",[a("svmUrl"),d("messageRenderingInfo"),d("messageListRenderingInfo")],"SvmFeedback",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagesReadState",[c("readState"),e("messages"),e("auxData"),d("batchInfo"),d("messageListRenderingInfo"),c("refreshFolderAndQuickViewLists")],"MarkMessagesReadState",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagesFlagState",[c("flagState"),e("messages"),e("auxData"),d("batchInfo"),d("messageListRenderingInfo"),c("refreshFolderAndQuickViewLists")],"MarkMessagesFlagState",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("SaveVoicemailOnPhone",[e("messageIdList")],"SaveVoicemailOnPhone",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("DeleteVoicemailOnPhone",[e("messageIdList")],"DeleteVoicemailOnPhone",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetConversationInboxData",[c("fetchFolderList"),c("renderUrlsInFolderList"),c("fetchConversationList"),d("conversationListRenderingInfo"),c("fetchConversation"),d("conversationRenderingInfo")],"GetConversationInboxData",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfc("MessagePartsUiData",[g("MessagePartData"),a("IdentityContext"),a("InfoPaneHtml"),a("RedirectUrl"),g("Content"),a("BiciJsonConfig")]);b.rfm("GetSingleMessagePart",[a("conversationId"),a("folderId"),d("messageRenderingInfo"),c("messagePartIndex"),c("showUnsubscribeLink")],"GetSingleMessagePart",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetManyMessageParts",[a("conversationId"),a("folderId"),a("startingMessageId"),c("numParts"),g("messageIdToIndexMap"),c("showUnsubscribeLink")],"GetManyMessageParts",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("GetFullMessagePart",[d("messageRenderingInfo"),c("messagePartIndex"),c("showUnsubscribeLink")],"GetFullMessagePart",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("MarkMessagePartForJmr",[c("fetchConversation"),a("cid"),a("fid"),a("startingMid"),c("numParts"),g("mpIndexMap"),d("messageListRenderingInfo"),e("mpMids"),e("mpAuxDatas"),a("mpFid"),f("jmrType"),c("setReportToJunkOK"),f("removeFromList"),c("markSenderAsSafe")],"MarkMessagePartForJmr",$Network.Type.XMLPost,"abortable","Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("CreateMoveRule",[f("ruleNoun"),a("matchingString"),a("fid")],"CreateMoveRule",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("CreateSendersMoveRules",[e("emails"),a("fid")],"CreateSendersMoveRules",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("CreateRecipientMoveRule",[a("recipientEmail"),a("folderId"),a("folderName")],"CreateRecipientMoveRule",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("BlockSenders",[e("emails")],"BlockSenders",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("DemandLoad",[e("demandLoadContentValues")],"DemandLoad",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.rfm("UndoSenderMoveToBlockList",[a("senderAddress")],"UndoSenderMoveToBlockList",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.NounEnum=new $Flags("SendersEmailAddress",97,"SendersName",110,"Subject",115,"ToOrCCHeader",116,"HasAttachments",104);b.MessagePartDataType=new $Flags("Body",0,"ToList",1,"Message",2);b.HMLiveViewResultCode=new $Flags("Success",0,"Failure",1);b.rfc("HMLiveViewRequestObject",[a("Id"),a("Sender"),a("Type"),a("SubType"),a("Data"),a("ExtraData")]);b.rfc("HMLiveViewResponseObject",[a("Id"),f("StatusCode"),a("Html")]);b.rfm("GetHMLiveViews",[e("requests")],"GetHMLiveViews",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.SandboxAuthenticationOption=new $Flags("None",0,"Oauth",1);b.rfc("SandboxRequest",[a("ID"),a("Uri"),a("Provider"),a("PostBody"),f("AuthOption"),a("AuthParam")]);b.rfc("SandboxResponse",[a("ID"),c("Status"),c("HttpStatusCode"),a("Body"),f("AuthOption"),a("AuthParam")]);b.rfm("DispatchSandboxRequests",[e("requests")],"DispatchSandboxRequests",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.ImportanceType=new $Enum("NORMAL","LOW","HIGH");b.MessageSentStateType=new $Enum("NOACTION","REPLIED","FORWARDED");b.rfm("SendMessage_ec",[a("to"),a("from"),a("cc"),a("bcc"),f("ImportanceType"),a("subject"),a("message"),a("messageForPlainTextConversion"),e("attachments"),a("draftId"),a("draftFolderId"),a("originalMessageId"),a("rfc822MessageId"),a("rfc822References"),a("rfc822InReplyTo"),f("MessageSentStateType"),c("sendByPlainTextFormat"),e("ignoredWordsFromSpellCheck"),a("hipAnswer"),a("hipMode"),a("meetingIcalId")],"SendMessage_ec",$Network.Type.XMLPost,null,"Microsoft.Msn.Hotmail.Ui.Fpp.MailBox");b.seal();return b});window.InboxServices={Events:{endgetmessagelistpage:new $Event,endmarkmessages:new $Event,preendupdateui:new $Event,endupdateui:new $Event,showbulkactionprogressui:new $Event,updatebulkactionprogressui:new $Event,closebulkactionprogressui:new $Event,endflagmessages:new $Event,endmovemessages:new $Event,endsetjunkstatus:new $Event,enddeletemessagepart:new $Event,endmarkmessagepartforjmr:new $Event,enddeleteallfromsender:new $Event,endmoveallfromsender:new $Event,endundosendermovetoblocklist:new $Event,sethiddenbulkselectallstate:new $Event}};InboxServices.Operations={MarkMessages:0,FlagMessages:1,MoveMessages:2,DeleteMessagePart:3,MarkMessagePartForJmr:4,SetJunkStatus:5};InboxServices.preEndUpdateUi=function InboxServices$_endUpdateUi(c,a,b){InboxServices.Events.preendupdateui.fire([c,a,b])};InboxServices._endUpdateUi=function InboxServices$_endUpdateUi(b,a){InboxServices.Events.endupdateui.fire([b,false,a])};InboxServices._endUpdateUiInner=function InboxServices$_endUpdateUiInner(c,a,b){InboxServices.Events.endupdateui.fire([c,a,b])};InboxServices.processPostActionInfo=function InboxServices$processPostActionInfo(d,e,c,b){var a=d.postActionInfo;if(a){if(b)a.args["onCompletionUiUpdateFn"]=b;if(c!=null)a.args["processedCount"]=c;if(a.nextActionFn&&e)a.nextActionFn(a.args,d);else a.onCompletionEvent.fire([a.args])}return a?true:false};InboxServices._processRspForBulkAction=function InboxServices$_processRspForBulkAction(b,a,f){var d=false,e=false,c=false;if(a.isBulk&&b.BatchInfo&&b.BatchInfo.IsLastBatch){c=InboxServices.processPostActionInfo(a,!InboxServices.stopAction,b.BatchInfo.ProcessedCount,f);if(!c)InboxServices.Events.closebulkactionprogressui.fire([])}else if(InboxServices.stopAction){e=true;if(a.postActionInfo)a.postActionInfo.args["processedCount"]=b.BatchInfo.ProcessedCount;InboxServices.beginRefreshInbox(true,true,a.messageListRenderingInfo,false,null,false,false,InboxServices._endBulkActionRefreshOnStop,InboxServices._bulkActionError,false,a)}else if(a.isBulk){InboxServices.Events.updatebulkactionprogressui.fire({count:b.BatchInfo.ProcessedCount});d=true}return {stopProcessing:e,executeNextBatch:d,postActionTaken:c}};InboxServices._endBulkActionRefreshOnStop=function InboxServices$_endBulkActionRefreshOnStop(e,a,d){var b=function(b){a["hasConfirmationMsg"]=b?true:false;InboxServices._endRefreshInbox(e,a,d)},c=InboxServices.processPostActionInfo(a,false,null,b);if(!c){InboxServices.Events.closebulkactionprogressui.fire([]);b(false)}};InboxServices._bulkActionError=function InboxServices$_bulkActionError(b,a){if(a.isHiddenBulk)InboxServices.Events.sethiddenbulkselectallstate.fire([false]);InboxServices.Events.closebulkactionprogressui.fire([]);Page.errorReportData.errorContainerOverride=ErrorDhtml;Page.errorReportData.ctx=a};InboxServices.beginViewAllFromSender=function InboxServices$beginViewAllFromSender(a,b){HM.LFPP=function(){HM.ViewAllFromSender(a,b,InboxServices._endRefreshInbox,{showItemList:false,messageListRenderingInfo:a})};HM.LFPP()};InboxServices.beginBlockSenders=function InboxServices$beginBlockSenders(a,b){HM.LFPP=function(){HM.BlockSenders(a.senders,InboxServices._endBlockSenders,b,InboxServices._bulkActionError)};HM.LFPP()};InboxServices._endBlockSenders=function InboxServices$_endBlockSenders(b,a){if(a.postActionInfo){a.postActionInfo.args["unblockedSndrs"]=b;InboxServices.processPostActionInfo(a,false,null,null)}};InboxServices.beginCreateSendersMoveRules=function InboxServices$beginCreateSendersMoveRules(a,b){HM.LFPP=function(){HM.CreateSendersMoveRules(a.senders,a.toFldr,InboxServices._endCreateSendersMoveRules,b,InboxServices._bulkActionError)};HM.LFPP()};InboxServices._endCreateSendersMoveRules=function InboxServices$_endCreateSendersMoveRules(c,a){if(a.postActionInfo){a.postActionInfo.args["rulesCreated"]=true;InboxServices.processPostActionInfo(a,false,null,null)}};InboxServices.beginRefreshInbox=function InboxServices$beginRefreshInbox(k,g,a,j,e,i,d,c,f,h,b){if(!c)c=InboxServices._endRefreshInbox;if(!b)b={};b["showItemList"]=i;b["isAutoRefresh"]=h;b["messageListRenderingInfo"]=a;if(a!=null&&a.SearchKeyword!=null)a.SearchKeyword=a.SearchKeyword.replace(/"/g,"&quot;");var l=d?HM.GetConversationInboxData:HM.GetInboxData;HM.LFPP=function(){l(k,false,g,a,j,e,c,b,f)};HM.LFPP()};InboxServices._endRefreshInbox=function InboxServices$_endRefreshInbox(c,a,b){InboxServices._endUpdateUi(c,a,b);if(a.showItemList)InboxPage.showFullReadingPane(false)};InboxServices._endGetMessageListPage=function InboxServices$_endGetMessageListPage(b,a){InboxServices._endUpdateUiInner(b,true,a);InboxServices.Events.endgetmessagelistpage.fire([])};InboxServices._endGetMessageListPageError=function InboxServices$_endGetMessageListPageError(){InboxServices.Events.endgetmessagelistpage.fire([])};InboxServices.beginClearFolder=function InboxServices$beginClearFolder(b,a){HM.LFPP=function(){HM.ClearFolder(b,a,InboxServices._endUpdateUi)};HM.LFPP()};InboxServices.beginMarkMessages=function InboxServices$beginMarkMessages(b,j,f,i,c,e,g){var a=null!=f;if(!a&&b.length==0)return;InboxPage.maybeDisableRefreshForReadAction();if(a){var h=c?InboxPage.Strings.bulkProgressUiRead:InboxPage.Strings.bulkProgressUiUnread;InboxServices.Events.showbulkactionprogressui.fire({isMark:true,actionOrFldr:Page.decode(h)})}var d=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(b,a);HM.LFPP=function(){HM.MarkMessagesReadState(c,b,j,f,e,d,InboxServices._endMarkMessages,{messages:b,isBulk:a,isHiddenBulk:i,asRead:c,messageListRenderingInfo:e,refreshFolderAndQuickViewLists:d,markingDuplicates:g},a?InboxServices._bulkActionError:null)};HM.LFPP()};InboxServices._endMarkMessages=function InboxServices$_endMarkMessages(b,a,d){var c=InboxServices._processRspForBulkAction(b,a,null);if(c.stopProcessing)return;if(c.executeNextBatch){HM.LFPP=function(){HM.MarkMessagesReadState(a.asRead,null,null,b.BatchInfo,a.messageListRenderingInfo,a.refreshFolderAndQuickViewLists,InboxServices._endMarkMessages,a,InboxServices._bulkActionError)};HM.LFPP();return}InboxServices.preEndUpdateUi(b,InboxServices.Operations.MarkMessages,{mids:a.messages,isBulk:a.isBulk,asRead:a.asRead,markingDuplicates:a.markingDuplicates});InboxServices._endUpdateUi(b,a,d);InboxServices.Events.endmarkmessages.fire([b,a.messages,a.isBulk,a.asRead,a.markingDuplicates])};InboxServices.beginFlagMessages=function InboxServices$beginFlagMessages(b,i,f,c,e,g){var a=null!=f;if(!a&&b.length==0)return;InboxPage.maybeDisableRefreshForFlagAction();if(a){var h=c?InboxPage.Strings.bulkProgressUiFlag:InboxPage.Strings.bulkProgressUiUnflag;InboxServices.Events.showbulkactionprogressui.fire({isMark:true,actionOrFldr:Page.decode(h)})}var d=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(b,a);HM.LFPP=function(){HM.MarkMessagesFlagState(c,b,i,f,e,d,InboxServices._endFlagMessages,{messages:b,isBulk:a,asFlagged:c,messageListRenderingInfo:e,refreshFolderAndQuickViewLists:d,flaggingDuplicates:g},a?InboxServices._bulkActionError:null)};HM.LFPP()};InboxServices._endFlagMessages=function InboxServices$_endFlagMessages(b,a,d){var c=InboxServices._processRspForBulkAction(b,a,null);if(c.stopProcessing)return;if(c.executeNextBatch){HM.LFPP=function(){HM.MarkMessagesFlagState(a.asFlagged,null,null,b.BatchInfo,a.messageListRenderingInfo,a.refreshFolderAndQuickViewLists,InboxServices._endFlagMessages,a,InboxServices._bulkActionError)};HM.LFPP();return}InboxServices.preEndUpdateUi(b,InboxServices.Operations.FlagMessages,{mids:a.messages,isBulk:a.isBulk,asFlagged:a.asFlagged,flaggingDuplicates:a.flaggingDuplicates});InboxServices._endUpdateUi(b,a,d);InboxServices.Events.endflagmessages.fire([b,a.messages,a.isBulk,a.asFlagged,a.flaggingDuplicates])};InboxServices.beginMoveMessages=function InboxServices$beginMoveMessages(f,x,q,p,b,a,l,j,u,o,s,n,r,d,e,v){var c=null!=q;if(!c&&f.length==0)return;var m=b==InboxPage.Config.sysFldrs.trashFid;if(!m&&b==a){if(p)InboxServices.Events.sethiddenbulkselectallstate.fire([false]);if(j)InboxServices.processPostActionInfo({postActionInfo:j},true,0,null);return}if(c){var t=m&&b==a,w=e&&e.folderName?e.folderName:FolderQuickViewListHelper.getFolderNameByFid(a);InboxServices.Events.showbulkactionprogressui.fire({isMark:false,actionOrFldr:w,isPermanentDelete:t,customUi:e})}Page.setPerformanceId("Move");var k=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(f,c),g=null;if(u)g=FolderQuickViewListHelper.getFolderNameByFid(a);var i=null,h=null;if(s)h=n;else i=n;d=d==true;HM.LFPP=function(){HM.MoveMessagesToFolder(b,a,f,x,q,l,o,k,g,i,h,r,d,InboxServices._endMoveMessages,{msgs:f,fromFid:b,toFid:a,isBulk:c,isHiddenBulk:p,messageListRenderingInfo:l,refreshFolderAndQuickViewLists:k,folderNameForRuleSuggestion:g,postActionInfo:j,fetchMessageList:o,messageRenderingInfo:i,conversationRenderingInfo:h,fetchItem:r,blockIfDelete:d,movingDuplicates:v},c?InboxServices._bulkActionError:null)};HM.LFPP()};InboxServices._endMoveMessages=function InboxServices$_endMoveMessages(b,a,e){if(e)a.postActionInfo.args["unblockedSndrs"]=e;var d=function(c){a["hasConfirmationMsg"]=c?true:false;InboxServices.preEndUpdateUi(b,InboxServices.Operations.MoveMessages,{mids:a.msgs,isBulk:a.isBulk,toFid:a.toFid,fromFid:a.fromFid,itemRenderingInfo:a.messageRenderingInfo||a.conversationRenderingInfo,movingDuplicates:a.movingDuplicates});InboxServices._endUpdateUi(b,a);InboxServices.Events.endmovemessages.fire([b])},c=InboxServices._processRspForBulkAction(b,a,d);if(c.stopProcessing)return;if(c.executeNextBatch){HM.LFPP=function(){HM.MoveMessagesToFolder(a.fromFid,a.toFid,null,null,b.BatchInfo,a.messageListRenderingInfo,a.fetchMessageList,a.refreshFolderAndQuickViewLists,a.folderNameForRuleSuggestion,a.messageRenderingInfo,a.conversationRenderingInfo,a.fetchItem,a.blockIfDelete,InboxServices._endMoveMessages,a,InboxServices._bulkActionError)};HM.LFPP();return}else if(!a.isBulk&&a.blockIfDelete&&a.fromFid==InboxPage.Config.sysFldrs.junkFid){var f=a.msgs.length;a.postActionInfo.args["blockFromJunk"]=1;c.postActionTaken=InboxServices.processPostActionInfo(a,!InboxServices.stopAction,f,d)}if(!c.postActionTaken)d()};InboxServices.beginCreateMoveRule=function InboxServices$beginCreateMoveRule(b,a,c){HM.LFPP=function(){HM.CreateMoveRule(b,a,c,InboxServices._endUpdateUi)};HM.LFPP()};InboxServices.addContactFromMessage=function InboxServices$addContactFromMessage(b,a,e,d,f){var c=DemandLoadHandler.createFppCallback(f,null);HM.LFPP=function(){HM.AddContactFromMessage(b,a,e,d,DemandLoadHandler.filterFetchedContentIds([HM.ContentId.ReadMessageAddContact]),c)};HM.LFPP()};InboxServices.beginGetSingleMessagePart=function InboxServices$beginGetSingleMessagePart(e,f,a,d,b,c){HM.LFPP=function(){HM.GetSingleMessagePart(e,f,a,d,b==true,c)};HM.LFPP()};InboxServices.beginGetFullMessagePart=function InboxServices$beginGetFullMessagePart(a,d,b,c){HM.LFPP=function(){HM.GetFullMessagePart(a,d,b,c)};HM.LFPP()};InboxServices.beginGetManyMessageParts=function InboxServices$beginGetManyMessageParts(f,g,c,e,b,a,d){HM.LFPP=function(){HM.GetManyMessageParts(f,g,c,e,b,a==true,d)};HM.LFPP()};InboxServices.beginDeleteMessagePart=function InboxServices$beginDeleteMessagePart(b,e,d,a,c){HM.LFPP=function(){HM.MoveMessagesToFolder(d,InboxPage.Config.sysFldrs.trashFid,[b],[e],null,a,false,false,null,null,null,false,false,c,{mid:b,messageListRenderingInfo:a})};HM.LFPP()};InboxServices.beginMarkMessagePartForJmr=function InboxServices$beginMarkMessagePartForJmr(b,n,o,i,m,j,a,e,k,d,c,f,h,g,l){HM.LFPP=function(){HM.MarkMessagePartForJmr(b,n,o,i,m,j,a,[e],[k],d,c,f,h,g,l,{fetchConversation:b,jmrType:c,mpFid:d,mpMid:e,messageListRenderingInfo:a})};HM.LFPP()};InboxServices.addContactFromMessagePart=function InboxServices$addContactFromMessagePart(d,b,g,j,h,k,a,f,e,i){var c=DemandLoadHandler.createFppCallback(i,null);HM.LFPP=function(){HM.AddContactFromMessagePart(d,b,g,j,h,a,f,e,DemandLoadHandler.filterFetchedContentIds([HM.ContentId.ReadMessageAddContact]),c,{mid:a.MessageId,fid:b})};HM.LFPP()};InboxServices.setJunkStatus=function InboxServices$setJunkStatus(c,q,m,n,j,b,g,i,p,l,h,k){var a=null!=m;if(!a&&c.length==0)return;if(a){var e,d;if(b==HM.JmrType.Junk){e=false;d=FolderQuickViewListHelper.getFolderNameByFid(InboxPage.Config.sysFldrs.junkFid)}else{e=true;var o=b==HM.JmrType.NotJunk?InboxPage.Strings.bulkProgressUiNotJunk:InboxPage.Strings.bulkProgressUiPhish;d=Page.decode(o)}InboxServices.Events.showbulkactionprogressui.fire({isMark:e,actionOrFldr:d})}Page.setPerformanceId("JK");var f=!FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(c,a);HM.LFPP=function(){HM.MarkMessagesForJmr(n,c,q,m,b,j,g,i,f,l,h,k,InboxServices._endSetJunkStatus,{jmrType:b,guids:c,fid:n,setReportToJunkOK:j,isBulk:a,messageListRenderingInfo:g,messageRenderingInfo:i,refreshFolderAndQuickViewLists:f,removeFromList:l,suppressListTransition:h,markSenderAsSafe:k,refreshMessage:p},a?InboxServices._bulkActionError:null)};HM.LFPP()};InboxServices._endSetJunkStatus=function InboxServices$_endSetJunkStatus(b,a,d){var c=InboxServices._processRspForBulkAction(b,a,null);if(c.stopProcessing)return;if(c.executeNextBatch){HM.LFPP=function(){HM.MarkMessagesForJmr(a.fid,null,null,b.BatchInfo,a.jmrType,a.setReportToJunkOK,a.messageListRenderingInfo,a.messageRenderingInfo,a.refreshFolderAndQuickViewLists,a.removeFromList,a.suppressListTransition,a.markSenderAsSafe,InboxServices._endSetJunkStatus,a,InboxServices._bulkActionError)};HM.LFPP();return}InboxServices.preEndUpdateUi(b,InboxServices.Operations.SetJunkStatus,{mids:a.guids,isBulk:a.isBulk,jmrType:a.jmrType});if(HM.JmrType.Unsubscribe==a.jmrType&&!a.refreshMessage)b.MessageHtml="";InboxServices._endUpdateUi(b,a,d);if(HM.JmrType.Unsubscribe==a.jmrType||HM.JmrType.Junk==a.jmrType||HM.JmrType.Phish==a.jmrType)InboxPage.Config.hasSeenReportUi=true;InboxServices.Events.endsetjunkstatus.fire([b]);LoadingIndicator.hide()};InboxServices.beginUndoSenderMoveToBlockList=function InboxServices$beginUndoSenderMoveToBlockList(a,b){HM.LFPP=function(){HM.UndoSenderMoveToBlockList(a,b,InboxServices._endUndoSenderMoveToBlockList)};HM.LFPP()};InboxServices._endUndoSenderMoveToBlockList=function InboxServices$_endUndoSenderMoveToBlockList(a){InboxServices.Events.endundosendermovetoblocklist.fire([a])};InboxServices.deleteVMFromPhone=function InboxServices$deleteVMFromPhone(a){HM.LFPP=function(){HM.DeleteVoicemailOnPhone([a],InboxServices._endUpdateUi)};HM.LFPP()};InboxServices.markVMAsSaved=function InboxServices$markVMAsSaved(a){HM.LFPP=function(){HM.SaveVoicemailOnPhone([a],InboxServices._endUpdateUi)};HM.LFPP()};InboxServices.beginSvmFeedback=function InboxServices$beginSvmFeedback(c,b,a){HM.LFPP=function(){HM.SvmFeedback(c,b,a,InboxServices._endUpdateUi,{messageListRenderingInfo:a})};HM.LFPP()};window.DemandLoadServices={Events:{enddemandload:new $Event}};DemandLoadServices.beginDemandLoad=function DemandLoadServices$beginDemandLoad(b,c,a){HM.LFPP=function(){HM.DemandLoad(b,DemandLoadServices._endDemandLoad,{callbacks:c},a?a:null)};HM.LFPP()};DemandLoadServices._endDemandLoad=function DemandLoadServices$_endDemandLoad(b,a){DemandLoadServices.Events.enddemandload.fire([b,a.callbacks])};if(!window["LiveViews"])LiveViews={Providers:{}};LiveViews._started=false;LiveViews._pendingRegistration=[];LiveViews.QueueState=new $Enum("NotSent","Waiting","Done");LiveViews.Kind=new $Enum("Hotmail","External");LiveViews.HmlvTypes=new $Enum("Photo","Video");LiveViews._delayRegistration=function LiveViews$_delayRegistration(c,d){var b=LiveViews._pendingRegistration,a=b[c];if(!a){a=[];a.kind=c;b.push(a);b[c]=a}a.push(d)};LiveViews.getHmlvDataElem=function LiveViews$getHmlvDataElem(a){return LiveViews._getDataElem("hmlv",a)};LiveViews._getDataElem=function LiveViews$_getDataElem(a,b){return Control.getAncestorByAttr(b,a)};LiveViews.registerElv=function LiveViews$registerElv(b,a){LiveViews._delayRegistration(LiveViews.Kind.External,[b,a])};LiveViews.registerHmlv=function LiveViews$registerHmlv(b,a){LiveViews._delayRegistration(LiveViews.Kind.Hotmail,[b,a])};LiveViews.start=function LiveViews$start(){LiveViews._started=true};Type.createStaticClass(LiveViews,"LiveViews");LiveViewContainerControl=function LiveViewContainerControl(a){Control.create(this,a);this._initialize()};LiveViewContainerControl._ICON_SIZE=28;LiveViewContainerControl._MINIMUM_TITLE_SIZE=150;LiveViewContainerControl._MAX_ICONS_ON_UPPER_BAR=5;LiveViewContainerControl.prototype={};var __p=LiveViewContainerControl.prototype;__p._initialize=function LiveViewContainerControl$_initialize(){this.hmlvData=eval(this.elt.getAttribute("hmlv"));if(this.hmlvData&&this.hmlvData.length>0)for(var ii=0;ii<this.hmlvData.length;ii++){var currentHmlvData=this.hmlvData[ii];currentHmlvData.provider=currentHmlvData[0];currentHmlvData.type=currentHmlvData[1];currentHmlvData.subType=currentHmlvData[2];currentHmlvData.icon=currentHmlvData[3];currentHmlvData.loadingTitle=currentHmlvData[4];currentHmlvData.data=currentHmlvData[5];currentHmlvData.extraData=currentHmlvData[6];currentHmlvData.container=$(this.elt.id+"_"+ii);currentHmlvData.registered=false;currentHmlvData.containerControl=this;currentHmlvData.hasBeenSelected=false}this.collapseExpandControl=$(this.elt.id+"_ce");this.upperIconBar=$(this.elt.id+"_uib");this.lowerIconBar=$(this.elt.id+"_lib");this.brandingArea=$(this.elt.id+"_brand");this.messagePartBody=Control.findControl(this.elt,"MessagePartBody");this.selectedIndex=-1;this._setCollapseState(this.elt.getAttribute("c")=="true");this._clickHandler=$CD(this,this._onIconClick);this.upperIconBar.attachEvent("onclick",this._clickHandler);this._clickHandler=$CD(this,this._onIconClick);this.lowerIconBar.attachEvent("onclick",this._clickHandler);this._resizeHandler=$CD(this,this._onResize);window.attachEvent("onresize",this._resizeHandler);this._buildIcons();this._createIconBar();this._selectHmlv(0)};__p.dispose=function LiveViewContainerControl$dispose(){if(this.isCollapsed)$BSI.reportEvent("lv.collapse",null);window.detachEvent("onclick",this._clickHandler);var a=0;if(this.hmlvData){this.hmlvData.forEach(function(b){if(b){if(b.hasBeenSelected)a++;if(b.binding)b.binding.dispose();b.binding=null;b.container=null;b.containerControl=null;b.iconControl=null}},null);if(this.hmlvData.length>1)$BSI.reportEvent("lv.tab.click",{tabClicks:a,totalTabs:this.hmlvData.length})}this.upperIconBar.detachEvent("onclick",this._clickHandler);this.lowerIconBar.detachEvent("onclick",this._clickHandler);window.detachEvent("onresize",this._resizeHandler);Control.destroy(this)};__p._buildIcons=function LiveViewContainerControl$_buildIcons(){for(var b=0;b<this.hmlvData.length;b++){var a=document.createElement("a");a.href="javascript:;";a.className="IconContainer";a.setAttribute("iconIndex",b+1);if(LiveViews.hmlvIconSutraLabel)a.setAttribute("sutra",LiveViews.hmlvIconSutraLabel);var c=document.createElement("div");c.style.backgroundImage="url("+this.hmlvData[b].icon+")";c.className="Icon";a.appendChild(c);this.hmlvData[b].iconControl=a;c=null;a=null}};__p._createIconBar=function LiveViewContainerControl$_createIconBar(i){if(InboxPage.readingPane&&InboxPage.readingPane.isAnyWideBodyExpanded()){if(this.messagePartBody){var d=this.messagePartBody.getMsgContainer();if(d&&d.parentElement)this.elt.style.width=d.parentElement.offsetWidth+"px"}}else this.elt.style.width="auto";var g=this.lowerIconBar.offsetWidth;if(this.hmlvData.length<=LiveViewContainerControl._MAX_ICONS_ON_UPPER_BAR&&this.hmlvData.length*LiveViewContainerControl._ICON_SIZE<g-this.brandingArea.offsetWidth-LiveViewContainerControl._MINIMUM_TITLE_SIZE){if(this._usesUpperBar&&i)return;this._usesUpperBar=true;while(this.upperIconBar.childNodes.length)this.upperIconBar.removeChild(this.upperIconBar.childNodes[0]);while(this.lowerIconBar.childNodes.length)this.lowerIconBar.removeChild(this.lowerIconBar.childNodes[0]);for(var b=0;b<this.hmlvData.length;b++)this.upperIconBar.appendChild(this.hmlvData[b].iconControl);$css.add($(this.elt.id+"_title"),"TitleWithUpper")}else{var a=Math.floor(g/LiveViewContainerControl._ICON_SIZE);if(a==0)return;var e=Math.ceil(this.hmlvData.length/a);if(!this._usesUpperBar&&a==this._iconsPerRow&&e==this._numRows&&i)return;this._usesUpperBar=false;this._iconsPerRow=a;this._numRows=e;while(this.upperIconBar.childNodes.length)this.upperIconBar.removeChild(this.upperIconBar.childNodes[0]);while(this.lowerIconBar.childNodes.length)this.lowerIconBar.removeChild(this.lowerIconBar.childNodes[0]);for(var b=0;b<e;b++){var c=document.createElement("div");c.style.height=LiveViewContainerControl._ICON_SIZE+"px";for(var f=0;f<a;f++){var h=b*a+f;if(h<this.hmlvData.length)c.appendChild(this.hmlvData[h].iconControl)}this.lowerIconBar.appendChild(c);c=null}$css.remove($(this.elt.id+"_title"),"TitleWithUpper")}};__p._onResize=function LiveViewContainerControl$_onResize(){this._createIconBar(true)};__p.updateLayout=function LiveViewContainerControl$updateLayout(){this._createIconBar(false);if(this.selectedIndex>=0){var a=this.hmlvData[this.selectedIndex];if(a)if(!(!a.registered&&!this.isCollapsed))if(a.binding&&a.binding.updateLayout)a.binding.updateLayout()}};__p._selectHmlv=function LiveViewContainerControl$_selectHmlv(b){if(this.selectedIndex==b)return;if(this.selectedIndex>=0){$css.swap(this.hmlvData[this.selectedIndex].container,"TabSelected","Tab");if(this.hmlvData.length>1)$css.swap(this.hmlvData[this.selectedIndex].iconControl,"IconContainerSelected","IconContainer")}this.selectedIndex=b;var a=this.hmlvData[this.selectedIndex];if(a){$css.swap(a.container,"Tab","TabSelected");if(this.hmlvData.length>1)$css.swap(a.iconControl,"IconContainer","IconContainerSelected");if(!this.isCollapsed)a.hasBeenSelected=true;if(!a.registered&&!this.isCollapsed)this._registerHmlv(a);else if(a.binding&&a.binding.onHmlvSelect)a.binding.onHmlvSelect();this.setTitle()}};__p.setTitle=function LiveViewContainerControl$setTitle(){var a=this.hmlvData[this.selectedIndex],b="";if(a.binding&&a.binding.hmlvTitle)b=a.binding.hmlvTitle;else b=a.loadingTitle;$(this.elt.id+"_title").innerText=b};__p._onIconClick=function LiveViewContainerControl$_onIconClick(){var a=Control.getAncestorByAttr(event.srcElement,"iconIndex");if(a){if(this.isCollapsed)this._setCollapseState(false);this._selectHmlv(a.getAttribute("iconIndex")-1)}};__p.toggleExpandHmlv=function LiveViewContainerControl$toggleExpandHmlv(){var a=event.srcElement;if(a&&$css.has(a,"SubBrand"))return;this._setCollapseState(!this.isCollapsed);InboxPage.doPostProc=false};__p._setCollapseState=function LiveViewContainerControl$_setCollapseUI(c){this.isCollapsed=c;var b=$(this.elt.id+"_c");if(this.isCollapsed){$css.swap(this.collapseExpandControl,"Expanded","Collapsed");$css.swap(b,"Content","ContentCollapsed")}else{$css.swap(this.collapseExpandControl,"Collapsed","Expanded");$css.swap(b,"ContentCollapsed","Content")}var a=this.hmlvData[this.selectedIndex];if(a&&!this.isCollapsed)if(!a.registered)this._registerHmlv(a);else if(a.binding&&a.binding.onHmlvSelect)a.binding.onHmlvSelect()};__p._registerHmlv=function LiveViewContainerControl$_registerHmlv(a){var b=new HM.HMLiveViewRequestObject;b.Id=a.container.id;b.Sender=InboxPage.senderName;b.Type=a.type;b.SubType=a.subType;b.Data=a.data;b.ExtraData=a.extraData;a.registered=true;LiveViews.registerHmlv(b,a)};__p.onHmlvLoaded=function LiveViewContainerControl$onHmlvLoaded(){this.setTitle()};LiveViewContainerControl.createClass("LiveViewContainerControl");var LiveViewControlBase=function LiveViewControlBase(a){Control.create(this,a);this.initialize()};LiveViewControlBase.prototype={};var __p=LiveViewControlBase.prototype;__p.initialize=function LiveViewControlBase$initialize(){this.hmlvTitle=this.elt.getAttribute("t");this._hasClickBeenReported={Internal:false,External:false}};__p.dispose=function LiveViewControlBase$dispose(){Control.destroy(this)};__p._reportClick=function LiveViewControlBase$_reportClick(a){this._suppressHistoryAndAds();if(!this._hasClickBeenReported[a]){this._hasClickBeenReported[a]=true;var c=LiveViews.getHmlvDataElem(this.elt),b=c?c._hmlvData:null;if(b)$BSI.reportEvent("lv.click",{LiveViewProvider:b.provider,LiveViewType:b.type,LiveViewTarget:a})}};__p._suppressHistoryAndAds=function LiveViewControlBase$_supressHistoryAndAds(){InboxPage.doPostProc=false};LiveViewControlBase.createClass("LiveViewControlBase");var Safety={};Safety.markAsJunk=function Safety$markAsJunk(e,f,d,a){InboxPage.postProcData.history=false;var b=false,c=false;a=a?true:false;if(!InboxPage.Config.hasSeenReportUi){c=!Safety._showReportingQuestionUi(Page.decode(InboxPage.Strings.allowJunkReportingQuestion));if(c)return;b=true}Safety._setJunkStatus(e,f,b,HM.JmrType.Junk,true,null,null,d,a,false)};Safety.markAsNotJunk=function Safety$markAsNotJunk(c,b,a,d){InboxPage.postProcData.history=false;if(b==InboxPage.Config.sysFldrs.junkFid)a=null;Safety._setJunkStatus(c,b,false,HM.JmrType.NotJunk,true,a,null,HM.RemoveSenderFromListOption.None,false,d)};Safety.markAsPhish=function Safety$markAsPhish(c,d){InboxPage.postProcData.history=false;var a=false,b=false;if(!InboxPage.Config.hasSeenReportUi){b=!Safety._showReportingQuestionUi(Page.decode(InboxPage.Strings.allowJunkReportingQuestion));if(b)return;a=true}Safety._setJunkStatus(c,d,a,HM.JmrType.Phish,true,null,null,HM.RemoveSenderFromListOption.None,false,false)};Safety.markAsUnsubscribe=function Safety$markAsUnsubscribe(g,h,a,e,f){InboxPage.postProcData.history=false;var b=false,c=false;if(!InboxPage.Config.hasSeenReportUi){c=!Safety._showReportingQuestionUi(Page.decode(InboxPage.Strings.unsubscribeText));if(c)return;b=true}var d=a&&""!=a;Safety._setJunkStatus(g,h,b,HM.JmrType.Unsubscribe,false,e,!d,f,false,false);if(d)window.open(a)};Safety._showReportingQuestionUi=function Safety$_showReportingQuestionUi(a){return confirm(a)};Safety._setJunkStatus=function Safety$_setJunkStatus(a,g,n,b,k,j,o,p,i,m){var l=b==HM.JmrType.Unsubscribe||b==HM.JmrType.NotJunk&&g!=InboxPage.Config.sysFldrs.junkFid,h=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(a,l,k),d=null,f=a.mids,e=a.mads;if(a.isBulk){d=InboxPage.createBatchInfo();if(InboxPage.isUnreadFilterOrFlaggedQuickView()){var c=InboxPage.messageList.getDelayedRemovalMessageData();f=c.mids;e=c.mads}}InboxServices.setJunkStatus(f,e,d,g,n,b,h,j,o,p,i,m)};Type.createStaticClass(Safety,"Safety");var Messages={};Messages.markAsReadUnread=function Messages$markAsReadUnread(b,d){InboxPage.postProcData.history=false;InboxPage.postProcData.ads=false;var a=b.mids,e=b.mads,i=null,g=false;if(b.isBulk){i=InboxPage.createBatchInfo();if(InboxPage.isUnreadFilterOrFlaggedQuickView()){g=d&&InboxPage.messageList.fltid==InboxPage.Config.filters.unreadFltid;var f=InboxPage.messageList.getDelayedRemovalMessageData();a=f.mids;e=f.mads}}if(a){var k=InboxPage.messageList;for(var c=a.length-1;c>=0;c--){if($(a[c])==null)continue;var j=k.isRead(a[c]);if(!j&&k.hasConversation([a[c]]))continue;if(j==d){a.splice(c,1);e.splice(c,1)}}if(0==a.length&&!b.isBulk)return}var h=InboxPage.createMessageListRenderingInfo(true,g);h.LastUpdateTimestamp=InboxPage.messageList.kDate;InboxServices.beginMarkMessages(a,e,i,b.isHiddenBulk,d,h,b.duplicateMsgIds&&b.duplicateMsgIds.length>0)};Messages.markAsFlaggedUnflagged=function Messages$markAsFlaggedUnflagged(b,d){InboxPage.postProcData.history=false;InboxPage.postProcData.ads=false;var a=b.mids,e=b.mads,i=null,g=false;if(b.isBulk){i=InboxPage.createBatchInfo();if(InboxPage.isUnreadFilterOrFlaggedQuickView()){g=!d&&InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid;var f=InboxPage.messageList.getDelayedRemovalMessageData();a=f.mids;e=f.mads}}if(a){for(var c=a.length-1;c>=0;c--){if($(a[c])==null)continue;var j=InboxPage.messageList.isFlagged(a[c]);if(j==d){a.splice(c,1);e.splice(c,1)}}if(0==a.length&&!b.isBulk)return}var h=InboxPage.createMessageListRenderingInfo(true,g);h.LastUpdateTimestamp=InboxPage.messageList.kDate;InboxServices.beginFlagMessages(a,e,i,d,h,b.duplicateMsgIds&&b.duplicateMsgIds.length>0)};Messages.remove=function Messages$remove(g,f,c,d,b,a,e){Messages.move(g,InboxPage.folderList.fid,InboxPage.Config.sysFldrs.trashFid,f,c,d,b,a,e)};Messages.move=function Messages$move(a,n,g,f,j,s,d,q,t,e){InboxPage.postProcData.history=false;var b=null,p=a.mids,o=a.mads;if(a.isBulk){b=InboxPage.createBatchInfo();if(f){b.SenderSearch=f;b.Timestamp=InboxPage.messageList.kDate}else if(InboxPage.isUnreadFilterOrFlaggedQuickView()){var h=InboxPage.messageList.getDelayedRemovalMessageData();p=h.mids;o=h.mads}if(!d)d=InboxPage.createBulkMoveDataPoints("view");$BSI.reportEvent(g==InboxPage.Config.sysFldrs.trashFid?"DeleteRemove.Messaging.Mail":"Move.Messaging.Mail",d)}var i=MessageList.doMessagesStayInView(n,g),c=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(a,i,true);if(j)c.AutoSelectMessageIndex=-1;var r=(!e||!e.disableSuggestion)&&!f&&c.SearchKeyword!=""&&InboxPage.messageList.areAllItemsSelectedInView(),l=!q||i||!InboxPage.messageList.canSimulateMove(a.mids,a.isBulk),k=null,m=false;if(!l&&!j&&(InboxPage.isReadingPaneOn||InboxPage.readingPane.isFullView)){m=true;k=Messages._getItemRenderingInfoForMove(a)}InboxServices.beginMoveMessages(p,o,b,a.isHiddenBulk,n,g,c,s,r,l,InboxPage.messageList.conv,k,m,t,e,a.duplicateMsgIds&&a.duplicateMsgIds.length>0)};Messages._getItemRenderingInfoForMove=function Messages$_getItemRenderingInfoForMove(j){var c=InboxPage.messageList;if(j.isBulk)return;var m=c.getAutoSelectIndex(),e={};j.mids.forEach(function(a){e[a]=true});var b=c.getMessageListItems(true),i=b.length,f=0,a,l=0;for(var g=0;g<i;g++){a=b[g];if(a.getAttribute("del")||e[a.id]){l++;continue}else if(m==f)break;else f++}var k=f+l,d=null;if(k<b.length)d=c.getItemRenderingInfo(b[k]);else for(var h=i-1;h>=0;h--){a=b[h];if(!a.getAttribute("del")&&!e[a.id]){d=c.getItemRenderingInfo(a);break}}return d};Messages.print=function Messages$print(a,e,d){if(a&&a.length>0&&InboxPage.allowAction("print",a[0])){var c=[];for(var b=a.length-1;b>=0;b--){c.push(a[b]);c.push(e[b]?"m":"c")}var f="PrintMessages.aspx?cpids="+c.join(",")+"&isSafe="+d+"&FolderID="+InboxPage.folderList.fid;window.open(f,"","width=600px,height=400px,menubar=no,location=no,toolbar=no,resizable=yes,scrollbars=yes")}};Messages.viewSource=function Messages$viewSource(a){var b=String.format("{0}/mail/GetMessageSource.aspx?{1}={2}&folderid={3}",InboxPage.getSrcHttps,a.mads[0]?"msgid":"convid",a.mids[0],InboxPage.folderList.fid);window.open(b)};Messages.replyForward=function Messages$replyForward(b,g,e,c,d,f){var a=d==b?null:String.format(g,b,e||c?"True":"False");InboxPage.doPostProc=false;if(a)if(!c)Page.postWithFolderQuickViewCache("NewMessage",a);else Page.showMessage(Page.decode(InboxPage.Strings.replyForwardWarning),a,null,"_self");else alert(Page.decode(f));return false};Type.createStaticClass(Messages,"Messages");var ButtonList=function ButtonList(c){Control.create(this,c);this._buttons={};this._keys=[];this._data={};this._enabled=false;this.Events={onbuttonclick:new $Event,ondispose:new $Event};var b=$tag(c,"li"),f=b.length;for(var a=0;a<f;a++){if(b[a].className=="Divider")continue;var e=b[a].getAttribute("key");this.initializeButton(b[a],e)}var d=c.getAttribute("enabled")=="true";this.setEnabled(d)};ButtonList.prototype={elt:null,userdata:null,_buttons:null,_keys:null,_data:null,initializeButton:function ButtonList$initializeButton(b,a){this._keys.push(a);this._buttons[a]=b;this._data[a]=b.getAttribute("data")},_enabled:true,getEnabled:function ButtonList$getEnabled(){return this._enabled},setEnabled:function ButtonList$setEnabled(a){if(a==this._enabled)return;if(a)$replaceClass(this.elt,"Disabled","Enabled");else $replaceClass(this.elt,"Enabled","Disabled");this.elt.setAttribute("enabled",a.toString());this._enabled=a},forEach:function ButtonList$forEach(c,d){var e=this._keys.length;for(var a=0;a<e;a++){var b=this._keys[a];c(this,{button:this._buttons[b],idx:a,key:b,context:d})}},clear:function ButtonList$clear(){this._buttons={};this._keys=[];this._data={};var a=$tag(this.elt,"UL")[0];a.innerHTML=""},count:function ButtonList$count(){return this._keys.length},containsButtonKey:function ButtonList$containsButtonKey(a){return this._keys.exists(a)},getButtonProperty:function ButtonList$getButtonElt(b,c){var a=this._buttons[b];switch(c){case "elt":return a;case "enabled":return !$css.has(a,"Disabled");case "visible":return $getDisplay(a);case "text":return $tag(a,"SPAN")[0].innerText;case "selected":return $css.has(a,"Selected");case "html":return $tag(a,"SPAN")[0].innerHTML;case "data":return this._data[b]}},setButtonProperty:function ButtonList$setButtonProperty(c,d,b){var a=this._buttons[c];switch(d){case "enabled":if(b)$css.remove(a,"Disabled");else $css.add(a,"Disabled");break;case "selected":if(b)$css.add(a,"Selected");else $css.remove(a,"Selected");break;case "visible":$setDisplay(a,b);break;case "text":$tag(a,"SPAN")[0].innerText=b;break;case "html":$tag(a,"SPAN")[0].innerHTML=b;break;case "data":this._data[c]=b}},dispose:function ButtonList$dispose(){this.userdata=null;Control.destroy(this)},_buttonOnClick:function ButtonList$_buttonOnClick(a){if(!a)return;var b={button:Control.getAncestorByAttr(event.srcElement,"key"),key:a,data:this._data[a]};if(this._enabled&&this.getButtonProperty(a,"enabled"))this.Events.onbuttonclick.fire([this,b])}};ButtonList.prototype.addButton=function ButtonList$addButton(c){this._buttons={};this._keys=[];var d=$tag(this.elt,"UL")[0];d.innerHTML+=this.getButtonHTML(c);var b=$tag(d,"LI"),f=b.length;for(var a=0;a<f;a++){if(b[a].className=="Divider")continue;var e=b[a].getAttribute("key");this._keys.push(e);this._buttons[e]=b[a]}this._data[c.key]=c.data};ButtonList.createClass("ButtonList");var Menu=function Menu(b,a){ButtonList.call(this,b);this.Events={onbuttonclick:new $Event,ondispose:new $Event,onhidden:new $Event};this.setEnabled(true);this.owner=a;this._focusHandler=$CD(this,this._focusOut);this.elt.attachEvent("onfocusout",this._focusHandler);this._keyDownHandler=$CD(this,this._keyDown);this.elt.attachEvent("onkeydown",this._keyDownHandler);this.hide()};Menu.prototype={owner:null,_focusHandler:null,dispose:function Menu$dispose(){this.hide();if(this.owner!=null){this.Events.ondispose.fire([this]);this.elt.detachEvent("onfocusout",this._focusHandler);this.owner=null;this.callBase(ButtonList,"dispose")}},_keyDown:function Menu$keyDown(){this._lastKey=event.keyCode},_focusOut:function Menu$onFocusOut(){if(!this.elt.contains(event.toElement)&&this.elt!=event.toElement){if(this._lastKey==9&&this.owner&&this.owner.focus)$callFocus(this.owner);this.dispose()}},getButtonHTML:function Menu$getButtonHTML(a){return String.format(Menu._BUTTON_HTML,a.key,a.caption||"",a.tooltip||"")},focus:function Menu$focus(){if(this._keys.length>0){var a=null;this.forEach(function(c,b){if(!a&&c.getButtonProperty(b.key,"visible"))a=$tag(c.getButtonProperty(b.key,"elt"),"A")[0]});if(a)$callFocus(a)}},_selected:null,getSelectedButton:function Menu$getSelectedButton(){return this._selected},setSelectedButton:function Menu$setSelectedButton(a){if(this._selected)this.setButtonProperty(this._selected,"selected",false);if(a)this.setButtonProperty(a,"selected",true)},reposition:function Menu$reposition(a){AlignBehavior.DropDown(this.elt,this.owner,a)},show:function Menu$show(a){$setDisplay(this.elt,true);this.reposition(a)},hide:function Menu$hide(){if(this.elt!=null)$setDisplay(this.elt,false);this.Events.onhidden.fire([this])},_buttonOnClick:function Menu$_buttonOnClick(a){if(a){this.callBase(ButtonList,"_buttonOnClick",[a]);this.dispose()}},getButtonHTML:function ButtonList$getButtonHTML(a){return Menu.CreateButtonHTML(a)}};if(Browser.isIE6){var oldShow=Menu.prototype.show;Menu.prototype.show=function Menu$show(b){oldShow.call(this,b);var a=this;setTimeout(function(){var b=$tag(a.elt,"DIV");b[b.length-1].style.height=$tag(a.elt,"UL")[0].offsetHeight+"px"},0)}}Menu._BUTTON_HTML='<li key="{0}"><a unselectable=on href="javascript:;" onclick="event.returnValue=false;" title="{2}">{1}</a></li>';Menu._DIVIDIER_HTML='<li class="Divider"><div></div></li>';Menu.CreateButtonHTML=function Menu$CreateButtonHTML(a){if(a.caption=="-")return Menu._DIVIDIER_HTML;return String.format(Menu._BUTTON_HTML,a.key,a.caption||"",a.tooltip||a.caption||"")};Menu.CreateMenuHTML=function Menu$CreateMenuHTML(c){var b=['<div onclick="return Control.invoke(\'Menu\', \'_buttonOnClick\', event, Control.lookup(event.srcElement, \'key\'));" enabled="false" class="Menu t_hovl c_m Disabled" style="display: none;"><div class="MenuTop"><div class="MenuItems"><ul>'],d=c.length;for(var a=0;a<d;a++)b[a+1]=Menu.CreateButtonHTML(c[a]);b[d+1]='</ul></div></div><div class="shadow"></div></div>';return b.join("")};Menu.Create=function Menu$Create(b){var a=document.createElement("div");document.body.appendChild(a);a.innerHTML=Menu.CreateMenuHTML(b||[]);a=a.firstChild;return a};Menu.Destroy=function Menu$Destroy(a){if(a!=null&&a.parentElement!=null)document.body.removeChild(a.parentElement)};Menu.createClass("Menu",ButtonList);var AlignBehavior={};AlignBehavior.DropDown=function AlignBehavior$DropDown(c,g,i){var d=$getLocation(g,i),f=d.left;if(document.documentElement.dir=="rtl")f=d.right-c.offsetWidth;var a={x:f,y:d.bottom},b=a.x+c.offsetWidth-document.body.offsetWidth;a.x=b>0?a.x-b:a.x;if(document.documentElement.dir=="rtl")a.x=a.x<0?0:a.x;var h=a.x,e=0;if(Browser.isSF){b=a.y+c.offsetHeight-document.body.offsetHeight;e=(b>0?a.y-b:a.y)+document.body.scrollTop}else{b=a.y-document.getElementsByTagName("HTML")[0].scrollTop+c.offsetHeight-document.body.offsetHeight;e=b>0?a.y-b:a.y}c.style.left=h+"px";c.style.top=e+"px"};function SelectionMsgPane(a){Control.create(this,a);this.selectionElt=$("selection");this.countElt=$("selCount");this.selAllMsgElt=$("selAll");this.genMsgContainer=$("genMsgContainer");this.genMsg=$("genMsg");if(InboxPage.isReadingPaneOn)this.genMsgHdr=$("genMsgHdr");else this.closeElt=$("CloseMessaging")}__p=SelectionMsgPane.prototype={};__p.selectionElt=null;__p.countElt=null;__p.selAllMsgElt=null;__p.genMsgContainer=null;__p.genMsgHdr=null;__p.genMsgContainer=null;__p.closeElt=null;__p.dispose=function SelectionMsgPane$dispose(){this.selectionElt=null;this.countElt=null;this.selAllMsgElt=null;this.genMsgContainer=null;this.genMsgHdr=null;this.genMsg=null;this.closeElt=null;Control.destroy(this)};__p.hide=function SelectionMsgPane$hide(){$setDisplay(this.elt,false)};__p.show=function SelectionMsgPane$show(c,b,a){if(InboxPage.isReadingPaneOn)if($getDisplay(InboxPage.readingPane.elt)){InboxPage.readingPane.reset();$setDisplay(InboxPage.readingPane.elt,false)}$setDisplay(this.genMsgContainer,b);$setDisplay(this.selectionElt,c);if(!InboxPage.isReadingPaneOn)$setDisplay(this.closeElt,a);$setDisplay(this.elt,true);if(InboxPage.isReadingPaneOn)this.elt.scrollTop=0};__p.showGeneralMsg=function SelectionMsgPane$showGeneralMsg(b,a,d){if(b)this.genMsg.innerHTML=b;if(InboxPage.isReadingPaneOn){var c=false;if(a){this.genMsgHdr.innerHTML=a;c=true}$setDisplay(this.genMsgHdr,c)}this.show(false,true,d)};SelectionMsgPane.Sel="Sel";SelectionMsgPane.SelPrompt="SelPrompt";SelectionMsgPane.NoSel="NoSel";__p.updateSelectedCount=function SelectionMsgPane$updateSelectedCount(a,e){var f=true,c=SelectionMsgPane.Sel,b;if(e){var d;if(!InboxPage.isQuickViewFilterOrSearch()){var i=FolderQuickViewListHelper.getFolderNameByFid(InboxPage.folderList.fid),h=Page.decode(InboxPage.folderList.fid==InboxPage.Config.sysFldrs.inboxFid?InboxPage.Strings.inboxFolder:InboxPage.Strings.specificFolder);d=String.format(h,i.encodeHtml())}else d=Page.decode(InboxPage.Strings.genericView);var g=String.format(Page.decode(InboxPage.Strings.bulkSelectPrompt),d);this.selAllMsgElt.innerHTML=g;c=SelectionMsgPane.SelPrompt}if(-1==a)b=InboxPage.formatMsgWithGenericFolderOrViewString(Page.decode(InboxPage.Strings.allSelected));else if(0==a&&InboxPage.isReadingPaneOn)c=SelectionMsgPane.NoSel;else if(e||InboxPage.isReadingPaneOn||a>0&&$getDisplay(this.elt)&&$getDisplay(this.selectionElt)&&$css.has(this.selectionElt,SelectionMsgPane.Sel))if(1==a)b=Page.decode(InboxPage.Strings.oneMsgSelected);else b=String.format(Page.decode(InboxPage.Strings.someMsgsSelectedTmpl),a);else f=false;if(f){this.selectionElt.className=c;if(b)this.countElt.innerHTML=b;this.show(true,false,false);if(InboxPage.isReadingPaneOn){InboxPage.readingPane.mode=ReadingPane.NOT_MESSAGE_MODE;InboxPage.resetContentHeight($("SelMsgPaneInner"))}}else this.hide()};SelectionMsgPane.createClass("SelectionMsgPane");function SearchPane(a){Control.create(this,a);this.advSrchContainer=$("advSrch");this.srchQuery=$("srchQuery");this.titleSrchContainer=$("titleSearchContainer")}__p=SearchPane.prototype={};__p.advSrchContainer=null;__p.srchQuery=null;__p.hasSearchQuery=false;__p.titleSrchContainer=null;__p.isOpen=false;__p.dispose=function SearchPane$dispose(){this.advSrchContainer=this.srchQuery=this.titleSrchContainer=null;Control.destroy(this)};__p.hide=function SearchPane$hide(){if(!this.isOpen)return;$setDisplay(this.elt,false);$setDisplay(this.srchQuery,false);$setDisplay(this.titleSrchContainer,true);InboxPage._onResize(null,true);this.isOpen=false};__p.show=function SearchPane$show(){if(this.isOpen)return;$setDisplay(this.titleSrchContainer,false);$setDisplay(this.elt,true);$setDisplay(this.srchQuery,this.hasSearchQuery);InboxPage._onResize(null,true);this.isOpen=true};__p.setContent=function SearchPane$setContent(a){if(a)this.advSrchContainer.innerHTML=a};__p.setSrchQuery=function SearchPane$setSrchQuery(a){if(a){var c=String.format(Page.decode(InboxPage.Strings.srchResults),'<span dir="ltr">'+a.encodeHtml()+"</span>");this.srchQuery.innerHTML=c;this.hasSearchQuery=true}else if(a!=null){var b=Page.decode(InboxPage.Strings.srchResultsAllMsgs);this.srchQuery.innerHTML=b;this.hasSearchQuery=true}else this.hasSearchQuery=false;if(this.isOpen){$setDisplay(this.srchQuery,this.hasSearchQuery);InboxPage._onResize(null,true)}};SearchPane.createClass("SearchPane");function MessageList(a){Control.create(this,a);this._sorted=InboxPage.isSortByConvReq;this._setStateFromDom();InboxServices.Events.endgetmessagelistpage.attach($CD(this,this._endGetMessageListPage));InboxServices.Events.endmarkmessages.attach($CD(this,this._endMarkMessages));InboxServices.Events.endflagmessages.attach($CD(this,this._endFlagMessages))}MessageList.unreadClass="mlUnrd";MessageList.flaggedClass="mlFlgd";__p=MessageList.prototype={};__p.sBy="Date";__p.sAsc=false;__p.pDir="FirstPage";__p.aMid="";__p.pCur=1;__p.mCt=0;__p.iCt=0;__p.mPgs=false;__p.aDate="";__p.big=false;__p.srch=false;__p.saDate="";__p.kDate="";__p.fltid="";__p.conv=false;__p.dirtyMads={};__p.disableRefreshForMl=false;__p._bulkSelectAll=false;__p._hiddenBulkSelectAll=false;__p._selectionMids=[];__p._selectionMads=[];__p._lastSelectedOrDeselectedIndex=-1;__p._shiftClickPivotAction=true;__p._messageListItems=null;__p._messageListItemsAll=null;__p._additionalMessageCount=0;__p._sorted=false;__p.dispose=function MessageList$dispose(){Control.destroy(this);this._messageListItems=null;this._messageListItemsAll=null};__p._setStateFromDom=function MessageList$_setStateFromDom(e){this._messageListItems=null;this._messageListItemsAll=null;this._additionalMessageCount=0;var a=$tag(this.elt,"div");if(null==a||a.length==0)return;a=a[0];this.sBy=a.getAttribute("sBy");this.sAsc=a.getAttribute("sAsc");this.pDir=a.getAttribute("pDir");this.aMid=a.getAttribute("aMid");this.aDate=a.getAttribute("aDate");this.pCur=a.getAttribute("pCur");this.mCt=a.getAttribute("mCt");this.iCt=a.getAttribute("iCt");this.mPgs=a.getAttribute("mPgs");this.big=a.getAttribute("big");this.srch=a.getAttribute("srch");this.vid=a.getAttribute("vid");this.saDate=a.getAttribute("saDate");this.kDate=a.getAttribute("kDate");this.fltid=a.getAttribute("fltid");this.hasConv=a.getAttribute("hasConv");this.conv=a.getAttribute("ct");this.sAsc=this.sAsc=="1";this.mPgs=this.mPgs=="1";this._initMessageListItems();this.setHiddenBulkSelectAll(false);if(this.isBulkSelectAllState()&&e){this.setCheckAllCheckBox(true);this.checkRange(0,0,true,true);this._clearPivotState();this.updateSelectedCount()}else{if(this.getCheckedCount()>0)this._refreshSelectionFromChecks();else{this.clearSelectionState();var b=a.getAttribute("sel");b=parseInt(b);if(-1!=b){var d=this.getMessageListItems()[b];this.selectMsg(d,b);this._ensureVisible(d)}}this.setCheckAllCheckBox(false)}InboxPage.postProcData.uiUpdate=true;if(InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.junkFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.trashFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.sentFid&&InboxPage.folderList.fid!=InboxPage.Config.sysFldrs.draftsFid){var c=$("atiml");if(c)$Ads.SetSDTag(c.value);$Ads.SetTag($Ads.Tags.PV,"I")}else{$Ads.SetSDTag("");$Ads.SetTag($Ads.Tags.PV,"")}this.dirtyMads={};setTimeout($CD(this,function(){this._initFlagIcons();this._initCheckboxes()}),1)};__p._initMessageListItems=function MessageList$_initMessageListItems(){var d=[],c=[],h=[],b=$tag(this.elt,"tbody");if(b&&b.length==1){var f=$tag(b[0],"tr"),g=f.length;for(var e=0;e<g;e++){var a=f[e];if($getDisplay(a))d.push(a);c.push(a)}}this._additionalMessageCount=c.length-d.length;this._messageListItems=d;this._messageListItemsAll=c};__p._initCheckboxes=function MessageList$_updateCheckboxes(){var c=this.getMessageListItemChecks(true),d=c.length;for(var b=d-1;b>=0;b--){var a=c[b];if(!a.title)this._setCheckBoxTitle(a.checked,a)}};__p._initFlagIcons=function MessageList$_updateFlagIcons(){var c=this.getMessageListItemFlags(true),d=c.length;for(var b=d-1;b>=0;b--){var a=c[b];if($css.has(a,"fg")){a.alt=InboxPage.Strings.flaggedAltText;a.title=InboxPage.Strings.flaggedMsgText}else{a.alt=InboxPage.Strings.unflaggedAltText;a.title=InboxPage.Strings.unflaggedMsgText}}};__p.setHTML=function MessageList$setHTML(b,a){this.elt.innerHTML=b;this._setStateFromDom(a);if(!InboxPage.isReadingPaneOn)InboxPage.resetContentHeight($("messageListContentContainer"));this.disableRefreshForMl=false};__p.cleanUpContextMenu=function MessageList$cleanUpContextMenu(){if(this._prepareContextMenuForUiUpdate)this._prepareContextMenuForUiUpdate()};__p.cancelContextMenuTimers=function MessageList$cancelContextMenuTimers(){if(this._cancelMenuEvents)this._cancelMenuEvents()};__p.getItemCount=function MessageList$getItemCount(){return parseInt(this.iCt)};__p.getMessageCount=function MessageList$getMessageCount(){return parseInt(this.mCt)};__p._setMessageCount=function MessageList$_setMessageCount(a){a=a>=0?a:-1;this.mCt=a;var b=$("mlRange");if(b)if(a>=0)b.innerText=String.format(Page.decode(InboxPage.Strings.pageNavMsgs),a);else if($getDisplay(b))$setDisplay(b,false)};__p.isMoreThanOnePage=function MessagesList$isMoreThanOnePage(){return this.mPgs};__p.setIsMoreThanOnePage=function MessagesList$setIsMoreThanOnePage(a){this.mPgs=a};__p.getCategories=function MessageList$getCategories(c){var b=$(c),a=b.getAttribute("ci");if(a)return a.split(",");else return []};__p.isMessageInCategory=function MessageList$isMessageInCategory(d,c){var a=this.getCategories(d);if(a)for(var b=0;b<a.length;b++)if(a[b]==c)return true;return false};__p.addCategory=function MessageList$addCategory(d,b){var c=$(d),a=c.getAttribute("ci");if(a){if(!a.split(",").contains(b+"")){c.setAttribute("ci",a+","+b);return true}}else{c.setAttribute("ci",b+"");return true}return false};__p.removeCategory=function MessageList$addCategory(e,c){var d=$(e),b=d.getAttribute("ci");if(b){var a=b.split(",");if(a.contains(c+"")){a.remove(c+"");d.setAttribute("ci",a.join(","));return true}}return false};__p.getViewId=function MessageList$getViewId(){return this.vid};__p.updateCount=function MessageList$updateCount(e,b){var a=$(e);if(a)if(a.getAttribute("conv")){var c=$getDescendantByClass(a,"TD","Ct")||$getDescendantByClass(a,"DIV","Ct"),d=$tag(c,"SPAN");if(1==b)c.innerText="";else d[0].innerText=b+""}};__p.canSimulateMove=function MessageList$canSimulateMove(){return false};__p.simulateMove=function MessageList$simulateMove(){};__p.hide=function MessageList$hide(){$css.add($("messageListSplitPane"),"MessageListSplitPaneHidden");$css.add($("msgListToolbarsContainer"),"MsgListToolbarsContainerHidden")};__p.show=function MessageList$show(){InboxPage.isReadMessageMode=false;if(!InboxPage.isReadingPaneOn)this.clearSelection();$css.remove($("messageListSplitPane"),"MessageListSplitPaneHidden");$css.remove($("msgListToolbarsContainer"),"MsgListToolbarsContainerHidden")};__p.sort=function MessageList$sort(b){var g="Conversation",d=false;if(g==b||this.conv&&this.srch&&"Date"==b){b="Date";d=true}var c=null,f=HM.SortBy[b]==HM.SortBy.Date,e=d?g:b;if(!f)if(this.big)c=InboxPage.Strings.cannotSortBigInbox;else if(this.srch)c=InboxPage.Strings.cannotSortSearch;if(!c&&(d&&!this.conv||!d&&this.conv))if(!this.srch){$BSI.reportEvent("ml.sort",{sortView:e});InboxPage.onSubmitSortConversationView(!this.conv,b);return}else c=InboxPage.Strings.cannotSortSearch;if(c){InboxPage.doPostProc=false;alert(Page.decode(c));return}this._sorted=true;var a=InboxPage.createMessageListRenderingInfo(false);a.FolderId=InboxPage.folderList.fid;a.QuickViewId=InboxPage.quickViewList.qvid;a.FilterId=this.fltid;a.IsSearchResults=InboxPage.folderList.isSrch;a.SearchKeyword=InboxPage.folderList.srchKw;a.AdvancedSearch=InboxPage.advancedSearch&&InboxPage.advancedSearch.getSearch();a.SortKey=b;a.SortAsc=this.sBy==b?!this.sAsc:!f;a.NumberOfMessages=this.mCt;a.IsFavoriteSelected=InboxPage.folderList.isFavoriteSelected;Page.setPerformanceId("SO");$BSI.reportEvent("ml.sort",{sortView:e+(a.SortAsc?"Incr":"Decr")});InboxPage.beginRefreshInbox(true,true,a,false,null,false,false)};__p._getSearchMessageListRenderingInfo=function MessageList$_getSearchMessageListRenderingInfo(){var a=InboxPage.createMessageListRenderingInfo(false);if(HM.SortBy[this.sBy]!=HM.SortBy.Date){a.SortKey="Date";a.SortAsc=false}else{a.SortKey=this.sBy;a.SortAsc=this.sAsc}a.IsSearchResults=true;a.FolderId=InboxPage.Config.sysFldrs.searchFid;return a};__p.search=function MessageList$search(a){var b=this._getSearchMessageListRenderingInfo();b.SearchKeyword=a;Page.setPerformanceId("SR");if(InboxPage.advancedSearch)InboxPage.advancedSearch.reset();var c=/(\sOR\s)|(\sAND\s)|[:]/;$BSI.reportEvent("ml.search.bsb",{sq:a&&c.test(a)?"1":"0",cx:this._getSearchComplexity(a)});this._searchInner(b)};__p.advancedSearch=function MessageList$advancedSearch(b){var a=this._getSearchMessageListRenderingInfo();a.AdvancedSearch=b;$BSI.informNav(null,"SR");SearchBox.resetValue();$BSI.reportEvent("ml.search.asb",{});this._searchInner(a)};__p._searchInner=function MessageList$_searchInner(a){InboxPage.beginRefreshInbox(true,true,a,false,null,false,false)};__p.searchAllFromSender=function MessageList$searchAllFromSender(b){$BSI.reportEvent("ml.cm.fe",{});var a=this._getSearchMessageListRenderingInfo();InboxServices.beginViewAllFromSender(a,b)};__p._getSearchComplexity=function MessageList$_getSearchComplexity(b){var c=/[^\s!"():]+/g,a=b?b.match(c):null;return a?a.length:0};__p._onBodyClick=function MessageList$_onBodyClick(){var b=event.srcElement;if("mCk"==b.name||"mCC"==b.getAttribute("name")){this._onCheckMessageClick(event);InboxPage.doPostProc=false;return true}else if("tFg"==Control.lookup(b,"aId")){this._onFlagMessageClick(Control.getAncestorByAttr(b,"aId"));InboxPage.doPostProc=false;return true}var c=this._getTextSelection(b);if(null!=c&&0!=c.length)return;var a=Control.getAncestorByAttr(b,"msg");if(null==a){a=Control.getAncestorByAttr(b,"conv");if(null==a){InboxPage.doPostProc=false;return true}}if(event.shiftKey||event.ctrlKey){window.open(String.format("{0}?Aux={1}&{2}&n={3}{4}",Page.SELF_PATH,a.getAttribute("mad"),String.format(a.getAttribute("conv")?"ReadConversationId={0}":"ReadMessageId={0}",a.id),Page.queryString.newNonce,InboxPage.folderList.isSrch?"":String.format("&FolderID={0}&fav={1}",InboxPage.folderList.fid,InboxPage.folderList.isFavoriteSelected)));event.returnValue=false;event.cancelBubble=true;InboxPage.doPostProc=false;return true}if(InboxPage.isReadingPaneOn&&InboxPage.readingPane.mode==ReadingPane.MESSAGE_MODE)if(InboxPage.readingPane.getItemId()==a.id){InboxPage.doPostProc=false;return}this._shiftClickPivotAction=true;Page.setPerformanceId(a.getAttribute("conv")?"RC":"R");this.selectByElem(a,true,-1,true,false,false,!InboxPage.isReadingPaneOn);this._openMessageByElt(a)};__p._onDblClick=function MessageList$_onDblClick(){if(!InboxPage.isReadingPaneOn)return;var a=InboxPage.readingPane;if(a.mode==ReadingPane.MESSAGE_MODE)if(a.setHTMLed)a.onFullViewClick();else a.doubleClicked=true};__p._onNavClick=function MessageList$_onNavClick(){var a=Control.getAncestorByAttr(event.srcElement,"pnCur");if(null==a){InboxPage.doPostProc=false;return}Page.setPerformanceId("PG");this._openPageByElt(a)};__p._getTextSelection=function MessageList$_getTextSelection(d){var a="";if(window.getSelection){if(window.getSelection().rangeCount>0){var b=window.getSelection().getRangeAt(0);a=d!=b.commonAncestorContainer.parentNode?"":b.toString()}}else if(document.getSelection)a=document.getSelection();else if(document.selection){var b=document.selection.createRange(),c=b.parentElement();a=null!=c&&d!=c?"":b.text}return a};__p.getItemRenderingInfo=function MessageList$getItemRenderingInfo(b){if(this.conv){var f=b.getAttribute("conv"),d=b.id,a=InboxPage.createConversationRenderingInfo(false);a.FolderId=InboxPage.folderList.fid;if(f)a.ConversationId=d;else a.MessageId=d}else{var c=b.id,g=b.getAttribute("mad"),e=b.getAttribute("vm"),a=InboxPage.createMessageRenderingInfo();a.MessageId=c;a.FolderId=InboxPage.folderList.fid;a.AuxData=e||this.dirtyMads[c]?null:InboxPage.createMessageAuxData(g);a.MarkAsRead="vm"!=e;if(b.getAttribute("ctu"))a.ConversationUpsell=true}return a};__p._openMessageByElt=function MessageList$_openMessageByElt(a,f,g,d){InboxPage.doPostProc=true;var e=MessageList.getMessageSenders(a),b=this.getItemRenderingInfo(a);if(e.length>0)b.SenderEmail=e[0].getAttribute("email");var c=null;if(typeof d=="function")c=function(b,a){InboxServices.Events.endupdateui.fire([b,false,a]);d()};InboxPage.beginRefreshInbox(false,false,null,true,b,false,this.conv,c);if(f)setTimeout($CC($CD(this,this._ensureVisible),[a]),1)};__p._endGetMessageListPage=function MessageList$_endGetMessageListPage(){this._getMessageListPageWorking=false};__p.next=function MessageList$next(c){var b=this._selectNextOrPreviousValidElem(true);this._shiftClickPivotAction=true;if(!b){var a=$("nextPageLink");if(a&&$getDisplay(a))this._openPageByElt(a,0)}else{Page.setPerformanceId("Next");this._openMessageByElt(b,true,c)}};__p.previous=function MessageList$previous(c){if(-1==this._lastSelectedOrDeselectedIndex)return;var b=this._selectNextOrPreviousValidElem(false);this._shiftClickPivotAction=true;if(!b){var a=$("prevPageLink");if(a&&$getDisplay(a))this._openPageByElt(a,InboxPage.Config.pageSize-1)}else{Page.setPerformanceId("Pre");this._openMessageByElt(b,true,c)}};__p.hasNextAndPreviousValidElem=function MessageList$hasNextAndPreviousValidElem(){var a={hasNext:false,hasPrev:false},e=this._getValidMsgFn(),d=this.getMessageListItems(),b=this.getSelectionIndex();if(b<0)return a;var c=$("mlPageNav");a.hasNext=!$css.has(c,"EndOfList");a.hasPrev=!$css.has(c,"BeginOfList");if(!a.hasPrev)a.hasPrev=this._getNextOrPreviousMsgIndex(false,b,d)>=0;if(!a.hasNext)a.hasNext=this._getNextOrPreviousMsgIndex(true,b,d)>=0;return a};__p._selectNextOrPreviousValidElem=function MessageList$_selectNextValidElem(c){var d=this._getValidMsgFn(),b=this.getMessageListItems(),a=this._lastSelectedOrDeselectedIndex;a=this._getNextOrPreviousMsgIndex(c,a,b);if(a<0)return null;else return this.selectByElem(b[a],true,a,true)};__p._getNextOrPreviousMsgIndex=function MessageList$_getNextOrPreviousMsgIndex(d,a,b){var c=this._getValidMsgFn();while(true){a+=d?1:-1;if(a<0||a>=b.length)break;var e=b[a];if(c(this,e))return a}return -1};__p._ensureVisible=function MessageList$_ensureVisible(a){$scrollIntoView(a,this.elt.children[0].children[0].children[0])};__p.updateSortMenu=function MessageList$updateSortMenu(){var n=$("sortMenu"),l=$("SortByDate"),e=$("SortBySender"),k=$("SortBySubject"),m=$("SortBySize"),b=$("SortByConversation"),d=InboxPage.Config.sysFldrs.sentFid==InboxPage.folderList.fid||InboxPage.Config.sysFldrs.draftsFid==InboxPage.folderList.fid,h=false,q=$tag(n,"A")[0],o="Sender"!=this.sBy?this.sBy:d?"To":"From",g=this.sBy;if(this.conv&&!this.srch&&!d)g=o="Conversation";if(this._sorted)q.title=String.format(InboxPage.Strings.sortByCaption,InboxPage.Strings.sortBy[o]);var j=InboxPage.Strings.sortBy[d?"To":"From"];$tag(e,"SPAN")[0].innerHTML=j;e.title=String.format(InboxPage.Strings.sortByCaption,j);var a="sel";$css.remove(l,a);$css.remove(e,a);$css.remove(k,a);$css.remove(m,a);if(b){$css.remove(b,a);var p=$getDisplay(b.parentElement),i=!this.srch&&!d?true:false;if(p!=i){$setDisplay(b.parentElement,i);h=true}}$css.add($("SortBy"+g),a);var c="clear";$tag(l,"IMG")[0].className=c;$tag(e,"IMG")[0].className=c;$tag(k,"IMG")[0].className=c;$tag(m,"IMG")[0].className=c;if(b)$tag(b,"IMG")[0].className=c;$tag($("SortBy"+g),"IMG")[0].className=this.sAsc?"g_sort_asc":"g_sort_desc";var f=$getDescendantByClass(n,"UL","c_m");if(h&&f&&f.binding)f.binding.invalidatePosition()};__p._endMarkMessages=function MessageList$_endMarkMessages(a){var e=a[0],d=a[1],c=a[2],b=a[3];if(!e.MessageListHtml)this.updateReadState(d,c,b)};__p._endFlagMessages=function MessageList$_endFlagMessages(a){var h=a[0],g=a[1],f=a[2],d=a[3];if(!h.MessageListHtml){this._updateItemListState(g,f,d,$CD(this,this.updateFlagStateByElt));var b=InboxPage.Config.quickViews.flaggedQvid;if(InboxPage.quickViewList.qvid==b){if(InboxPage.areNoFiltersApplied()){var e=$(FolderQuickViewListHelper.qvidPrefix+b),c=FolderQuickViewListHelper.getCount(e);this._setMessageCount(c)}else this._setMessageCount(-1);this.iCt=-1}}};__p._updateItemListState=function MessageList$_updateItemListState(f,g,c,b){if(g){var d=this.getMessageListItems();for(var a=d.length-1;a>=0;a--)b(d[a],c)}else for(var a=f.length-1;a>=0;a--){var e=$(f[a]);if(null==e)return;b(e,c)}};__p.updateReadState=function MessageList$updateReadState(b,a,c){this._updateItemListState(b,a,c,$CD(this,this.updateReadStateByElt))};__p.updateReadStateByElt=function MessageList$updateReadStateByElt(a,b){var f=false;if(a){var c=MessageList.unreadClass,e=a.getAttribute("rpl"),d=a.getAttribute("fwd"),i=a.getAttribute("conv");if($css.has(a,c)&&b||!$css.has(a,c)&&!b){this.dirtyMads[a.id]=true;if(b)$css.remove(a,c);else $css.add(a,c);var j=$getDescendantByClass(a,"TD","Io").children[0],g=["i_c_",i?"a_":"",b?"r":"u",e?"r":d?"f":""].join(""),h=InboxPage.Strings[e?"repliedMsgText":d?"forwardedMsgText":b?"readMsgText":"unreadMsgText"];this._updateIcon(j,g,Page.decode(h));f=true}}return f};__p.isConversation=function MessageList$isConversation(b){var a=$(b);return a.getAttribute("conv")};__p.isSenderInContactList=function MessageList$isSenderInContactList(a){return this.isMessageInCategory(a,"2")};__p.updateFlagStateByElt=function MessageList$updateFlagStateByElt(a,c){var b=MessageList.flaggedClass;if(InboxActions.setFlagIcon(a,c)){this.dirtyMads[a.id]=true;if(c){$css.add(a,b);this.addCategory(a,InboxPage.Config.quickViews.flaggedQvid)}else{$css.remove(a,b);this.removeCategory(a,InboxPage.Config.quickViews.flaggedQvid)}}};__p._updateIcon=function MessageList$_updateIcon(a,c,b){a.className=c;a.alt=b;a.title=b};__p.isFlagged=function MessageList$isFlagged(b){var a=$(b);return $css.has(a,MessageList.flaggedClass)};__p.isRead=function MessageList$isRead(b){var a=$(b);return !$css.has(a,MessageList.unreadClass)};__p.hasConversation=function MessageList$hasConversation(c){if(!this.hasConv)return false;for(var a=c.length-1;a>=0;a--){var b=$(c[a]);if(b&&b.getAttribute("conv"))return true}return false};__p.removeVMOnPhoneStatus=function MessageList$removeVMOnPhoneStatus(){var d=this.getMessageListItems()[this.getSelectionIndex()],a=$tag(d,"TD"),c=3==a.length,b=c?$tag($tag(a[1],"DIV")[0],"IMG"):$tag(a[4],"IMG");if(2==b.length)$setDisplay(b[1],false)};MessageList.createSelectedMessageData=function MessageList$createSelectedMessageData(b,d,c,a){return MessageList._createSelectedMessageDataImpl(b,d,c,false,a)};MessageList.createHiddenBulkSelectedMessageData=function MessageList$createHiddenBulkSelectedMessageData(){return MessageList._createSelectedMessageDataImpl(true,null,null,true)};MessageList._createSelectedMessageDataImpl=function MessageList$_createSelectedMessageDataImpl(h,c,b,e,a){if(a&&a.length>0){var f=b[0];b=[];c=a;var g=c.length;for(var d=0;d<g;d++)b.push(f)}return {isBulk:h,mids:c,mads:b,duplicateMsgIds:a,isHiddenBulk:e}};MessageList.getMessageSenders=function MessageList$getMessageSenders(a){return $getDescendantsByAttr(a,"span","email")};MessageList.getSenderEmailsFromMids=function MessageList$getSenderEmailsFromMids(f){var e=[],c={};for(var b=f.length-1;b>=0;b--){var d=MessageList.getMessageSenders($(f[b]));if(d.length>0){var a=d[0].getAttribute("email");if(a&&!c[a]){e.push(a);c[a]=true}}}return e};MessageList.doMessagesStayInView=function MessageList$doMessagesStayInView(a,b){return (a==InboxPage.Config.sysFldrs.searchFid||a==InboxPage.Config.sysFldrs.noneFid)&&b!=InboxPage.Config.sysFldrs.trashFid&&b!=InboxPage.Config.sysFldrs.junkFid};__p.getMessageListItemChecks=function MessageList$getMessageListItemChecks(a){return this._getMessageListItemsByName("mCk",a)};__p.getMessageListItemFlags=function MessageList$getMessageListItemFlags(a){return this._getMessageListItemsByName("mFg",a)};__p._getMessageListItemsByName=function MessageList$_getMessageListItemsByName(h,f){var b=document.getElementsByName(h),a;if(f)a=b;else{var g=b.length;a=[];for(var c=0;c<g;c++){var e=b[c],d=Control.getAncestorByAttr(e,"id");if(d&&$getDisplay(d))a.push(e)}}return a};__p.getMessageListItems=function MessageList$getMessageListItems(a){return a?this._messageListItemsAll.clone():this._messageListItems.clone()};__p.getSelectedMessageData=function MessageList$getSelectedMessageData(){var c=null,b=null,a=this.isBulkSelectAllState();if(!a){c=this._selectionMids.clone();b=this._selectionMads.clone()}return MessageList.createSelectedMessageData(a,c,b)};__p.getDelayedRemovalMessageData=function MessageList$getDelayedRemovalMessageData(){var a=[],b=[],f=this._getValidMsgFn(),d=this.getMessageListItems();for(var c=d.length-1;c>=0;c--){var e=d[c];if(!f(this,e))this._selectMsgInner(e,a,b)}if(a.length==0){a=null;b=null}return {mids:a,mads:b}};__p.selectByIndex=function MessageList$selectByIndex(a,c,d){var b=this.getMessageListItems();if(a>=b.length||a<0)return null;return this.selectByElem(b[a],c,a,d)};__p.selectByMid=function MessageList$selectByMid(d,b,c,a){return this.selectByElem($(d),b,-1,c,false,a)};__p.getSelectedItem=function MessageList$getSelectedItem(b){var a=Control.getAncestorByAttr(b,"msg");if(null==a)a=Control.getAncestorByAttr(b,"conv");return a};__p._getMessageListEltIndex=function MessageList$_getMessageListEltIndex(d){var c=-1,b=this.getMessageListItems();for(var a=b.length;a--;)if(d==b[a]){c=a;break}return c};__p.selectByElem=function MessageList$selectByElem(a,f,b,g,c,e,d){if(!a)return null;if(-1==b)b=this._getMessageListEltIndex(a);if(-1==b)return null;if(g)this.clearSelection();if(f){if(!c&&!this.isBulkSelectAllState())this.selectMsg(a,b);if(!d){$css.add(a,"MessageListItemSelected t_sel");if(e)setTimeout($CD(this,function(){this._ensureVisible(a)}),1)}}else{if(!c)this.unselectMsg(a,b);if(!d&&$css.has(a,"MessageListItemSelected t_sel"))$css.remove(a,"MessageListItemSelected t_sel")}return a};__p.clearSelection=function MessageList$clearSelection(b){var c=this.getMessageListItems(),d;if(c.length==0)return;if(!b)d=this.getMessageListItemChecks();for(var a=c.length-1;a>=0;a--){this.selectByElem(c[a],false,a,false,true);if(!b)this._setCheckBox(false,d[a])}if(!b)this.setCheckAllCheckBox(false);this.clearSelectionState()};__p.clearSelectionState=function MessageList$clearSelectionState(){this._bulkSelectAll=false;this._selectionMids=[];this._selectionMads=[];this._clearPivotState()};__p._clearPivotState=function MessageList$_clearPivotState(){this._lastSelectedOrDeselectedIndex=-1;this._shiftClickPivotAction=true};__p.selectMsg=function MessageList$selectMsg(b,a){this._selectMsgInner(b,this._selectionMids,this._selectionMads);this._lastSelectedOrDeselectedIndex=a};__p._selectMsgInner=function MessageList$_selectMsgInner(a,d,c){var e=a.id,b=a.getAttribute("mad");if(a.getAttribute("msg")!=null);var f=b?InboxPage.createMessageAuxData(b):"";d.push(e);c.push(f)};__p.unselectMsg=function MessageList$unselectMsg(f,d){if(this.isBulkSelectAllState()){$BSI.reportEvent("bk.uncheck",{unchecked:true});this._bulkSelectAll=false;var c=this.getMessageListItems();for(var a=c.length-1;a>=0;a--)if(a!=d)this.selectMsg(c[a],a)}else{var e=f.id,b=this._selectionMids.indexOf(e);if(b>=0){this._selectionMids.splice(b,1);this._selectionMads.splice(b,1)}}this._lastSelectedOrDeselectedIndex=d};__p.getSelectionIndex=function MessageList$getSelectionIndex(){return this.areAnyItemsSelected()?this._lastSelectedOrDeselectedIndex:-1};__p.getAutoSelectIndex=function MessageList$getAutoSelectIndex(){if(!this.areAnyItemsSelected()||this._lastSelectedOrDeselectedIndex<0)return -1;var c=this.getMessageListItemChecks(),b=0;for(var a=this._lastSelectedOrDeselectedIndex-1;a>=0;a--)if(c[a].checked)b++;return this._lastSelectedOrDeselectedIndex-b};__p._onFlagMessageClick=function MessageList$_onFlagMessageClick(b){var c=$css.has(b,"uf"),a=Control.getAncestorByAttr(b,"msg");if(null==a)a=Control.getAncestorByAttr(b,"conv");var e=a.getAttribute("id"),d=a.getAttribute("mad")||"";InboxActions.markMessageAsFlaggedUnflagged(e,d,c)};__p._onCheckMessageClick=function MessageList$_onCheckMessageClick(k){var a=k.srcElement,b=$("msgChkAll"),e=this.getSelectedItem(a),c=this._getMessageListEltIndex(e),g=false;if("TD"==a.nodeName){var i=$tag(a,"INPUT");if(i.length>0){a=i[0];this._setCheckBox(!a.checked,a)}}else this._setCheckBoxTitle(a.checked,a);var d=this._lastSelectedOrDeselectedIndex;if(this.isOneItemSelected()){var h=this._selectionMids[0],f=$tag($(h),"INPUT")[0].checked;if(h==e.id)g=f;else if(!f)this.clearSelection(true)}if(!g)this.selectByElem(e,a.checked,c,false);if(event.shiftKey&&d>-1)if(d<c)this.checkRange(d,c,this._shiftClickPivotAction);else this.checkRange(c,d,this._shiftClickPivotAction);if(b.checked==true&&a.checked==false)this.setCheckAllCheckBox(false,b);else if(b.checked==false&&a.checked==true){var j=this.areAllItemsChecked();this.setCheckAllCheckBox(j,b)}this.updateSelectedCount(this._shouldShowBulkSelectPrompt(b.checked));if(!(event.shiftKey&&this._lastSelectedOrDeselectedIndex>-1))this._shiftClickPivotAction=a.checked};__p.areAllItemsChecked=function MessageList$areAllItemsChecked(){var c=this.getMessageListItemChecks(),b=true;for(var a=c.length-1;a>=0;a--)if(c[a].checked==false){b=false;break}return b};__p._refreshSelectionFromChecks=function MessageList$_refreshSelectionFromChecks(){this.clearSelectionState();var b=this.getMessageListItemChecks(),c=this.getMessageListItems();for(var a=b.length-1;a>=0;a--)if(b[a].checked)this.selectMsg(c[a],a)};__p.updateSelectedCount=function MessageList$updateSelectedCount(a){var b=this.isBulkSelectAllState()?-1:this._getSelectionListCount();InboxPage.selectionMsgPane.updateSelectedCount(b,a)};__p.isOneItemSelected=function MessageList$isOneItemSelected(){return 1==this._getSelectionListCount()};__p.areAnyItemsSelected=function MessageList$areAnyItemsSelected(){return this.isBulkSelectAllState()||this._getSelectionListCount()>0};__p.areAllItemsSelectedInView=function MessageList$areAllItemsSelectedInView(){return this.isBulkSelectAllState()||!this.isMoreThanOnePage()&&this.getMessageListItems().length==this._getSelectionListCount()};__p._getSelectionListCount=function MessageList$_getSelectionListCount(){return this._selectionMids.length};__p.getCheckedCount=function MessageList$getCheckedCount(){var c=0,b=this.getMessageListItemChecks();for(var a=b.length-1;a>=0;a--)if(b[a].checked)c++;return c};__p.checkRange=function MessageList$checkRange(f,g,d,e){var c=this.getMessageListItemChecks(),b=c.length;if(!e)b=Math.min(g+1,b);for(var a=f;a<b;a++)if(c[a].checked!=d){this._setCheckBox(d,c[a]);this.selectByIndex(a,d,false)}if(!e)this.updateSelectedCount()};__p.checkAll=function MessageList$checkAll(a){InboxPage.doPostProc=false;this.clearSelection();if(a)this.checkRange(0,0,a,true);this.setCheckAllCheckBox(a);this._lastSelectedOrDeselectedIndex=a?0:-1;this.updateSelectedCount(this._shouldShowBulkSelectPrompt(a))};__p.setCheckAllCheckBox=function MessageList$setCheckAllCheckBox(b,a){if(!a)a=$("msgChkAll");a.checked=b;a.title=b?InboxPage.Strings.selectNone:InboxPage.Strings.selectAll};__p._setCheckBox=function MessageList$_setCheckBox(b,a){a.checked=b;this._setCheckBoxTitle(b,a)};__p._setCheckBoxTitle=function MessageList$_setCheckBoxTitle(a,b){b.title=a?InboxPage.Strings.checkedCbTitle:InboxPage.Strings.unCheckedCbTitle};__p._shouldShowBulkSelectPrompt=function MessageList$_shouldShowBulkSelectPrompt(a){return a&&InboxPage.Config.isBulkSelectEnabled&&this.isMoreThanOnePage()};__p.isBulkSelectAllState=function MessageList$isBulkSelectAllState(){return this._bulkSelectAll};__p.bulkSelectAll=function MessageList$bulkSelectAll(){InboxPage.doPostProc=false;this.clearSelectionState();this._bulkSelectAll=true;this.updateSelectedCount()};__p.getHiddenBulkSelectAll=function MessageList$getHiddenBulkSelectAll(){return this._hiddenBulkSelectAll};__p.setHiddenBulkSelectAll=function MessageList$setHiddenBulkSelectAll(a){this._hiddenBulkSelectAll=a};__p.hasFocus=__p.focus=function MessageList$emptyFunction(){};MessageList.createClass("MessageList");__p=MessageList.prototype;__p._openPageByElt=function MessageList$_openPageByElt(e,b,f){if(f&&this._getMessageListPageWorking)return;InboxPage.doPostProc=true;this._getMessageListPageWorking=true;var g=e.getAttribute("pnCur"),d=e.getAttribute("pnDir"),a=InboxPage.createMessageListRenderingInfo(true);a.PageNumCurrent=g;switch(d){case "FirstPage":this.setFirstOrLastPageParams(a,true);break;case "LastPage":this.setFirstOrLastPageParams(a,false);break;case "NextPage":this._setNextPageParams(a);break;case "PreviousPage":this._setPrevPageParams(a);break;default:this.setFirstOrLastPageParams(a,true)}var c=true;if(this.isBulkSelectAllState()&&!InboxPage.isUnreadFilterOrFlaggedQuickView()){a.BulkSelectAllTimestamp=this.saDate;a.AutoSelectMessageIndex=-1;c=false}else if(null!=b)a.AutoSelectMessageIndex=b;$BSI.reportEvent("ml.paging",{dir:d,by:this.conv?"Conversation":a.SortKey,asc:a.SortAsc?"1":"0"});InboxPage.beginRefreshInbox(c,true,a,false,null,false,false,InboxServices._endGetMessageListPage,InboxServices._endGetMessageListPageError)};__p._setNextPageParams=function MessageList$_setNextPageParams(a){var c=null,b=null,e=false,d=this._findNextPageMsgAnchor();if(d){c=this._getMsgIdFromMsgElt(d);b=this._getMsgDateFromMsgElt(d)}else if(HM.ListNavigateDirection[this.pDir]==HM.ListNavigateDirection.FirstPage)e=true;else if(this.aMid&&this.aDate){c=this.aMid;b=this.aDate}if(!e&&c&&b){a.PageDirection=HM.ListNavigateDirection.NextPage;a.AnchorId=c;a.AnchorDate=b}else this.setFirstOrLastPageParams(a,true)};__p._setPrevPageParams=function MessageList$_setPrevPageParams(a){if(this.aMid&&this.aDate){a.PageDirection=HM.ListNavigateDirection.PreviousPage;a.AnchorId=this.aMid;a.AnchorDate=this.aDate}else this.setFirstOrLastPageParams(a,true)};__p.setFirstOrLastPageParams=function MessageList$setFirstPageParams(a,b){a.PageDirection=b?HM.ListNavigateDirection.FirstPage:HM.ListNavigateDirection.LastPage;a.AnchorId=null;a.AnchorDate=null};__p._findNextPageMsgAnchor=function MessageList$_findNextPageMsgAnchor(){var e=this._getValidMsgFn(),b=null,d=this.getMessageListItems();for(var a=d.length-1;a>=0;--a){var c=d[a];if(e(this,c)){b=c;break}}return b};__p._getValidMsgFn=function MessageList$_getValidMsgFn(){var a;if(this.fltid==InboxPage.Config.filters.unreadFltid&&InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)a=function(a,b){return a._isValidAnchorMsgForUnreadView(b)&&a._isValidAnchorMsgForFlaggedView(b)};else if(this.fltid==InboxPage.Config.filters.unreadFltid)a=function(a,b){return a._isValidAnchorMsgForUnreadView(b)};else if(InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)a=function(a,b){return a._isValidAnchorMsgForFlaggedView(b)};else a=function(a,b){return a._isValidAnchorMsgForNormalView(b)};return a};__p._getMsgDateFromMsgElt=function MessageList$_getMsgDateFromMsgElt(b){var c=null;if(b){var a=b.getAttribute("mdt");if(null!=a&&""!=a)c=a}return c};__p._getMsgIdFromMsgElt=function MessageList$_getMsgIdFromMsgElt(a){var b=null;if(a)b=a.id;return b};__p._isValidAnchorMsgForNormalView=function MessageList$_isValidAnchorMsgForNormalView(){return true};__p._isValidAnchorMsgForUnreadView=function MessageList$_isValidAnchorMsgForUnreadView(a){return $css.has(a,MessageList.unreadClass)};__p._isValidAnchorMsgForFlaggedView=function MessageList$_isValidAnchorMsgForFlaggedView(a){return $css.has(a,MessageList.flaggedClass)};function FolderList(a){Control.create(this,a);this._setStateFromDom()}FolderList.JUNK_NAME="J";FolderList.NOT_JUNK_NAME="NJ";FolderList.UNSAFE_NAME="MU";FolderList.SAFE_NAME="MS";__p=FolderList.prototype={};__p.fid=__p.fst=__p.ft=null;__p.dispose=function FolderList$dispose(){Control.destroy(this)};__p._setStateFromDom=function FolderList$_setStateFromDom(){FolderQuickViewListHelper.initLeftNavTitles(this.elt);var a=$getDescendantByAttr(this.elt,"div","flmain","flmain");this.fid=a.getAttribute("selfid");this.fst=a.getAttribute("fst");this.isSrch=null!=a.getAttribute("isSrch");this.isFavoriteSelected=null!=a.getAttribute("fav");this.srchKw=a.getAttribute("srchKw");InboxPage.postProcData.uiUpdate=true;setTimeout($CD(this,function(){this._updateHeader()}),10)};__p._updateHeader=function FolderList$_setStateFromDom(){var a=$(InboxPage.Config.sysFldrs.inboxFid),b=a.getAttribute("count");$HeaderCookie.updateUnreadCount(b)};__p._onclick=function FolderList$_onclick(){var c=FolderQuickViewListHelper.resolveToFolderElt(event.srcElement),a=c.folderElt,b=c.targetElt;if(!b){if(window.ExpandCollapse)ExpandCollapse.handleClick(event.srcElement,App.config.excoCookieValFl);InboxPage.doPostProc=false;return}else{var f=a.id,e=null!=a.getAttribute("isSrch"),d=b.getAttribute("fidref")!=null;this.goToFldr(f,e,d)}};__p.goToFldr=function FolderList$goToFldr(e,b,d){var c=InboxPage.messageList,a=InboxPage.createMessageListRenderingInfo(false);a.FolderId=e;a.SortKey=c.sBy;a.SortAsc=c.sAsc;a.IsSearchResults=b;a.SearchKeyword=b?this.srchKw:null;a.AdvancedSearch=b&&InboxPage.advancedSearch?InboxPage.advancedSearch.getSearch():null;a.IsFavoriteSelected=d;Page.setPerformanceId("VI");InboxPage.beginRefreshInbox(true,true,a,false,null,true,false)};__p.setHTML=function FolderList$setHTML(a){this.elt.innerHTML=a;this._setStateFromDom()};FolderList.createClass("FolderList");function QuickViewList(a){Control.create(this,a);this._setStateFromDom()}__p=QuickViewList.prototype={};__p.qvid=null;__p.dispose=function QuickViewList$dispose(){Control.destroy(this)};__p._setStateFromDom=function QuickViewList$_setStateFromDom(){FolderQuickViewListHelper.initLeftNavTitles(this.elt);var a=$tag(this.elt,"ul");if(!Object.isNull(a)&&a.length>0){a=a[0];this.qvid=a.getAttribute("qvid");InboxPage.postProcData.uiUpdate=true}};__p._onclick=function QuickViewList$_onclick(){var a=Control.getAncestorByAttr(event.srcElement,"qvid");if(null==a||!a.id||a.id.substring(0,3)!="qv-"){if(window.ExpandCollapse)ExpandCollapse.handleClick(event.srcElement,App.config.excoCookieValQv);InboxPage.doPostProc=false;return}var b=parseInt(a.id.substring(3));if(isNaN(b)){InboxPage.doPostProc=false;return}this._goToQuickView(b)};__p._onclickHeader=function QuickViewList$_onclickHeader(){};__p._goToQuickView=function QuickViewList$_goToQuickView(b){$BSI.reportEvent("Filter.Messaging.Mail",{QuickView:b});var c=InboxPage.messageList,a=InboxPage.createMessageListRenderingInfo(false);a.QuickViewId=b;a.SortKey=c.sBy;a.SortAsc=c.sAsc;InboxPage.beginRefreshInbox(true,true,a,false,null,true)};__p.setHTML=function QuickViewList$setHTML(a){this.elt.innerHTML=a;this._setStateFromDom()};QuickViewList.createClass("QuickViewList");function ReadingPane(g){Control.create(this,g);var b=$("readingPaneHtml");if(b){var a=b.innerHTML,c=true;if(Browser.isSF){var d=document.createElement("textarea"),f="&lt;",e="<";d.innerHTML=f;if(d.innerHTML==e)c=false}if(c)a=a.decodeHtml();this._safelySetInnerHtml(a)}this._setStateFromDom();InboxServices.Events.endmarkmessages.attach($CD(this,this._endMarkMessages));InboxServices.Events.endflagmessages.attach($CD(this,this._endFlagMessages));window.ic_viewemail=function(a){InboxPage.messageList.searchAllFromSender(a)}}ReadingPane.allNotExpandedClass="AllNotExpanded";ReadingPane.allExpandedClass="AllExpanded";ReadingPane.NO_MODE=0;ReadingPane.MESSAGE_MODE=1;ReadingPane.NOT_MESSAGE_MODE=2;ReadingPane.DELAY_LOADED_MODE=3;ReadingPane.READ_NAME="R";__p=ReadingPane.prototype={};__p.isFullView=false;__p.mode=ReadingPane.NO_MODE;__p._msgParts=null;__p._allBodies=false;__p.dispose=function ReadingPane$dispose(){this._disposeMsgParts();Control.destroy(this)};__p._disposeMsgParts=function ReadingPane$disposeMsgParts(){if(this._msgParts!=null){this._doForAllMessageParts(function(a){a.dispose()});this._msgParts=null}this._msgPartsArray=null;this._actionMid=null;if($ic&&$ic.ic)$ic.ic.removeICsFromNamespace("rm")};__p._doForAllMessageParts=function ReadingPane$_doForAllMessageParts(b){for(var a in this._msgParts)if(!FunctionHelper.isSpecialMember(this._msgParts,a))if(false===b(this._msgParts[a]))break};__p._setStateFromDom=function ReadingPane$_setStateFromDom(){if(!$getDisplay(this.elt)){this.mode=ReadingPane.NOT_MESSAGE_MODE;return}var c=$tag(this.elt,"div");if(null==c||c.length==0){this.mode=ReadingPane.NO_MODE;return}this._child=c[0];if(this._child.getAttribute("delayed")){this.mode=ReadingPane.DELAY_LOADED_MODE;this._delayedId=this._child.getAttribute("itemid");this._isConversation=this._child.getAttribute("conv")?true:false;return}ReadingPane.downloadFrame=$("downloadFrame");if(null!=ReadingPane.downloadFrame)ReadingPane.downloadFrame.attachEvent("onload",ReadingPane._endDownloadAttachment);this.mode=ReadingPane.MESSAGE_MODE;this.setHTMLed=true;this.mid=this._child.getAttribute("mid");this.cid=this._child.getAttribute("cid");this.secretCid=this._child.getAttribute("scd");this._isConversation=this.cid!=null;this.ulr=this._child.getAttribute("ulr");this._msgParts={};this._msgPartsArray=[];var f=$("msgParts").children,h=f.length;for(var d=0;d<h;d++){var b=f[d];if(!(b!=null&&"DIV"==b.tagName&&null!=b.getAttribute("mid")))continue;var a=new MessagePart(b);this._msgParts[a.mid]=a;this._msgPartsArray.push(a);if(null==this._actionMid)this._actionMid=a.isDraft?null:a.mid}if(null==this._actionMid)this._actionMid=this._msgPartsArray[0].mid;if(this._isConversation&&null!=this.mid&&!(Browser.isIE6&&!InboxPage.readingPane)){var a=this._msgParts[this.mid];if(a){var g=$CD(this,function(){this._scrollToMessagePart(a)});setTimeout(g,50)}}this._allBodies=false;this.updateNextPrevMessageArrows();var e=$("atirp");if(e)$Ads.SetSDTag(e.value);$Ads.SetTag($Ads.Tags.PV,"R")};__p._scrollToMessagePart=function ReadingPane$_scrollToMessagePart(b){if(InboxPage.isReadingPaneOn)$scrollIntoView(b.elt,$("readingPaneContainer"),2);else{var a=$getLocation(b.elt);window.scrollTo(a.left,a.top-2)}};__p.initializeMsgPartsAsRead=function ReadingPane$initializeMsgPartsAsRead(){this._doForAllMessageParts(function(a){a.isRead=true})};__p.setHTML=function ReadingPane$setHTML(a){this._disposeMsgParts();this._safelySetInnerHtml(a);if(!InboxPage.isReadingPaneOn)InboxPage.selectionMsgPane.hide();else if(!$getDisplay(this.elt)){InboxPage.selectionMsgPane.hide();$setDisplay(this.elt,true)}this._setStateFromDom();setTimeout($CD(this,this._handleWideLayout),1)};__p.handlePageLoadWithMsg=function ReadingPane$handlePageLoadWithMsg(){setTimeout($CD(this,this._handleWideLayout),1)};__p._safelySetInnerHtml=function ReadingPane$_safelySetInnerHtml(a){try{$Utility.ajaxInnerHtml(this.elt,a)}catch(b){$Utility.ajaxInnerHtml(this.elt,a.replace(/<p.*>/gi,"<br/>"))}};__p.updateNextPrevMessageArrows=function ReadingPane$updateNextPrevMessageArrows(){var a=InboxPage.messageList.hasNextAndPreviousValidElem();if(a.hasNext)$css.remove($("readingPaneContentContainer"),"NextMessageDisabled");else $css.add($("readingPaneContentContainer"),"NextMessageDisabled");if(a.hasPrev)$css.remove($("readingPaneContentContainer"),"PreviousMessageDisabled");else $css.add($("readingPaneContentContainer"),"PreviousMessageDisabled")};__p.reset=function ReadingPane$reset(){if(InboxPage.isReadingPaneOn){if(this._child){this.elt.removeChild(this._child);this._child=null}this.elt.innerHTML="";this.elt.scrollTop=0}this.mode=ReadingPane.NO_MODE};__p.getItemId=function ReadingPane$getItemId(){if(this._isConversation)return this.cid;else return this.getActionableMsgPart().mid};__p.getMessagePart=function ReadingPane$getMessagePart(a){return this._msgParts[a]};__p.numMessageParts=function ReadingPane$numMessageParts(){return this._msgPartsArray.length};__p.isVoicemail=function ReadingPane$isVoicemail(){if(this._isConversation)return false;else return this.getActionableMsgPart().getBody().vm};__p.getSelectedMessageData=function ReadingPane$getSelectedMessageData(){if(this._isConversation)return MessageList.createSelectedMessageData(false,[this.cid],[""]);else if(this.secretCid!=null)return MessageList.createSelectedMessageData(false,[this.secretCid],[""]);else{var a=this.getActionableMsgPart(),c=[a.mid],d=InboxPage.createMessageAuxData(a.getBody().auxData),b=[d];return MessageList.createSelectedMessageData(false,c,b,a.duplicateMsgIds)}};__p.getActionableMsgPartActions=function ReadingPane$_getActionableMsgPartActions(){var a=this.getActionableMsgPart();return a.getActionsHandler()};__p.getActionableMsgPart=function ReadingPane$getActionableMsgPart(){if(null==this._actionMid)this._assignActionMid();var a=this._msgParts[this._actionMid];return a};__p._assignActionMid=function ReadingPane$_assignActionMid(){if(1==this._msgPartsArray.length)this._actionMid=this._msgPartsArray[0].mid;else{var c=this._msgPartsArray.length;for(var a=0;a<c;a++){var b=this._msgPartsArray[a];if(!b.isDraft){this._actionMid=b.mid;break}}}if(null==this._actionMid)this._actionMid=this._msgPartsArray[0].mid};__p.collapseAll=function ReadingPane$collapseAll(){InboxPage.doPostProc=false;this._updateSubSubjectUi(false);this._doForAllMessageParts(function(a){if(a.isExpanded)a.updateHeaderUi(false)});$BSI.reportEvent("rm.clsall")};__p.expandAll=function ReadingPane$expandAll(){InboxPage.postProcData.history=false;InboxPage.postProcData.ads=false;$BSI.reportEvent("rm.expall");if(this._allBodies)this._expandAllHeadersUi();else{var b=null,d={},e=this._msgPartsArray.length;for(var c=0;c<e;c++){var a=this._msgPartsArray[c];if(null==b&&!a.hasAnyBody())b=a.mid;if(!a.hasAnyBody())d[a.mid]=a.idx}if(null!=b)InboxServices.beginGetManyMessageParts(this.cid,InboxPage.folderList.fid,b,-1,d,!InboxPage.readingPane.ulr,$CD(this,this._endExpandAll));else this._expandAllHeadersUi()}};__p._endExpandAll=function ReadingPane$_endExpandAll(d){var a=d.MessagePartData,c;for(var b in a)if(!FunctionHelper.isSpecialMember(a,b)){c=this._msgParts[b];c.setPartData(false,a[b]);c.updateHeaderUi(true)}this._insertIdentityContext(d.IdentityContext);this.expandAll()};__p._expandAllHeadersUi=function ReadingPane$_expandAllHeadersUi(){this._updateSubSubjectUi(true);this._doForAllMessageParts(function(a){a.updateHeaderUi(true)});this._allBodies=true};__p._updateSubSubjectUi=function ReadingPane$_updateSubSubjectUi(a){$replaceClass($("subSubjectToolbar"),a?ReadingPane.allNotExpandedClass:ReadingPane.allExpandedClass,a?ReadingPane.allExpandedClass:ReadingPane.allNotExpandedClass)};__p._getTargetMessagesForReRender=function ReadingPane$_getTargetMessagesForReRender(j,g){var c=null,f={},h=this._msgPartsArray.length,d=0,e=0;for(var a=0;a<h;a++){var b=this._msgPartsArray[a];if(g(j,b)){if(null==c){c=b.mid;d=a}e=a;f[b.mid]=b.idx}}var i=e-d+1;return {mpMap:f,startingMid:c,numParts:i}};__p._markMessagePartForJmr=function ReadingPane$_markMessagePartForJmr(c,a,m,j,l){InboxPage.postProcData.history=false;var g=false;if(HM.JmrType.Unsubscribe==a||HM.JmrType.Junk==a||HM.JmrType.Phish==a){var h=false;if(!InboxPage.Config.hasSeenReportUi){h=!confirm(Page.decode(InboxPage.Strings.allowJunkReportingQuestion));if(h)return;g=true}}var e=c.getSelectedMessageData(),k=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(e,true,false),b=this._getTargetMessagesForReRender(c,j),d=c.getBody().unsubscribeUrl,i=HM.JmrType.Unsubscribe==a&&d!=null&&d!="",f=b.startingMid!=null&&!i;InboxServices.beginMarkMessagePartForJmr(f,this.cid,InboxPage.folderList.fid,b.startingMid,b.numParts,f?b.mpMap:{o:"o"},k,e.mids[0],e.mads[0],c.fid,a,g,l,m,$CD(this,this._endMarkMessagePartForJmr));if(i)window.open(d)};__p.markMessagePartAsJunk=function ReadingPane$markMessagePartAsJunk(d,b,a){var c=this._msgParts[d];if(1==this._msgPartsArray.length)c.markAsUnsafe(b,a);else{var e=function(b,a){return a.contactEmail==b.contactEmail&&a.hasAnyBody()&&a.mid!=b.mid};this._markMessagePartForJmr(c,b?HM.JmrType.Phish:HM.JmrType.Junk,false,e,a)}};__p.markMessagePartAsNotJunk=function ReadingPane$markMessagePartAsNotJunk(c,b){var a=this._msgParts[c],e=a.getSelectedMessageData();if(1==this._msgPartsArray.length)a.markAsSafe(b);else{var d=function(b,a){return a.contactEmail==b.contactEmail&&a.hasAnyBody()&&(a.fid!=InboxPage.Config.sysFldrs.junkFid||a.mid!=b.mid)};this._markMessagePartForJmr(a,HM.JmrType.NotJunk,b,d,HM.RemoveSenderFromListOption.None)}};__p.markMessagePartAsUnsubscribe=function ReadingPane$markMessagePartAsUnsubscribe(c){var a=this._msgParts[c],e=a.getSelectedMessageData();if(1==this._msgPartsArray.length)a.unsubscribe();else{var d=function(c,b){return b.contactEmail==a.contactEmail&&b.hasAnyBody()},b=a.getRemoveOption();this._markMessagePartForJmr(a,HM.JmrType.Unsubscribe,false,d,b)}};__p._endMarkMessagePartForJmr=function ReadingPane$_endMarkMessagePartForJmr(b,a){InboxServices.preEndUpdateUi(b,InboxServices.Operations.MarkMessagePartForJmr,{mids:[a.mpMid],isBulk:false,jmrType:a.jmrType});if(HM.JmrType.Unsubscribe==a.jmrType||HM.JmrType.Junk==a.jmrType||HM.JmrType.Phish==a.jmrType)InboxPage.Config.hasSeenReportUi=true;if(a.fetchConversation){var c=b.MessagePartData;for(var d in c){if(FunctionHelper.isSpecialMember(c,d))continue;var f=c[d],e=this._msgParts[d];e.setPartData(false,f);e.hideHistory();e.invalidateFullBody()}this._insertIdentityContext(b.IdentityContext)}if(HM.JmrType.Junk==a.jmrType||HM.JmrType.Phish==a.jmrType||HM.JmrType.NotJunk==a.jmrType&&a.mpFid==InboxPage.Config.sysFldrs.junkFid)this._removeMessagePartFromUi(a.mpMid);InboxServices.Events.endmarkmessagepartforjmr.fire([b]);LoadingIndicator.hide()};__p.addContactFromMessagePart=function ReadingPane$addContactFromMessagePart(f){var a=this._msgParts[f];if(1==this._msgPartsArray.length)a.addContact();else{var c=function(b,a){return a.contactEmail==b.contactEmail&&(a.fid!=InboxPage.Config.sysFldrs.junkFid||a.mid!=b.mid)},b=this._getTargetMessagesForReRender(a,c),e=b.startingMid!=null,d=a.getMessageRenderingInfo();InboxServices.addContactFromMessagePart(this.cid,InboxPage.folderList.fid,b.startingMid,b.numParts,e?b.mpMap:{o:"o"},this._msgPartsArray.length,d,a.contactName,a.contactEmail,$CD(this,this._endAddContactFromMessagePart))}};__p._endAddContactFromMessagePart=function ReadingPane$_endAddContactFromMessagePart(a,c){var b=a.MessagePartData;for(var d in b){if(FunctionHelper.isSpecialMember(b,d))continue;var f=b[d],g=this._msgParts[d];this._replaceMessagePartWithHtml(g,f[HM.MessagePartDataType.Message])}var e=a.InfoPaneHtml;if(e)InboxPage.showInfoPane(e);if(c.fid==InboxPage.Config.sysFldrs.junkFid)this._removeMessagePartFromUi(c.mid);else this._msgParts[c.mid].updateHeaderUi(true);this._insertIdentityContext(a.IdentityContext);if(a.RedirectUrl)MessagePart.showDedupUi(function(){MessagePart.handleRedirect(a,true)})};__p._insertIdentityContext=function ReadingPane$_insertIdentityContext(b){if(b){var a=document.createElement("DIV");a.style.display="none";$("msgParts").appendChild(a);$Utility.ajaxInnerHtml(a,b)}};__p._replaceMessagePartWithHtml=function ReadingPane$_replaceMessagePartWithHtml(a,e){if(a.icId)$ic.ic.removeIC(a.icId);var b=document.createElement("DIV");b.style.display="none";$("msgParts").appendChild(b);$Utility.ajaxInnerHtml(b,e);var c=$tag(b,"DIV")[0];$getDescendantByClass(c,"DIV","ReadMsgContainer").style.zIndex=$getDescendantByClass(a.elt,"DIV","ReadMsgContainer").style.zIndex;$("msgParts").replaceChild(c,a.elt);var d=new MessagePart(c);d.updateHeaderUi(a.isExpanded);this._msgParts[a.mid]=d;var f=this._msgPartsArray.indexOf(a);this._msgPartsArray[f]=d;a.elt.innerHTML="";a.dispose();$("msgParts").removeChild(b)};__p.deleteMessagePart=function ReadingPane$deleteMessagePart(d){var b=this._msgParts[d],a=b.getSelectedMessageData();if(1==this._msgPartsArray.length||a.duplicateMsgIds&&a.duplicateMsgIds.length>0)Messages.remove(a);else{InboxPage.postProcData.history=false;var c=InboxPage.createMoveOrJunkActionMessageListRenderingInfo(a,true,false);InboxServices.beginDeleteMessagePart(a.mids[0],a.mads[0],b.fid,c,$CD(this,this._endDeleteMessagePart))}};__p._endDeleteMessagePart=function ReadingPane$_endDeleteMessagePart(a,b){var c=b.mid;InboxServices.preEndUpdateUi(a,InboxServices.Operations.DeleteMessagePart,{mids:[c],isBulk:false});this._removeMessagePartFromUi(c);InboxServices._endUpdateUi(a,b);InboxServices.Events.enddeletemessagepart.fire([a])};__p._removeMessagePartFromUi=function ReadingPane$_removeMessagePartFromUi(b){var a=this._msgParts[b],c=a.isUnreadOnClient();this._msgParts[a.mid]=null;delete this._msgParts[a.mid];this._msgPartsArray.remove(a);a.elt.innerHTML="";$("msgParts").removeChild(a.elt);a.dispose();if(b==this._actionMid)this._actionMid=null;InboxPage.messageList.updateCount(this.getItemId(),this._msgPartsArray.length);this._updateTotalCount();if(c)this._updateUnreadCount()};__p.getUnreadMids=function ReadingPane$getUnreadMids(){var a={};a.unreadMids=[];a.foundDupes=false;this._doForAllMessageParts(function(b){var c=b.getBody();if(b.isMixedReadState&&(!c||c&&!c.vm))if(b.duplicateMsgIds&&b.duplicateMsgIds.length>0){a.foundDupes=true;for(var d=0;d<b.duplicateMsgIds.length;d++)a.unreadMids.push(b.duplicateMsgIds[d])}else{var e=b.mid;a.unreadMids.push(e)}});return a};__p._endMarkMessages=function ReadingPane$_endMarkMessages(b){var h=b[1],g=b[2],f=b[3],e=b[4];if(this.isShowingMessage()){var c;if(g)c=this.getItemId();else{if(!e);c=h[0]}this.updateReadState(c,f);if((this._isConversation||this.secretCid!=null)&&!InboxPage.isSearch()){var d=false;this._doForAllMessageParts(function(a){if(!a.isRead){d=true;return false}});var a=$(this.cid);if(a==null)a=$(this.secretCid);if(null!=a)InboxPage.messageList.updateReadStateByElt(a,!d)}}};__p._endFlagMessages=function ReadingPane$_endFlagMessages(c){var h=c[1],i=c[2],g=c[3],e=c[4];if(this.isShowingMessage()){if(!e);var a=h[0];if((a==this.mid||a==this.cid||a==this.secretCid)&&!this._msgParts[a]&&this._msgPartsArray.length==1)a=this._msgPartsArray[0].mid;var f=this._updateFlaggedState(a,g);if(f&&(this._isConversation||this.secretCid!=null)&&!InboxPage.isSearch()){var d=false;this._doForAllMessageParts(function(a){if(a.isFlagged){d=true;return false}});var b=$(this.cid);if(b==null)b=$(this.secretCid);if(null!=b)InboxPage.messageList.updateFlagStateByElt(b,d)}if(InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)this.updateNextPrevMessageArrows()}};__p.updateReadState=function ReadingPane$updateReadState(b,a){if(this._isConversation&&this.cid==b||this.secretCid!=null)this._doForAllMessageParts(function(b){b.updateReadState(a)});else{var c=this._msgParts[b];if(!c)return;c.updateReadState(a)}this._updateUnreadCount()};__p._updateUnreadCount=function ReadingPane$_updateUnreadCount(){if(this._isConversation){var b=$("unreadCount"),a=0;this._doForAllMessageParts(function(b){if(b.isUnreadOnClient())a++});b.innerText=a+""}};__p._updateTotalCount=function ReadingPane$_updateTotalCount(){if(this._isConversation){var a=$("totalCount");a.innerText=this._msgPartsArray.length+""}};__p._updateFlaggedState=function ReadingPane$_updateFlaggedState(c,a){var b=false;if(this._isConversation&&this.cid==c){if(a)this._msgPartsArray[0].updateFlagState(a);else this._doForAllMessageParts(function(b){b.updateFlagState(a)});b=true}else{var d=this._msgParts[c];if(d){d.updateFlagState(a);b=true}}return b};ReadingPane.downloadAttachment=function ReadingPane$downloadAttachment(a){if(null!=ReadingPane.downloadFrame)ReadingPane.downloadFrame.src=a};ReadingPane._endDownloadAttachment=function ReadingPane$_endDownloadAttachment(){var b=null;try{if(Browser.isIE)b=ReadingPane.downloadFrame.contentWindow.document.parentWindow;else b=ReadingPane.downloadFrame.contentWindow}catch(e){return}if(b){var a={show:b.bShowMessage,block:b.bBlockClient,descr:b.sErrorDescription,yesNo:b.iYesCode,data:b.sData};if(a.show&&a.descr)if(a.block)if(a.yesNo>=0){var d=confirm(a.descr)?a.yesNo:-1;if(15==d&&null!=ReadingPane.downloadFrame)ReadingPane.downloadAttachment(a.data)}else alert(a.descr);else{var c=Infopane.getInstance();c.setContent(a.descr);$css.add(c.elt,"BorderNoTop");c.show()}}};__p.updateLayout=function ReadingPane$updateLayout(){setTimeout($CD(this,this.collapseLayout),1);setTimeout($CD(this,this._maybeExpandLayout),1)};__p._maybeExpandLayout=function ReadingPane$_maybeExpandLayout(){if(this.isAnyWideBodyExpanded())this._expandLayout()};__p._expandLayout=function ReadingPane$_expandLayout(){this._hideWideMessageBars();var a=$("contentRight");if(InboxPage.hasSkyscraper){if($css.has(a,"WithSkyscraper"))$css.remove(a,"WithSkyscraper");if(Browser.isIE6)$("MainContent").className=$("MainContent").className}if("BottomUnmanaged"==Page.getLayout()){$css.add(a,"RightUnmanaged");if(Browser.isIE6)a.style.width=$("MainContent").offsetWidth+"px"}else{InboxPage.showFullReadingPane(true);InboxPage.resetSkyscraperScroll(true);InboxPage.readingPane.focus();InboxToolbar.updateToolbarState()}this.resetMessageWidths();this._doForAllMessageParts(function(a){a.maybeUpdateLiveViewLayout()})};__p.getWideBodyCount=function ReadingPane$getWideBodyCount(){var a=0;this._doForAllMessageParts(function(b){if(b.isExpanded){var c=b.getBody();if(c.isWide)a++}});return a};__p.isAnyWideBodyExpanded=function ReadingPane$_isAnyWideBodyExpanded(){atLeastOneWideBody=false;this._doForAllMessageParts(function(b){if(b.isExpanded){var a=b.getBody();a.calculateWidth();if(a.isWide){atLeastOneWideBody=true;return false}}});return atLeastOneWideBody};__p.collapseLayout=function ReadingPane$collapseLayout(){var a=$("contentRight");if(InboxPage.hasSkyscraper){$css.add(a,"WithSkyscraper");if(Browser.isIE6)$("MainContent").className=$("MainContent").className}if("BottomUnmanaged"==Page.getLayout()){if($css.has(a,"RightUnmanaged"))$css.remove(a,"RightUnmanaged");if(Browser.isIE6)a.style.width="auto"}this._doForAllMessageParts(function(a){a.maybeUpdateLiveViewLayout()})};__p._handleWideLayout=function ReadingPane$_handleWideLayout(){this.collapseLayout();setTimeout($CD(this,this._handleWideLayout2),1)};__p._handleWideLayout2=function ReadingPage$_handleWideLayout2(){var b=0;this._doForAllMessageParts(function(d){if(d.isExpanded){var c=d.getBody();c.calculateWidth();if(c.isWide){var a=c._getIndexedElementById("readMsgBodyContainer");if(a&&a.scrollWidth>b)b=a.scrollWidth}}});this._unhideWideMessageBars();var c=this.isAnyWideBodyExpanded(),e=Browser.isSF?document.body:$tag(document,"HTML")[0],a=parseInt(InboxPage.Config.readingPane.unmanagedAutoExpandMessageAtWidth);a=isNaN(a)||a<0?-1:a;var g="BottomUnmanaged"==Page.getLayout(),d=this.isFullView&&c&&(g&&(a==-1||e.offsetWidth<a)||!InboxPage.hasSkyscraper);if(this.doubleClicked){this.doubleClicked=false;d=true}if(d){var f=$("contentRight");if(f.offsetWidth-(Browser.isIE6?b+35:b)<160)InboxPage.postProcData.ads=false;if(Browser.isIE6)setTimeout($CD(this,this._expandLayout),0);else this._expandLayout()}else if(c&&this.isFullView)this._doForAllMessageParts(function(b){if(b.isExpanded){var a=b.getBody();if(a.isWide&&!a.safetyBarLinkExpands)a.showWideMsgBar()}});InboxPage.callDelayedBsi()};__p._hideWideMessageBars=function ReadingPane$_hideWideMessageBars(){var a=$("contentRight");$css.add(a,"HideWideMessageBars")};__p._unhideWideMessageBars=function ReadingPane$_unhideWideMessageBars(){var a=$("contentRight");if($css.has(a,"HideWideMessageBars"))$css.remove(a,"HideWideMessageBars")};__p._onShowFullClick=function ReadingPane$_onShowFullClick(){var a=InboxPage.postProcData;a.ads=false;a.history=false;this._expandLayout()};__p.resetMessageWidths=function ReadingPane$resetMessageWidths(){if("BottomUnmanaged"!=Page.getLayout())this._doForAllMessageParts(function(a){a.resetWidth()})};__p.onCloseClick=function ReadingPane$onCloseClick(){var a=InboxPage.postProcData;a.history=false;InboxPage.showFullReadingPane(false);setTimeout(InboxToolbar.updateToolbarState,1)};__p.onFullViewClick=function ReadingPane$onFullViewClick(){var a=InboxPage.postProcData;a.ads=false;a.history=false;this._expandLayout()};__p.showFullView=function ReadingPane$showFullView(){if(this.isFullView)return;var a=$("readingPaneSplitPane");if("Bottom"==InboxPage.Config.readingPane.location){a._oldTop=a.style.top;a.style.top=null}else if("Right"==InboxPage.Config.readingPane.location){a._oldLeft=a.style[Loc.LEFT];a.style[Loc.LEFT]=null}InboxPage._onResize(null,false,true);$updateClass(a,["ReadingPaneSplitPaneFull"],["ReadingPaneSplitPaneRight","ReadingPaneSplitPaneBottom","ReadingPaneSplitPaneHidden"]);$css.add($("mainContentContainer"),"ReadMsgMode");this.isFullView=true;if(InboxPage.messageList.hasFocus())this.focus(true);this.resetMessageWidths()};__p.hideFullView=function ReadingPane$hideFullView(){if(!this.isFullView)return;this.collapseLayout();var b=InboxPage.Config.readingPane.location,a=$("readingPaneSplitPane");if("Bottom"==b){a.style.top=a._oldTop;a.style._oldTop=null;$updateClass(a,["ReadingPaneSplitPaneBottom"],["ReadingPaneSplitPaneFull"])}else if("Right"==b){a.style[Loc.LEFT]=a._oldLeft;a.style._oldLeft=null;$updateClass(a,["ReadingPaneSplitPaneRight"],["ReadingPaneSplitPaneFull"])}else $css.add(a,"ReadingPaneSplitPaneHidden");InboxPage._onResize(null,$getDisplay($("searchPane")));$css.remove($("mainContentContainer"),"ReadMsgMode");this.isFullView=false;if(this.hasFocus())setTimeout($CD(InboxPage.messageList,InboxPage.messageList.focus),1);this.resetMessageWidths()};__p.isShowingMessage=function ReadingPane$isShowingMessage(){return this.mode==ReadingPane.MESSAGE_MODE&&(InboxPage.isReadingPaneOn||this.isFullView)};ReadingPane.doDelayLoad=function ReadingPane$doDelayLoad(b){var a;if(b._isConversation){a=InboxPage.createConversationRenderingInfo(false);a.ConversationId=b._delayedId}else{var d=b._delayedId,c;a=InboxPage.createMessageRenderingInfo();a.MessageId=d;c=MessageList.getSenderEmailsFromMids([d]);if(c.length>0)a.SenderEmail=c[0]}a.FolderId=InboxPage.folderList.fid;InboxPage.beginRefreshInbox(false,false,null,true,a,false,b._isConversation,null,null,false,{notByUser:true})};__p.hasFocus=__p.focus=function ReadingPane$emptyFunction(){};__p.showTaggingInfo=function ReadingPane$showTaggingInfo(a){InboxPage.postProcData.ads=false;var e=a[0],f=a[1],d=a[2],c=a[3],b;$BSI.reportEvent("ReadView.Messaging.Mail.tagInfo");b=$(c)!=null?FolderQuickViewListHelper.getFolderNameByFid(c):"";_TT(e,d,f.format(b))};ReadingPane.createClass("ReadingPane");function MessagePart(a){Control.create(this,a);this._actions=new MessagePartActions(this);this._setStateFromDom();this._toolbar=new Toolbar(this._getIndexedElementById("header"),this._actions.getToolbarCallback());this._toolbar.registerOnIgnoreHandler(MessagePartActions.ignoreCallback);this._toolbar.setIgnoreActions(["editContact","moreActions"])}MessagePart.readClass="Read";MessagePart.unreadClass="Unread";MessagePart.expandedClass="Expanded";MessagePart.collapsedClass="Collapsed";MessagePart.hideShadows="HideShadows";MessagePart.fullClass="FullPart";MessagePart.singleClass="SinglePart";MessagePart.hoverZIndex=500;MessagePart.focusZIndex=600;__p=MessagePart.prototype={};__p.dispose=function MessagePart$dispose(){if(this._body)this._body.dispose();if(this._fullBody)this._fullBody.dispose();if(this._toolbar)this._toolbar.dispose();if(this._actions)this._actions.dispose();if(this._container){this._container.detachEvent("onmouseover",this._onHoverDelegate);this._container.detachEvent("onmouseout",this._onOutDelegate);this._container.detachEvent("onfocus",this._onFocusDelegate);this._container.detachEvent("onblur",this._onBlurDelegate);this._container.detachEvent("onfocusin",this._onFocusDelegate);this._container.detachEvent("onfocusout",this._onBlurDelegate)}this._body=this._fullBody=this._toolbar=this._actions=this._container=null;Control.destroy(this)};__p._setStateFromDom=function MessagePart$_setStateFromDom(){var a=this.elt;this._containerDiv=a.children[0];this._container=a.children[0].children[0];this.idx=parseInt(a.getAttribute("idx"));this.pfx=a.getAttribute("pfx");this.mid=a.getAttribute("mid");this.fid=a.getAttribute("fid");this.ps=a.getAttribute("ps");this.contactEmail=a.getAttribute("ca");this.contactName=a.getAttribute("cn");this._hasBody=a.getAttribute("hb");this._hasFullBody=a.getAttribute("hfb");this._isFullBody=a.getAttribute("fb");this.isExpanded=a.getAttribute("ex");this.isFlagged=a.getAttribute("flg");this.isMixedReadState=a.getAttribute("nr");this.auxData=a.getAttribute("mad");this.isDraft=a.getAttribute("dr");this.categories=a.getAttribute("ci");this.icId=a.getAttribute("ic");this.isSenderInContactList=a.getAttribute("ab");this.isSenderInWhiteList=a.getAttribute("wl");this.isCollapsible=a.getAttribute("cl");var d=a.getAttribute("ci");if(d)this.categories=d.split(",");else this.categories=[];var c=a.getAttribute("ids");if(c)this.duplicateMsgIds=c.split(",");else this.duplicateMsgIds=[];var f=this._getIndexedElementById("msgPartBody"),e=this._getIndexedElementById("msgPartFullBody"),b={idx:this.idx,mid:this.mid,duplicateMsgIds:this.duplicateMsgIds,auxData:this.auxData,actions:this._actions,contactEmail:this.contactEmail};this._body=new MessagePartBody(f,b,$CD(this,this._beginGetBodyHtml),!this._isFullBody&&this.isExpanded);this._fullBody=new MessagePartBody(e,b,$CD(this,this._beginGetFullBodyHtml),this._isFullBody&&this.isExpanded);this.resetWidth();this.isRead=false;this._onHoverDelegate=$CD(this,this._onHover);this._onOutDelegate=$CD(this,this._onOut);this._onFocusDelegate=$CD(this,this._onFocus);this._onBlurDelegate=$CD(this,this._onBlur);this._container.attachEvent("onmouseover",this._onHoverDelegate);this._container.attachEvent("onmouseout",this._onOutDelegate);this._container.attachEvent("onfocus",this._onFocusDelegate);this._container.attachEvent("onblur",this._onBlurDelegate);this._container.attachEvent("onfocusin",this._onFocusDelegate);this._container.attachEvent("onfocusout",this._onBlurDelegate)};__p.getBody=function MessagePart$getBody(){var a=null;if(this.hasAnyBody())a=this._isFullBody?this._fullBody:this._body;return a};__p.hasAnyBody=function MessagePart$hasAnyBody(){return this._hasBody||this._hasFullBody};__p.invalidateFullBody=function MessagePart$invalidateFullBody(){this._hasFullBody=false};__p._beginGetBodyHtml=function MessagePart$_beginGetBodyHtml(a){var b=$CD(this,this._endGetBodyHtml);InboxServices.beginGetSingleMessagePart(InboxPage.readingPane.cid,this.fid,a,this.idx,!InboxPage.readingPane.ulr,b)};__p._beginGetFullBodyHtml=function MessagePart$_beginGetFullBodyHtml(a){var b=$CD(this,this._endGetFullBodyHtml);InboxServices.beginGetFullMessagePart(a,this.idx,!InboxPage.readingPane.ulr,b)};__p.setPartData=function MessagePart$setPartData(b,a){if(a[HM.MessagePartDataType.ToList])this.setRecipientList(a[HM.MessagePartDataType.ToList]);if(a[HM.MessagePartDataType.Body])this.setBodyHtml(b,a[HM.MessagePartDataType.Body])};__p._endGetBodyHtml=function MessagePart$_endGetBodyHtml(b,a,d){if(a&&a.mayRedirect)MessagePart.handleRedirect(b);var e=b.MessagePartData,c=e[this.mid];this.setPartData(d,c);LoadingIndicator.hide()};__p._endGetFullBodyHtml=function MessagePart$_endGetFullBodyHtml(b,a){this._endGetBodyHtml(b,a,true);LoadingIndicator.hide()};MessagePart.handleRedirect=function MessagePart$handleRedirect(a,b){if(null!=a.RedirectUrl&&""!=a.RedirectUrl){InboxPage.doPostProc=false;var c=b?window.top:window;c.location.href=a.RedirectUrl;return}};__p.setBodyHtml=function MessagePart$setBodyHtml(d,b){if(d){this._fullBody.setHTML(b);this._hasFullBody=true}else{this._body.setHTML(b);this._hasBody=true;var a=this._getIndexedElementById("aph");if(a&&!a.innerHTML){var c=this._getIndexedElementById("act");if(c)a.appendChild(c)}}if(this.isExpanded)this._wireUpLiveViews();this._maybeUpdateLayout();this.resetWidth()};__p.setRecipientList=function MessagePart$setRecipientList(a){this._getIndexedElementById("recip").innerHTML=a};__p.getSelectedMessageData=function MessagePart$getSelectedMessageData(){return MessageList.createSelectedMessageData(false,[this.mid],[InboxPage.createMessageAuxData(this.auxData)],this.duplicateMsgIds)};__p._getIndexedElementById=function MessagePart$_getIndexedElementById(a){return $([this.pfx,a].join(""))};__p._getDefaultMessageRenderingInfo=function MessagePart$_getDefaultMessageRenderingInfo(){var a=InboxPage.createMessageRenderingInfo();a.MessageId=this.mid;a.FolderId=this.fid;a.AuxData=InboxPage.createMessageAuxData(this.auxData);a.SenderEmail=this.contactEmail;return a};__p.getMessageRenderingInfo=function MessagePart$getMessageRenderingInfo(){return this.hasAnyBody()?this.getBody().createMessageRenderingInfo():this._getDefaultMessageRenderingInfo()};__p.resetWidth=function MessagePart$resetWidth(){if("BottomUnmanaged"!=Page.getLayout()){var b=this._container,a=this._getIndexedElementById("ctr");if(null!=a){b.style.width="auto";a.style.width="auto";if(this.hasAnyBody()&&this.isExpanded){var c=this.getBody().getMsgContainer();if(c&&c.scrollWidth>b.offsetWidth){a.style.width=a.offsetWidth+"px";b.style.width=c.scrollWidth+24+"px"}}}}};__p.showHistory=function MessagePart$showHistory(){if(!this._hasFullBody){var a=InboxPage.createMessageRenderingInfo();a.SenderEmail=this.contactEmail;a.MessageId=this.mid;a.FolderId=this.fid;a.AuxData=InboxPage.createMessageAuxData(this.auxData);InboxServices.beginGetFullMessagePart(a,this.idx,!InboxPage.readingPane.ulr,$CD(this,this._endShowHistory))}else this._updateHistoryUi(true)};__p.hideHistory=function MessagePart$hideHistory(){this._updateHistoryUi(false)};__p._endShowHistory=function MessagePart$_endShowHistory(a){this._endGetFullBodyHtml(a);this._updateHistoryUi(true)};__p._updateHistoryUi=function MessagePart$_updateHistoryUi(a){if(a&&this._isFullBody||!a&&!this._isFullBody)return;this._isFullBody=a;$replaceClass(this._container,a?MessagePart.singleClass:MessagePart.fullClass,a?MessagePart.fullClass:MessagePart.singleClass);if(this.isExpanded)this._wireUpLiveViews();this._maybeUpdateLayout()};__p.toggleDetails=function MessagePart$toggleDetails(){var a=$css.has(this._container,"HideH");this.setDetailsDisplay(a);return a};__p.setDetailsDisplay=function MessagePart$setDetailsDisplay(a){$css&&$css.swap(this._container,a?"HideH":"ShowH",a?"ShowH":"HideH");var b=this.getBody();b.setDetailsDisplay(a);if(Browser.isIE&&$css.has(this._container,MessagePart.unreadClass)){$replaceClass(this._container,MessagePart.unreadClass,MessagePart.readClass);$replaceClass(this._container,MessagePart.readClass,MessagePart.unreadClass)}};__p.getActionsHandler=function MessagePart$getActionsHandler(){return this._actions};__p.getBsiData=function MessagePart$getBsiData(a){if(typeof a!="object")a={};a.msgIndex=InboxPage.readingPane.numMessageParts()>1?this.idx+1:this.idx;return a};__p.updateReadState=function MessagePart$updateReadState(a){if(a&&this.isUnreadOnClient())$replaceClass(this._container,MessagePart.unreadClass,MessagePart.readClass);else if(!a&&this.isRead)$replaceClass(this._container,MessagePart.readClass,MessagePart.unreadClass);this.isMixedReadState=false;this.isRead=a};__p.isUnreadOnClient=function MessagePart$isUnreadOnClient(){return !this.isRead||this.isMixedReadState};__p.updateFlagState=function MessagePart$updateFlagState(b){if(this.isFlagged!=b){this.isFlagged=b;InboxActions.setFlagIcon(this.elt,b);var a=InboxPage.Config.quickViews.flaggedQvid+"";if(b){if(!this.categories.contains(a))this.categories.push(a)}else if(this.categories.contains(a))this.categories.remove(a)}};__p.updateDateStamp=function MessagePart$updateDateStamp(b){var a=this._getIndexedElementById("Date");if(a)a.innerHTML=b};__p.toggleHeader=function MessagePart$toggleHeader(){if(this.isCollapsible)if(this.isExpanded)this._collapse();else this._expand();InboxPage.postProcData.ads=false;InboxPage.postProcData.history=false};__p._expand=function MessagePart$_expand(){$BSI.reportEvent("mp.exp",this.getBsiData());this.loadBody($CD(this,function(){this.updateHeaderUi(true)}))};__p.loadBody=function MessagePart$loadBody(a){a=typeof a=="function"?a:function(){};var c=$CD(this,function(c,b){this._endGetBodyHtml(c,b);a()});if(!this.hasAnyBody()){var b=this._getDefaultMessageRenderingInfo();Page.setPerformanceId("RMP");InboxServices.beginGetSingleMessagePart(InboxPage.readingPane.cid,this.fid,b,this.idx,!InboxPage.readingPane.ulr,c);return false}else return a()};__p._collapse=function MessagePart$_collapse(){if(InboxPage.readingPane.isFullView&&this.getBody().isWide&&1==InboxPage.readingPane.getWideBodyCount())InboxPage.readingPane.collapseLayout();this.updateHeaderUi(false);$BSI.reportEvent("mp.cls",this.getBsiData())};__p.updateHeaderUi=function MessagePart$updateHeaderUi(a){if(a&&this.isExpanded||!a&&!this.isExpanded)return;this.isExpanded=a;$replaceClass(this._containerDiv,a?MessagePart.collapsedClass:MessagePart.expandedClass,a?MessagePart.expandedClass:MessagePart.collapsedClass);if(a)this._wireUpLiveViews();this._maybeUpdateLayout();this.resetWidth()};__p._wireUpLiveViews=function MessagePart$_wireUpLiveViews(){if(this.hasAnyBody())this.getBody().wireUpLiveViews()};__p._maybeUpdateLayout=function MessagePart$_maybeUpdateLayout(){this._maybeUpdateReadingPaneLayout();this.maybeUpdateLiveViewLayout()};__p._maybeUpdateReadingPaneLayout=function MessagePart$_maybeUpdateReadingPaneLayout(){if(InboxPage.readingPane.isFullView)InboxPage.readingPane.updateLayout()};__p.maybeUpdateLiveViewLayout=function MessagePart$maybeUpdateLiveViewLayout(){if(this.hasAnyBody())this.getBody().maybeUpdateLiveViewLayout()};__p._onMarkAsSafe=function MessagePart$_onMarkAsSafe(){Page.setPerformanceId("MS");InboxPage.readingPane.markMessagePartAsNotJunk(this.mid,false)};__p._onMarkAsUnsafe=function MessagePart$_onMarkAsUnsafe(){Page.setPerformanceId("MU");InboxPage.readingPane.markMessagePartAsJunk(this.mid,false)};__p._onUnsubscribe=function MessagePartBody$_onUnsubscribe(){InboxPage.readingPane.markMessagePartAsUnsubscribe(this.mid)};__p.markAsSafe=function MessagePart$markAsSafe(b){var a=this.getBody().createMessageRenderingInfo();a.AuxData=null;Safety.markAsNotJunk(this.getSelectedMessageData(),InboxPage.folderList.fid,a,b)};__p.markAsUnsafe=function MessagePart$markAsUnsafe(d,c){var a=this.getSelectedMessageData(),b=InboxPage.folderList.fid;if(b!=InboxPage.Config.sysFldrs.junkFid)if(d)Safety.markAsPhish(a,b);else Safety.markAsJunk(a,b,c,false);else Messages.remove(a)};__p.unsubscribe=function MessagePartBody$unsubscribe(){var b=this.getRemoveOption(),a=this.getBody().createMessageRenderingInfo();a.AuxData=null;Safety.markAsUnsubscribe(this.getSelectedMessageData(),InboxPage.folderList.fid,this.getBody().unsubscribeUrl,a,b)};__p.getRemoveOption=function MessagePartBody$getRemoveOption(){var a=HM.RemoveSenderFromListOption.None;if(this.isSenderInContactList)a=HM.RemoveSenderFromListOption.RemoveContact;else if(this.isSenderInWhiteList)a=HM.RemoveSenderFromListOption.RemoveSafeSender;return a};__p.addContact=function MessagePart$addContact(){InboxPage.postProcData.history=false;var b=this.getMessageRenderingInfo(),a=this.fid==InboxPage.Config.sysFldrs.junkFid?InboxPage.createMoveOrJunkActionMessageListRenderingInfo(this.getSelectedMessageData(),false,true):null;InboxServices.addContactFromMessage(b,a,this.contactName,this.contactEmail,$CD(this,this._endAddContact))};__p._endAddContact=function MessagePart$_endOnAddContact(a,b){InboxServices.Events.endupdateui.fire([a,false,b]);if(a.RedirectUrl)MessagePart.showDedupUi(function(){MessagePart.handleRedirect(a,true)});InboxPage.messageList.dirtyMads[this.mid]=true};MessagePart.showDedupUi=function MessagePart$showDedupUi(c){var d=function(d,a){if(1==a)c()},a=DemandLoadHandler.getContent(HM.ContentId.ReadMessageAddContact),b=new Alert(Alert.Importance.none,a.Title,String.format("<div {0}>{1}</div>",a.Sutra,a.Message),true,null);b.addButton(a.ActionButton,1,true,false);b.addButton(a.Cancel,0,false,true);b.setCallback(d);gShowAlert(b)};__p._setShadows=function MessagePart$_setShadows(c){var b=this._container,a=MessagePart.hideShadows;if(c){if($css.has(b,a))$css.remove(b,a)}else $css.add(b,a)};__p._resetZIndex=function MessagePart$_resetZIndex(){var a=this._container;if(this._isFocusOn)a.style.zIndex=MessagePart.focusZIndex;else if(this._isHoverOn)a.style.zIndex=MessagePart.hoverZIndex;else a.style.zIndex=1};__p._handleFocusEvent=function MessagePart$_handleFocusEvent(a){this._setShadows(a);this._resetZIndex()};__p._onHover=function MessagePart$_onHover(){this._isHoverOn=true;this._handleFocusEvent(true)};__p._onOut=function MessagePart$_onOut(){this._isHoverOn=false;this._handleFocusEvent(false)};__p._onFocus=function MessagePart$_onFocus(){this._isFocusOn=true;this._handleFocusEvent(true)};__p._onBlur=function MessagePart$_onBlur(){this._isFocusOn=false;this._handleFocusEvent(false)};MessagePart.createClass("MessagePart");function MessagePartBody(e,d,b,c){Control.create(this,e);this._getBodyDelegate=b;this._setStateFromMsgPart(d);this._setStateFromDom();this.isWide=false;var a=this._getIndexedElementById("safetyBar");this.safetyBarLinkExpands=a&&a.getAttribute("expands");if(c)this.wireUpLiveViews();if(this.isSbd)Infopane.forceHide()}__p=MessagePartBody.prototype={};__p.dispose=function MessagePartBody$dispose(){this._disposeLiveViews();if(this._detailsElt){this._detailsElt.detachEvent("onmouseover",this._detailsHover);this._detailsElt.detachEvent("onmouseout",this._detailsOut);this._detailsElt.detachEvent("onfocus",this._detailsHover);this._detailsElt.detachEvent("onblur",this._detailsOut)}if(this._toolbar){this._toolbar.dispose();this._actions=null}Control.destroy(this)};__p._disposeLiveViews=function MessagePartBody$_disposeLiveViews(){if(this.hmlvContainer){this.hmlvContainer.dispose();this.hmlvContainer=null}if(this.elvData)this.elvData.forEach(function(a){if(a&&a.binding){LiveViews.detachElvControlHandlers(a.binding);a.binding.dispose();a.binding=null}},null)};__p._setStateFromMsgPart=function MessagePartBody$_setStateFromMsgPart(a){this.idx=a.idx;this.mid=a.mid;this.auxData=a.auxData;this._actions=a.actions;this.contactEmail=a.contactEmail};__p._setStateFromDom=function MessagePartBody$_setStateFromDom(){var b=$tag(this.elt,"div");if(null==b||b.length==0)return;var a=b[0];this.pfx=a.getAttribute("pfx");this.showUnsafe=a.getAttribute("su")!=null;var c=a.getAttribute("cpo");this.codePageOverride=null!=c?c:-1;this.vm=a.getAttribute("vm");this.vop=a.getAttribute("vop");this.safety=a.getAttribute("sf");this.isSafe="s"==a.getAttribute("sf");this.replyForwardUrl=a.getAttribute("rfu");this.replyAction=a.getAttribute("ra");this.replyAllAction=a.getAttribute("raa");this.forwardAction=a.getAttribute("fa");this.warnOnReplyForward=null!=a.getAttribute("wrf");this.unsubscribeUrl=a.getAttribute("uu");this.isSvm=a.getAttribute("svm");this.isSbd=a.getAttribute("sbd");this.isPsaDown=a.getAttribute("psa")!=null;this.hasHmlv=a.getAttribute("hmlv")!=null;this.hasElv=a.getAttribute("elv")!=null;this.elvData=this._generateExternalLiveViewsData(a.getAttribute("elv"));if(a.getAttribute("ulr")&&InboxPage["readingPane"])InboxPage.readingPane.ulr=true;this._toolbar=new Toolbar(this._getIndexedElementById("bodyHdr"),this._actions.getToolbarCallback());this._toolbar.registerOnIgnoreHandler(MessagePartActions.ignoreCallback);this._toolbar.setIgnoreActions(["moreActions","draftMessage"]);this._detailsElt=this._getIndexedElementById("details");this._detailsHover=$CD(this,this._onDetailsHover);this._detailsOut=$CD(this,this._onDetailsOut);this._detailsElt.attachEvent("onmouseover",this._detailsHover);this._detailsElt.attachEvent("onmouseout",this._detailsOut);this._detailsElt.attachEvent("onfocus",this._detailsHover);this._detailsElt.attachEvent("onblur",this._detailsOut)};__p.setHTML=function MessagePartBody$setHTML(a){this._disposeLiveViews();try{this.elt.innerHTML=a}catch(b){this.elt.innerHTML=a.replace(/<p.*>/gi,"<br/>")}this._setStateFromDom();this._isWidthCalculated=false};__p.createMessageRenderingInfo=function MessagePartBody$createMessageRenderingInfo(){var a=new HM.MessageRenderingInfo;a.MessageId=this.mid;a.FolderId=InboxPage.folderList.fid;a.AllowUnsafeContent=this.showUnsafe;a.OverrideCodepage=this.codePageOverride;a.AuxData=InboxPage.createMessageAuxData(this.auxData);a.MarkAsRead=true;a.SenderEmail=this.contactEmail;return a};__p._getIndexedElementById=function MessagePartBody$_getIndexedElementById(a){return $([this.pfx,a].join(""))};__p.calculateWidth=function MessagePartBody$calculateWidth(){if(this._isWidthCalculated)return;var d=$("contentRight"),c=$("RadAd_Skyscraper"),f=c?c.offsetWidth:0,e="BottomUnmanaged"==Page.getLayout(),a=this._getIndexedElementById("readMsgBodyContainer"),b=$("readingPaneContainer"),g=a?a.scrollWidth+a.offsetWidth:0;this.isWide=Browser.isIE6&&e?a&&a.scrollWidth+35>d.offsetWidth-f:a&&b&&a.scrollWidth>b.offsetWidth;this._isWidthCalculated=true};__p.showWideMsgBar=function MessagePartBody$showWideMsgBar(){var a=this._getIndexedElementById("wideMsgBarPlaceholder");if(null==a.innerHTML||""==a.innerHTML)a.innerHTML=$("wideMsgBar").innerHTML};__p.getMsgContainer=function MessagePartBody$getMsgContainer(){return this._getIndexedElementById("MsgContainer")};__p._onBodyClick=function MessagePartBody$_onBodyClick(){var a=false;if(this._isSvmLinkClick()){var b=InboxPage.createMessageListRenderingInfo(true),c=event.srcElement.href;InboxPage.configureAutoSelect(b);InboxServices.beginSvmFeedback(c,this.createMessageRenderingInfo(),b);event.returnValue=false;event.cancelBubble=true;a=true}if(this._isDocumentLinkClick())event.srcElement.href=String.format("{0}&msgId={1}",event.srcElement.href,this.mid);if(!a)InboxPage.doPostProc=false;return !a};__p._isSvmLinkClick=function MessagePartBody$_isSvmLink(){var a=false;if(this.isSvm&&"A"==event.srcElement.tagName){var b=event.srcElement.href;if(b&&b.match("cgi-bin/feedback"))a=true}return a};__p._isDocumentLinkClick=function MessagePartBody$_isDocumentLinkClick(){var a=false;if("A"==event.srcElement.tagName){var b=event.srcElement.getAttribute("type");if(b&&"DocLink"==b){var c=event.srcElement.href,d=c.substr(c.indexOf(".")+1);if(d.indexOf(InboxPage.Config.skyDriveResourceUrlPart)==0)a=true}}return a};__p._getDownloadUrl=function MessagePartBody$_getDownloadUrl(a){var b="";if(a){var e=a.getAttribute("aIdx"),d=a.getAttribute("aDepth"),c=a.getAttribute("entryPt");b=this._getDownloadUrlFromParams(e,d,c)}return b};__p._getDownloadUrlFromParams=function MessagePartBody$_getDownloadUrlFromParams(c,e,b,d){var a="";if(null!=c&&""!=c)a=String.format("ScanAttachment.aspx?messageid={0}&attindex={1}&cp={2}&attdepth={3}",this.mid,c,this.codePageOverride,e);if(null!=b&&""!=b)a=String.format("{0}&entryPt={1}",a,b);if(d)a=String.format("{0}//{1}/mail/{2}",window.location.protocol,window.location.hostname,a);return a};__p._getOfficePreviewUrl=function MessagePartBody$_getOfficePreviewUrl(a){var b="";if(a){var d=a.getAttribute("aIdx"),c=a.getAttribute("aDepth");b=this._getOfficePreviewUrlFromParams(d,c)}return b};__p._getOfficePreviewUrlFromParams=function MessagePartBody$_getOfficePreviewUrlFromParams(c,b){var a="";if(c&&b){a=String.format("ViewOfficePreview.aspx?messageid={0}&folderid={1}&attindex={2}&cp={3}&attdepth={4}&n={5}",this.mid,InboxPage.folderList.fid,c,this.codePageOverride,b.encodeUrl(),Page.queryString.newNonce);if(Browser.isIE6)a=String.format("BrowserSupport.aspx?targetUrl={0}",a.encodeUrl())}return a};__p._onAttachmentClick=function MessagePartBody$_onAttachmentClick(){var a=Control.getAncestorByAttr(event.srcElement,"aIdx");InboxPage.doPostProc=false;if(null!=a){var e=a.getAttribute("aIdx"),d=a.getAttribute("aDepth"),g=a.getAttribute("wacScenario")=="View";if(InboxPage.allowAction("downloadOrPreviewAttachment",[this.mid,e,d].join("|")))if(g){var b=this._getOfficePreviewUrlFromParams(e,d);if(b)if(event.shiftKey||event.ctrlKey){window.open(b);event.returnValue=false;event.cancelBubble=true;return false}else if(InboxPage.Config.isPfDown)window.location.href=b;else top.getUiFrame().src=b}else{var h=a.getAttribute("entryPt"),c=this._getDownloadUrlFromParams(e,d,h);if(c){var f=a.getAttribute("aNewWin");if(f)window.open(c);else ReadingPane.downloadAttachment(c)}}}};__p.setDetailsDisplay=function MessagePartBody$setDetailsDisplay(b){var a=this._getIndexedElementById("details");if(a)a.title=Page.decode(b?InboxPage.Strings.hideDetails:InboxPage.Strings.showDetails)};__p._getSelectedMessageData=function MessagePartBody$_getSelectedMessageData(){return MessageList.createSelectedMessageData(false,[this.mid],[InboxPage.createMessageAuxData(this.auxData)])};__p._onOpenBody=function MessagePartBody$_onOpenBody(){InboxPage.postProcData.history=false;this._openMessage(false)};__p._onShowUnsafe=function MessagePartBody$_onShowUnsafe(){this._showUnsafe()};__p._onMarkAsSafe=function MessagePartBody$_onMarkAsSafe(){this._actions.markAsNotJunk(true)};function onClickUnsafeLink(a){Control.invoke("MessagePartBody","_onClickUnsafeLink",a)}__p._onClickUnsafeLink=function MessagePartBody$_onClickUnsafeLink(){if(this._isSvmLinkClick())return;var a=event;a.cancelBubble=true;if(confirm(Page.decode(InboxPage.Strings.unsafeLinkQuestion)))this._showUnsafe();else{a.returnValue=false;InboxPage.doPostProc=false}};__p._showUnsafe=function MessagePartBody$_showUnsafe(){InboxPage.postProcData.history=false;this._openMessage(true)};__p._openMessage=function MessagePartBody$_openMessage(d,b,c){var a=this.createMessageRenderingInfo();a.AllowUnsafeContent=d;if(b)a.OverrideCodepage=b;if(c)a.MtLang=c;this._getBodyDelegate(a)};__p._onSelectMenu=function MessagePartBody$_onSelectMenu(){if(event.keyCode==13||event.keyCode!=38&&event.keyCode!=40&&event.keyCode!=9){var b=this.codePageOverride,c="",a=event.srcElement.value;if(null==a||""==a){InboxPage.doPostProc=false;return true}if(event.srcElement.name=="CP")b=a;else if(event.srcElement.name=="MT")c=a;InboxPage.postProcData.history=false;this._openMessage(this.showUnsafe,b,c)}};__p._onDeleteVMFromPhone=function MessagePartBody$_onDeleteVMFromPhone(){this._changeVMSafetyBar(false);InboxPage.messageList.removeVMOnPhoneStatus();InboxServices.deleteVMFromPhone(this.mid)};__p._onMarkVMFAsSaved=function MessagePartBody$_onMarkVMFAsSaved(){this._changeVMSafetyBar(true);InboxServices.markVMAsSaved(this.mid)};__p._changeVMSafetyBar=function MessagePartBody$_changeSafetyBar(c){var a=this._getIndexedElementById("safetyBar");if(!a)return;a=$tag(a,"SPAN")[0];var b=$tag(a,"SPAN");$css.add(b[0],"DisplayNone");$css.remove(b[c?1:2],"DisplayNone");$css.add(b[!c?1:2],"DisplayNone");$css.add(b[3],"DisplayNone");var d=$tag(a,"A");if(c)$css.add(d[1],"DisplayNone");else{$css.add(d[0],"DisplayNone");$css.add(d[1],"DisplayNone")}};__p.wireUpLiveViews=function MessagePartBody$wireUpLiveViews(){if(this.hasHmlv&&!this.hmlvContainer){var a=this._getIndexedElementById("hmlvControl");if(a)this.hmlvContainer=new LiveViewContainerControl(a)}if(this.hasElv)this.wireUpExternalLiveViews()};__p.maybeUpdateLiveViewLayout=function MessagePartBody$maybeUpdateLiveViewLayout(){if(this.hasHmlv&&this.hmlvContainer)this.hmlvContainer.updateLayout()};__p._generateExternalLiveViewsData=function MessagePartBody$_generateExternalLiveViewsData(data){var elvData=null;if(this.hasElv){var expandoData=eval(data);elvData=[];if(expandoData)for(var i=0;i<expandoData.length;i++){var currentExpando=expandoData[i],elv={tag:currentExpando[0],id:currentExpando[1],provider:currentExpando[2],url:currentExpando[3],lvh:currentExpando[4],auth:currentExpando[5],authParam:currentExpando[6]};elvData.push(elv)}}return elvData};__p.wireUpExternalLiveViews=function MessagePartBody$wireUpExternalLiveViews(f){LiveViews.isPsaDown=this.isPsaDown;var c=this.elvData;if(c&&c.length>0)for(var d=0;d<c.length;d++)if(!c[d]["registered"]||f){this.setLiveViewsProgressBarDisplay(true);var a=c[d],b=new HM.SandboxRequest,e=a.binding;if(e){LiveViews.detachElvControlHandlers(e);e.dispose();a.binding=null}b.ID=a.id+"__"+ ++LiveViews.ElvIdSeed;b.Uri=a.url;b.Provider=a.provider;b.AuthOption=HM.SandboxAuthenticationOption[a.auth];b.AuthParam=a.authParam;a.registered=true;LiveViews.registerElv(b,a)}};__p.setLiveViewsProgressBarDisplay=function MessagePartBody$setLiveViewsProgressBarDisplay(a){$setDisplay(this._getIndexedElementById("elvProgress"),a)};__p.setLiveViewsInfoPaneDisplay=function MessagePartBody$setLiveViewsInfoPaneDisplay(a){this._setIndexElementDisplay("elvInfoPane",a)};__p.setLiveViewsAuthInfoPaneDisplay=function MessagePartBody$setLiveViewsAuthInfoPaneDisplay(a){this._setIndexElementDisplay("elvAuthInfoPane",a)};__p._setIndexElementDisplay=function MessagePartBody$_setIndexElementDisplay(b,c){var a=this._getIndexedElementById(b);if(a)$setDisplay(a,c)};__p._onDetailsHover=function MessagePartBody$_onDetailsHover(){$css.add(this._detailsElt,"DetailToggleHover")};__p._onDetailsOut=function MessagePartBody$_onDetailsOut(){$css.remove(this._detailsElt,"DetailToggleHover")};MessagePartBody.createClass("MessagePartBody");SearchBox={};SearchBox._onSearch=function SearchBox$_onSearch(a){Control.invokeStatic("SearchBox","_search",{},a)};SearchBox._search=function SearchBox$_search(b){var a=b.trim();if(a!=""){InboxPage.doPostProc=true;InboxPage.messageList.search(a)}else InboxPage.doPostProc=false};SearchBox.setValue=function SearchBox$updateSearchValue(b){var a=$SB.sbs[$SB.first];if(b){a.setValue("",true);a.setValue(b)}else a.resetDefault()};SearchBox.resetValue=function SearchBox$resetValue(){SearchBox.setValue("")};Type.createStaticClass(SearchBox,"SearchBox");function Toolbar(b,a){Control.create(this,b);this._ignoreActions=[];this._handler=null;this._onIgnore=null;this.registerOnClickHandler(a)}Toolbar.standardIgnoreList=["Help","HelpFeedback","HelpGettingStarted","HelpSupport"];var __p=Toolbar.prototype;__p.dispose=function Toolbar$dispose(){this._ignoreActions=null;this._handler=null;this._onIgnore=null;Control.destroy(this)};__p.registerOnClickHandler=function Toolbar$registerOnClickHandler(a){this._handler=a};__p.registerOnIgnoreHandler=function Toolbar$registerOnIgnoreHandler(a){this._onIgnore=a};__p.setIgnoreActions=function Toolbar$setIgnoreActions(a){this._ignoreActions=a};__p.onclick=function Toolbar$onClick(a){if(!a||this._ignoreActions.exists(a)){if(this._onIgnore)this._onIgnore(a);return}return this._handler(a,event)};Toolbar.createClass("Toolbar");InboxToolbar={};InboxToolbar.initialize=function InboxToolbar$initialize(){InboxToolbar.initializeToolbar(InboxToolbar,"");if($("BottomToolbar")){InboxToolbar.bottomToolbar={};InboxToolbar.initializeToolbar(InboxToolbar.bottomToolbar,"bt_")}};InboxToolbar.initializeToolbar=function InboxToolbar$initializeToolbar(a,b){if(!InboxPage.isManagedUser)a.junk=$(b+"MarkAsJunk").parentNode;a.pipeAfterNew=$(b+"AfterNewPipe");a.reply=$(b+"Reply").parentNode;a.replyAll=$(b+"ReplyAll").parentNode;a.forward=$(b+"Forward").parentNode;a.pipeAfterForward=$(b+"AfterForwardPipe");a.notJunk=$(b+"MarkAsNotJunk").parentNode;a.phish=$(b+"MarkAsPhish").parentNode;a.read=$(b+"MarkAsRead").parentNode;a.unread=$(b+"MarkAsUnread").parentNode;a.newMsg=$(b+"NewMessage").parentNode;a.markAs=$(b+"MarkAs");a.markAsMenu=$tag(a.markAs,"UL")[0];a.markAsFlagged=$(b+"MarkAsFlagged").parentNode;a.markAsUnflagged=$(b+"MarkAsUnflagged").parentNode;if(InboxPage.Config.isBulkSelectEnabled){a.cleanUp=$(b+"CleanUp");a.cleanUpMenu=$tag(a.cleanUp,"UL")[0];a.markAllReadLink=$(b+"MarkAllRead");a.markAllRead=a.markAllReadLink.parentNode;a.deleteAllLink=$(b+"DeleteAll");a.deleteAll=a.deleteAllLink.parentNode;if(InboxPage.Config.isEnhancedRulesEnabled){a.moveAllFromSender=$(b+"MoveAllFromSender").parentNode;a.deleteAllFromSender=$(b+"DeleteAllFromSender").parentNode;a.blockAllFromSender=$(b+"BlockAllFromSender").parentNode}}a.moveTo=$(b+"MoveTo");a.moveToMenu=$tag(a.moveTo,"UL")[0];a.print=$(b+"PrintMessages").parentNode;a.refresh=$(b+"Refresh").parentNode;a.emptyFolder=$(b+"EmptyFolderButton").parentNode;a.pipeAfterMove=$(b+"AfterMoveToPipe")};InboxToolbar.onclick=function InboxToolbar$onclick(a){if(!a){InboxPage.doPostProc=false;return}return InboxToolbar.doAction(a)};InboxToolbar.doAction=function InboxToolbar$doAction(a){var c=InboxPage.readingPane;switch(a){case "rd_next":InboxActions.nextMsg();return;case "rd_prev":InboxActions.prevMsg();return;case "rd_full":c.onFullViewClick();return;case "rd_close":InboxActions.closeFullViewMsg();return;case "expandAll":InboxActions.expandAll();return;case "collapseAll":InboxActions.collapseAll();return;case "showConversation":InboxPage.onSubmitUpsellConversationView(InboxPage.readingPane.getActionableMsgPart().mid);return;case "bulkSelectAll":InboxActions.bulkSelectAll();return;case "clearSelection":InboxActions.clearSelection();return;case "createMoveRule":InboxActions.createMoveRule();return;case "dismissMessaging":InboxActions.dismissMessaging();return;case "CheckAll":InboxActions.select($("msgChkAll").checked);return;case "SortByDate":InboxPage.messageList.sort("Date");return;case "SortBySender":InboxPage.messageList.sort("Sender");return;case "SortBySubject":InboxPage.messageList.sort("Subject");return;case "SortBySize":InboxPage.messageList.sort("Size");return;case "SortByConversation":InboxPage.messageList.sort("Conversation");return;case "Flt_reset":FilterSelector.applyFilter(InboxPage.Config.filters.noneFltid);return;case "Flt_col":FilterSelector.toggleCollapse();return}if(a&&a.startsWith("Flt_")){var b=parseInt(a.substr(4));if(!isNaN(b)){FilterSelector.applyFilter(b);return}}};InboxToolbar.updateToolbarState=function InboxToolbar$updateToolbarState(){InboxToolbar.updateToolbar(InboxToolbar);if(InboxToolbar.bottomToolbar)InboxToolbar.updateToolbar(InboxToolbar.bottomToolbar);Resize._mainContentResize()};InboxToolbar.updateToolbar=function InboxToolbar$updateToolbar(a){var e=InboxPage.folderList.fst,m=e=="SENT",i=e=="DRAFTS",b=e=="JUNK",k=e=="TRASH",g=!m&&!i,f=m||i,d=b||k,h=InboxPage.readingPane.isFullView,l=InboxPage.readingPane.isShowingMessage()&&InboxPage.readingPane.isVoicemail();if(!InboxPage.isManagedUser)$setDisplay(a.junk,g&&!b);$setDisplay(a.notJunk,g&&b);$setDisplay(a.phish,g);$setDisplay(a.read,!l);$setDisplay(a.unread,!l);$setDisplay(a.emptyFolder,d);$setDisplay(a.markAsFlagged,!d);$setDisplay(a.markAsUnflagged,!d);if(InboxPage.Config.isBulkSelectEnabled){var j=(!d||!k&&InboxPage.Config.enableSweepInJunk)&&(!h||InboxPage.Config.isEnhancedRulesEnabled&&!f);$setDisplay(a.cleanUp,j);if(j){$setDisplay(a.markAllRead,!h);$setDisplay(a.deleteAll,!h&&!b);a.markAllReadLink.innerHTML=Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.markAllReadMenuView:InboxPage.Strings.markAllReadMenuFolder);a.deleteAllLink.innerHTML=Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.deleteAllMenuView:InboxPage.Strings.deleteAllMenuFolder);if(InboxPage.Config.isEnhancedRulesEnabled){$setDisplay(a.moveAllFromSender,!f&&!b);$setDisplay(a.deleteAllFromSender,!f&&!b);$setDisplay(a.blockAllFromSender,b)}}InboxToolbar.invalidateMenuPosition(a.cleanUpMenu)}var c=!b&&!i&&(InboxPage.readingPane.isShowingMessage()||InboxPage.isReadingPaneOn);$setDisplay(a.reply,c);$setDisplay(a.replyAll,c);$setDisplay(a.forward,c);$setDisplay(a.pipeAfterNew,c);$setDisplay(a.pipeAfterForward,c);InboxToolbar.invalidateMenuPosition(a.markAsMenu);InboxToolbar.invalidateMenuPosition(a.moveToMenu);Resize.recalculatePrimaryToolbarWidths()};InboxToolbar.invalidateMenuPosition=function InboxToolbar$invalidateMenuPosition(b){var a=b.binding;if(a)a.invalidatePosition()};Type.createStaticClass(InboxToolbar,"InboxToolbar");InboxToolbar.initialize();FilterSelector={_allFilterContainerElemIds:InboxPage.Config.filters.allElemIds.split(" ")};FilterSelector.applyFilter=function FilterSelector$applyFilter(b){$BSI.reportEvent("Filter.Messaging.Mail",{FilterView:b});var a=InboxPage.createMessageListRenderingInfo(true);a.FilterId=b;InboxPage.messageList.setFirstOrLastPageParams(a,true);InboxPage.beginRefreshInbox(true,true,a,false,null,true)};FilterSelector.updateState=function FilterSelector$updateState(a){FilterSelector._updateSelectedState(a)};FilterSelector.toggleCollapse=function FilterSelector$toggleCollapse(){var a=$("filtersContainer");if(a){var b=$css.has(a,"Fs_iscol");if(b)$css.remove(a,"Fs_iscol");else $css.add(a,"Fs_iscol");if(OptionsWriter){var c=!b?"true":"false";OptionsWriter.fireOption(InboxPage.Config.filters.colUrl+c)}FilterSelector.applyFilter(InboxPage.Config.filters.noneFltid);InboxPage._onResize(null,false)}};FilterSelector._updateSelectedState=function FilterSelector$_updateSelectedState(a){if(!a)a=0;var e="fs_"+a;for(var c=FilterSelector._allFilterContainerElemIds.length-1;c>=0;--c){var d=FilterSelector._allFilterContainerElemIds[c],b=$(d);if(b)if(d==e)$css.add(b,"Selected");else $css.remove(b,"Selected")}};Type.createStaticClass(FilterSelector,"FilterSelector");__p=ReadingPane.prototype;__p._hasFocus=false;__p.initFocusHandling=function MessageList$initFocusHandling(){this._focusInDelegate=$CD(this,this._onFocusIn);this._focusOutDelegate=$CD(this,this._onFocusOut);this._splitPaneElt=$("readingPaneSplitPane");this._splitPaneElt.attachEvent("onfocusin",this._focusInDelegate);this._splitPaneElt.attachEvent("onfocusout",this._focusOutDelegate)};__p.disposeFocusHandling=function MessageList$disposeFocusHandling(){this._splitPaneElt.detachEvent("onfocusout",this._focusOutDelegate);this._splitPaneElt.detachEvent("onfocusin",this._focusInDelegate);this._focusOutDelegate=null;this._focusInDelegate=null};__p._innerSetHTML=__p.setHTML;__p.setHTML=function ReadingPane$setHTML$wrapper(b){var a=this._hasFocus;this._innerSetHTML(b);if(a)setTimeout($CD(this,this.focus),1)};__p._onFocusIn=function ReadingPane$_onFocusIn(){this._hasFocus=true};__p._onFocusOut=function ReadingPane$_onFocusOut(){if(!this._splitPaneElt.contains(event.toElement))this._hasFocus=false};__p.focus=function ReadingPane$focus(b){if(this.mode===ReadingPane.MESSAGE_MODE){var a=$("rpFocusElt");if(a)$callFocus(a)}else if(this.mode===ReadingPane.DELAY_LOADED_MODE||b)this._hasFocus=true};__p.hasFocus=function ReadingPane$hasFocus(){return this._hasFocus};__p=MessageList.prototype;__p._navEventTimer=null;__p._hasFocus=false;MessageList.KEYBOARD_DELAY_MILLISECONDS=200;__p.initFocusHandling=function MessageList$initFocusHandling(){this._focusInDelegate=$CD(this,this._onFocusIn);this._focusOutDelegate=$CD(this,this._onFocusOut);this.elt.attachEvent("onfocusin",this._focusInDelegate);this.elt.attachEvent("onfocusout",this._focusOutDelegate)};__p.initKeyboardHandling=function MessageList$initKeyboardHandling(){this._keyDownDelegate=$CD(this,this._onKeyDownWrapper);this.elt.attachEvent("onkeydown",this._keyDownDelegate);var a=$("msgChkAll");if(a)a.attachEvent("onkeydown",this._keyDownDelegate)};__p.disposeFocusHandling=function MessageList$disposeFocusHandling(){this.elt.detachEvent("onfocusout",this._focusOutDelegate);this.elt.detachEvent("onfocusin",this._focusInDelegate);this._focusOutDelegate=null;this._focusInDelegate=null};__p.disposeKeyboardHandling=function MessageList$disposeKeyboardHandling(){this.elt.detachEvent("onkeydown",this._keyDownDelegate);var a=$("msgChkAll");if(a)a.detachEvent("onkeydown",this._keyDownDelegate);this._keyDownDelegate=null};__p._onKeyDownWrapper=function MessageList$_onKeyDownWrapper(){Control.onPreInvoke("MessageList","_onKeyDownWrapper");InboxPage.doPostProc=false;this._onKeyDown();Control.onPostInvoke("MessageList","_onKeyDownWrapper")};__p._onKeyDown=function MessageList$_onKeyDown(){if(event.shiftKey||event.ctrlKey||event.altKey)return true;var a;switch(event.keyCode){case 38:a="prevMsg";break;case 40:a="nextMsg";break;default:return true}if(Control.invokeStatic("InboxActions",a,event,{isKbd:true,senderData:null}))return true;event.returnValue=false;event.cancelBubble=true;return false};__p._startNavEventTimer=function MessageList$_startNavEventTimer(a){this._cancelNavEventTimer();this._navEventTimer=setTimeout(a,MessageList.KEYBOARD_DELAY_MILLISECONDS)};__p._cancelNavEventTimer=function MessageList$_cancelNavEventTimer(){if(null!=this._navEventTimer){clearTimeout(this._navEventTimer);delete this._navEventTimer;this._navEventTimer=null}};__p._innerOpenMessageByElt=__p._openMessageByElt;__p._openMessageByElt=function MessageList$_openMessageByElt$wrapper(d,b,a,c){if(a)this._startNavEventTimer($CD(this,function(){this._innerOpenMessageByElt(d,b,a,c)}));else this._innerOpenMessageByElt(d,b,a,c)};__p._innerOpenPageByElt=__p._openPageByElt;__p._openPageByElt=function MessageList$_openPageByElt$wrapper(b,a){this._cancelNavEventTimer();this._innerOpenPageByElt(b,a,true)};__p._innerSetHTML=__p.setHTML;__p.setHTML=function MessageList$setHTML$wrapper(c,a){var b=this._hasFocus;this._innerSetHTML(c,a);if(b)this.focus()};__p._onFocusIn=function MessageList$_onFocusIn(){this._hasFocus=true};__p._onFocusOut=function MessageList$_onFocusOut(){if(!this.elt.contains(event.toElement))this._hasFocus=false};__p.focus=function MessageList$focus(){var a=$tag(this.elt,"input");if(a&&a.length>0){var b=this.getSelectionIndex();if(b<0||b>=a.length)b=0;$callFocus(a[b])}};__p.hasFocus=function MessageList$hasFocus(){return this._hasFocus};function ErrorDhtml(){this.Events={onclick:new $Event};this._onclickHandler=$CD(this,this._onClick)}__p=ErrorDhtml.prototype={ui:null,content:null};__p.dispose=function ErrorDhtml$dispose(){this.Events.onclick.dispose();this.ui=null;this.content=null};__p._onClick=function ErrorDhtml$_onClick(){this.Events.onclick.fire([this,{}])};__p.show=function ErrorDhtml$show(a){var c=['<div id="ErrDhtml" class="ErrDhtml">',this.content,"</div>"].join("");this.ui=new Alert(Alert.Importance.high,Page.decode(Res.strings.errDhtmlTitle),c,true,null);this.ui.addButton(Page.decode(Res.strings.errDhtmlBtn),1,true,false);this.ui.doNotDismissOnButtonClick();this.ui.setCallback(function(){ErrorDhtml.hide();if(a&&a.messageListRenderingInfo)Control.invokeStatic("InboxActions","_refreshAfterError",event,{mlri:a.messageListRenderingInfo})});gShowAlert(this.ui);var b=$("ErrDhtml");b.attachEvent("onclick",this._onclickHandler)};__p.hide=function ErrorDhtml$hide(){if(this.ui){var a=$("ErrDhtml");if(a)a.detachEvent("onclick",this._onclickHandler);this.ui.close()}ErrorDhtml.cleanup()};__p.setContent=function ErrorDhtml$setContent(a){this.content=a};ErrorDhtml._instance=null;ErrorDhtml.getInstance=function ErrorDhtml$getInstance(a){if(!ErrorDhtml._instance&&(a===undefined||a))ErrorDhtml.initialize();return ErrorDhtml._instance};ErrorDhtml.showHighPri=function ErrorDhtml$showHighPri(b,d,c){var a=ErrorDhtml.getInstance(true);a.setContent(b);a.show(c);return a};ErrorDhtml.hide=function ErrorDhtml$hide(){if(ErrorDhtml._instance)ErrorDhtml._instance.hide()};ErrorDhtml.showBlocking=function ErrorDhtml$showBlocking(b,a){ErrorDhtml.showHighPri(b,a)};ErrorDhtml.initialize=function ErrorDhtml$initialize(){ErrorDhtml._instance=new ErrorDhtml};ErrorDhtml.cleanup=function ErrorDhtml$cleanup(){if(ErrorDhtml._instance){ErrorDhtml._instance.dispose();ErrorDhtml._instance=null}};ErrorDhtml.createClass("ErrorDhtml");InboxActions={};InboxActions._promptUserToBulkDelete=function InboxActions$_promptUserToBulkDelete(){var b=InboxPage.isQuickViewFilterOrSearch(),a;if(InboxPage.folderList.fid==InboxPage.Config.sysFldrs.trashFid)a=b?InboxPage.Strings.permanentDeleteAllPromptView:InboxPage.Strings.permanentDeleteAllPromptFolder;else a=b?InboxPage.Strings.deleteAllPromptView:InboxPage.Strings.deleteAllPromptFolder;return confirm(Page.decode(a))};InboxActions.markAsNotJunk=function InboxActions$markAsNotJunk(b){var a=InboxActions._getMessageDataFromHoverOrSelection(b);if(a){Page.setPerformanceId("NJ");Safety.markAsNotJunk(a,InboxPage.folderList.fid,null,false)}};InboxActions.markAsPhish=function InboxActions$markAsPhish(){var a=InboxPage.verifyMinimumSelection();if(a)Safety.markAsPhish(a,InboxPage.folderList.fid)};InboxActions.markAllRead=function InboxActions$markAllAsRead(){if(InboxPage.messageList.getItemCount()!=0){InboxServices.Events.sethiddenbulkselectallstate.fire([true]);Messages.markAsReadUnread(MessageList.createHiddenBulkSelectedMessageData(),true);return}InboxPage.doPostProc=false};InboxActions.deleteAll=function InboxActions$deleteAll(){if(InboxPage.messageList.getItemCount()!=0&&confirm(Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.deleteAllPromptView:InboxPage.Strings.deleteAllPromptFolder))){Page.setPerformanceId("DM");InboxServices.Events.sethiddenbulkselectallstate.fire([true]);Messages.remove(MessageList.createHiddenBulkSelectedMessageData());return}InboxPage.doPostProc=false};InboxActions.emptyFolder=function InboxActions$emptyFolder(){if(confirm(Page.decode(InboxPage.Strings.permanentDeleteAllPromptFolder))){var b=InboxPage.messageList.getItemCount(),a=InboxPage.folderList.fid;if(InboxPage.Config.sysFldrs.trashFid==a&&InboxPage.areNoFiltersApplied()&&(b>InboxPage.Config.emptyDeleteThreshold||b==-1&&InboxPage.messageList.isMoreThanOnePage()))Messages.remove(MessageList.createSelectedMessageData(true,null,null));else{if(InboxPage.Config.sysFldrs.junkFid==a)Page.setPerformanceId("EJ");InboxPage.postProcData.history=false;InboxServices.beginClearFolder(a,InboxPage.createMessageListRenderingInfo(true))}return}InboxPage.doPostProc=false};InboxActions._markAsReadUnread=function InboxActions$_markAsReadUnread(e,g){var a=InboxActions._getMessageDataFromHoverOrSelection(g);if(a){InboxPage.postProcData.showLoading=false;if(e){var c=InboxPage.readingPane;if(c.isShowingMessage()){var b=a.duplicateMsgIds?a.duplicateMsgIds:a.mids;if(c.secretCid!=null)b=[c.secretCid];var f=b.length;for(var d=0;d<f;d++)if(InboxPage.messageList.isRead(b[d]))c.updateReadState(b[d],true)}}Messages.markAsReadUnread(a,e)}};InboxActions.markAsFlagged=function InboxActions$markAsFlagged(){InboxActions._markAsFlaggedUnflagged(true)};InboxActions.markAsUnflagged=function InboxActions$markAsUnflagged(){InboxActions._markAsFlaggedUnflagged(false)};InboxActions.markMessageAsFlaggedUnflagged=function InboxActions$markMessageAsFlaggedUnflagged(c,b,a){Messages.markAsFlaggedUnflagged(MessageList.createSelectedMessageData(false,[c],[b]),a)};InboxActions._markAsFlaggedUnflagged=function InboxActions$_markAsFlaggedUnflagged(b){var a=InboxPage.verifyMinimumSelection();if(a)Messages.markAsFlaggedUnflagged(a,b)};InboxActions.setFlagIcon=function InboxActions$setFlagIcon(g,h){var d=$getDescendantByAttr(g,"A","aId","tFg"),f=d.children[0],e=false,a,c,b;if(h){a="fg";c=InboxPage.Strings.flaggedAltText;b=InboxPage.Strings.flaggedMsgText}else{a="uf";c=InboxPage.Strings.unflaggedAltText;b=InboxPage.Strings.unflaggedMsgText}if(!$css.has(d,a)){d.className=a;f.alt=c;f.title=b;e=true}return e};InboxActions.moveTo=function InboxActions$moveTo(){var b=InboxPage.verifyMinimumSelection();if(b){var a=Control.getAncestorByAttr(event.srcElement,"aId"),c=a&&a.getAttribute?a.getAttribute("fid"):"";InboxActions._moveToFolder(b,c)}};InboxActions._moveToFolder=function InboxActions$_moveToFolder(a,b){Page.setPerformanceId("DM");Messages.move(a,InboxPage.folderList.fid,b,null,null,null,null,true)};InboxActions.checkPop=function InboxActions$checkPop(){Page.submit("CheckPop");InboxPage.doPostProc=false};InboxActions.viewSource=function InboxActions$viewSource(){InboxPage.doPostProc=false;var a=InboxPage.verifyMinimumSelection();if(a)if(!a.isBulk&&a.mids.length>0)Messages.viewSource(a)};InboxActions.viewAllFromSender=function InboxActions$viewAllFromSender(a){InboxActions._getSingleSenderAndPerformAction(a,function(a){InboxPage.messageList.searchAllFromSender(a)})};InboxActions.sendEmailToSender=function InboxActions$sendEmailToSender(a){InboxActions._getSingleSenderAndPerformAction(a,function(a){Page.setPerformanceId("CON");Page.postWithFolderQuickViewCache("NewMessage","EditMessageLight.aspx?n="+Page.queryString.newNonce+"&MailTo="+a.encodeUrl())})};InboxActions.showAdvancedSearch=function InboxActions$showAdvancedSearch(){InboxActions._advancedSearchHelper(function(){this.show().focus()})};InboxActions.hideAdvancedSearch=function InboxActions$hideAdvancedSearch(){InboxActions._advancedSearchHelper(function(){this.hideAndSetFocus()})};InboxActions.advancedSearch=function InboxActions$advancedSearch(){InboxActions._advancedSearchHelper(function(){this.search()},true)};InboxActions.tryAdvancedSearch=function InboxActions$tryAdvancedSearch(){InboxActions._advancedSearchHelper(function(){this.reset().show().focus()})};InboxActions._advancedSearchHelper=function InboxActions$_advancedSearchHelper(c,b){var a=InboxPage.advancedSearch;if(a){a.load(c);if(b)return}InboxPage.doPostProc=false};InboxActions.refresh=function InboxActions$refresh(){if(typeof ManualRefresh!="undefined")ManualRefresh.refreshInbox()};InboxActions.undoMoveSenderToBlockList=function InboxAction$undoMoveSenderToBlockList(a){var b=a[0],c=a[1];InboxServices.beginUndoSenderMoveToBlockList(b,c)};InboxActions._getSingleSenderAndPerformAction=function InboxActions$_getSingleSenderAndPerformAction(d,c){var b=InboxActions._getSenderEmailsFromHoverOrSelection(d,false),a=b[0];if(a){c(a);return}InboxPage.doPostProc=false};InboxActions._getSenderEmailsFromHoverOrSelection=function InboxActions$_getSenderEmailsFromHoverOrSelection(b,d){if(b&&b.senderData){senderElt=b.senderData.senderElt;if(senderElt){var e=senderElt.getAttribute("email");return [e]}}else{var a=InboxPage.verifyMinimumSelection();if(a)if(!a.isBulk){var c=MessageList.getSenderEmailsFromMids(a.mids);if(c.length>0)return c;alert(String.format(Page.decode(InboxPage.Strings.noSendersSelected),Page.decode(InboxPage.Strings.unknownSender)))}else if(d)alert(Page.decode(InboxPage.Strings.sndrActionNoBulk))}return null};InboxActions._getMessageDataFromHoverOrSelection=function InboxActions$_getMessageDataFromHoverOrSelection(b){var a=null;if(b&&b.senderData){var c=b.senderData;a=MessageList.createSelectedMessageData(false,[c.msgElt.getAttribute("id")],[c.msgElt.getAttribute("mad")])}else a=InboxPage.verifyMinimumSelection();return a};InboxActions._prevNextHelper=function InboxActions$_prevNextHelper(a,b){InboxPage.doPostProc=false;if(a&&!InboxPage.isReadingPaneOn&&!InboxPage.readingPane.isFullView)return true;if(InboxPage.readingPane.isFullView&&-1==InboxPage.messageList.getSelectionIndex()){InboxPage.doPostProc=true;InboxPage.showFullReadingPane(false)}else if(b)InboxPage.messageList.previous(a);else InboxPage.messageList.next(a)};InboxActions._replyForwardImpl=function InboxActions$_replyForwardImpl(e,c){var f=c&&c.isKbd,a=InboxPage.folderList.fid,b=InboxPage.Config.sysFldrs;if(!f||a!=b.junkFid&&a!=b.draftsFid&&(InboxPage.readingPane.isShowingMessage()||InboxPage.isReadingPaneOn)){var d=InboxActions._loadSelectedMessageAndDoAction(e);if(!d.msgSelected){alert(Page.decode(InboxPage.Strings.selectOne));InboxPage.doPostProc=false;return false}return d.value}else{InboxPage.doPostProc=false;return true}};InboxActions._loadSelectedMessageAndDoAction=function InboxActions$_loadSelectedMessageAndDoAction(c){var b=false,d=true,a=InboxPage.messageList;if(InboxPage.readingPane.isShowingMessage()){b=true;d=InboxActions._doActionOnSelectedMessage(c)}else if(a.isOneItemSelected()){var g=a.getSelectedMessageData(),e=g.mids[0],f=$(e);if(f){if(InboxPage.allowAction(c,e))a._openMessageByElt(f,false,false,function(){InboxActions._doActionOnSelectedMessage(c,true)});b=true;d=false}}return {msgSelected:b,value:d}};InboxActions._doActionOnSelectedMessage=function ReadingPane$doActionOnSelectedMessage(b,a){if(InboxPage.readingPane.isShowingMessage()){var c=InboxPage.readingPane.getActionableMsgPartActions();return c[b](a)}return true};InboxActions.select=function InboxActions$select(b,a){if(a&&InboxPage.readingPane.isFullView){InboxPage.doPostProc=false;return true}InboxPage.messageList.checkAll(b)};InboxActions.bulkSelectAll=function InboxActions$bulkSelectAll(){$BSI.reportEvent("bk.check",{bulkSelect:true});InboxPage.messageList.bulkSelectAll()};InboxActions.clearSelection=function InboxActions$clearSelection(){InboxPage.doPostProc=false;InboxPage.messageList.clearSelection();InboxPage.messageList.updateSelectedCount()};InboxActions.createMoveRule=function InboxActions$createMoveRule(){InboxPage.postProcData.ads=false;InboxPage.postProcData.history=false;InboxPage.postProcData.showLoading=false;var a=Control.getAncestorByAttr(event.srcElement,"aId"),d=a.getAttribute("rn"),b=a.getAttribute("rm"),c=a.getAttribute("rfid");InboxServices.beginCreateMoveRule(d,b,c);InboxPage.selectionMsgPane.hide()};InboxActions.dismissMessaging=function InboxActions$dismissMessaging(){InboxPage.doPostProc=false;InboxPage.selectionMsgPane.hide()};InboxActions.expandAll=function InboxActions$expandAll(){InboxPage.readingPane.expandAll()};InboxActions.collapseAll=function InboxActions$collapseAll(){InboxPage.readingPane.collapseAll()};InboxActions.closeUpsell=function InboxActions$closeUpsell(){InboxPage.doPostProc=false;Infopane.forceHide();OptionsWriter.fireOption(String.format(InboxPage.upsellActionUrl,InboxPage.upsellDismissAction))};InboxActions.closeMessageSuperBar=function InboxActions$closeMessageSuperBar(a){InboxPage.doPostProc=false;var b=$getNearestParentByClass(event.srcElement,"sb");if(b)$setDisplay(b,false);if(a=="LiveViewAuth"||a=="PSAUpsell")$BSI.reportEvent("sb.close",{SuperBarType:a})};InboxActions.closeMessageSuperBarAndWriteOption=function InboxActions$closeMessageSuperBarAndWriteOption(a){$Beacon.fire(a.url,$BSI.addLDToHash({}));InboxActions.closeMessageSuperBar(a.type)};InboxActions.navigateMessageSuperBar=function InboxActions$navigateMessageSuperBar(a){$BSI.reportEvent("sb.click",{SuperBarType:a.type});$BSI.navigateTo(a.url)};InboxActions.setReadingPane=function InboxActions$setReadingPane(){var a=Control.lookup(event.srcElement,"iid");if(a)InboxPage.onSubmitReadingPaneOptionClicked(a)};InboxActions.demandLoadWithLoadingIndicator=function InboxActions$demandLoadWithLoadingIndicator(d,f,e){var b=false,c=function(){b=true;f()};DemandLoadHandler.demandLoadContent(d,[c],e);if(b)InboxPage.doPostProc=false;else{var a=InboxPage.postProcData;a.ads=false;a.history=false;a.hideInfoPane=false}};InboxActions.maybeShowJunkConfirmationDialog=function InboxActions$maybeShowJunkConfirmationDialog(b,c,a){if(b||c)InboxActions.demandLoadWithLoadingIndicator([HM.ContentId.JunkContactOrSafeSender],function(){InboxActions._showJunkConfirmationDialog(b,c,a)},function(){a()});else a()};InboxActions._showJunkConfirmationDialog=function InboxActions$_showJunkConfirmationDialog(c,d,e){var b=DemandLoadHandler.getContent(HM.ContentId.JunkContactOrSafeSender);if(c)where="C";else if(d)where="WL";var a=new Alert(Alert.Importance.none,b.title,b[where+"msg"],true,null);a.addButton(b[where+"keep"],"keep",true,true);a.addButton(b[where+"remove"],"remove",false,false);a.doNotAddCloseBox();a.setContext({where:where,callback:e});a.setCallback(this._junkConfirmationDialogCallback);$BSI.reportEvent("ReadView.Messaging.Mail.JunkPrompt",{PromptType:"KnownSender"});gShowAlert(a)};InboxActions._junkConfirmationDialogCallback=function InboxActions$_junkConfirmationDialogCallback(b,c){var a=HM.RemoveSenderFromListOption.None;if(c=="remove"){a=b.where=="C"?HM.RemoveSenderFromListOption.RemoveContact:HM.RemoveSenderFromListOption.RemoveSafeSender;$BSI.reportEvent("SelectClick.Messaging.Mail.JunkPrompt",{PromptType:"Block"})}else a=b.where=="C"?HM.RemoveSenderFromListOption.KeepContact:HM.RemoveSenderFromListOption.KeepSafeSender;b.callback(a)};InboxActions._checkMessagesFromSelf=function InboxActions$_checkMessagesFromSelf(c){if(!c.mids)return false;var b=false,e=c.mids;for(var a=e.length-1;a>=0;a--){var d=$(e[a]);if(d&&d.getAttribute("self")){b=true;break}}return b};Type.createStaticClass(InboxActions,"InboxActions");InboxActions.newMsg=function InboxActions$newMsg(){Page.setPerformanceId("CON");Page.postWithFolderQuickViewCache("NewMessage","EditMessageLight.aspx?n="+Page.queryString.newNonce);InboxPage.doPostProc=false};InboxActions.deleteMsg=function InboxActions$deleteMsg(b){var a=InboxActions._getMessageDataFromHoverOrSelection(b);if(a&&(!a.isBulk||InboxActions._promptUserToBulkDelete())){Page.setPerformanceId("DM");Messages.remove(a,null,null,null,null,a.duplicateMsgIds==undefined||a.duplicateMsgIds.length==0,false);return}InboxPage.doPostProc=false};InboxActions.markAsJunk=function InboxActions$markAsJunk(f){var n=f&&f.isKbd,c=InboxPage.folderList.fid,k=InboxPage.Config.sysFldrs;if(n&&(c==k.junkFid||c==k.trashFid||InboxPage.isManagedUser)){InboxPage.doPostProc=false;return true}var a=InboxActions._getMessageDataFromHoverOrSelection(f),b=InboxActions._checkMessagesFromSelf(a);if(a&&InboxPage.allowAction("markAsJunk",!a.isBulk&&a.mids&&a.mids.length>0?a.mids[0]:null)){Page.setPerformanceId("J");var i=!a.isBulk&&a.mids.length==1&&(a.duplicateMsgIds==undefined||a.duplicateMsgIds.length==0),g=InboxPage.readingPane,l=InboxPage.messageList.conv,m=l!=null&&l!="",h=b||m&&(i&&g.isShowingMessage()&&g.numMessageParts()>1);if(InboxPage.Config.junkSenderEnabled&&i&&!InboxPage.messageList.isConversation(a.mids[0])){var d,e;if(g.isShowingMessage()){var j=InboxPage.readingPane.getMessagePart(a.mids[0]);d=!b&&j.isSenderInContactList;e=!b&&j.isSenderInWhiteList}else{d=!b&&InboxPage.messageList.isSenderInContactList(a.mids[0]);e=false}InboxActions.maybeShowJunkConfirmationDialog(d,e,function(b){var d=HM.RemoveSenderFromListOption.None;if(b)d=b;Safety.markAsJunk(a,c,d,h)})}else Safety.markAsJunk(a,c,HM.RemoveSenderFromListOption.None,h)}};InboxActions.markAsRead=function InboxActions$markAsRead(a){InboxActions._markAsReadUnread(true,a)};InboxActions.markAsUnread=function InboxActions$markAsUnread(a){InboxActions._markAsReadUnread(false,a)};InboxActions.toggleFlag=function InboxActions$toggleFlag(){if(FolderQuickViewListHelper.isJunkOrDeletedFolder(InboxPage.folderList.fid)){InboxPage.doPostProc=false;return true}var a=InboxPage.verifyMinimumSelection();if(a){var c=false,d=a.isBulk?InboxPage.messageList.getMessageListItems():a.mids;for(var b=0;b<d.length;b++)if(!InboxPage.messageList.isFlagged(d[b])){c=true;break}Messages.markAsFlaggedUnflagged(a,c)}};InboxActions.moveToFolder=function InboxActions$moveToFolder(){InboxPage.doPostProc=false;var b=$("MoveTo");if(b){var a=b.children[0];if(a){a.focus();if(typeof a.menu==="undefined")try{$menu.bind(event,0,0,1,0,0,0,0,0,0,0,0,"click",a);InboxPage.makeMenuScroll("MoveTo",0)}catch(c){}else if(typeof a.menu.toggleState==="function")a.menu.toggleState();InboxPage.doNotCloseMenu=true}}};InboxActions.printMsg=function InboxActions$printMsg(){InboxPage.doPostProc=false;var a=InboxPage.verifyMinimumSelection();if(a)if(a.isBulk)alert(Page.decode(InboxPage.Strings.cannotBulkPrint));else{var c=false;if(InboxPage.readingPane.isShowingMessage()){var b=InboxPage.readingPane.getActionableMsgPart().getBody();if(b&&(b.isSafe||b.showUnsafe))c=true}Messages.print(a.mids,a.mads,c)}};InboxActions.reply=function InboxActions$reply(a){return InboxActions._replyForwardImpl("reply",a)};InboxActions.replyAll=function InboxActions$replyAll(a){return InboxActions._replyForwardImpl("replyAll",a)};InboxActions.forward=function InboxActions$forward(a){return InboxActions._replyForwardImpl("forward",a)};InboxActions.prevMsg=function InboxActions$prevMsg(a){var b=a&&a.isKbd;return InboxActions._prevNextHelper(b,true)};InboxActions.nextMsg=function InboxActions$nextMsg(a){var b=a&&a.isKbd;return InboxActions._prevNextHelper(b,false)};InboxActions.selectAll=function InboxActions$selectAll(){if(InboxPage.messageList.isBulkSelectAllState()){InboxPage.doPostProc=false;return true}return InboxActions.select(true,true)};InboxActions.selectNone=function InboxActions$selectNone(){return InboxActions.select(false,true)};InboxActions.searchMail=function InboxActions$searchMail(){InboxPage.doPostProc=false;if(InboxPage.readingPane.isFullView)return true;var a=$("c_search_psb_box");if(a)try{a.focus();a.blur();a.focus()}catch(b){}};InboxActions.closeFullViewMsg=function InboxActions$closeFullViewMsg(b){var c=b&&b.isKbd,a=InboxPage.readingPane;if(c&&!a.isFullView){InboxPage.doPostProc=false;return true}Page.setPerformanceId("BackMsg");a.onCloseClick()};InboxActions.openMsg=function InboxActions$openMsg(){if(!InboxPage.isReadingPaneOn&&!InboxPage.readingPane.isFullView){var a=InboxPage.messageList;if(a.isOneItemSelected()){var d=a.getSelectedMessageData(),b=d.mids[0],c=$(b);if(c&&InboxPage.allowAction("openMsg",b))a._openMessageByElt(c);return false}}InboxPage.doPostProc=false;return true};InboxActions.goToInbox=function InboxActions$goToInbox(){InboxPage.folderList.goToFldr(InboxPage.Config.sysFldrs.inboxFid,false)};InboxActions.goToSent=function InboxActions$goToSent(){InboxPage.folderList.goToFldr(InboxPage.Config.sysFldrs.sentFid,false)};InboxActions.goToDrafts=function InboxActions$goToDrafts(){InboxPage.folderList.goToFldr(InboxPage.Config.sysFldrs.draftsFid,false)};InboxActions.blockAllFromSender=function InboxActions$deleteAllFromSender(a){InboxActions._deleteOrMoveAllFromSender(a,InboxActions.showBlockAllFromSenderUi,[HM.ContentId.CommonDeleteAndBlockAllFromSender,HM.ContentId.BlockAllFromSender])};InboxActions.showBlockAllFromSenderUi=function InboxActions$showDeleteAllFromSenderUi(b,a){a.alwaysBlockAll=true;a.fromJunk=true;a.biciEventName="SelectClick.Messaging.Mail.JunkPrompt";a.biciEventArgs={PromptType:"Block"};InboxActions._showDeleteOrBlockAllFromSenderUi(b,a,HM.ContentId.BlockAllFromSender)};InboxActions.deleteAllFromSender=function InboxActions$deleteAllFromSender(a){InboxActions._deleteOrMoveAllFromSender(a,InboxActions.showDeleteAllFromSenderUi,[HM.ContentId.CommonDeleteAndBlockAllFromSender,HM.ContentId.DeleteAllFromSender])};InboxActions.showDeleteAllFromSenderUi=function InboxActions$showDeleteAllFromSenderUi(a,b){InboxActions._showDeleteOrBlockAllFromSenderUi(a,b,HM.ContentId.DeleteAllFromSender)};InboxActions._showDeleteOrBlockAllFromSenderUi=function InboxActions$_showDeleteOrBlockAllFromSenderUi(c,d,b){var a=DemandLoadHandler.getContent(b),e=[a.optionsMsg,c,InboxPage.isQuickViewFilterOrSearch()?a.optionsScopeView:a.optionsScopeFldr].join("");InboxActions._showActionConfirmationAlert(a.optionsTitle,e,a.optionsOkBtn,a.optionsCancelBtn,a.optionsBlkSndrs?a.optionsBlkSndrs:null,false,d,null,"_deleteAllFromSenderImpl",null)};InboxActions._deleteAllFromSenderImpl=function InboxActions$_deleteAllFromSenderImpl(a){Page.setPerformanceId("DM");if(a.biciEventName)$BSI.reportEvent(a.biciEventName,a.biciEventArgs);var d=a.secondaryAction||a.alwaysBlockAll,c,b,e;e=function(){Messages.remove(MessageList.createHiddenBulkSelectedMessageData(),InboxActions._createSenderSearchQuery(a.senderEmails),true,InboxPage.createPostActionInfo(b,InboxServices.Events.enddeleteallfromsender,{senders:a.senderEmails}),InboxPage.createBulkMoveDataPoints("sender",a.entryPoint,d?"block":null),null,c)};if(!InboxPage.Config.useUpdatePicwDataWhenSweepBlocking){c=false;b=d?InboxServices.beginBlockSenders:null}else{c=d;b=null;if(a["fromJunk"])e=function(){Messages.remove(InboxPage.verifyMinimumSelection(),null,true,InboxPage.createPostActionInfo(b,InboxServices.Events.enddeleteallfromsender,{senders:a.senderEmails}),InboxPage.createBulkMoveDataPoints("sender",a.entryPoint,d?"block":null),null,c)}}e()};InboxActions.moveAllFromSender=function InboxActions$moveAllFromSender(a){InboxActions._deleteOrMoveAllFromSender(a,InboxActions.showMoveAllFromSenderUi,[HM.ContentId.MoveAllFromSender,HM.ContentId.MoveToFolderListSelect])};InboxActions.showMoveAllFromSenderUi=function InboxActions$showMoveAllFromSenderUi(b,c){var a=DemandLoadHandler.getContent(HM.ContentId.MoveAllFromSender),d=[InboxPage.isQuickViewFilterOrSearch()?a.optionsPromptScopeView:a.optionsPromptScopeFldr,b,a.optionsSelFldr,DemandLoadHandler.getContent(HM.ContentId.MoveToFolderListSelect)].join("");InboxActions._showActionConfirmationAlert(a.optionsTitle,d,a.optionsOkBtn,a.optionsCancelBtn,a.optionsCreateRule?a.optionsCreateRule:null,true,c,InboxActions._handleFolderListOkBtn,"_moveAllFromSenderImpl",InboxActions._addToFldrToCtx)};InboxActions._moveAllFromSenderImpl=function InboxActions$_moveAllFromSenderImpl(a){Page.setPerformanceId("DM");Messages.move(MessageList.createHiddenBulkSelectedMessageData(),InboxPage.folderList.fid,a.toFldr,InboxActions._createSenderSearchQuery(a.senderEmails),true,InboxPage.createPostActionInfo(a.secondaryAction?InboxServices.beginCreateSendersMoveRules:null,InboxServices.Events.endmoveallfromsender,{senders:a.senderEmails,toFldr:a.toFldr}),InboxPage.createBulkMoveDataPoints("sender",a.entryPoint,a.secondaryAction?"rule":null),false)};InboxActions._deleteOrMoveAllFromSender=function InboxActions$_deleteOrMoveAllFromSender(a,d,c){var b=a&&a.senderEmails?a.senderEmails:InboxActions._getSendersForDelOrMoveAction(a);if(b&&b.length>0){InboxServices.Events.sethiddenbulkselectallstate.fire([true]);var e=a&&a.entryPoint?a.entryPoint:"ToolBar",f=function(){var a=InboxActions._getSndrHtml(b,DemandLoadHandler.getContent(HM.ContentId.CommonSenderAction).sndrListHtml);d(a,{senderEmails:b,entryPoint:e})};c.push(HM.ContentId.CommonSenderAction);InboxActions.demandLoadWithLoadingIndicator(c,f,InboxActions._errDemandLoadSenderContent)}else InboxPage.doPostProc=false};InboxActions.moveToPopup=function InboxActions$moveToPopup(){var a=InboxPage.verifyMinimumSelection();if(a){var b=function(){var b=DemandLoadHandler.getContent(HM.ContentId.MoveMessage),c=a.isBulk||a.mids.length>1||$(a.mids[0]).getAttribute("conv"),d=(c?b.promptPlural:b.promptSingular)+DemandLoadHandler.getContent(HM.ContentId.MoveToFolderListSelect);InboxActions._showActionConfirmationAlert(c?b.titlePlural:b.titleSingular,d,b.okBtn,b.cancelBtn,null,true,{messageData:a},InboxActions._handleFolderListOkBtn,"_moveToPopupImpl",InboxActions._addToFldrToCtx)};InboxActions.demandLoadWithLoadingIndicator([HM.ContentId.MoveMessage,HM.ContentId.MoveToFolderListSelect],b,InboxActions._errDemandLoadSenderContent)}else InboxPage.doPostProc=false};InboxActions._moveToPopupImpl=function InboxActions$_moveToPopupImpl(a){InboxActions._moveToFolder(a.messageData,a.toFldr)};InboxActions._errDemandLoadSenderContent=function InboxActions$_errDemandLoadSenderContent(){InboxServices.Events.sethiddenbulkselectallstate.fire([false])};InboxActions._showActionConfirmationAlert=function InboxActions$_showActionConfirmationAlert(k,h,j,g,e,c,m,f,l,d){var a=new Alert(Alert.Importance.none,k,h,true,null),b=1,i=2;if(e)a.addCheckbox(e,i,false);a.addButton(j,b,true,false);a.addButton(g,0,false,true);if(c)a.doNotDismissOnButtonClick();a.setContext(m);var n=function(f,g,i,h){var e=g==b;if(e){f["secondaryAction"]=h.length==1;if(d)e=d(f)}if(c)a.close();if(e)Control.invokeStatic("InboxActions",l,event,f);else InboxServices.Events.sethiddenbulkselectallstate.fire([false])};a.setCallback(n);gShowAlert(a);if(f)f(a,b)};InboxActions._handleFolderListOkBtn=function InboxActions$_handleFolderListOkBtn(c,b){c.disableButton(b);var a=$("moveFldrList");a.attachEvent("onchange",function(){"0"!=a.options[a.selectedIndex].value?c.enableButton(b):c.disableButton(b)})};InboxActions._addToFldrToCtx=function InboxActions$_addToFldrToCtx(c){var b=$("moveFldrList"),a=b.options[b.selectedIndex].value;if(a&&a!="0"){c["toFldr"]=a;return true}return false};InboxActions._getSendersForDelOrMoveAction=function InboxActions$_getSendersForDelOrMoveAction(a){if(FolderQuickViewListHelper.isDeletedFolder(InboxPage.folderList.fid))return null;return InboxActions._getSenderEmailsFromHoverOrSelection(a,true)};InboxActions._createSenderSearchQuery=function InboxActions$_createSenderSearchQuery(a){return "from:"+a.join(" OR from:")};InboxActions._getSndrHtml=function InboxActions$_getSndrHtml(a,b){var d=a.length>6?" BorderBox SndrScrollList":"",c=InboxPage.getEncodedEmails(a),e=["<li>",c.join("</li><li>"),"</li>"].join("");return String.format(b,d,e)};InboxActions._refreshAfterError=function InboxActions$_refreshAfterError(a){InboxPage.postProcData.ads=false;InboxPage.postProcData.history=false;InboxPage.beginRefreshInbox(true,true,a.mlri,false,null,true,false,false)};function MessagePartActions(a){this.mp=a}__p=MessagePartActions.prototype={};__p.dispose=function MessagePartActions$dispose(){this.mp=null};__p.getToolbarCallback=function MessagePartActions$getToolbarCallback(){return $CD(this,this._toolbarCallback)};__p._toolbarCallback=function MessagePartAction$_toolbarCallback(a){if(a=="tFg")a="toggleFlag";var b=["reply","replyAll","forward"];if(b.exists(a))$BSI.reportEvent(String.format("mp.{0}",a),this.mp.getBsiData());InboxPage.postProcData.ads=false;InboxPage.postProcData.history=false;return this[a]()};MessagePartActions.ignoreCallback=function MessagePartActions$ignoreCallback(){InboxPage.doPostProc=false};__p.toggleFlag=function MessagePartActions$toggleFlag(){Messages.markAsFlaggedUnflagged(this.mp.getSelectedMessageData(),!this.mp.isFlagged)};__p.toggleHeader=function MessagePartActions$toggleHeader(){this.mp.toggleHeader()};__p.showHistory=function MessagePartActions$showHistory(){this.mp.showHistory()};__p.hideHistory=function MessagePartActions$hideHistory(){this.mp.hideHistory()};__p.reply=function MessagePartActions$reply(a){if(a||InboxPage.allowAction("reply",this.mp.mid))return this.mp.loadBody($CD(this,this._replyImpl))};__p.replyAll=function MessagePartActions$replyAll(a){if(a||InboxPage.allowAction("replyAll",this.mp.mid))return this.mp.loadBody($CD(this,this._replyAllImpl))};__p.forward=function MessagePartActions$forward(a){if(a||InboxPage.allowAction("forward",this.mp.mid))return this.mp.loadBody($CD(this,this._forwardImpl))};__p._replyImpl=function MessagePartActions$replyImpl(){var a=this.mp.getBody();if(null!=a){Page.setPerformanceId("COR");return Messages.replyForward(a.replyAction,a.replyForwardUrl,a.showUnsafe,a.warnOnReplyForward,"CanNotReplyAddress",InboxPage.Strings.cannotReplyAddr)}InboxPage.doPostProc=false;return true};__p._replyAllImpl=function MessagePartActions$replyAllImpl(){var a=this.mp.getBody();if(null!=a){Page.setPerformanceId("CORA");return Messages.replyForward(a.replyAllAction,a.replyForwardUrl,a.showUnsafe,a.warnOnReplyForward,"CanNotReplyAddress",InboxPage.Strings.cannotReplyAddr)}InboxPage.doPostProc=false;return true};__p._forwardImpl=function MessagePartActions$forwardImpl(){var a=this.mp.getBody();if(null!=a){Page.setPerformanceId("COF");return Messages.replyForward(a.forwardAction,a.replyForwardUrl,a.showUnsafe,a.warnOnReplyForward,"CanNotForwardAddress",InboxPage.Strings.cannotFwdAddr)}InboxPage.doPostProc=false;return true};__p.deleteMessage=function MessagePartAction$deleteMessage(){Page.setPerformanceId("DM");$BSI.reportEvent("mp.delete",this.mp.getBsiData());InboxPage.readingPane.deleteMessagePart(this.mp.mid)};__p.markAsRead=function MessagePartActions$markAsRead(){this._markReadUnread(true)};__p.markAsUnread=function MessagePartActions$markAsUnread(){this._markReadUnread(false)};__p._markReadUnread=function MessagePartActions$_markReadUnread(b){var a=this.mp;if(a.isMixedReadState&&a.isRead&&b){InboxPage.readingPane.updateReadState(a.mid,true);InboxPage.doPostProc=false}else if(a.isRead&&!b||!a.isRead&&b){InboxPage.postProcData.showLoading=false;Messages.markAsReadUnread(a.getSelectedMessageData(),b)}else InboxPage.doPostProc=false};__p.markAsJunk=function MessagePartActions$markAsJunk(){if(InboxPage.allowAction("markAsJunk",this.mp.mid))if(InboxPage.Config.junkSenderEnabled)InboxActions.maybeShowJunkConfirmationDialog(this.mp.isSenderInContactList,this.mp.isSenderInWhiteList,$CD(this,this._markAsJunkImpl));else this._markAsJunkImpl()};__p._markAsJunkImpl=function MessagePartActions$_markAsJunkImpl(a){var b=HM.RemoveSenderFromListOption.None;if(typeof a!="undefined")b=a;Page.setPerformanceId("J");$BSI.reportEvent("mp.junk",this.mp.getBsiData({IsJunk:"1"}));InboxPage.readingPane.markMessagePartAsJunk(this.mp.mid,false,b)};__p.markAsNotJunk=function MessagePartActions$markAsNotJunk(a){if(typeof a=="undefined")a=false;Page.setPerformanceId("NJ");$BSI.reportEvent("mp.junk",this.mp.getBsiData({IsJunk:"0"}));InboxPage.readingPane.markMessagePartAsNotJunk(this.mp.mid,a)};__p.deleteAllFromSender=function MessagePartActions$deleteAllFromSender(){InboxActions.deleteAllFromSender({senderEmails:[this.mp.contactEmail],entryPoint:"MPToolBar"})};__p.addContact=function MessagePartActions$addContact(){$BSI.reportEvent("mp.addContact",{AddContactLocation:"ReadMessageLink"});InboxPage.readingPane.addContactFromMessagePart(this.mp.mid)};__p.printMessage=function MessagePartActions$printMessage(){var a=this.mp.getBody();if(null!=a){InboxPage.doPostProc=false;Messages.print([a.mid],[true],a.isSafe||a.showUnsafe)}};__p.viewSource=function MessagePartActions$viewSource(){InboxPage.doPostProc=false;Messages.viewSource(this.mp.getSelectedMessageData())};__p.toggleDetails=function MessagePartActions$toggleDetails(){if(this.mp.toggleDetails())$BSI.reportEvent("mp.showDetails",this.mp.getBsiData());InboxPage.doPostProc=false};__p.showDetails=function MessagePartActions$showDetails(){$BSI.reportEvent("mp.showDetails",this.mp.getBsiData());this.mp.setDetailsDisplay(true)};__p.hideDetails=function MessagePartActions$hideDetails(){this.mp.setDetailsDisplay(false)};MessagePartActions.createClass("MessagePartActions");var BulkActionsProgressUi={};BulkActionsProgressUi.initialize=function BulkActionsProgressUi$initialize(){BulkActionsProgressUi._resetStateVariables();InboxServices.Events.showbulkactionprogressui.attach($CD(this,BulkActionsProgressUi._showBulkActionProgressUi));InboxServices.Events.updatebulkactionprogressui.attach($CD(this,BulkActionsProgressUi._updateBulkActionProgressUi));InboxServices.Events.closebulkactionprogressui.attach($CD(this,BulkActionsProgressUi._closeBulkActionProgressUi))};BulkActionsProgressUi.dispose=function BulkActionsProgressUi$dispose(){BulkActionsProgressUi._resetStateVariables()};BulkActionsProgressUi._resetStateVariables=function BulkActionsProgressUi$_resetStateVariables(){InboxServices.stopAction=false;BulkActionsProgressUi.ui=null;BulkActionsProgressUi.fullMsgTmpl=null;BulkActionsProgressUi.actionMsgTmpl=null;BulkActionsProgressUi.actionOrFldrEncoded=null;BulkActionsProgressUi.permanentDeleteMsgTmpl=null;BulkActionsProgressUi.isPermanentDelete=false};BulkActionsProgressUi._showBulkActionProgressUi=function BulkActionsProgressUi$_showBulkActionProgressUi(b){var d=b.isMark,g=b.actionOrFldr,e=b.isPermanentDelete,a=b.customUi;BulkActionsProgressUi.fullMsgTmpl=a?a.body:Page.decode(InboxPage.Strings.bulkProgressUiHtml);var c;if(e){BulkActionsProgressUi.isPermanentDelete=true;BulkActionsProgressUi.permanentDeleteMsgTmpl=Page.decode(InboxPage.Strings.bulkProgressUiPermanentDelMsg);c=Page.decode(InboxPage.Strings.bulkProgressUiPermanentDelMsgNoCount)}else{BulkActionsProgressUi.actionMsgTmpl=Page.decode(d?InboxPage.Strings.bulkProgressUiMarkAsMsg:InboxPage.Strings.bulkProgressUiMoveToMsg);BulkActionsProgressUi.actionOrFldrEncoded=g.encodeHtml();var f=Page.decode(d?InboxPage.Strings.bulkProgressUiMarkAsMsgNoCount:InboxPage.Strings.bulkProgressUiMoveToMsgNoCount);c=String.format(f,BulkActionsProgressUi.actionOrFldrEncoded)}var h=String.format(BulkActionsProgressUi.fullMsgTmpl,c);BulkActionsProgressUi.ui=new Alert(Alert.Importance.med,Page.decode(InboxPage.Strings.bulkProgressUiTitle),h,true,null);BulkActionsProgressUi.ui.addButton(Page.decode(InboxPage.Strings.bulkProgressUiStop),0,true,true);BulkActionsProgressUi.ui.setCallback(BulkActionsProgressUi._stopBulkActionProgressUi);BulkActionsProgressUi.ui.doNotAddCloseBox();BulkActionsProgressUi.ui.doNotDismissOnButtonClick();if(a&&a.position)BulkActionsProgressUi.ui.setPosition(a.position);gShowAlert(BulkActionsProgressUi.ui)};BulkActionsProgressUi._updateBulkActionProgressUi=function BulkActionsProgressUi$_updateBulkActionProgressUi(c){var a=c.count;if(a>0){var b=BulkActionsProgressUi.isPermanentDelete?BulkActionsProgressUi._getBulkActionPermanentDeleteProgressUiMsg(a):BulkActionsProgressUi._getBulkActionMarkOrMoveProgressUiMsg(a);BulkActionsProgressUi.ui.updateContents(b)}};BulkActionsProgressUi._getBulkActionPermanentDeleteProgressUiMsg=function BulkActionsProgressUi$_getBulkActionPermanentDeleteProgressUiMsg(a){return String.format(BulkActionsProgressUi.fullMsgTmpl,String.format(BulkActionsProgressUi.permanentDeleteMsgTmpl,a))};BulkActionsProgressUi._getBulkActionMarkOrMoveProgressUiMsg=function BulkActionsProgressUi$_getBulkActionMarkOrMoveProgressUiMsg(a){return String.format(BulkActionsProgressUi.fullMsgTmpl,String.format(BulkActionsProgressUi.actionMsgTmpl,a,BulkActionsProgressUi.actionOrFldrEncoded))};BulkActionsProgressUi._closeBulkActionProgressUi=function BulkActionsProgressUi$_closeBulkActionProgressUi(){if(BulkActionsProgressUi.ui)BulkActionsProgressUi.ui.close();BulkActionsProgressUi._resetStateVariables()};BulkActionsProgressUi._stopBulkActionProgressUi=function BulkActionsProgressUi$_stopBulkActionProgressUi(){InboxServices.stopAction=true;BulkActionsProgressUi.ui.disableButton(0);BulkActionsProgressUi.ui.updateContents(String.format(BulkActionsProgressUi.fullMsgTmpl,Page.decode(InboxPage.Strings.bulkProgressUiStoppingMsg)))};BulkActionsProgressUi._errorBulkActionProgressUi=function BulkActionsProgressUi$_errorBulkActionProgressUi(){BulkActionsProgressUi._closeBulkActionProgressUi()};BulkActionsProgressUi.isVisible=function BulkActionsProgressUi$isVisible(){return BulkActionsProgressUi.ui&&BulkActionsProgressUi.ui.isShown()};var DemandLoadHandler={};DemandLoadHandler.initialize=function DemandLoadHandler$initialize(a){DemandLoadHandler._contentObj=a;DemandLoadHandler._endDemandLoadDelegate=$CD(this,DemandLoadHandler._endDemandLoad);DemandLoadServices.Events.enddemandload.attach(DemandLoadHandler._endDemandLoadDelegate)};DemandLoadHandler.dispose=function DemandLoadHandler$dispose(){DemandLoadServices.Events.enddemandload.detach($CD(this,DemandLoadHandler._endDemandLoad));DemandLoadHandler._endDemandLoadDelegate=DemandLoadHandler._contentObj=null};DemandLoadHandler.getContent=function DemandLoadHandler$getContent(a){return DemandLoadHandler._contentObj[a]};DemandLoadHandler.filterFetchedContentIds=function DemandLoadHandler$filterFetchedContentIds(a){for(var b=a.length-1;b>=0;b--)if(DemandLoadHandler.getContent(a[b]))a.splice(b,1);return a};DemandLoadHandler.demandLoadContent=function DemandLoadHandler$demandLoadContent(a,b,c){a=DemandLoadHandler.filterFetchedContentIds(a);if(a.length>0)DemandLoadServices.beginDemandLoad(a,b,c);else DemandLoadServices.Events.enddemandload.fire([null,b])};DemandLoadHandler.createFppCallback=function DemandLoadHandler$createFppCallback(b,a){return function(c,d){if(c.Content)DemandLoadServices.Events.enddemandload.fire([c.Content,a]);b(c,d)}};DemandLoadHandler._endDemandLoad=function DemandLoadHandler$_endDemandLoad(e){var a=e[0],b=e[1];for(var c in a)if(!FunctionHelper.isSpecialMember(a,c))DemandLoadHandler._contentObj[c]=a[c];if(b)for(var d=b.length-1;d>=0;d--){var f=b[d];if(f)f()}};InboxPage.initialize=function InboxPage$initialize(){InboxPage._initializePostProcData();window.attachEvent("onunload",InboxPage._onUnload);window.attachEvent("onbeforeunload",InboxPage._onBeforeUnload);window.attachEvent("onresize",InboxPage._onResize);var d=$("MainContent");if(d)d.attachEvent("onresize",InboxPage._onResize);if(Page.isPageLoaded)InboxPage._onLoad();else window.attachEvent("onload",InboxPage._onLoad);InboxPage._invokes=[];InboxPage.isReadingPaneOn="Bottom"==InboxPage.Config.readingPane.location||"Right"==InboxPage.Config.readingPane.location;InboxPage.hasSkyscraper=$css.has($("contentRight"),"WithSkyscraper");InboxPage.folderList=new FolderList($("folderListContainer"));InboxPage.quickViewList=new QuickViewList($("quickViewListContainer"));InboxPage.messageList=new MessageList($("messageListContainer"));InboxPage.readingPane=new ReadingPane($("readingPaneContainer"));InboxPage.selectionMsgPane=new SelectionMsgPane($("selMsgPane"));InboxPage.searchPane=new SearchPane($("searchPane"));InboxPage._ic={ctrlReady:false,ctxReady:false};$Do.when("h_icCtxReady",0,InboxPage._onIdentityContextReady);$Do.when("h_icCtrlReady",0,InboxPage._onIdentityControlsReady);$Do.register("h_icCtrlReady");if(window.ic_dinit)$Do.register("h_icCtxReady");InboxPage.advancedSearch=null;var c=function(a,b){return Control.invokeStatic("InboxActions",a,b)},b=function(){InboxPage.doPostProc=false};InboxPage.toolbar=new Toolbar($("toolbarContainer"),c);InboxPage.toolbar.setIgnoreActions(Toolbar.standardIgnoreList);InboxPage.toolbar.registerOnIgnoreHandler(b);if($("BottomToolbar")){InboxPage.bottomToolbar=new Toolbar($("BottomToolbar"),c);InboxPage.bottomToolbar.setIgnoreActions(Toolbar.standardIgnoreList);InboxPage.bottomToolbar.registerOnIgnoreHandler(b)}InboxPage.messageList.initFocusHandling();if(InboxPage.kbdInitMsgListShortcuts)InboxPage.messageList.initKeyboardHandling();InboxPage.readingPane.initFocusHandling();if(InboxPage.kbdShortcuts)KeyboardHandler.initialize(InboxPage.kbdShortcuts,function(c,b){var a=Control.invokeStatic("InboxActions",b,c,{isKbd:true,senderData:null});if(!a&&!InboxPage.doNotCloseMenu)$menu.closeCurrent();InboxPage.doNotCloseMenu=false;return a},KbdShortcutsTimeout,false,function(){return !BulkActionsProgressUi.isVisible()&&!AlertManager.getInstance().isAlertVisible()&&!WebDialogManager.getInstance().isDialogVisible()});InboxPage.Content={};DemandLoadHandler.initialize(InboxPage.Content);BulkActionsProgressUi.initialize();if(InboxPage.Config.aliasRenameFlow&&!Object.isNull(window.AliasRenameFlowUi))AliasRenameFlowUi.initialize();if(InboxPage.isReadMessageMode)InboxPage.showFullReadingPane(true,true);InboxPage.updateUi(true);Page.setupNetwork({onprecallback:InboxPage._onNetworkPreInvoke,onpostcallback:InboxPage._onNetworkPostCallback,onaftercallback:InboxPage._onPostInvoke});Control.onPreInvoke=InboxPage._onPreInvoke;Control.onPostInvoke=InboxPage._onPostInvoke;InboxServices.Events.endupdateui.attach($CD(this,InboxPage._endUpdateUi));InboxServices.Events.preendupdateui.attach($CD(this,InboxPage._preEndUpdateUi));InboxServices.Events.enddeleteallfromsender.attach($CD(this,InboxPage._endDeleteAllFromSender));InboxServices.Events.endmoveallfromsender.attach($CD(this,InboxPage._endMoveAllFromSender));InboxServices.Events.endundosendermovetoblocklist.attach($CD(this,InboxPage._endUndoSenderMoveToBlockList));InboxServices.Events.sethiddenbulkselectallstate.attach($CD(this,InboxPage._setHiddenBulkSelectAllState));Infopane.initialize();Infopane._instance.Events.onhide.attach($CD(this,InboxPage._onInfopaneVisibilityChanged));Infopane._instance.Events.onshow.attach($CD(this,InboxPage._onInfopaneVisibilityChanged));Page.initPageNavFppCallbackErrorSuppression();InboxPage.countUpdateHandlers={};InboxPage.countUpdateHandlers[InboxServices.Operations.MarkMessages]=function(a){return FolderQuickViewListHelper.getCountOffsetsForMark(a.mids,a.isBulk,a.asRead,null,a.markingDuplicates)};InboxPage.countUpdateHandlers[InboxServices.Operations.FlagMessages]=function(a){return FolderQuickViewListHelper.getCountOffsetsForFlagMessages(a.mids,a.isBulk,a.asFlagged,a.flaggingDuplicates)};InboxPage.countUpdateHandlers[InboxServices.Operations.MoveMessages]=function(a){return FolderQuickViewListHelper.getCountOffsetsForMove(a.mids,a.isBulk,a.toFid,a.movingDuplicates)};InboxPage.countUpdateHandlers[InboxServices.Operations.DeleteMessagePart]=function(a){return FolderQuickViewListHelper.getCountOffsetsForMove(a.mids,a.isBulk,InboxPage.Config.sysFldrs.trashFid)};InboxPage.countUpdateHandlers[InboxServices.Operations.MarkMessagePartForJmr]=function(a){return FolderQuickViewListHelper.getCountOffsetsForJmr(a.mids,a.isBulk,a.jmrType)};InboxPage.countUpdateHandlers[InboxServices.Operations.SetJunkStatus]=function(a){return FolderQuickViewListHelper.getCountOffsetsForJmr(a.mids,a.isBulk,a.jmrType)};if(!Browser.isSF)History.Events.onnavigate.attach(function(a){Control.invokeStatic("InboxPage","_onRestoreState",{},a)});LoadingIndicator.hide();$Cookie.deleteCookie(InboxPage.Config.konaRefreshCookie);if(InboxPage.readingPane.mode==ReadingPane.DELAY_LOADED_MODE){var a=function(){Control.invokeStatic("ReadingPane","doDelayLoad",{},InboxPage.readingPane)};if(InboxPage.Config.hasIc)$Do.when("$ic",0,a);else a()}else if(!InboxPage.isReadMessageMode&&InboxPage.Config.readingPane.autoSelectFirstMsg&&InboxPage.isReadingPaneOn)InboxPage._markCurrentAsRead();else if(InboxPage.isReadMessageMode)InboxPage._markCurrentAsRead(true);Page.oninitresize=InboxPage._onResize;if(InboxPage.upsellActionUrl)OptionsWriter.fireOption(String.format(InboxPage.upsellActionUrl,InboxPage.upsellShowAction));setTimeout(InboxPage.downloadBucket1,100)};InboxPage.onBucket1Download=function InboxPage$onBucket1Download(){InboxPage.initializeBucket1()};InboxPage.downloadBucket1=function InboxPage$downloadBucket1(){Loader.load(InboxPage.cssUrls,InboxPage.scriptUrls,InboxPage.onBucket1Download,$("bucket1"))};InboxPage.dispose=function InboxPage$dispose(){window.detachEvent("onunload",InboxPage._onUnload);window.detachEvent("onbeforeunload",InboxPage._onBeforeUnload);window.detachEvent("onload",InboxPage._onLoad);Infopane.cleanup();if(InboxPage.folderList)InboxPage.folderList.dispose();if(InboxPage.messageList){if(InboxPage.kbdInitMsgListShortcuts)InboxPage.messageList.disposeKeyboardHandling();InboxPage.messageList.disposeFocusHandling();if(InboxPage.messageList.disposeContextMenu)InboxPage.messageList.disposeContextMenu();InboxPage.messageList.dispose()}if(InboxPage.readingPane){InboxPage.readingPane.disposeFocusHandling();InboxPage.readingPane.dispose()}if(InboxPage.selectionMsgPane)InboxPage.selectionMsgPane.dispose();if(InboxPage.searchPane)InboxPage.searchPane.dispose();if(InboxPage.advancedSearch){InboxPage.advancedSearch.dispose();InboxPage.advancedSearch=null}if(InboxPage.splitter)InboxPage.splitter.dispose();if(InboxPage.dnd)InboxPage.disposeDragDrop();if(InboxPage.kbdShortcuts)KeyboardHandler.dispose();DemandLoadHandler.dispose();BulkActionsProgressUi.dispose();if(InboxPage.toolbar)InboxPage.toolbar.dispose();if(InboxPage.bottomToolbar)InboxPage.bottomToolbar.dispose();InboxPage.doNotCloseMenu=null};InboxPage._initializePostProcData=function InboxPage$_initializePostProcData(){InboxPage.postProcData={history:true,ads:true,delayBsiForReadMessage:false,uiUpdate:false,showLoading:true,hideInfoPane:false,updateSortUi:false,showAdvancedSearch:false,hideAdvancedSearch:false}};InboxPage._onPreInvoke=function InboxPage$_onPreInvoke(a,b,c){if(a=="Resize")return;if(InboxPage._invokes.length>5)InboxPage._invokes.shift();InboxPage._invokes.push({typeName:a,methodName:b,args:c});InboxPage.doPostProc=true;InboxPage._initializePostProcData();InboxPage.messageList.cancelContextMenuTimers()};InboxPage._onPostInvoke=function InboxPage$_onPostInvoke(b){if(b=="Resize")return;if(InboxPage.doPostProc){if(InboxPage.postProcData.showLoading&&!(typeof ToastManager!="undefined"&&ToastManager.getInstance().isToastVisible()))LoadingIndicator.show();if(InboxPage.postProcData.hideInfoPane){Infopane.hide();InboxPage.postProcData.hideInfoPane=false}if(InboxPage.advancedSearch&&InboxPage.advancedSearch.isLoaded()){var a=InboxPage.postProcData;if(a.showAdvancedSearch){InboxPage.advancedSearch.show();a.showAdvancedSearch=false}else if(a.hideAdvancedSearch){InboxPage.advancedSearch.hide();a.hideAdvancedSearch=false}}if(!Page.hasNetworkOpenRequests()){InboxPage.doPostProc=false;InboxPage._onUserActionComplete();InboxPage._initializePostProcData()}}};InboxPage._onUserActionComplete=function InboxPage$_onUserActionComplete(){var a=InboxPage.postProcData;if(a.history)setTimeout(InboxPage._saveState,1);if(a.uiUpdate)InboxPage.updateUi(false);$CSIPerf.addCsd("f",InboxPage.messageList.getViewId());$CSIPerf.addCsd("rp",InboxPage.Config.readingPane.location);if(!InboxPage.isReadingPaneOn&&InboxPage.readingPane.isFullView&&$("readingPaneContainer"))setTimeout(function(){$BSI.reportEvent("ReadView.Messaging.Mail",{rmw:$("readingPaneContainer").scrollWidth})},500);$BSI.informPVHead();if(!a.delayBsiForReadMessage)setTimeout(function(){$BSI.informLoaded(!a.ads)},100);if(a.hideInfoPane)Infopane.hide();if(typeof ToastManager!="undefined")ToastManager.getInstance().hideVisibleToast();LoadingIndicator.hide();$Do.when("$NM.clear")};InboxPage._onBeforeUnload=function InboxPage$_onBeforeUnload(){if(!InboxPage.doPostProc)InboxPage._createPageRefreshCookie()};InboxPage._onUnload=function InboxPage$_onUnload(){LoadingIndicator.hide();InboxPage.dispose()};InboxPage._onLoad=function InboxPage$_onLoad(){if(!Browser.isSF){if(""==$("isFirstPL").value){var a=History.getSerializedState();if(a)History.stateChanged(a)}$("isFirstPL").value="";History.isPageLoaded=true}LiveViews.start()};InboxPage._onResize=function InboxPage$_onResize(o,k,m){Resize._mainContentResize();var a=$("sortFilterContainer");if(a){var d=$("msgListMainContainer"),j=[],f=$tag(a,"SPAN"),l=f.length;for(var c=0;c<l;++c)if($css.has(f[c],"Fs_f"))j.push(f[c]);var g=$("searchPane"),i=$getDisplay(g),h=InboxPage.isReadingPaneOn&&(k||i),n=h?[]:[d];Resize.resizeToolbarForToolbarItems(a,j,n);if(m)d.style.top="0em";else if(h){var b;if(!i){a.style.top="";b=Resize.convertToEm(a.offsetTop)}else{b=Resize.convertToEm(g.offsetTop+g.offsetHeight);a.style.top=b+"em"}d.style.top=b+Resize.convertToEm(a.offsetHeight)+"em"}}var e=InboxPage.readingPane;if(e.isShowingMessage())setTimeout($CD(e,e.resetMessageWidths),1);InboxPage._maybeResizeMessageList()};InboxPage._maybeResizeMessageList=function InboxPage$_maybeResizeMessageList(){var d=InboxPage.messageList;if(d&&InboxPage.isReadingPaneOn){var a=$("messageListInnerContainer");if(a.children.length==3){var e=a.children[0],b=a.children[1],c=a.children[2];b.style.bottom=c.offsetHeight+"px";e.style.bottom=c.offsetHeight+b.offsetHeight+"px"}}};InboxPage.beginRefreshInbox=function InboxPage$beginRefreshInbox(j,e,a,h,c,g,b,i,d,f,k){InboxPage.readingPane.doubleClicked=false;InboxPage.readingPane.setHTMLed=false;InboxServices.beginRefreshInbox(j,e,a,h,c,g,b,i,d,f,k)};InboxPage.getEncodedEmails=function InboxPage$getEncodedEmails(b){var c=new Array(b.length);for(var a=0;a<b.length;a++)c[a]=b[a].encodeHtml();return c};InboxPage._setHiddenBulkSelectAllState=function InboxPage$_setHiddenBulkSelectAllState(a){InboxPage.messageList.setHiddenBulkSelectAll(a[0])};InboxPage._endDeleteAllFromSender=function InboxPage$_endDeleteAllFromSender(j){var b=j[0],a=DemandLoadHandler.getContent(HM.ContentId.CommonDeleteAndBlockAllFromSender),h=DemandLoadHandler.getContent(b["blockFromJunk"]?HM.ContentId.BlockAllFromSender:HM.ContentId.DeleteAllFromSender),c=1==b.senders.length,i=DemandLoadHandler.getContent(HM.ContentId.CommonSenderAction).emailSeparator,e=InboxPage.getEncodedEmails(b.senders).join(i),f=b.unblockedSndrs,g=1==b.processedCount?a.confirmOneMsg:String.format(a.confirmMultipleMsgsTmpl,b.processedCount),d;if(f)if(0==f.length)d=String.format(c?h.confirmDelAndAllBlockOneSenderTmpl:h.confirmDelAndAllBlockMultipleSenderTmpl,g,e,a.blkSndrsLink);else d=String.format(c?a.confirmDelAndNotBlockOneSenderTmpl:a.confirmDelAndNotBlockMultipleSenderTmpl,g,e,a.contactsLink,c?null:InboxPage.getEncodedEmails(f).join(i));else d=String.format(c?a.confirmDelOnlyOneSenderTmpl:a.confirmDelOnlyMultipleSenderTmpl,g,e);InboxPage.selectionMsgPane.showGeneralMsg(d,a.confirmHeader,true);InboxServices.Events.closebulkactionprogressui.fire([]);if(b.onCompletionUiUpdateFn)b.onCompletionUiUpdateFn(true)};InboxPage._endMoveAllFromSender=function InboxPage$_endMoveAllFromSender(h){var a=h[0],b=DemandLoadHandler.getContent(HM.ContentId.MoveAllFromSender),e=1==a.senders.length,g=DemandLoadHandler.getContent(HM.ContentId.CommonSenderAction).emailSeparator,f=InboxPage.getEncodedEmails(a.senders).join(g),c;if(e)c=a.processedCount==1?(c=b.confirmMoveOnlyOneSenderOneMsgTmpl):b.confirmMoveOnlyOneSenderMultipleMsgTmpl;else c=b.confirmMoveOnlyMultipleSendersTmpl;var d=String.format(c,f,FolderQuickViewListHelper.getFolderNameByFid(a.toFldr).encodeHtml(),e&&a.processedCount==1?null:a.processedCount);if(a.rulesCreated)d=[d,b.confirmRule].join(" ");InboxPage.selectionMsgPane.showGeneralMsg(d,b.confirmHeader,true);InboxServices.Events.closebulkactionprogressui.fire([]);if(a.onCompletionUiUpdateFn)a.onCompletionUiUpdateFn(true)};InboxPage._endUndoSenderMoveToBlockList=function InboxPage$_endUndoSenderMoveToBlockList(c){var b=c[0],a=Infopane.getInstance();a.setContent(b);a.show()};InboxPage._endUpdateUi=function InboxPage$_endUpdateUi(n){var c=n[0],q=n[1],b=n[2]||{};if(b.notByUser){var o=InboxPage.postProcData;o.hideInfoPane=false;o.history=false;o.ads=false}var k=c.MessageHtml,h=c.MessageListHtml,i=c.FolderListHtml,g=c.QuickViewListHtml,j=c.InfoPaneHtml,l=c.SuggestionHtml,r=c.MltRootHtml,s=c.MltSubHtml,f=c.BiciJsonConfig,a=0;InboxPage.messageList.cleanUpContextMenu();if(null!=i&&""!=i){InboxPage.folderList.setHTML(i);a=i.length;var d=InboxPage.advancedSearch;if(InboxPage.folderList.isSrch){SearchBox.setValue(InboxPage.folderList.srchKw);InboxPage.searchPane.setSrchQuery(InboxPage.folderList.srchKw);var t=b&&b.messageListRenderingInfo&&b.messageListRenderingInfo.AdvancedSearch;if(d&&d.isLoaded())d.setSearch(t)}else{SearchBox.resetValue();InboxPage.searchPane.setSrchQuery(null);if(d&&d.isLoaded())d.setSearch(null).hide()}}if(null!=g&&""!=g){InboxPage.quickViewList.setHTML(g);a=a+g.length}if(null!=h&&""!=h){InboxPage.messageList.setHTML(h,q&&!InboxPage.isUnreadFilterOrFlaggedQuickView());a=a+h.length;InboxPage.postProcData.updateSortUi=true;var u=InboxPage.messageList;FilterSelector.updateState(u.fltid);InboxPage._maybeUpdateMessageListTitleHtml(r,s);InboxPage._maybeResizeMessageList()}if(b.isHiddenBulk)InboxServices.Events.sethiddenbulkselectallstate.fire([false]);var m=null!=l&&""!=l;if(!m||!InboxPage.isReadingPaneOn)if(null!=k&&""!=k){var e=InboxPage.readingPane;a=a+k.length;e.reset();if(!InboxPage.isReadingPaneOn){InboxPage.showFullReadingPane(true);if(Browser.isIE6)Resize.Element_OnResize($("readingPaneSplitPane"),false)}InboxPage.postProcData.delayBsiForReadMessage=true;e.setHTML(k);InboxPage.resetContentHeight($("readingPaneContentContainer"));if(e.mode==ReadingPane.DELAY_LOADED_MODE)setTimeout(function(){ReadingPane.doDelayLoad(e)},1);else if(e.mode==ReadingPane.MESSAGE_MODE)InboxPage._markCurrentAsRead()}else if(!b.isAutoRefresh&&!b.hasConfirmationMsg&&!InboxPage.messageList.areAnyItemsSelected()&&!m)InboxPage.messageList.updateSelectedCount();if(null!=j&&""!=j){InboxPage.showInfoPane(j);a=a+j.length}if(m||b.hasConfirmationMsg){InboxPage.selectionMsgPane.showGeneralMsg(l,null);var p=$("NoMsgs");if(p)$setDisplay(p,false)}else if(InboxPage.messageList.getItemCount()==0)InboxPage.selectionMsgPane.hide();if(-1==InboxPage.messageList.getSelectionIndex()&&InboxPage.readingPane.isFullView&&!b.markSenderAsSafe&&b.jmrType!=HM.JmrType.Unsubscribe)InboxPage.showFullReadingPane(false);if(f&&f!=""){f=Object.fromJSON(f);$Utility.updateObject($Config,f.$Config)}$CSIPerf.payloadLength=a;InboxPage.postProcData.uiUpdate=true};InboxPage.callDelayedBsi=function InboxPage$callDelayedBsi(){setTimeout(function(){$BSI.informLoaded(!InboxPage.postProcData.ads);InboxPage._initializePostProcData()},100)};InboxPage.showInfoPane=function InboxPage$showInfoPane(b){var a=Infopane.getInstance();a.setContent(b);a.show()};InboxPage._onInfopaneVisibilityChanged=function InboxPage$_onInfopaneVisibilityChanged(){if(Page.getLayout().indexOf("Unmanaged")>=0)UnmanagedFooter.resize()};InboxPage._maybeUpdateMessageListTitleHtml=function InboxPage$_maybeUpdateMessageListTitleHtml(b,d){var a=$("messageListTitle");if(a){var c=$getDescendantByAttr(a,"SPAN","rt","rt");if(null!=b&&c)c.innerHTML=b;var e=$getDescendantByAttr(a,"SPAN","sb","sb");if(null!=d&&e)e.innerHTML=d}};InboxPage._preEndUpdateUi=function InboxPage$_preEndUpdateUi(c){var b=c[0],e=c[1],a=c[2],d=InboxPage.countUpdateHandlers[e];if(typeof d!="undefined"&&FolderQuickViewListHelper.canUpdateFolderQuickViewCounts(a.mids,a.isBulk))if(!b||!b.FolderListHtml&&!b.QuickViewListHtml){var f=d(a);FolderQuickViewListHelper.updateCounts(f)}if(e==InboxServices.Operations.MoveMessages)if(!b||!b.MessageListHtml)InboxPage.messageList.simulateMove(a.mids,a.isBulk,a.fromFid,a.toFid,a.itemRenderingInfo)};InboxPage._scrollToTop=function InboxPage$_scrollToTop(){var a=Browser.isSF?document.body:$tag(document,"HTML")[0];a.scrollTop=0};InboxPage._markCurrentAsRead=function InboxPage$_markCurrentAsRead(d){var e=InboxPage.readingPane.mode;if(e!=ReadingPane.MESSAGE_MODE)return;var a=InboxPage.readingPane;if(a.isVoicemail())return;var b=a.getUnreadMids();FolderQuickViewListHelper.updateCounts(FolderQuickViewListHelper.getCountOffsetsForMark(b.unreadMids,false,true,d,b.foundDupes));var c=a.getItemId();if(b.foundDupes&&a.numMessageParts()==1)c=a.secretCid;InboxPage.messageList.updateReadState([c],false,true);a.initializeMsgPartsAsRead();InboxPage.maybeDisableRefreshForReadAction()};InboxPage.formatMsgWithGenericFolderOrViewString=function InboxPage$formatMsgWithGenericFolderOrViewString(a){return String.format(a,Page.decode(InboxPage.isQuickViewFilterOrSearch()?InboxPage.Strings.genericView:InboxPage.Strings.genericFolder))};InboxPage.isQuickViewFilterOrSearch=function InboxPage$isQuickViewFilterOrSearch(){return !InboxPage.areNoFiltersApplied()||InboxPage.quickViewList.qvid||InboxPage.isSearch()};InboxPage.areNoFiltersApplied=function InboxPage$areNoFiltersApplied(){var a=InboxPage.messageList.fltid;return !a||InboxPage.Config.filters.noneFltid==a};InboxPage.isSearch=function InboxPage$isSearch(){return InboxPage.folderList.fid==InboxPage.Config.sysFldrs.searchFid};InboxPage.isUnreadFilterOrFlaggedQuickView=function InboxPage$isUnreadFilterOrFlaggedQuickView(){return InboxPage.messageList.fltid==InboxPage.Config.filters.unreadFltid||InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid};InboxPage.maybeDisableRefreshForReadAction=function InboxPage$maybeDisableRefreshForReadAction(){if(InboxPage.messageList.fltid==InboxPage.Config.filters.unreadFltid)InboxPage.messageList.disableRefreshForMl=true};InboxPage.maybeDisableRefreshForFlagAction=function InboxPage$maybeDisableRefreshForFlagAction(){if(InboxPage.quickViewList.qvid==InboxPage.Config.quickViews.flaggedQvid)InboxPage.messageList.disableRefreshForMl=true};InboxPage.showFullReadingPane=function InboxPage$showFullReadingPane(a,c){var b=a!=InboxPage.readingPane.isFullView;if(a){InboxPage.readingPane.showFullView();InboxPage.messageList.hide()}else{InboxPage.messageList.show();InboxPage.readingPane.hideFullView()}if(InboxPage.isReadingPaneOn&&!InboxPage.readingPane.isFullView){$css.remove($("readingPaneSplitter"),"SplitterBarHidden");InboxPage.initSplitter()}else $css.add($("readingPaneSplitter"),"SplitterBarHidden");if(!c&&b&&!InboxPage.isReadingPaneOn)setTimeout(InboxPage._scrollToTop,1)};InboxPage._onIdentityControlsReady=function InboxPage$_onIdentityControlsReady(){InboxPage._ic.ctrlReady=true;InboxPage._InitICsIfReady()};InboxPage._onIdentityContextReady=function InboxPage$_onIdentityContextReady(){InboxPage._ic.ctxReady=true;InboxPage._InitICsIfReady()};InboxPage._InitICsIfReady=function InboxPage$_InitICsIfReady(){var a=InboxPage._ic;if(a.ctrlReady&&a.ctxReady&&typeof $ic!="undefined"&&typeof $ic.ic!="undefined")$ic.ic.init()};InboxPage._createPageRefreshCookie=function InboxPage$_createPageRefreshCookie(){var a=InboxPage._getCurrentState();a["n"]=Page.queryString.nonce;a["fullView"]=InboxPage.readingPane.isFullView;$Cookie.setCookieValues(InboxPage.Config.konaRefreshCookie,a)};InboxPage._saveState=function InboxPage$_saveState(){if(Browser.isSF)return;History.addNavigationStep(InboxPage._getCurrentState())};InboxPage._getCurrentState=function InboxPage$_getCurrentState(){var c=InboxPage.messageList,d=InboxPage.folderList,h=InboxPage.quickViewList,e=InboxPage.readingPane,f=InboxPage.advancedSearch,b={mid:"",mad:"",cid:"",fid:d.fid,qvid:h.qvid,fltid:c.fltid,sBy:c.sBy,sAsc:c.sAsc+"",pDir:c.pDir+"",aMid:c.aMid,aDate:c.aDate,pCur:c.pCur+"",isSrch:d.isSrch+"",fav:d.isFavoriteSelected+""},a=f?f.getSearch():null;b.isAdv=a?"1":"";b.advKwds=a&&a.Keywords?a.Keywords+"":"";b.advFrom=a&&a.From?a.From+"":"";b.advTo=a&&a.To?a.To+"":"";b.advSbj=a&&a.Subject?a.Subject+"":"";b.advFld=a&&a.Folder?a.Folder+"":"";b.advBeg=a&&a.DateBegin?a.DateBegin+"":"";b.advEnd=a&&a.DateEnd?a.DateEnd+"":"";b.advAtt=a&&a.HasAttachment?a.HasAttachment+"":"";b.srchKw=d.srchKw;if(e.isShowingMessage()){var g=e.getActionableMsgPart();b.mid=g.mid;b.mad=g.auxData;if(e.cid)b.cid=e.cid}return b};InboxPage._onRestoreState=function InboxPage$_onRestoreState(a){InboxPage.postProcData.history=false;if(window["WebDialogManager"])WebDialogManager.getInstance().hideVisibleDialog();if(window["AlertManager"])AlertManager.getInstance().hideVisibleAlert();if(window["TooltipManager"])TooltipManager.getInstance().hideVisibleTooltip();a.sAsc=a.sAsc=="true";a.isSrch=a.isSrch=="true";var b=InboxPage.createMessageListRenderingInfo(false);b.FolderId=a.fid;b.QuickViewId=a.qvid;b.FilterId=a.fltid;b.PageDirection=a.pDir;b.SortKey=a.sBy;b.SortAsc=a.sAsc;b.AnchorId=a.aMid;b.AnchorDate=a.aDate;b.PageNumCurrent=a.pCur;b.IsSearchResults=a.isSrch;b.SearchKeyword=a.srchKw;b.IsFavoriteSelected=a.fav;if(a.isAdv){var c=new HM.AdvancedSearch;c.From=a.advFrom;c.Keywords=a.advKwds;c.DateBegin=a.advBeg;c.DateEnd=a.advEnd;c.Subject=a.advSbj;c.To=a.advTo;c.HasAttachment=a.advAtt;c.Folder=a.advFld;b.AdvancedSearch=c;InboxPage.postProcData.showAdvancedSearch=true}else InboxPage.postProcData.hideAdvancedSearch=true;var d=null,e=false,f=InboxPage.messageList.conv&&a.cid;if(f){d=InboxPage.createConversationRenderingInfo(false);d.ConversationId=a.cid;d.FolderId=a.fid;e=true}else if(a.mid){d=InboxPage.createMessageRenderingInfo();d.MessageId=a.mid;d.FolderId=a.fid;d.AuxData=null;e=true}InboxPage.beginRefreshInbox(a.fid!=InboxPage.folderList.fid||a.qvid!=InboxPage.quickViewList.qvid,true,b,e,d,false,f)};InboxPage.updateUi=function InboxPage$updateUi(a){setTimeout(InboxToolbar.updateToolbarState,1);if(InboxPage.postProcData.updateSortUi)InboxPage.messageList.updateSortMenu();if(a||InboxPage.folderList.isSrch)FolderQuickViewListHelper.scrollIntoView();if(a)InboxPage.readingPane.handlePageLoadWithMsg()};InboxPage.createMessageListRenderingInfo=function InboxPage$createMessageListRenderingInfo(b,d){var a=new HM.MessageListRenderingInfo,c=InboxPage.messageList,e=InboxPage.folderList,f=InboxPage.quickViewList;a.FolderId=b?e.fid:null;a.QuickViewId=b?f.qvid:null;a.FilterId=b?c.fltid:null;a.SortKey=b?c.sBy:"Date";a.SortAsc=b?c.sAsc:false;a.IsSearchResults=b?e.isSrch:false;a.SearchKeyword=b?e.srchKw:"";a.AdvancedSearch=b?InboxPage.advancedSearch&&InboxPage.advancedSearch.getSearch():null;a.AutoSelectMessageIndex=InboxPage.Config.readingPane.autoSelectFirstMsg&&InboxPage.isReadingPaneOn?0:-1;a.ReadingPaneLocationMember=InboxPage.Config.readingPane.location;a.PageDirection=b&&!d?c.pDir:"FirstPage";a.ExtraFetchCount=InboxPage.Config.extraMessageCount;a.PageNumCurrent=b&&!d?c.pCur:1;a.NumberOfMessages=b&&!d?c.mCt:-1;a.AnchorId=b&&!d?c.aMid:null;a.AnchorDate=b&&!d?c.aDate:null;a.BulkSelectAllTimestamp=null;a.LastUpdateTimestamp=null;a.IsFavoriteSelected=b?e.isFavoriteSelected:null;return a};InboxPage.createMoveOrJunkActionMessageListRenderingInfo=function InboxPage$createMoveOrJunkActionMessageListRenderingInfo(c,b,e){var d=c.isBulk&&!b,a=InboxPage.createMessageListRenderingInfo(true,d);if(e&&!d)InboxPage.configureAutoSelect(a,b);if(!c.isBulk&&!b&&a.NumberOfMessages>=0)a.NumberOfMessages-=c.mids.length;a.LastUpdateTimestamp=InboxPage.messageList.kDate;return a};InboxPage.createConversationRenderingInfo=function InboxPage$createConversationRenderingInfo(b){var a=new HM.ConversationRenderingInfo;a.ConversationId=b?InboxPage.readingPane.cid:null;a.FolderId=b?InboxPage.folderList.fid:null;a.MarkAsRead=true;a.SenderEmail=null;return a};InboxPage.createMessageRenderingInfo=function InboxPage$createMessageRenderingInfo(){var a=new HM.MessageRenderingInfo;a.MessageId=null;a.FolderId=null;a.AllowUnsafeContent=false;a.OverrideCodepage=-1;a.AuxData=null;a.MarkAsRead=true;a.SenderEmail=null;return a};InboxPage.createBatchInfo=function InboxPage$createBatchInfo(){var a=new HM.BatchInfo;a.Timestamp=InboxPage.messageList.saDate;a.AnchorDate=null;a.AnchorId=null;a.ProcessedCount=0;a.IsLastBatch=false;a.SenderSearch=null;return a};InboxPage.createPostActionInfo=function InboxPage$createPostActionInfo(b,a,c){return {nextActionFn:b,onCompletionEvent:a,args:c}};InboxPage.createBulkMoveDataPoints=function InboxPage$createBulkMoveDataPoints(d,b,c){var a={BulkType:d};if(b)a["BulkEntry"]=b;if(c)a["BulkNext"]=c;return a};InboxPage.configureAutoSelect=function InboxPage$configureAutoSelect(a,b){a.AutoSelectMessageIndex=InboxPage.isReadingPaneOn||InboxPage.readingPane.isFullView?b?InboxPage.messageList.getSelectionIndex():InboxPage.messageList.getAutoSelectIndex():-1};InboxPage.createMessageAuxData=function InboxPage$createMessageAuxData(a){var b=null;if(null!=a&&""!=a){b=new HM.HmAuxData;b.Value=a}return b};InboxPage.getSelectedMessageData=function InboxPage$getSelectedMessageData(){if(InboxPage.readingPane.isShowingMessage())return InboxPage.readingPane.getSelectedMessageData();else return InboxPage.messageList.getSelectedMessageData()};InboxPage.verifyMinimumSelection=function InboxPage$verifyMinimumSelection(){var a=!InboxPage.isSearch()?InboxPage.getSelectedMessageData():InboxPage.messageList.getSelectedMessageData();if(!a.isBulk&&0==a.mids.length){InboxPage.doPostProc=false;alert(Page.decode(InboxPage.Strings.noMessagesSelected));return null}return a};InboxPage.allowAction=function InboxPage$allowAction(b,d){if(!InboxPage.Config.isThrottleActionsEnabled)return true;var c=(new Date).getTime(),a=InboxPage._throttleData;if(a.action==b&&a.msgId==d&&c-a.initialTime<InboxPage.Config.throttleActionTime){a.count++;if(a.count>InboxPage.Config.maxThrottleActions){if(!a.isThrottled){$WebWatson.submit("action throttled: "+b,null,null,null,null,null,null,true);a.isThrottled=true}InboxPage.doPostProc=false;return false}}else{a.action=b;a.msgId=d;a.count=1;a.initialTime=c;a.isThrottled=false}return true};InboxPage._throttleData={action:null,msgId:null,count:0,initialTime:null,isThrottled:false};InboxPage._getUserActionsStack=function InboxPage$_getUserActionsStack(){return InboxPage._invokes};FireAnt.Debug.CB.getUserActions=InboxPage._getUserActionsStack;InboxPage._postWatsonCallback=function InboxPage$_postWatsonCallback(){InboxPage.postProcData.history=false;InboxPage.postProcData.hideInfoPane=false};FireAnt.Debug.CB.postWatsonCallback=InboxPage._postWatsonCallback;InboxPage._onNetworkPreInvoke=function InboxPage$_onNetworkPreInvoke(){InboxPage.postProcData.hideInfoPane=true;Page.fppPending(true);Page.stopCaching()};InboxPage._onNetworkPostCallback=function InboxPage$_onNetworkPostCallback(){Page.fppPending(false);Page.startCaching()};InboxPage._postReportErrorCallback=function InboxPage$_postReportErrorCallback(){InboxPage.postProcData.hideInfoPane=false};Page.postReportErrorCallback=InboxPage._postReportErrorCallback;Type.createStaticClass(InboxPage,"InboxPage");function $showIN(){if(typeof Infopane!="undefined"&&Infopane._instance){Infopane._instance.show();$css.remove($("wlidContainer"),"WlidContainer")}}function $hideIN(){if(typeof Infopane!="undefined"&&Infopane._instance){Infopane._instance.forceHide();$css.remove($("wlidContainer"),"WlidContainer");$css.remove($("contentRight"),"HasWlidAbove")}}Type.createStaticClass(InboxServices,"InboxServices");if(!Browser.isIE)InboxPage.downloadBucket1=function InboxPage$downloadBucket1(){Loader.load(InboxPage.cssUrls,InboxPage.scriptUrls,InboxPage.onBucket1Download)};InboxPage.initSplitter=function(){};InboxPage.onSubmitReadingPaneOptionClicked=function(){};InboxPage.onSubmitChangeConversationView=function(){};InboxPage.onSubmitSortConversationView=function(){};InboxPage.onSubmitUpsellConversationView=function(){};InboxPage.makeMenuScroll=function(){};InboxPage.resetSkyscraperScroll=function(){};InboxPage.resetContentHeight=function(){};InboxPage.initialize()